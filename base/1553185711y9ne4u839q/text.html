<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="articleBody"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">С</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">ервер VNC или удаленный рабочий стол на Ubuntu</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1080454639.png" /><span style=" font-family:'Ubuntu';"> Опубликовано: 22.09.2018 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Тематические термины: </span><a href="https://www.dmosk.ru/terminus.php?object=linux"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Linux</span></a><span style=" font-family:'Ubuntu';">, </span><a href="https://www.dmosk.ru/terminus.php?object=ubuntu"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Ubuntu</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В статье рассказано о настройке возможности подключения к Ubuntu по удаленному рабочему столу (аналогично RDP в Windows). Примеры команд выполнены на Linux Ubuntu 18.04. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.dmosk.ru/miniinstruktions.php?mini=vnc-server-ubuntu#install"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Установка и настройка</span></a><span style=" font-family:'Ubuntu';"><br />    </span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=vnc-server-ubuntu#install-xfce"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">XFCE</span></a><span style=" font-family:'Ubuntu';"><br />    </span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=vnc-server-ubuntu#install-gnome"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Gnome</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=vnc-server-ubuntu#client"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Проверка настройки</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=vnc-server-ubuntu#autorun"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Автозапуск VNC</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="install"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">У</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">становка и настройка VNC сервера</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Рассмотрим два варианта использования графической оболочки — xfce и gnome. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если используется брандмауэр, добавляем правило: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">iptables -A INPUT -p tcp --dport 5901 -j ACCEPT </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* в данном примере, мы разрешаем входящие соединения на порту </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">5901</span><span style=" font-family:'Ubuntu'; font-style:italic;">. Для работы с несколькими портами, добавляем их по аналогии.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="install-xfce"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">X</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">FCE</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Установка</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Установку выполняем следующей командой: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt install xfce4 xfce4-goodies tightvncserver </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Задаем пароль для доступа по удаленному рабочему столу. Для этого вводим команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vncserver </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На запрос пароля вводим его дважды. После будет предложено ввод пароля для гостевого доступа — можно согласиться (</span><span style=" font-family:'Ubuntu'; font-weight:600;">y</span><span style=" font-family:'Ubuntu';">) и ввести пароль или отказаться (</span><span style=" font-family:'Ubuntu'; font-weight:600;">n</span><span style=" font-family:'Ubuntu';">). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Настройка</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для начала, останавливаем экземпляр VNC сервера: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vncserver -kill :1 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* экземпляр </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">:1</span><span style=" font-family:'Ubuntu'; font-style:italic;">, по умолчанию, слушает на порту 5900+1 (5901).</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Настраиваем VNC сервер: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vi ~/.vnc/xstartup </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">#!/bin/bash<br />xrdb $HOME/.Xresources<br />startxfce4 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Снова запускаем vncserver: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vncserver </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="install-gnome"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">G</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">nome</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Установка</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Установку выполняем следующей командой: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt install ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal vnc4server </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Задаем пароль для доступа по удаленному рабочему столу. Для этого вводим команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vncserver </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На запрос пароля вводим его дважды. После будет предложено ввод пароля для гостевого доступа — можно согласиться (</span><span style=" font-family:'Ubuntu'; font-weight:600;">y</span><span style=" font-family:'Ubuntu';">) и ввести пароль или отказаться (</span><span style=" font-family:'Ubuntu'; font-weight:600;">n</span><span style=" font-family:'Ubuntu';">). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Настройка</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для начала, останавливаем экземпляр VNC сервера: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vncserver -kill :1 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* экземпляр </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">:1</span><span style=" font-family:'Ubuntu'; font-style:italic;">, по умолчанию, слушает на порту 5900+1 (5901).</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Настраиваем VNC сервер для текущего пользователя: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vi ~/.vnc/xstartup </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">#!/bin/sh<br /># Uncomment the following two lines for normal desktop:<br /># unset SESSION_MANAGER<br /># exec /etc/X11/xinit/xinitrc<br /><br />[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup<br />[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources<br />xsetroot -solid grey<br />vncconfig -iconic &amp;<br />x-terminal-emulator -geometry 80x24+10+10 -ls -title &quot;$VNCDESKTOP Desktop&quot; &amp;<br />x-window-manager &amp;<br /><br />gnome-panel &amp;<br />gnome-settings-daemon &amp;<br />metacity &amp; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Снова запускаем vncserver: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vncserver </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="client"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">одключаемся к удаленному рабочему столу</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Запускаем клиент VNC. Например, в Linux — Remmina, в Windows — </span><a href="https://www.tightvnc.com/download.php"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">TightVNC Viewer</span></a><span style=" font-family:'Ubuntu';"> или </span><a href="https://www.realvnc.com/en/connect/download/viewer/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">RealVNC</span></a><span style=" font-family:'Ubuntu';">. Вводим IP-адрес компьютера с VNC и номер порта: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1439507005.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Будет запрошен пароль — вводим тот, что устанавливали при настройке. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="autorun"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">А</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">втозапуск сервиса</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Чтобы VNC сервер запускался после перезагрузки, создаем новый юнит в systemd: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vi /etc/systemd/system/vncserver.service </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">[Unit]<br />Description=VNC server<br />After=syslog.target network.target<br /><br />[Service]<br />Type=forking<br />User=root<br />PAMName=login<br />PIDFile=/root/.vnc/%H:%i.pid<br />ExecStartPre=-/usr/bin/vncserver -kill :1 &gt; /dev/null 2&gt;&amp;1<br />ExecStart=/usr/bin/vncserver<br />ExecStop=/usr/bin/vncserver -kill :1<br /><br />[Install]<br />WantedBy=multi-user.target </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Обновляем systemd: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">systemctl daemon-reload </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Разрешаем автозапуск сервиса: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">systemctl enable vncserver </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p></body></html>