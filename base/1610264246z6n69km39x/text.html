<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="js-post-6435"></a><span style=" font-family:'Ubuntu';">О</span><span style=" font-family:'Ubuntu';">пишу свой опыт установки и настройки LXC в пространстве пользователя (не root). Поскольку работа с контейнером в пространстве root накладывает некоторые ограничения и не очень удобна (для меня).<br />Если я выбрал не тот путь или пошел слишком длинной дорогой, надеюсь соратники меня поправят.<br /><br />Что у меня есть:<br />Astra Linux Common Edition (Orel) 2.12.8;<br />Сетевой интерфейс eth0;<br />Учетная запись administrator.<br /><br />1) Для начала устанавливаю собственно пакет lxc:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo apt install lxc</span><span style=" font-family:'Ubuntu';"><br /><br />2) Проверяю всё ли прошло хорошо:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo lxc-checkconfig</span><span style=" font-family:'Ubuntu';"><br /><br />3) Заодно посмотрю какие доступны контейнеры:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo ls /usr/share/lxc/templates/</span><span style=" font-family:'Ubuntu';"><br /><br />4) Поскольку я не исключаю возможности в дальнейшем создавать контейнеры в пространстве root, то сразу сконфигурирую настройки по умолчанию для root. Для этого приведу файл &quot;/etc/lxc/default.conf&quot; к такому виду:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo nano /etc/lxc/default.conf</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.type = veth</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.link = br0</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.flags = up </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">5) Создаю сетевой мост на интерфейсе eth0, в который будут подключаться контейнеры. Для этого приведу файл &quot;/etc/network/interfaces&quot; к такому виду:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo nano /etc/network/interfaces</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">source /etc/network/interfaces.d/*</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">auto lo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">iface lo inet loopback</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">auto br0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">iface br0 inet dhcp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        bridge_ports eth0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        bridge_stp off</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        bridge_fd 0</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        bridge_maxwait 0 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">6) Перезагружаю систему, чтобы сетевые настройки вступили в силу (Результат команды &quot;sudo service networking restart&quot; немного насторожил, поэтому всё таки лучше перезагружу).<br /><br />7) Теперь создаю каталог, в котором будут лежать настройки по умолчанию контейнеров в пространстве пользователя (administrator). (Взято </span><a href="https://losst.ru/kontejnery-linux-ustanovka-i-nastrojka-lxc"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">отсюда</span></a><span style=" font-family:'Ubuntu';">)<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">mkdir -p ~/.config/lxc</span><span style=" font-family:'Ubuntu';"><br /><br />8) Теперь сконфигурирую настройки по умолчанию для контейнеров в пространстве пользователя (administrator). (Взято </span><a href="https://losst.ru/kontejnery-linux-ustanovka-i-nastrojka-lxc"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">отсюда</span></a><span style=" font-family:'Ubuntu';">)<br />Настраиваю пользовательские пространства имен:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">echo &quot;lxc.id_map = u 0 100000 65536&quot; &gt;&gt; ~/.config/lxc/default.conf<br />echo &quot;lxc.id_map = g 0 100000 65536&quot; &gt;&gt; ~/.config/lxc/default.conf</span><span style=" font-family:'Ubuntu';"><br />Настраиваю сеть:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">echo &quot;lxc.network.type = veth&quot; &gt;&gt; ~/.config/lxc/default.conf<br />echo &quot;lxc.network.link = br0&quot; &gt;&gt; ~/.config/lxc/default.conf<br />echo &quot;lxc.network.flags = up&quot; &gt;&gt; ~/.config/lxc/default.conf</span><span style=" font-family:'Ubuntu';"><br /><br />9) Затем в файле /etc/lxc/lxc-usernet нужно разрешить использовать сетевые интерфейсы текущему пользователю, чтобы получить возможность запускать контейнер без root прав. (Взято </span><a href="https://losst.ru/kontejnery-linux-ustanovka-i-nastrojka-lxc"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">отсюда</span></a><span style=" font-family:'Ubuntu';">)<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">echo &quot;$USER veth br0 2&quot; | sudo tee -a /etc/lxc/lxc-usernet</span><span style=" font-family:'Ubuntu';"><br /><br />10) Для того чтобы пространства имен пользователей linux в контейнере работали, нужно присвоить своему пользователю подпространство UID и GID 100000-165536. (Взято </span><a href="https://losst.ru/kontejnery-linux-ustanovka-i-nastrojka-lxc"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">отсюда</span></a><span style=" font-family:'Ubuntu';">)<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo usermod --add-subuids 100000-165536 $USER<br />sudo usermod --add-subgids 100000-165536 $USER</span><span style=" font-family:'Ubuntu';"><br /><br />11) Теперь запускаю LXC:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo service lxc start</span><span style=" font-family:'Ubuntu';"><br /><br />12) Установлю контейнер в пространстве пользователя на базе ubuntu 18.10 с архитектурой i386 и назову его &quot;ubuntu02&quot;:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-create -t download -n ubuntu02 -- --dist ubuntu --release cosmic --arch i386</span><span style=" font-family:'Ubuntu';"><br /><br />13) После установки сразу задам пароль &quot;12345678&quot; для пользователя &quot;ubuntu&quot; и пользователя &quot;root&quot; в контейнере. Для этого отредактирую файл &quot;~/.local/share/lxc/ubuntu02/rootfs/etc/shadow&quot;, а именно приведу строки с этими пользователями к виду:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo nano ~/.local/share/lxc/ubuntu02/rootfs/etc/shadow</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">root:$6$THtH1yko$.rDzWsGt3Cem1.6iRBs/qklDVs2tGWvZzvYekIuUJo6tWH/xdW5vyGf57CJhIfxZZ.tWMyJJ9BxQlvAnGgrn50:17999:0:99999:7:::</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ubuntu:$6$THtH1yko$.rDzWsGt3Cem1.6iRBs/qklDVs2tGWvZzvYekIuUJo6tWH/xdW5vyGf57CJhIfxZZ.tWMyJJ9BxQlvAnGgrn50:17999:0:99999:7::: </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">14) Проверю конфигурацию контейнера, она должна иметь такой вид:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">nano ~/.local/share/lxc/ubuntu02/config</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># Distribution configuration</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.include = /usr/share/lxc/config/ubuntu.common.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.include = /usr/share/lxc/config/ubuntu.userns.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.arch = linux32</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># Container specific configuration</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 0 100000 65536</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 0 100000 65536</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.rootfs = /home/administrator/.local/share/lxc/ubuntu02/rootfs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.rootfs.backend = dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.utsname = ubuntu02</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># Network configuration</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.type = veth</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.link = br0</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.flags = up </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь если попытаться запустить контейнер от пользователя без прав root (administrator), то появятся ошибки, суть которых заключается в том, что у текущего пользователя не хватает прав. Если бы у текущего пользователя были права root, то контейнер бы запустился. Но если попытаться запустить этот контейнер от root, то root будет искать контейнер по адресу &quot;/var/lib/lxc/&quot;, а там его соответственно нет. Решение нашел </span><a href="https://unix.stackexchange.com/questions/176973/userns-container-fails-to-start-how-to-track-down-the-reason"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">здесь</span></a><span style=" font-family:'Ubuntu';">, адаптировав его под ситуацию.<br /><br />15) Добавлю прав домашней директории:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo chmod -R o+X $HOME</span><span style=" font-family:'Ubuntu';"><br /><br />Теперь нужно установить пакет cgmanager.<br /><br />16) Пакета cgmanager в репозитории astra linux нет. Поэтому подключаю репозиторий debian:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo echo &quot;deb </span><a href="https://mirror.yandex.ru/debian/"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">https://mirror.yandex.ru/debian/</span></a><span style=" font-family:'Ubuntu'; font-weight:600;"> stretch main contrib non-free&quot; &gt;&gt; /etc/apt/sources.list<br />sudo apt update</span><span style=" font-family:'Ubuntu';"><br /><br />17) Устанавливаю пакет:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo apt install cgmanager</span><span style=" font-family:'Ubuntu';"><br /><br />18) Теперь отключаю репозиторий debian, для этого я вручную отредактирую файл /etc/apt/sources.list (удалю последнюю строку):<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo vi /etc/apt/sources.list<br />sudo apt update</span><span style=" font-family:'Ubuntu';"><br /><br />19) Теперь запускаю cgmanager:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo service cgmanager start</span><span style=" font-family:'Ubuntu';"><br /><br />20) Теперь нужно выполнить &quot;заветные&quot; три команды, суть которых я не до конца понял:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo cgm create all user<br />sudo cgm chown all user $(id -u) $(id -g)<br />cgm movepid all user $$</span><span style=" font-family:'Ubuntu';"><br /><br />21) И теперь наконец-то запускаю контейнер:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start -n ubuntu02 -d</span><span style=" font-family:'Ubuntu';"><br /><br />Вот теперь вроде бы всё хорошо, но не совсем. После перезагрузки системы для запуска контейнера необходимо выполнить такой список команд:<br />sudo service lxc start<br />sudo service cgmanager start<br />sudo cgm create all user<br />sudo cgm chown all user $(id -u) $(id -g)<br />cgm movepid all user $$<br />lxc-start -n ubuntu02 -d<br /><br />И это совсем не радует, поэтому:<br />22) LXC и cgmanager сразу ставим в автозагрузку:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo systemctl enable lxc<br />sudo systemctl enable cgmanager</span><span style=" font-family:'Ubuntu';"><br /><br />Кроме того заметил, что три &quot;заветные&quot; команды из п.20 нужно выполнять непосредственно перед стартом контейнера. При чем если открыть 2 окна терминала и команды выполнить в одном, а контейнер запустить в другом, то контейнер не запустится. Углубляться в суть проблемы не стал (хотя стоило бы) и просто создал скрипт, который выполняет три &quot;заветные команды&quot; и сразу стартует контейнер.<br /><br />23) Создаю каталог, в котором будет лежать скрипт:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">mkdir ~/scripts</span><span style=" font-family:'Ubuntu';"><br /><br />24) Создаю скрипт:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">nano ~/scripts/lxc-start</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo cgm create all user</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo cgm chown all user $(id -u) $(id -g)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">cgm movepid all user $$</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc-start -n ubuntu02 -d </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">25) Выдаю файлу скрипта права на выполнение:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod +x ~/scripts/lxc-start</span><span style=" font-family:'Ubuntu';"><br /><br />Теперь, если я захочу запустить контейнер, то я просто выполню этот скрипт (вот такой костыль).<br />Кроме всего, что уже сделано, мне нужно чтобы контейнер стартовал при запуске системы. Но этот контейнер существует только в пространстве моего пользователя (administrator), поэтому стартовать он должен после входа пользователя в систему. Поэтому я воспользуюсь &quot;Автозапуском&quot;, который предлагает Astra Linux:<br />26) Захожу (в GUI) &quot;Звезда/Панель управления/Система/Автозапуск&quot; и нажимаю &quot;Добавить приложение&quot;.<br /><br />27) В строке &quot;Имя&quot; я указал &quot;lxc-start&quot;. В строке &quot;Команда&quot; указываю &quot;/home/administrator/scripts/lxc-start&quot;. Всё это сохраняю и закрываю.<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2109942981.png" /><span style=" font-family:'Ubuntu';"> <br /><br />28) Теперь у меня появился такой файл &quot;~/.config/autostart/userapp_NyyzWL.desktop&quot; с таким содержимым:<br />cat ~/.config/autostart/userapp_NyyzWL.desktop<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[Desktop Entry]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Name=lxc-start</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Type=Application</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">NoDisplay=false</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Exec=/home/administrator/scripts/lxc-start</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Hidden=false</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Terminal=false</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">StartupNotify=false </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">29) Теперь перезагружаю систему и выполняю команду &quot;lxc-ls -f&quot;. И вижу в колонке &quot;State&quot; напротив &quot;ubuntu02&quot; значение &quot;RUNNING&quot;, этого я и добивался. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Симпатии: </span><a href="https://forum.astralinux.ru/posts/6435/likes"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Понравилось ValerySV и Olej</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="js-XFUniqueId17"></a><a href="https://forum.astralinux.ru/members/633/"><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600; text-decoration: underline; color:#0000ff;">v</span></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600; text-decoration: underline; color:#0000ff;">ladimirk1211</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">New member</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:8px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Сообщения </span></p>
<p style=" margin-top:0px; margin-bottom:8px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">40 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://forum.astralinux.ru/threads/1264/post-6466"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">07.05.2019</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://forum.astralinux.ru/threads/1264/post-6466"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">#8</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В продолжение предыдущего поста напишу как я запустил GUI приложение, на примере VLC.<br />Настраивал по </span><a href="https://stgraber.org/2014/02/09/lxc-1-0-gui-in-containers/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">этой</span></a><span style=" font-family:'Ubuntu';"> статье, учитывая особенности, которые я описал в предыдущем посте.<br /><br />1) Для начала надо поправить конфигурацию контейнера, поэтому останавливаю контейнер:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-stop -n ubuntu02</span><span style=" font-family:'Ubuntu';"><br /><br />2) В файле &quot;~/.local/share/lxc/ubuntu02/config&quot; удаляю строки:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">nano ~/.local/share/lxc/ubuntu02/config</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 0 100000 65536</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 0 100000 65536 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">3) Вместо удаленных строк добавляю строки:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">nano ~/.local/share/lxc/ubuntu02/config</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 0 100000 1000</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 0 100000 1000</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 1000 1000 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 1000 1000 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 1001 101001 64535</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 1001 101001 64535</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># а эти строки дописываем в конец файла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount.entry = /dev/dri dev/dri none bind,optional,create=dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount.entry = /dev/snd dev/snd none bind,optional,create=dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount.entry = /tmp/.X11-unix tmp/.X11-unix none bind,optional,create=dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#lxc.mount.entry = /dev/video0 dev/video0 none bind,optional,create=file</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.hook.pre-start = /home/administrator/.local/share/lxc/ubuntu02/setup-pulse.sh </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В итоге получаю файл с таким содержимым:<br />cat ~/.local/share/lxc/ubuntu02/config<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#Distribution configuration</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.include = /usr/share/lxc/config/ubuntu.common.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.include = /usr/share/lxc/config/ubuntu.userns.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.arch = linux32</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># Container specific configuration</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 0 100000 1000</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 0 100000 1000</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 1000 1000 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 1000 1000 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = u 1001 101001 64535</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.id_map = g 1001 101001 64535</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.rootfs = /home/administrator/.local/share/lxc/ubuntu02/rootfs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.rootfs.backend = dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.utsname = ubuntu02</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># Network configuration</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.type = veth</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.link = br0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.network.flags = up</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount.entry = /dev/dri dev/dri none bind,optional,create=dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount.entry = /dev/snd dev/snd none bind,optional,create=dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount.entry = /tmp/.X11-unix tmp/.X11-unix none bind,optional,create=dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#lxc.mount.entry = /dev/video0 dev/video0 none bind,optional,create=file</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.hook.pre-start = /home/administrator/.local/share/lxc/ubuntu02/setup-pulse.sh </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если в системе установлена видеокамера, то чтобы пробросить её в контейнер нужно раскомментировать строку &quot;</span><span style=" font-family:'Ubuntu'; font-style:italic;">lxc.mount.entry = /dev/video0 dev/video0 none bind,optional,create=file</span><span style=" font-family:'Ubuntu';">&quot;.<br /><br />4) Теперь создаю скрипт хука для автонастройки звука при старте контейнера:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">nano ~/.local/share/lxc/ubuntu02/setup-pulse.sh</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#!/bin/sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">PULSE_PATH=/home/administrator/.local/share/lxc/ubuntu02/rootfs/home/ubuntu/.pulse_socket</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">if [ ! -e &quot;$PULSE_PATH&quot; ] || [ -z &quot;$(lsof -n $PULSE_PATH 2&gt;&amp;1)&quot; ]; then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    pactl load-module module-native-protocol-unix auth-anonymous=1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        socket=$PULSE_PATH</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">fi </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">5) Выдаю файлу скрипта права на выполнение:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod +x ~/.local/share/lxc/ubuntu02/setup-pulse.sh</span><span style=" font-family:'Ubuntu';"><br /><br />6) Узнаю uid и gid пользователя в основной системе (administrator):<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">id</span><span style=" font-family:'Ubuntu';"><br />Меня интересует вот этот фрагмент вывода команды &quot;</span><span style=" font-family:'Ubuntu'; font-style:italic;">uid=1000(administrator) gid=1000(administrator)</span><span style=" font-family:'Ubuntu';">&quot;.<br /><br />7) &quot;Синхранизирую&quot; uid и gid пользователя в основной системе и пользователя в контейнере:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo chown -R 1000:1000 ~/.local/share/lxc/ubuntu02/rootfs/home/ubuntu</span><span style=" font-family:'Ubuntu';"><br /><br />8) Запускаю контейнер:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">~/scripts/lxc-start</span><span style=" font-family:'Ubuntu';"><br /><br />9) Захожу в консоль контейнера и авторизуюсь под root'ом:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-console -n ubuntu02</span><span style=" font-family:'Ubuntu';"><br /><br />10) Выполняю команды:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">umount /tmp/.X11-unix<br />apt install vlc<br />sudo -u ubuntu mkdir -p /home/ubuntu/.pulse/</span><span style=" font-family:'Ubuntu';"><br /><br />11) Выхожу из консоли контейнера:<br />Нажимаю сочетание клавиш &quot;Ctrl+a&quot;, затем нажимаю клавишу &quot;q&quot;.<br /><br />12) Выполняю команду:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">echo &quot;disable-shm=yes&quot; | lxc-attach -n ubuntu02 -- sudo -u ubuntu tee /home/ubuntu/.pulse/client.conf</span><span style=" font-family:'Ubuntu';"><br /><br />13) И, наконец, создаю скрипт в основной системе на запуск vlc из контейнера:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">nano ~/.local/share/lxc/ubuntu02/lxc-start-vlc</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#!/bin/sh</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc-attach --clear-env --name=ubuntu02 -- sudo -u ubuntu -i env DISPLAY=$DISPLAY PULSE_SERVER=/home/ubuntu/.pulse_socket vlc </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если нет необходимости в запуске контейнера при старте системы, то лучше вместо команды указанной выше, использовать полноценный скрипт из оригинальной </span><a href="https://stgraber.org/2014/02/09/lxc-1-0-gui-in-containers/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">статьи</span></a><span style=" font-family:'Ubuntu';">.<br /><br />14) Выдаю файлу скрипта права на выполнение:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod +x ~/.local/share/lxc/ubuntu02/lxc-start-vlc</span><span style=" font-family:'Ubuntu';"><br /><br />15) Ну и чтобы максимально упростить себе жизнь, создаю ярлык на рабочем столе на запуск скрипта, который запустит vlc:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">nano ~/Desktops/Desktop1/vlc-ubuntu.desktop</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[Desktop Entry]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Version=1.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Name=vlc ubuntu</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Name[ru]=vlc ubuntu</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Comment=Media player</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Exec=/home/administrator/.local/share/lxc/ubuntu02/lxc-start-vlc %U</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Icon=vlc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Type=Application</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Categories=AudioVideo;Player;Recorder; </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">16) Теперь перезагружу контейнер, чтобы все изменения вступили в силу:<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-stop -n ubuntu02<br />~/scripts/lxc-start</span><span style=" font-family:'Ubuntu';"><br /><br />Для проверки того, что vlc заработает, скопировал в &quot;~/.local/share/lxc/ubuntu02/rootfs/home/ubuntu/&quot; файл &quot;мой.mp3&quot;. Выключил в основной системе воспроизведение музыки (для чистоты эксперимента лучше выключить все приложения, связанные с воспроизведением звука). И запустил ярлык. У меня открылся vlc. Я открыл файл &quot;/home/ubuntu/мой.mp3&quot; и услышал воспроизведение файла.<br />Однако есть &quot;проблема&quot;. Только одна система может использовать устройства вывода звука, либо основная система, либо контейнер. Если запустили музыку в контейнере, то в основной системе, параллельно запустить воспроизведение музыки не получится. И наоборот точно так же. &quot;Кто первый встал, того и тапки&quot;. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">  </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p></body></html>