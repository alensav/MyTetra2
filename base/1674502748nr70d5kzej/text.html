<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:20px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.1%; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:xx-large; font-weight:496; color:#000000;">directman</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a href="https://connect.smartliving.ru/profile/1502/blog.html"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; text-decoration: underline; color:#337ab7; background-color:transparent;">&lt;&lt;&lt; Назад</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#3c3c3c; background-color:#ffffff;"><br /></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:496; color:#000000;">Настройка брокера MQTT</span></p>
<p style="-qt-paragraph-type:empty; margin-top:20px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.1%; font-family:'inherit'; font-size:x-large; font-weight:496; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">соберу необходимую по первоначальной настройке информацию из разных источников на будущее (протестировано на арм, на openmediavalue)</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px;">Обновляем систему<br />Первым делом перед началом установки нам необходимо обновить систему. Подключаеся к нашему Pi по SSH и вводим:</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo apt-get update</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo apt-get upgrade</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Подробнее посмотреть как подключаться к Pi по SSH и что потом можно делать вы можете прочитать в нашей статье.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px;">Устновка брокера и клиента “mosquitto”<br />К сожалению, обычные библиотеки “apt-get” Raspberry Pi (Orange Pi) не содержат последнюю версию Mosquitto software. Поэтому перед установкой нам нужно будет обновить библиотеки. Если на сервере будет установлена не последняя версия брокера, то могут появляться ошибки в процессе работы.</span></li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Добавляем ключ и обновляем репозиторий. Вводим эти строчки по очереди. Иногда надо будет вводить пароль от вашего пользователя и нажимать Y для согласия с установкой.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo wget http://repo.mosquitto.org/debian/mosquitto-repo.gpg.key</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo apt-key add mosquitto-repo.gpg.key</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">cd /etc/apt/sources.list.d/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo wget http://repo.mosquitto.org/debian/mosquitto-jessie.list</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo apt-get update</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Устанавливаем MQTT брокер (сервер):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo apt-get install mosquitto</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Устанавливаем MQTT клиент:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo apt-get install mosquitto mosquitto-clients</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">После установки mosquitto сервер будет автоматически запускаться при загрузке системы.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px;">Останавливаем сервер для настройки<br />После установки сервер MQTT сразу запускается. Нам необходимо оставновить его, чтобы произвести последующую настройку.</span></li>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo /etc/init.d/mosquitto stop</span></p>
<li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></li>
<li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px;">Настройка<br />Открываем файл настроек</span></li>
<li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo nano /etc/mosquitto/mosquitto.conf</span></li></ol>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:#f5f5f5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">и заменяем его содержимое на следующее:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;"># Place your local configuration </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;"> /etc/mosquitto/conf.d/</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">#</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;"># A full description of the configuration file is at</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;"># /usr/share/doc/mosquitto/examples/mosquitto.conf.example</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">pid_file /var/run/mosquitto.pid</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">persistence true</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">persistence_location /var/lib/mosquitto/</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">log_dest topic</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">log_type error</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">log_type warning</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">log_type notice</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">log_type information</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">connection_messages true</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">log_timestamp true</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">include_dir /etc/mosquitto/conf.d</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Сохраняем, закрываем программу nano и выходим обратно в терминал (ctrl+o, Enter, ctrl+x).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">5.Запускаем сервер MQTT</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo /etc/init.d/mosquitto start</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></li>
<li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px;">Проверяем работу MQTT брокера<br />Для проверки работы нашего MQTT брокера нам понадобится MQTT клиента. Это могут быть смартфоны с MQTT клиентами, которые подключены к той же Wi-Fi сети. Но мы воспользуемся более простым способом - подключимся к серверу 2 терминалами параллельно.</span></li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Принцип работы протокола MQTT</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Нам необходимо, чтобы первый терминал подписался на топик hello/world, второй терминал отправил в этот топик сообщение и первый терминал его получил.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Итак, в первом терминале, в котором вы делали все настройки, подписываемся на канал hello/world:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">mosquitto_sub -d -t hello/world</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Открываем второе окно терминала, по SSH подключаемся к нашему серверу и отправляем сообщение в канал hello/world:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">mosquitto_pub -d -t hello/world -m &quot;Hello from Terminal window 2!&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">В результате в первом окне появится сообщение:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">Hello from Terminal window 2!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Проверка работы брокера с помощью 2х терминалов</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Поздравляем! Ваш MQTT брокер работает!</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px;">Статус сервера MQTT<br />Проверить стаус вашего MQTT брокера вы всегда можете через терминал:</span></li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo /etc/init.d/mosquitto status</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">После этой команды в терминале будет показана подробная информация о состоянии вашего сервера.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Проверка статуса MQTT брокера</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px;">Настройка пароля для MQTT<br />Для тестов и маленьких проектов вы можете использовать подключение к MQTT серверу без пароля, но в больших системах для повышения уровня безопасности необходимо добавить логин и пароль. Это делается достаточно просто.</span></li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Для того, чтобы клиенты могли подключиться к вашемо брокеру только по логину и паролю необходимо создать конфигурационный файл, который будет содержать имя пользователя и зашифрованный пароль. Вводим в консоли:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo mosquitto_passwd -c /etc/mosquitto/passwd &lt;username&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Вместо &lt;username&gt; необходимо указать имя пользователя, которому будет разрешен доступ, например, mqtusr. После выполнения этой команды юзер mqtusr будет добавлен в систему. Дальше необходимо будет ввести ваш пароль от юзера pi, а потом 2 раза пароль для доступа юзера mqtusr к mqtt брокеру. В качестве второго пароля не воодите пароль от пользователи pi, лучше придумайте новый.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Теперь необходимо поменять настройки доступа к системе, для этого необходимо отредактировать файл /etc/mosquitto/conf.d/default.conf на вашем pi. Вы можете использовать для этого любой текстовый редактор, я предпочитаю nano, поэтому в консоли ввожу:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo nano /etc/mosquitto/conf.d/default.conf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">В открывшейся файл добавляем 2 строчки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">allow_anonymous false</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">password_file /etc/mosquitto/passwd</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Сохраняем и закрываем файл. Для этого в nano нажимаем ctrl+x, выбираем Y и нажимает Enter. Как вы видите в этом конфиге мы прописали в каком файле хранятся юзеры и пароли для подключения к нашему MQTT брокеру, а также мы запретили подключение к серверу всем пользователям без логина и пароля.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Теперь необходимо перезапустить MQTT сервер, для этого вводим в консоли:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#000000; background-color:transparent;">sudo systemctl restart mosquitto</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">Настройка закончена - безопасность вашей системы теперь на высшем уровне!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;">сылка на статью </span><a href="http://robot-on.ru/articles/ystanovka-mqtt-brokera-mosquitto-raspberry-orange-pi"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; text-decoration: underline; color:#337ab7; background-color:transparent;">http://robot-on.ru/articles/ystanovka-mqtt-brokera...</span></a></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'YS Text,Arial,sans-serif'; font-size:13px; color:#333333; vertical-align:top;" style="-qt-paragraph-type:empty; margin-top:2px; margin-bottom:0px; margin-left:-15px; margin-right:-11px; -qt-block-indent:0; text-indent:0px;"><br /></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>