<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600; color:#996633;">Установка и подготовка к работе</span><span style=" font-family:'Ubuntu';"><br />Для cryptoloop нам потребуется установить небольшой пакет:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sudo aptitude install loop-aes-utils</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее загружаем модуль cryptoloop:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sudo modprobe cryptoloop</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">он должен появиться в списке модулей ядра, проверить который можно командой </span><span style=" font-family:'Ubuntu'; font-weight:600;">lsmod</span><span style=" font-family:'Ubuntu';">.<br /><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#996633;">Шифруем файлы и разделы с помощью Cryptoloop и алгоритма AES</span><span style=" font-family:'Ubuntu';"><br />Для начала нужно определиться: указываемый метод</span><span style=" font-family:'Ubuntu'; font-size:18pt;"> </span><span style=" font-family:'Ubuntu'; font-size:18pt; font-weight:600; color:#cc0000;">НЕ ПРЕДНАЗНАЧЕН</span><span style=" font-family:'Ubuntu'; font-size:18pt;"> для шифрования </span><span style=" font-family:'Ubuntu'; font-size:18pt; font-weight:600; color:#cc0000;">разделов с данными</span><span style=" font-family:'Ubuntu'; font-size:18pt;">, а только для создания зашифрованных разделов</span><span style=" font-family:'Ubuntu';">, куда эти данные потом будут скопированы. Так что если вы сотрёте свой раздел с важными данными - пеняйте на себя и читайте в следующий раз внимательно.<br /><br />Если следовать рецептам ниже с головой и всё сделать правильно, то в результате мы получим раздел\файл, с которым можно будет работать, как с любым диском на чтение и запись - с той разницей, что данные там будут зашифрованы. Каждый раз при монтировании нас будут спрашивать пароль для доступа к этим файлам.<br /><br />Итак, начинаем подготавливать криптораздел\криптофайл, куда мы скопируем ценные данные и зашифруем.<br /><br /></span><span style=" font-family:'Ubuntu'; color:#996633;">0. Создание криптофайла или криптораздела</span><span style=" font-family:'Ubuntu';"><br />Если мы хотим создать один большой файл, который будет содержать зашифрованные файлы, делаем это так:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">dd if=/dev/zero of=~</span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">crypto.file</span><span style=" font-family:'Ubuntu';"> bs=1M count=</span><span style=" font-family:'Ubuntu'; font-weight:600; color:#3333ff;">30</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В данном примере это файл на </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#3333ff;">30 </span><span style=" font-family:'Ubuntu';">Мб, но при нужде можно сделать сколько угодно.<br /><br />Или ищем флешку, на которой есть </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic; color:#ff0000;">пустой</span><span style=" font-family:'Ubuntu';"> раздел - этот пустой раздел мы сделаем шифрованным. Допустим, это будет </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">/dev/sdd2</span><span style=" font-family:'Ubuntu';"> который мы скоро </span><span style=" font-family:'Ubuntu'; font-style:italic;">отформатируем</span><span style=" font-family:'Ubuntu';"> и зашифруем.<br /><br /></span><span style=" font-family:'Ubuntu'; font-size:18pt;">Ещё раз:</span><span style=" font-family:'Ubuntu'; font-size:18pt; font-weight:600; color:#993399;">/dev/sdd2 </span><span style=" font-family:'Ubuntu'; font-size:18pt;">это НЕ раздел с вашими данными, а пустой раздел, куда вы эти данные переместите - и они при этом зашифруются. О создании разделов можно почитать </span><a href="http://mydebianblog.blogspot.com.au/2008/10/cfdisk-mkfs-linux.html"><span style=" font-family:'Ubuntu'; font-size:18pt; text-decoration: underline; color:#0000ff;">в посте о форматировании</span></a><span style=" font-family:'Ubuntu'; font-size:18pt;">.</span><span style=" font-family:'Ubuntu';"><br /><br /><br /></span><span style=" font-family:'Ubuntu'; color:#996633;">1. Связываем устройство с loop device (петлевым устройством) с использованием шифрования</span><span style=" font-family:'Ubuntu';"><br />В случае криптофайла:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">losetup </span><span style=" font-family:'Ubuntu'; color:#339999;">-e aes</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span><span style=" font-family:'Ubuntu';"> ~</span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">crypto.file</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В случае криптораздела:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">losetup </span><span style=" font-family:'Ubuntu'; color:#339999;">-e aes</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">/dev/sdd2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">При любом варианте вас попросят ввести пароль - он будет использоваться для доступа к вашим файлам.<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">cat file | losetup </span><span style=" font-family:'Ubuntu'; color:#339999;">-e aes </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">/dev/sdd2</span><span style=" font-family:'Ubuntu';"> -p0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Пароль меньше 20 символов оно не примет - и правильно сделает. Излишне напоминать, что если забудете пароль - не сможете примонтировать данные обратно. Для любопытных: ключ </span><span style=" font-family:'Ubuntu'; color:#339999;">-e aes</span><span style=" font-family:'Ubuntu';"> указывает программе использовать шифрование AES, который довольно устойчив ко взлому.<br /><br />Теперь больше работать с устройством через </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">/dev/sdd2</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">crypto.file</span><span style=" font-family:'Ubuntu';"> мы не будем, потому как оно зашифровано и система его просто так не примонтирует. Вместо этого работать мы будем именно с </span><span style=" font-family:'Ubuntu'; font-style:italic;">петлевым устройством</span><span style=" font-family:'Ubuntu';">, на которое замкнули криптофайл или криптораздел - оно может быть </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span><span style=" font-family:'Ubuntu';"> или другое (необязательно каждый раз замыкать на одно и то же устройство).<br /><br /><br /></span><span style=" font-family:'Ubuntu'; color:#996633;">2. Форматирование зашифрованного раздела или файла</span><span style=" font-family:'Ubuntu';"><br />После того, как мы связали устройство или файл с loop-device, нужно его отформатировать:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">mkfs.ext2 </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом примере мы отформатировали на файловую систему Ext2, но можно использовать любую.<br /><br /><br /></span><span style=" font-family:'Ubuntu'; color:#996633;">3. Перенос данных и работа с зашифрованным разделом или файлом</span><span style=" font-family:'Ubuntu';"><br />Работаем с петлевым устройством, как с обычным разделом: монтируем, записываем на него данные и так далее. Монтирование зашифрованного раздела или файла выглядит так:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">mkdir /mnt/cryptodisk </span><span style=" font-family:'Ubuntu'; color:#999999;">&lt;--- это если точка монтирования ещё не создана</span><span style=" font-family:'Ubuntu';"><br />mount </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span><span style=" font-family:'Ubuntu';"> /mnt/cryptodisk</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Размонтирование:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">umount </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Больше о монтировании можно </span><a href="http://mydebianblog.blogspot.com.au/2008/09/linux.html"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">прочитать в соответствующем посте</span></a><span style=" font-family:'Ubuntu';">.<br /><br /><br /></span><span style=" font-family:'Ubuntu'; color:#996633;">4. Окончание работы с криптофайлом\криптоустройством</span><span style=" font-family:'Ubuntu';"><br />После отмонтирования нужно отвязать устройство или файл от петлевого устройства:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">losetup -d </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На всякий случай, просмотреть список задействованных петлевых устройств (loop devices) можно командой:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">losetup -a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь петлевое устройство свободно, данные зашифрованы, враг не пройдёт.<br /><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#996633;">А как теперь обратно прикрутить криптованный раздел или файл?</span><span style=" font-family:'Ubuntu';"><br />Легко - доступ к зашифрованным данным можно получить, опять привязав к петлевому устройству криптораздел\криптофайл и введя пароль, который вы назначили ранее. То есть в случае криптофайла:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">losetup </span><span style=" font-family:'Ubuntu'; color:#339999;">-e aes</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span><span style=" font-family:'Ubuntu';"> ~</span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">crypto.file</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В случае криптораздела:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">losetup </span><span style=" font-family:'Ubuntu'; color:#339999;">-e aes</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#009900;">/dev/loop0</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600; color:#993399;">/dev/sdd2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вас снова попросят ввести пароль, который нужен для доступа к вашим файлам.<br /><br />Теперь мы имеем раздел или файл, который невозможно примонтировать просто так (он зашифрован и Linux не увидит на нем файловую систему). Но после прикручивания к петлевому устройству все данные будут доступны (если вы знаете пароль, разумеется).<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#783f04;">Альтернативы</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">более каноничный способ по мнению некоторых комментаторов ниже, это использовать штатный cryptsetup. Об этом <a href="http://libc6.org/page/perenos-home-na-zashifrovannyj-razdel"><span style=" text-decoration: underline; color:#0000ff;">есть хорошая заметка на блоге у Librarian</span></a> и толковое <a href="http://www.debian-administration.org/articles/469"><span style=" text-decoration: underline; color:#0000ff;">руководство</span></a>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ещё можно попробовать <a href="http://web-bricks.ru/comments/truecrypt_-_besplatnaya_krossplatformennaya_programma_shifrovaniya_dannyh"><span style=" text-decoration: underline; color:#0000ff;">Truecrypt</span></a>, где есть возможность создания зашифрованного контейнера с &quot;двойным&quot; дном, т.е. двух уровней правдоподобного отрицания, на случай рассекречивания паролей.</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#996633;">Лирическое отступление</span><span style=" font-family:'Ubuntu';"><br />Не хотелось бы разочаровывать начинающих криптоанархистов, но ребята с xkcd в общем реалистично смотрят на вещи:<br /><br /></span><img src="image1626572144.png" /><span style=" font-family:'Ubuntu';"><br />Тем не менее, светить своими данными не комильфо, и какое-то время вы выиграете. </span></p></body></html>