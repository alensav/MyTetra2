<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">Настройка KVM на Ubuntu Server</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image151895094.png" /><span style=" font-family:'Ubuntu';"> Обновлено: 20.09.2020 </span><img src="image151895094.png" /><span style=" font-family:'Ubuntu';"> Опубликовано: 28.08.2017 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Тематические термины: </span><a href="https://www.dmosk.ru/terminus.php?object=kvm"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">KVM виртуализация</span></a><span style=" font-family:'Ubuntu';">, </span><a href="https://www.dmosk.ru/terminus.php?object=linux"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Linux</span></a><span style=" font-family:'Ubuntu';">, </span><a href="https://www.dmosk.ru/terminus.php?object=ubuntu"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Ubuntu</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Инструкция написана на примере Linux Ubuntu Server 18.04.3 LTS. Она подойдет для большинства дистрибутивов на основе Debian. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#prepare"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Проверка совместимости<br />Подготовка</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#install"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Установка и запуск</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#network"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Настройка сетевого моста</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#vm-create"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Создание ВМ</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#connect"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Подключение к ВМ</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#virsh"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Управление из командной строки</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#hddexpand"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Увеличение размера виртуального диска</span></a><span style=" font-family:'Ubuntu';"><br /></span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#manage"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Дополнительные средства управления</span></a><span style=" font-family:'Ubuntu';"><br />    </span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#virt-manager"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Virt Manager</span></a><span style=" font-family:'Ubuntu';"><br />    </span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-ubuntu#ubuntu-vm-builder"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Ubuntu-VM-Builder</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="prepare"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">роверка поддержки гипервизора</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Проверяем, что сервер поддерживает технологии виртуализации: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">cat /proc/cpuinfo | egrep &quot;(vmx|svm)&quot; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В ответ должны получить что-то наподобие: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes64 monitor ds_cpl </span><span style=" font-family:'Ubuntu'; color:#ff0000;">vmx</span><span style=" font-family:'Ubuntu';"> smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt aes lahf_lm epb tpr_shadow vnmi flexpriority ept vpid dtherm ida arat </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В противном случае, заходим в БИОС, находим опцию для включения технологии виртуализации (имеет разные названия, например, Intel Virtualization Technology или Virtualization) и включаем ее — задаем значение </span><span style=" font-family:'Ubuntu'; font-weight:600;">Enable</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Также проверить совместимость можно командой: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">kvm-ok </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* если команда вернет ошибку </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">«kvm-ok command not found»</span><span style=" font-family:'Ubuntu'; font-style:italic;">, установите соответствующий пакет: </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">apt-get install cpu-checker</span><span style=" font-family:'Ubuntu'; font-style:italic;">.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если видим: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">INFO: /dev/kvm exists<br />KVM acceleration can be used </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">значит поддержка со стороны аппаратной части есть. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="prepare"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">одготовка сервера</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для нашего удобства, создадим каталог, в котором будем хранить данные для KVM: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">mkdir -p /kvm/{vhdd,iso} </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* будет создано два каталога: </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">/kvm/vhdd</span><span style=" font-family:'Ubuntu'; font-style:italic;"> (для виртуальных жестких дисков) и </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">/kvm/iso</span><span style=" font-family:'Ubuntu'; font-style:italic;"> (для iso-образов).</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Настроим время: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">timedatectl set-timezone Europe/Moscow </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* данная команда задает зону в соответствии с московским временем.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt-get install chrony </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">systemctl enable chrony </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* устанавливаем и запускаем утилиту для синхронизации времени.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="install"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">У</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">становка и запуск</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Устанавливаем KVM и необходимые утилиты управления. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">а) Ubuntu после версии 18.10 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt-get install qemu qemu-kvm libvirt-daemon-system virtinst libosinfo-bin </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">б) Ubuntu до 18.10: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt-get install qemu-kvm libvirt-bin virtinst libosinfo-bin </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* где </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">qemu-kvm</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — гипервизор; </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">libvirt-bin</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — библиотека управления гипервизором; </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">virtinst</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — утилита управления виртуальными машинами; </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">libosinfo-bin</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — утилита для просмотра списка вариантов операционных систем, которые могут быть в качестве гостевых.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Настроим автоматический запуск сервиса: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">systemctl enable libvirtd </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="network"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Н</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">астройка сети</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Виртуальные машины могут работать за NAT (в качестве которого выступает сервер KVM) или получать IP-адреса из локальной сети — для этого необходимо настроить сетевой мост. Мы настроим последний. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Используя удаленное подключение, внимательно проверяйте настройки. В случае ошибки соединение будет прервано. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Устанавливаем bridge-utils: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt-get install bridge-utils </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">а) настройка сети в старых версиях Ubuntu (/etc/network/interfaces). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Открываем конфигурационный файл для настройки сетевых интерфейсов: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vi /etc/network/interfaces </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">И приведем его к виду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">#iface eth0 inet static<br />#       address 192.168.1.24<br />#       netmask 255.255.255.0<br />#       gateway 192.168.1.1<br />#       dns-nameservers 192.168.1.1 192.168.1.2<br /><br />auto br0<br />iface br0 inet static<br />        address 192.168.1.24<br />        netmask 255.255.255.0<br />        gateway 192.168.1.1<br />        dns-nameservers 192.168.1.1 192.168.1.2<br />        bridge_ports eth0<br />        bridge_fd 9<br />        bridge_hello 2<br />        bridge_maxage 12<br />        bridge_stp off </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* где все, что закомментировано — старые настройки моей сети; </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">br0</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — название интерфейса создаваемого моста; </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">eth0</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — существующий сетевой интерфейс, через который будет работать мост.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Перезапускаем службу сети: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">systemctl restart networking </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">б) настройка сети в новых версиях Ubuntu (netplan). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vi /etc/netplan/01-netcfg.yaml </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* в зависимости от версии системы, конфигурационной файл </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">yaml</span><span style=" font-family:'Ubuntu'; font-style:italic;"> может иметь другое название.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Приводим его к виду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">network:<br />  version: 2<br />  renderer: networkd<br />  ethernets:<br />   eth0:<br />      dhcp4: false<br />      dhcp6: false<br />      wakeonlan: true<br /><br />  bridges:<br />    br0:<br />      macaddress: 2c:6d:45:c3:55:a7<br />      interfaces:<br />        - eth0<br />      addresses:<br />        - 192.168.1.24/24<br />      gateway4: 192.168.1.1<br />      mtu: 1500<br />      nameservers:<br />        addresses:<br />          - 192.168.1.2<br />          - 192.168.1.3<br />      parameters:<br />        stp: true<br />        forward-delay: 4<br />      dhcp4: false<br />      dhcp6: false </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">* в данном примере мы создаем виртуальный бридж-интерфейс </span><span style=" font-family:'Ubuntu'; font-weight:600;">br0</span><span style=" font-family:'Ubuntu';">; в качестве физического интерфейса используем </span><span style=" font-family:'Ubuntu'; font-weight:600;">eth0</span><span style=" font-family:'Ubuntu';">. </span><span style=" font-family:'Ubuntu'; font-weight:600;">2c:6d:45:c3:55:a7</span><span style=" font-family:'Ubuntu';"> — физический адрес интерфейса, через который мы будем настраивать бридж; </span><span style=" font-family:'Ubuntu'; font-weight:600;">192.168.1.24</span><span style=" font-family:'Ubuntu';"> — IP-адрес нашего сервера KVM; </span><span style=" font-family:'Ubuntu'; font-weight:600;">192.168.1.1</span><span style=" font-family:'Ubuntu';"> — адрес шлюза; </span><span style=" font-family:'Ubuntu'; font-weight:600;">192.168.1.2</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">192.168.1.3</span><span style=" font-family:'Ubuntu';"> — адреса серверов DNS. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Применяем сетевые настройки: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">netplan apply </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Настаиваем перенаправления сетевого трафика (чтобы виртуальные машины с сетевым интерфейсом NAT могли выходить в интернет): </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">vi /etc/sysctl.d/99-sysctl.conf </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Добавляем строку: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">net.ipv4.ip_forward=1 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Применяем настройки: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sysctl -p /etc/sysctl.d/99-sysctl.conf </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="vm-create"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">С</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">оздание виртуальной машины</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для создания первой виртуальной машины вводим следующую команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virt-install -n VM1 \<br />--autostart \<br />--noautoconsole \<br />--network=bridge:br0 \<br />--ram 2048 --arch=x86_64 \<br />--vcpus=2 --cpu host --check-cpu \<br />--disk path=/kvm/vhdd/VM1-disk1.img,size=16 \<br />--cdrom /kvm/iso/ubuntu-18.04.3-server-amd64.iso \<br />--graphics vnc,listen=0.0.0.0,password=vnc_password \<br />--os-type linux --os-variant=ubuntu18.04 --boot cdrom,hd,menu=on </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">* где: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">VM1 —</span> имя создаваемой машины; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">autostart —</span> разрешить виртуальной машине автоматически запускаться вместе с сервером KVM; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">noautoconsole —</span> не подключается к консоли виртуальной машины; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">network —</span> тип сети. В данном примере мы создаем виртуальную машину с интерфейсом типа «сетевой мост». Для создания внутреннего интерфейса с типом NAT вводим <span style=" font-weight:600;">--network=network:default,model=virtio</span>; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ram —</span> объем оперативной памяти; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">vcpus —</span> количество виртуальных процессоров; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">disk —</span> виртуальный диск: <span style=" font-weight:600;">path —</span> путь до диска; <span style=" font-weight:600;">size —</span> его объем; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">cdrom —</span> виртуальный привод с образом системы; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">graphics —</span> параметры подключения к виртуальной машины с помощью графической консоли (в данном примере используем vnc); <span style=" font-weight:600;">listen —</span> на какой адресе принимает запросы vnc (в нашем примере на всех); <span style=" font-weight:600;">password —</span> пароль для подключения при помощи vnc; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">os-variant —</span> гостевая операционная система (весь список мы получали командой <span style=" font-weight:600;">osinfo-query os</span>, в данном примере устанавливаем Ubuntu 18.04). </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="connect"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">одключение к виртуальной машине</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На компьютер, с которого планируем работать с виртуальными машинами, скачиваем VNC-клиент, например, </span><a href="http://www.tightvnc.com/download.php"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">TightVNC</span></a><span style=" font-family:'Ubuntu';"> и устанавливаем его. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На сервере вводим: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh vncdisplay VM1 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">команда покажет, на каком порту работает VNC для машины VM1. У меня было: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">:1 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* :1 значит, что нужно к 5900 прибавить 1 — 5900 + 1 = 5901.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Запускаем TightVNC Viewer, который мы установили и вводим данные для подключения: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1658591938.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Кликаем по </span><span style=" font-family:'Ubuntu'; font-weight:600;">Connect</span><span style=" font-family:'Ubuntu';">. На запрос пароля вводим тот, что указали при создании ВМ, (</span><span style=" font-family:'Ubuntu'; font-weight:600;">vnc_password</span><span style=" font-family:'Ubuntu';">). Мы подключимся к виртуальной машине удаленной консолью. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если мы не помним пароль, открываем настройку виртуальной машины командой: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh edit VM1 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">И находим строку: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">&lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0' passwd='</span><span style=" font-family:'Ubuntu'; color:#000000; background-color:#ffff00;">12345678</span><span style=" font-family:'Ubuntu';">'&gt;<br />  &lt;listen type='address' address='0.0.0.0'/&gt;<br />&lt;/graphics&gt; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* в данном примере для доступа к виртуальной машине используется пароль </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">12345678</span><span style=" font-family:'Ubuntu'; font-style:italic;">.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="virsh"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">У</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">правление виртуальной машиной из командной строки</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Примеры команд, которые могут пригодиться при работе с виртуальными машинами. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">1. Получить список созданных машин:</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh list --all </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">2. Включить виртуальную машину:</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh start VMname </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* где </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">VMname</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — имя созданной машины.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">3. Выключить виртуальную машину:</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh shutdown VMname </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">4. Включить автозапуск виртуальной машины:</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh autostart VMname </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">5. Редактирование конфигурации виртуальной машины:</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh edit VMname </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">6. Работа с сетевыми интерфейсами.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Добавить обычный сетевой интерфейс (default или NAT) виртуальной машине: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh attach-interface --domain VMname --type network --source default --model virtio --config --live </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Добавить интерфейс типа bridge: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh attach-interface --domain VMname --type bridge --source br0 --model rtl8139 --config --live </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Удалить сетевой интерфейс: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh detach-interface VMname --type bridge --mac 52:54:00:2e:a9:4d </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* где </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">bridge</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — тип сетевого интерфейса (также может быть network); </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">52:54:00:2e:a9:4d</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — MAC-адрес сетевого адаптера (узнать данный адрес можно в конфигурации виртуальной машины или в самой гостевой операционной системы).</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">7. Посмотреть IP-адреса, выданные виртуальным машинам автоматически:</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh net-dhcp-leases default </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* где </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">default</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — виртуальная сеть, создаваемая по умолчанию при установке KVM.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="hddexpand"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">У</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">величение размера виртуального диска</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Получаем список дисков для виртуальной машины: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh domblklist VMname </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Пример ответа: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Target     Source<br />------------------------------------------------<br />vda        /data/kvm/vhdd/VMname-disk1.img </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* в данном примере путь до диска — </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">/data/kvm/vhdd/VMname-disk1.img.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Останавливаем виртуальную машину: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh shutdown VMname </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* или завершаем работу в самой операционной системе.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Увеличиваем размер диска: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">qemu-img resize /data/kvm/vhdd/VMname-disk1.img +100G </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* данной командой мы расширим дисковое пространство виртуального диска </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">/data/kvm/vhdd/VMname-disk1.img</span><span style=" font-family:'Ubuntu'; font-style:italic;"> на </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">100</span><span style=" font-family:'Ubuntu'; font-style:italic;"> Гигабайт.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Мы должны увидеть: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Image resized. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Получаем информацию о виртуальном диске: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">qemu-img info /data/kvm/vhdd/VMname-disk1.img </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Запускаем виртуальную машину: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh start VMname </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Меняем размер блочного устройства: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">virsh blockresize UBU /data/kvm/vhdd/VMname-disk1.img 200G </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">* где </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">200G</span><span style=" font-family:'Ubuntu'; font-style:italic;"> — общий размер виртуального диска после расширения.</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После необходимо поменять размер диска в самой операционной системе. Пример того, как это можно сделать можно прочитать в инструкции </span><a href="https://www.dmosk.ru/miniinstruktions.php?mini=vmware-add-disksize"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Добавление дискового пространства виртуальной машине в VMware</span></a><span style=" font-family:'Ubuntu';"> (раздел «Настройка операционной системы»). </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="manage"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Д</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">ополнительные средства управления</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="virt-manager"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">V</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">irt-Manager</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Virt-manager — графическая консоль для управления виртуальными машинами. С ее помощью можно создавать последние, модифицировать их, запускать, останавливать, подключаться консолью. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Установить на Linux Ubuntu: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt-get install virt-manager </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ubuntu-vm-builder"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">u</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">buntu-vm-builder</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">ubuntu-vm-builder — пакет, разработанный компанией Canonical для упрощения создания новых виртуальных машин. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для его установки вводим: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">apt-get install ubuntu-vm-builder </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Читайте также</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.dmosk.ru/miniinstruktions.php?mini=kvm-centos7"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Установка KVM на CentOS 7</span></a></p></body></html>