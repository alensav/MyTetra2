<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">Пошаговая инструкция установки Postfix и Dovecot на Ubuntu</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом руководстве будет рассмотрен процесс установки агентов работы с электронной почтой Postfix, Dovecot на </span><a href="https://1cloud.ru/blog/chto-takoe-vds"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">виртуальные серверы</span></a><span style=" font-family:'Ubuntu';"> под управлением операционной системы </span><a href="https://1cloud.ru/services/vps-vds/ubuntu"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Ubuntu 16.04 x64</span></a><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Что это такое</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Postfix - агент передачи электронной почты для обмена в сети Интернет и внутри локальной сети. Преимуществом Postfix является простота настройки и конфигурации. Может использоваться для отправки системных сообщений. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Dovecot - агент получения электронной почты по протоколам IMAP и POP3. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Установка Postfix</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Прежде всего следует обновить локальную базу пакетов:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apt-get update</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее установите пакет postfix из главного репозитория:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apt-get install postfix</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После запуска пользовательского интерфейса в списке типов конфигурации сервера выберите «Internet Site» для автоматической генерации файла конфигурации main.cf. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image125095288.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В поле &quot;System mail name&quot; укажите полное доменное или локальное имя сервера, например: </span><span style=" font-family:'Ubuntu'; font-style:italic;">example.org</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1932682211.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Доменное имя сервера можно посмотреть с помощью утилиты nslookup:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">nslookup</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Настройка Postfix</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Создайте файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">virtual</span><span style=" font-family:'Ubuntu';"> в директории </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/</span><span style=" font-family:'Ubuntu';"> с помощью команды touch, в этом файле будут храниться почтовые адреса и имена пользователей, которым доставляется почта:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">touch virtual</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Создайте директорию </span><span style=" font-family:'Ubuntu'; font-style:italic;">private</span><span style=" font-family:'Ubuntu';"> в </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/</span><span style=" font-family:'Ubuntu';"> с помощью команды mkdir, в которой будут храниться файлы настройки yandex smtp:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mkdir private</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Создайте следующие файлы в директории </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/private/</span><span style=" font-family:'Ubuntu';"> с помощью команды touch:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">touch canonical sender_relay sasl_passwd</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Услуги 1cloud </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://1cloud.ru/services/vps-vds/ubuntu/?utm_source=help&amp;utm_campaign=banner-ubuntu&amp;utm_content=vertical"><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600; text-decoration: underline; color:#0000ff;">Виртуальный сервер Ubuntu</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Бесплатное тестирование </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">API к панели управления </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">От 318 руб./мес. </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://1cloud.ru/services/vps-vds/ubuntu/?utm_source=help&amp;utm_campaign=banner-ubuntu&amp;utm_content=vertical"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Подробнее &gt;&gt;</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />canonical – задает правила подмены адресов<br />sender_relay – задает связь доменов и конкретных отправителей к внешним службам<br />sasl_passwd – в этот файл вы добавляете внешние учетные данные почтового провайдера </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее необходимо внести изменения в файл конфигурации </span><span style=" font-family:'Ubuntu'; font-style:italic;">main.cf</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Откройте файл в текстовом редакторе в привилегированном режиме:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo nano /etc/postfix/main.cf</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Записи имеют вид: параметр = значение1, значение2, значение3. Комментарии начинаются с символа #. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Измените значение параметра </span><span style=" font-family:'Ubuntu'; font-style:italic;">myhostname</span><span style=" font-family:'Ubuntu';"> на ваше доменное имя, если доменного имени нет, то оставьте по умолчанию:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">myhostname = example.org</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Измените значение параметра </span><span style=" font-family:'Ubuntu'; font-style:italic;">mydestination</span><span style=" font-family:'Ubuntu';">, добавив значение вашего ip-адреса через запятую. Ip-адрес можно посмотреть с помощью следующей команды (параметр inet addr):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ifconfig | grep </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">&quot;inet addr&quot; -m 1</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Чтобы письмо могло быть переслано на другие домены или адреса, замените параметр </span><span style=" font-family:'Ubuntu'; font-style:italic;">alias_maps</span><span style=" font-family:'Ubuntu';"> параметром </span><span style=" font-family:'Ubuntu'; font-style:italic;">virtual_alias_maps</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Измените расположение хэша на </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/virtual</span><span style=" font-family:'Ubuntu';">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virtual_</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">alias_maps = hash:/etc/postfix/virtual</span><span style=" font-family:'Ubuntu';"><br />Значение параметра mynetworks, определяющего авторизованные сети:<br />mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128<br /><br />127.0.0.0/8 — безопасно: авторизовать только локальную машину </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для отправки почты с помощью Yandex SMTP добавьте в конец файла следующие строки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />smtp_sasl_auth_enable = yes<br />smtp_sasl_password_maps = hash:/etc/postfix/private/sasl_passwd<br />smtp_sasl_security_options = noanonymous<br />smtp_sasl_type = cyrus<br />smtp_sasl_mechanism_filter = login<br />smtp_sender_dependent_authentication = yes<br />sender_dependent_relayhost_maps = hash:/etc/postfix/private/sender_relay<br />sender_canonical_maps = hash:/etc/postfix/private/canonical<br /><br />Описание параметров:<br />smtp_sasl_auth_enable – параметр отвечает, за включение поддержки sasl для проверки подлинности почтовых серверов<br />smtp_sasl_password_maps – указываем путь до файла sasl_passwd с внешними учетными данными<br />smtp_sasl_security_options – параметр безопасности<br />Возможные значения параметра: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">noanonymous - не использовать механизмы, которые разрешают анонимную проверку подлинности; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">noplaintext - не использовать механизмы, которые передают незашифрованное имя пользователя и пароль; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">nodictionary - не использовать механизмы, которые уязвимы для атак по словарю; </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mutual_auth - использовать только механизмы, которые прошли проверку подлинности клиента и сервера друг с другом.</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />smtp_sasl_type - тип плагина sasl, который должен использоваться для проверки подлинности, по умолчанию cyrus.<br />smtp_sasl_mechanism_filter список поддерживаемых методов аутентификации<br />smtp_sender_dependent_authentication – проверка подлинности будет зависеть от домена отправителя<br />sender_dependent_relayhost_maps - указываем путь до файла sender_relay<br />sender_canonical_maps - указываем путь до файла canonical<br /><br />В файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/private/canonical</span><span style=" font-family:'Ubuntu';"> внесите изменения:<br />@yandex.ru user_name@yandex.ru<br /><br />В файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/private/sender_relay</span><span style=" font-family:'Ubuntu';"> внесите изменения:<br />@yandex.ru smtp.yandex.ru<br /><br />В файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/private/sasl_passwd</span><span style=" font-family:'Ubuntu';"> внесите изменения, где вместо *** укажите свой пароль:<br />[smtp.yandex.ru] user@yandex.ru:***<br />  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для переадресации писем на другие почтовые адреса необходимо создать псевдонимы. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Откройте файл virtual в текстовом редакторе в привилегированном режиме:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo nano /etc/postfix/virtual</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Укажите произвольные электронные адреса, которые необходимо создать, и имена существующих пользователей, которым нужно доставлять почту:<br />mail@example.org user1<br />mail2@example.org user1, user2 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для просмотра всех существующих пользователей системы выполните команду:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">cut </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">-d: -f1 /etc/passwd</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Преобразуем файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/virtual</span><span style=" font-family:'Ubuntu';"> в файлы директории </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/postfix/private/</span><span style=" font-family:'Ubuntu';"> в справочные таблицы с помощью команды postmap: </span><span style=" font-family:'Courier New,courier';">sudo postmap /etc/postfix/virtual</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Courier New,courier';">sudo postmap /etc/postfix/private/*</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После внесения изменений в конфигурационные файлы необходимо перезапустить сервис:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo /etc/init.d/postfix restart</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На Ubuntu Server 16 с помощью команды </span><span style=" font-family:'Ubuntu'; font-style:italic;">iptables</span><span style=" font-family:'Ubuntu';"> необходимо открыть порты для почтовых служб:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">iptables -A INPUT -p tcp --dport 25 -j ACCEPT</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Проверка почтового сервиса Postfix</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для более удобной работы с почтой установите утилиту mutt:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apt-get install mutt</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для проверки корректности работы сервиса отправьте электронное письмо на любой почтовый ящик:<br />echo &quot;First message&quot; | mutt -s &quot;msg&quot; mail@example.com </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Замечание: письма отправленные на почтовые адреса Google попадают в спам. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Получение писем с помощью Dovecot</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Установите пакеты из главного репозитория:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apt-get install dovecot-imapd dovecot-pop3d</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/dovecot/dovecot.conf</span><span style=" font-family:'Ubuntu';"> добавьте следующую строку с перечнем протоколов:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">protocols = pop3 pop3s imap imaps</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В файле </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/dovecot/conf.d/10-mail.conf</span><span style=" font-family:'Ubuntu';"> проверьте содержимое параметра</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">mail_location = mbox:~/mail:INBOX=/var/mail/%u</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После внесения изменений в конфигурационные файлы необходимо перезапустить сервис:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo /etc/init.d/dovecot restart</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Внесите изменения в файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/hosts</span><span style=" font-family:'Ubuntu';">, добавив свое доменное имя:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ip-address example.com</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее с помощью команды iptables необходимо открыть порты для почтовых служб:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">iptables -A INPUT -p tcp --dport 220 -j ACCEPT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"><br />iptables -A INPUT -p tcp --dport 993 -j ACCEPT<br />iptables -A INPUT -p tcp --dport 110 -j ACCEPT<br />iptables -A INPUT -p tcp --dport 995 -j ACCEPT</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для проверки корректности работы сервиса отправьте электронное письмо с любого почтового ящика на созданный электронный адрес и проверьте с помощью утилиты mutt. Письмо должно быть отправлено только существующему пользователю и на адрес с указанием доменного имени, а не ip-адреса, в противном случае письмо получено не будет.   </span></p></body></html>