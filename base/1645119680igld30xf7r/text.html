<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:40px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.5%;"><img src="image1591818658.png" /></p>
<p style=" margin-top:20px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:19.2px;"><span style=" font-family:'Epilogue,sans-serif'; font-size:medium; font-weight:496; color:#0069ff; text-transform:uppercase;">TUTORIAL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Epilogue,sans-serif'; font-size:xx-large; font-weight:792; color:#031b4e;">Установка и настройка сервера OpenVPN в Ubuntu 20.04</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><a href="https://www.digitalocean.com/community/tags/ubuntu"><span style=" font-family:'Inter,sans-serif'; font-size:12px; text-decoration: underline; color:#031b4e; background-color:#f3f5f9;">Ubuntu</span></a><a href="https://www.digitalocean.com/community/tags/ubuntu-20-04"><span style=" font-family:'Inter,sans-serif'; font-size:12px; text-decoration: underline; color:#031b4e; background-color:#f3f5f9;">Ubuntu 20.04</span></a><a href="https://www.digitalocean.com/community/tags/vpn"><span style=" font-family:'Inter,sans-serif'; font-size:12px; text-decoration: underline; color:#031b4e; background-color:#f3f5f9;">VPN</span></a><a href="https://www.digitalocean.com/community/tags/security"><span style=" font-family:'Inter,sans-serif'; font-size:12px; text-decoration: underline; color:#031b4e; background-color:#f3f5f9;">Security</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:1; text-indent:0px;"><img src="image225507180.png" /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Inter,sans-serif'; font-size:13px; font-weight:496; color:#031b4e;" style=" margin-top:0px; margin-bottom:0px; margin-left:46px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:13px;">By</span></li>
<li style=" font-family:'Inter,sans-serif'; font-size:13px; font-weight:496; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:46px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:13px;">Published on May 21, 2020</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:72px; margin-right:36px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Inter,sans-serif'; font-size:14px; font-weight:496; color:#333333;">Русский</span></p>
<p style=" margin-top:0px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">Введение</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://en.wikipedia.org/wiki/Virtual_private_network"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">Виртуальная частная сеть</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> (VPN) позволит вам работать в незащищенных сетях, как если бы вы находились в частной сети. Она предоставляет возможность получить безопасный и защищенный доступ к сети Интернет со смартфона или ноутбука при подключении к недоверенной сети, например Wi-Fi в отеле или в кафе.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В сочетании с </span><a href="https://en.wikipedia.org/wiki/HTTP_Secure"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">соединениями HTTPS</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> данная схема позволяет защитить учетные данные и транзакции в беспроводной сети. Вы можете обойти географические ограничения и цензуру и скрыть свое местоположение, а также любой незашифрованный трафик HTTP при работе в незащищенной сети.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://openvpn.net/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">OpenVPN</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> — это полнофункциональное решение VPN с открытым исходным кодом, которое использует протокол TLS и позволяет использовать широкий круг конфигураций. В этом обучающем руководстве мы установим OpenVPN на сервере Ubuntu 20.04 и настроим его для доступа с клиентского компьютера.</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> Если вы планируете настроить сервер OpenVPN на DigitalOcean Droplet, то мы, как и многие поставщики хостинга, будем взимать плату за превышение лимита пропускной способности. По этой причине необходимо следить за объемом трафика, который обрабатывает ваш сервер.</span></p>
<p style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">Дополнительную информацию можно найти на </span><a href="https://www.digitalocean.com/docs/accounts/billing/bandwidth/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">этой странице</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Предварительные требования</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для данного обучающего руководства вам потребуется следующее:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Один сервер Ubuntu 20.04 с пользователем sudo без привилегий root и активированным брандмауэром. Чтобы выполнить настройку сервера, воспользуйтесь нашим руководством по </span><a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04"><span style=" font-size:medium; text-decoration: underline; color:#0000ff; background-color:transparent;">начальной настройке сервера Ubuntu 20.04.</span></a><span style=" font-size:medium;"> В этом обучающем руководстве мы будем называть его </span><span style=" font-size:medium; font-weight:600;">сервером OpenVPN</span><span style=" font-size:medium;">.</span></li>
<li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Отдельный сервер Ubuntu 20.04 настроенный в качестве частного центра сертификации (Certificate Authority, CA), который мы далее будем называть </span><span style=" font-size:medium; font-weight:600;">сервером ЦС</span><span style=" font-size:medium;">. После выполнения шагов </span><a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04"><span style=" font-size:medium; text-decoration: underline; color:#0000ff; background-color:transparent;">руководства по начальной настройке сервера</span></a><span style=" font-size:medium;"> вы можете выполнить шаги 1–3 руководства </span><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-configure-a-certificate-authority-ca-on-ubuntu-20-04"><span style=" font-size:medium; text-decoration: underline; color:#0000ff; background-color:transparent;">Установка и настройка центра сертификации в Ubuntu 20.04</span></a><span style=" font-size:medium;">.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> Хотя технически возможно использовать ваш сервер OpenVPN или ваш локальный компьютер в качестве центра сертификации, делать это не рекомендуется, поскольку это открывает ваш VPN для ряда уязвимостей. Согласно </span><a href="https://openvpn.net/index.php/open-source/documentation/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">официальной документации OpenVPN</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">, вы должны разместить ЦС на отдельном компьютере, который будет отвечать за импорт и подписание запросов сертификатов. По этой причине в данном обучающем модуле предполагается, что ваш ЦС располагается на отдельном сервере Ubuntu 20.04, где также имеются пользователь без привилегий root с привилегиями sudo и базовый брандмауэр.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Помимо этого вам потребуется клиентский компьютер, который вы будете использовать для подключения к вашему серверу OpenVPN. В этом обучающем руководстве мы будем называть его </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">клиентом OpenVPN</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. В целях данного руководства рекомендуется использовать ваш локальный компьютер в качестве клиента OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После выполнения всех предварительных требований вы можете начать установку и настройку сервера OpenVPN в Ubuntu 20.04.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> Обратите внимание, что если вы отключите аутентификацию с помощью пароля при настройке этих серверов, то можете столкнуться с трудностями при передаче файлов между ними, как предусматривается последующими разделами этого обучающего руководства. Чтобы устранить эту проблему, вам нужно будет заново включить аутентификацию с помощью пароля на каждом сервере. Также вы можете сгенерировать пару ключей SSH для каждого сервера и добавить публичный ключ SSH сервера OpenVPN в файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">authorized_keys</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> на компьютере ЦС, и наоборот. Дополнительные инструкции по этим решениям можно найти в обучающем модуле </span><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-20-04"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">Настройка ключей SSH в Ubuntu 20.04</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="1-openvpn-easy-rsa"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 1 — Установка OpenVPN и Easy-RSA</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Первый шаг этого руководства подразумевает установку OpenVPN и Easy-RSA. Easy-RSA — это инструмент управления инфраструктурой открытых ключей (PKI), который вы будете использовать на сервере OpenVPN для генерации запроса сертификата, который вы затем будете проверять и подписывать на сервере ЦС.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для начала обновите указатель пакетов сервера OpenVPN и установите OpenVPN и Easy-RSA. Оба пакета доступны в репозиториях Ubuntu по умолчанию, и поэтому вы можете использовать </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">apt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для установки:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">apt</span><span style=" font-size:medium;"> update</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">apt</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">install</span><span style=" font-size:medium;"> openvpn easy-rsa</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Далее вам потребуется создать новую директорию на сервере OpenVPN от имени вашего пользователя non-root user с названием </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">mkdir</span><span style=" font-size:medium;"> ~/easy-rsa</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь вам нужно создать символьную ссылку из скрипта </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easyrsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, установленного пакетом в директории </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, которую вы только что создали:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">ln</span><span style=" font-size:medium;"> -s /usr/share/easy-rsa/* ~/easy-rsa/</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> Хотя другие руководства могут предписывать скопировать файлы пакета </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> в директорию PKI, в этом обучающем руководстве мы используем подход на основе символьных ссылок. Таким образом, любые изменения пакета </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> будут автоматически отражаться в ваших скриптах PKI.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В заключение убедитесь, что владельцем директории является ваш пользователь non-root user с привилегиями sudo, и ограничьте доступ с помощью команды </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">chmod</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">chown</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;"> ~/easy-rsa</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">chmod</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#225196;">700</span><span style=" font-size:medium;"> ~/easy-rsa</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После установки этих программ и их перемещения в нужные локации в вашей системе следующим шагом будет создание инфраструктуры открытых ключей (PKI) на сервере OpenVPN, чтобы вы могли запрашивать и управлять сертификатами TLS для клиентов и других серверов, которые будут подключаться к вашему VPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="2-pki-openvpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 2 — Создание PKI для OpenVPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Прежде чем вы сможете создавать закрытый ключ и сертификат вашего сервера OpenVPN, вам нужно создать локальную директорию инфраструктуры открытых ключей на сервере OpenVPN. Вы будете использовать эту директорию для управления запросами сертификата сервера и клиентов, вместо того чтобы получать их прямо на сервере ЦС.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для создания директории PKI на сервере OpenVPN вам нужно указать в файле </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">vars</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> ряд значений по умолчанию. Используйте команду </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">cd</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для перехода в каталог </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, а затем создайте и отредактируйте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">vars</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с помощью nano или другого предпочитаемого текстового редактора:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cd</span><span style=" font-size:medium;"> ~/easy-rsa</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> vars</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После открытия файла вставьте следующие две строки:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/easy-rsa/vars</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">set_var EASYRSA_ALGO &quot;ec&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">set_var EASYRSA_DIGEST &quot;sha512&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Эти две строки потребуются вам в файле </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">vars</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на сервере OpenVPN, поскольку он не будет использоваться в качестве ЦС. Они будут гарантировать, что ваши закрытые ключи и запросы сертификата будут настроены для использования современной криптографии на эллиптических кривых (Elliptic Curve Cryptography, ECC) при генерации ключей и защищенных подписей для ваших клиентов и сервера OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Под настройкой использования ECC для ваших серверов OpenVPN и ЦС подразумевается, что, когда клиент и сервер будут пытаться установить общий симметричный ключ, они будут использовать алгоритмы эллиптической кривой для обмена. Использование ECC для обмена ключами значительно быстрее, чем использование простого алгоритма Диффи — Хеллмана с классическим алгоритмом RSA, поскольку числа намного меньше, а вычисления выполняются быстрее.</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Справка:</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> когда клиенты подключаются к OpenVPN, они используют асимметричное шифрование (также известное как открытый/закрытый ключ) для выполнения </span><a href="https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">TLS-рукопожатия</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">. Однако при передаче шифрованного VPN-трафика сервер и клиенты используют симметричное шифрование, которое также известно как шифрование общедоступного ключа.</span></p>
<p style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">Симметричное шифрование требует гораздо меньшего количества вычислений по сравнению с асимметричным: используемые числа гораздо меньше, и современные процессоры имеют </span><a href="https://en.wikipedia.org/wiki/AES_instruction_set"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">инструкции для выполнения оптимизированного симметричного шифрования</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">. Для переключения с асимметричного на симметричное шифрование сервер OpenVPN и клиент будут использовать </span><a href="https://en.wikipedia.org/wiki/Elliptic_curve_Diffie-Hellman"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">алгоритм Диффи — Хеллмана на эллиптических кривых</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> для согласования общего секретного ключа в максимально короткие сроки.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После добавления в файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">vars</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> данных вы можете перейти к созданию директории PKI. Для этого воспользуйтесь скриптом </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easyrsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с опцией </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">init-pki</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Хотя вы уже использовали эту команду на сервере ЦС в соответствии с предварительными требованиями, необходимо запустить ее здесь, поскольку сервер OpenVPN и сервер ЦС имеют разные директории PKI.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./easyrsa init-pki</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Обратите внимание, что на сервере OpenVPN не нужно создавать центр сертификации. Ваш сервер ЦС отвечает за валидацию и подпись сертификатов. PKI на вашем сервере VPN используется только в качестве удобного и централизованного места хранения запросов сертификата и публичных сертификатов.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После инициализации PKI на сервере OpenVPN вы можете перейти к следующему шагу и создать запрос сертификата и закрытого ключа сервера OpenVPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="3-openvpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 3 — Создание запроса сертификата и закрытого ключа сервера OpenVPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь, когда на вашем сервере OpenVPN установлено все необходимое, на следующем шаге мы сгенерируем закрытый ключ и запрос подписи сертификата на вашем сервере OpenVPN. После этого вы передадите запрос в ваш центр сертификации для подписи, создав необходимый сертификат. После подписи сертификата вы передадите его назад на сервер OpenVPN и установите его для использования на сервере.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для начала перейдите в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на сервере OpenVPN, используя вашего пользователя non-root user:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cd</span><span style=" font-size:medium;"> ~/easy-rsa</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь вы можете вызвать </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easyrsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с опцией </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">gen-req</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, за которой необходимо указать стандартное имя для компьютера. Вы можете использовать любое стандартное имя, но лучше всего выбрать запоминающийся вариант. В этом обучающем руководстве для сервера OpenVPN будет использоваться стандартное имя </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Обязательно добавьте опцию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nopass</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Без этого файл запроса будет защищен паролем, что впоследствии может привести к проблемам с разрешениями.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> Если вы выберете любое другое имя, а не </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">, вы должны будете следовать некоторым из приведенных ниже инструкций с изменениями. Например, при копировании сгенерированных файлов в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> вам нужно будет указать правильные имена. Позднее вам нужно будет изменить файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">etc/openvpn/server.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">, чтобы он указывал на соответствующие файлы </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./easyrsa gen-req </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">server</span><span style=" font-size:medium;"> nopass</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">Common Name (eg: your user, host, or server name) [server]:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">Keypair and certificate request completed. Your files are:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">req: /home/sammy/easy-rsa/pki/reqs/server.req</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">key: /home/sammy/easy-rsa/pki/private/server.key</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В результате будет создан закрытый ключ для сервера и файл запроса сертификата с именем </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.req</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Скопируйте ключ сервера в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> /home/sammy/easy-rsa/pki/private/server.key /etc/openvpn/server/</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В результате выполнения этих шагов вы успешно создали закрытый ключ для вашего сервера OpenVPN. Также вы создали запрос на подпись сертификата для сервера OpenVPN. Запрос на подпись сертификата теперь готов к подписи в вашем центре сертификации. В следующем разделе этого обучающего руководства вы узнаете, как подписать запрос на подпись сертификата с помощью закрытого ключа вашего сервера ЦС.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="4-openvpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 4 — Подпись запроса сертификата сервера OpenVPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">На предыдущем шаге вы создали запрос на подпись сертификата (CSR) и закрытый ключ для сервера OpenVPN. Теперь сервер ЦС должен узнать о сертификате </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и выполнить его валидацию. После подтверждения сертификата сервером ЦС и его отправки назад на сервер OpenVPN клиенты, которые доверяют вашему ЦС, также смогут доверять серверу OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">На сервере OpenVPN от имени вашего пользователя non-root user воспользуйтесь запросом на передачу или другим методом передачи для копирования запроса сертификата </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.req</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на сервер ЦС для подписи:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">scp</span><span style=" font-size:medium;"> /home/sammy/easy-rsa/pki/reqs/server.req </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;">@</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">your_ca_server_ip</span><span style=" font-size:medium;">:/tmp</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы выполнили предварительное требование </span><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-configure-a-certificate-authority-ca-on-ubuntu-20-04"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">обучающего модуля «Установка и настройка Центра сертификации (ЦС) в Ubuntu 20.04</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">», следующим шагом будет войти на </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">сервер ЦС</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> как пользователь без привилегий root, которого вы создали для управления ЦС. Вы использовали команду </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">cd</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для перехода в каталог </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, где вы создали и импортируйте запрос сертификата с помощью скрипта </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easyrsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f; background-color:#fdebf5;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cd</span><span style=" font-size:medium;"> ~/easy-rsa</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./easyrsa import-req /tmp/server.req server</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">. . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">The request has been successfully imported with a short name of: server</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">You may now use this name to perform signing operations on this request.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f; background-color:#fdebf5;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Далее подпишите запрос, запустив скрипт </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easyrsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с опцией </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">sign-req</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и указанием типа запроса и стандартного имени. В качестве типа запроса может использоваться </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> или </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Поскольку мы работаем с запросом сертификата сервера OpenVPN, необходимо использовать тип запроса </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f; background-color:#fdebf5;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./easyrsa sign-req server </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">server</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В выводе вам будет нужно подтвердить, что запрос поступил из надежного источника. Введите </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">yes</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, а затем нажмите </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ENTER</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для подтверждения:</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">You are about to sign the following certificate.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">Please check over the details shown below for accuracy. Note that this request</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">has not been cryptographically verified. Please be sure it came from a trusted</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">source or that you have verified the request checksum with the sender.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f; background-color:#fdebf5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">Request subject, to be signed as a server certificate for 3650 days:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f; background-color:#fdebf5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">subject=</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">commonName = </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">server</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#fdebf5;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#fdebf5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">Type the word 'yes' to continue, or any other input to abort.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">Confirm request details: yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">. . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">Certificate created at: /home/sammy/easy-rsa/pki/issued/server.crt</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f; background-color:#fdebf5;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Обратите внимание, что если вы зашифровали закрытый ключ ЦС, вам будет предложено ввести пароль в данный момент.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В результате выполнения этих шагов вы успешно подписали запрос сертификата сервера OpenVPN с помощью закрытого ключа сервера ЦС. Полученный файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​​ содержит открытый ключ шифрования сервера OpenVPN, а также новую подпись от сервера ЦС. Смысл подписи состоит в том, чтобы сообщить всем, кто доверяет серверу ЦС, что они также могут доверять серверу OpenVPN при подключении к нему.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для завершения настройки сертификатов скопируйте файлы </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ca.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с сервера ЦС на сервер OpenVPN:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f; background-color:#fdebf5;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">scp</span><span style=" font-size:medium;"> pki/issued/server.crt </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;">@</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">your_vpn_server_ip</span><span style=" font-size:medium;">:/tmp</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">scp</span><span style=" font-size:medium;"> pki/ca.crt </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;">@</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">your_vpn_server_ip</span><span style=" font-size:medium;">:/tmp</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь вернитесь на ваш сервер OpenVPN, скопируйте файлы из </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/tmp</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> /tmp/</span><span style=" font-size:medium; color:#666a71;">{</span><span style=" font-size:medium;">server.crt,ca.crt</span><span style=" font-size:medium; color:#666a71;">}</span><span style=" font-size:medium;"> /etc/openvpn/server</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь ваш сервер OpenVPN почти готов к принятию подключений. На следующем шаге вы выполните ряд дополнительных шагов для повышения безопасности сервера.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="5-openvpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 5 — Настройка криптографических материалов OpenVPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В качестве дополнительного уровня безопасности мы добавим дополнительный общий секретный ключ, который будет использовать сервер и все клиенты, с помощью </span><a href="https://build.openvpn.net/doxygen/group__tls__crypt.html#details"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">директивы OpenVPN </span></a><a href="https://build.openvpn.net/doxygen/group__tls__crypt.html#details"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; text-decoration: underline; color:#535772; background-color:#f3f5f9;">tls-crypt</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Эта опция используется, чтобы «затемнить» сертификат TLS, используемый, когда сервер и клиент первоначально подключаются друг к другу. Также она используется сервером OpenVPN для выполнения быстрых проверок входящих пакетов: если пакет подписан с помощью предварительно предоставленного ключа, сервер обрабатывает его, если подпись отсутствует, сервер понимает, что пакет получен из непроверенного источника, и может отклонить его, не выполняя дополнительную работу по расшифровке.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Эта опция поможет убедиться, что ваш сервер OpenVPN может справляться с неудостоверенным трафиком, сканированием портов и DoS-атаками, которые могут связывать ресурсы сервера. Она также затрудняет выявление сетевого трафика OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для получения предварительно предоставленного ключа </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">tls-crypt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​​ запустите следующую команду на сервере OpenVPN в директории </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/easy-rsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cd</span><span style=" font-size:medium;"> ~/easy-rsa</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">openvpn --genkey --secret ta.key</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В результате вы получите файл с именем </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ta.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Скопируйте его в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/server/</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> ta.key /etc/openvpn/server</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После получения этих файлов на сервере OpenVPN вы можете переходить к созданию клиентских сертификатов и файлов ключей для ваших пользователей, которые вы будете использовать для подключения к VPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="6"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 6 — Создание сертификата клиента и пары ключей</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Хотя вы можете сгенерировать закрытый ключ и запрос сертификата на клиентской системе и отправить их в ЦС для подписания, в этом обучающем руководстве мы рассмотрим процесс генерирования запроса сертификата на сервере OpenVPN. Преимущество этого подхода заключается в том, что мы можем создать скрипт, который будет автоматически генерировать файлы конфигурации клиентов, содержащие все необходимые ключи и сертификаты. Благодаря этому вам не нужно будет передавать ключи, сертификаты и файлы конфигурации на клиентские системы, и процесс подключения к VPN ускорится.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В этом обучающем руководстве мы создадим одну пару из ключа и сертификата для клиентской системы. Если у вас несколько клиентских систем, вы можете повторить этот процесс для каждой такой системы. Обратите внимание, что для каждого клиента в скрипте нужно указать уникальное имя. В этом обучающем руководстве мы будем использовать первую пару сертификат/ключ под именем </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вначале создайте в домашней директории структуру директорий, где будут храниться файлы сертификатов и ключей клиентской системы:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">mkdir</span><span style=" font-size:medium;"> -p ~/client-configs/keys</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Поскольку в этой директории будут храниться пары сертификат/ключ ваших клиентов и файлы конфигурации, для нее следует закрыть все разрешения:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">chmod</span><span style=" font-size:medium;"> -R </span><span style=" font-size:medium; color:#225196;">700</span><span style=" font-size:medium;"> ~/client-configs</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вернитесь в директорию EasyRSA и запустите скрипт </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">easyrsa</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с опциями </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">gen-req</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nopass</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, указав обычное имя клиента:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cd</span><span style=" font-size:medium;"> ~/easy-rsa</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./easyrsa gen-req </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">client1</span><span style=" font-size:medium;"> nopass</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Нажмите </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ENTER</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы подтвердить обычное имя. Скопируйте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в ранее созданную директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/client-configs/keys/</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​​:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> pki/private/client1.key ~/client-configs/keys/</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем передайте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.req</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на сервер ЦС, используя безопасный метод:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">scp</span><span style=" font-size:medium;"> pki/reqs/client1.req </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;">@</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">your_ca_server_ip</span><span style=" font-size:medium;">:/tmp</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь выполните вход на ваш сервер ЦС. Затем перейдите в директорию EasyRSA и импортируйте запрос сертификата:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f; background-color:#fdebf5;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cd</span><span style=" font-size:medium;"> ~/easy-rsa</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./easyrsa import-req /tmp/client1.req client1</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем подпишите запрос, как вы делали это для сервера на предыдущем шаге. Однако в этот раз обязательно укажите тип запроса </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f; background-color:#fdebf5;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./easyrsa sign-req client </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">client1</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">При запросе введите </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">yes</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы подтвердить, что вы планируете подписать запрос сертификата и что он поступил из доверенного источника:</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">Type the word 'yes' to continue, or any other input to abort.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fdebf5;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#86003f;">Confirm request details: </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">yes</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#fdebf5;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы зашифровали свой ключ ЦС, вам будет предложено ввести пароль.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В результате будет создан файл клиентского сертификата с именем </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Переместите этот файл обратно на сервер.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#86003f; background-color:#fdebf5;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">scp</span><span style=" font-size:medium;"> pki/issued/client1.crt </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;">@</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">your_server_ip</span><span style=" font-size:medium;">:/tmp</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вернитесь на ваш сервер OpenVPN, скопируйте клиентский сертификат в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/client-configs/keys/</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> /tmp/client1.crt ~/client-configs/keys/</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем скопируйте файлы </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ca.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ta.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/client-configs/keys/</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и предоставьте соответствующие разрешения для вашего пользователя sudo:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> ~/easy-rsa/ta.key ~/client-configs/keys/</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> /etc/openvpn/server/ca.crt ~/client-configs/keys/</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">chown</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;">.</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;"> ~/client-configs/keys/*</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В результате вы сгенерировали ключи и сертификаты для сервера и клиента и сохранили их в соответствующих директориях на вашем сервере OpenVPN. С этими файлами еще предстоит выполнить несколько действий, но к ним мы вернемся позднее. Теперь вы можете перейти к настройке OpenVPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="7-openvpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 7 — Настройка OpenVPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Как и во многих широко используемых инструментах с открытым исходным кодом, OpenVPN имеет множество доступных параметров настройки для кастомизации вашего сервера согласно вашим нуждам. В этом разделе мы предоставим инструкции по настройке конфигурации сервера OpenVPN на основе одного из примеров файлов конфигурации, который включен в документацию для этого программного обеспечения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вначале скопируйте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в качестве отправной точки для вашего собственного файла конфигурации:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz /etc/openvpn/server/</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> gunzip /etc/openvpn/server/server.conf.gz</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Откройте новый файл для редактирования в текстовом редакторе по вашему выбору. В нашем случае мы будем использовать nano:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> /etc/openvpn/server/server.conf</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Нам нужно изменить несколько строк в этом файле. Сначала необходимо найти раздел </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">HMAC</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в конфигурации, выполнив поиск директивы </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">tls-auth</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Эта строка должна быть разкомментирована. Закомментируйте ее, добавив </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">;</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в начало строки. Затем добавьте после нее новую строку, содержащую только значение </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">tls-crypt ta.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​​:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">tls-auth ta.key 0 # This file is secret</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">tls-crypt ta.key</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем найдите раздел криптографических шифров, выполнив поиск строк с текстом </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">cipher</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. По умолчанию установлено значение </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">AES-256-CBC</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, однако шифр </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">AES-256-GCM</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> обеспечивает более высокий уровень шифрования, производительности и лучше поддерживается современными клиентами OpenVPN. Мы закомментируем значение по умолчанию, добавив </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">;</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в начало этой строки, а затем добавим другую строку после нее, содержащую обновленное значение </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">AES-256-GCM</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">cipher AES-256-CBC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">cipher AES-256-GCM</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сразу после этой строки добавьте директиву </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">auth</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для выбора алгоритма выборки сообщений HMAC. Для этого хорошо подойдет </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">SHA256</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">auth SHA256</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем найдите строку с директивой </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">dh</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, которая определяет параметры алгоритма Диффи — Хеллмана. Поскольку мы настроили все сертификаты для использования криптографии на эллиптических кривых, нет необходимости в использовании файла прототипа Диффи — Хеллмана. Закомментируйте существующую строку </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">dh dh2048.pem</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​​ или </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">dh dh.pem</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Имя файла для ключа Диффи — Хеллмана может отличаться от того, что перечислено в примере файла конфигурации сервера. Затем добавьте строку после нее с содержанием </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">dh none</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">dh dh2048.pem</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">dh none</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Далее нам нужно запустить OpenVPN без привилегий, с которыми он запущен, поэтому нам нужно указать на необходимость запуска с пользователем </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">nobody</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и группой </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">nogroup</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Чтобы активировать эту возможность, найдите и разкомментируйте строки </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">user nobody</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">group nogroup</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, удалив </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">;</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в начале каждой строки:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">user nobody</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">group nogroup</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="dns-vpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">(</span><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">Необязательно) Изменение DNS для перенаправления всего трафика через сеть VPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вышеуказанные настройки создадут соединение VPN между вашим клиентом и сервером, но не будут заставлять соединения использовать туннель. Если вы хотите использовать VPN для перенаправления всего вашего клиентского трафика, вам нужно будет передать дополнительные настройки на клиентские компьютеры.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для начала найдите и разкомментируйте строку </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Она будет сообщать вашему клиенту о необходимости перенаправлять весь трафик через ваш сервер OpenVPN. Обратите внимание, что при активации этой функции могут возникать проблемы с подключением к другим сетевым службам, например SSH:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Под этой строкой найдите раздел </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">dhcp-option</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Удалите </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">;</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в начале обеих строк, чтобы разкомментировать эти строки:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">push &quot;dhcp-option DNS </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">208.67.222.222</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">push &quot;dhcp-option DNS </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">208.67.220.220</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Эти строки будут сообщать вашему клиенту о необходимости использования бесплатных </span><a href="https://www.opendns.com/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">интерпретаторов OpenDNS</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на перечисленных IP-адресах. Если вы предпочитаете использовать другие интерпретаторы DNS, вставьте их на место выделенных IP-адресов.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Это поможет клиентам изменить настройки DNS, чтобы туннель VPN использовался как шлюз по умолчанию.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">(Необязательно) Изменение порта и протокола</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">По умолчанию сервер OpenVPN использует для подключения клиентов порт </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">1194</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и протокол UDP. Если вам потребуется использовать другой порт из-за ограничений сети клиента, вы можете изменить номер </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">порта</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Если вы не храните веб-контент на сервере OpenVPN, вам подойдет порт </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">443</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, поскольку его обычно не запрещают правила брандмауэра.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Чтобы заставить OpenVPN прослушивать порт 443, откройте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и найдите строку, которая выглядит следующим образом:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">port 1194</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Измените ее, указав порт 443:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># Optional!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">port </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">443</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Довольно часто этот порт также ограничивает протокол. В этом случае найдите строку </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">proto</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> под строкой </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">port</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и измените протокол с </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">udp</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">tcp</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># Optional!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">proto </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">tcp</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">действительно</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> смените протокол на TCP, вам нужно будет изменить значение директивы </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">explicit-exit-notify</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">1</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">0</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, поскольку эта директива используется только протоколом UDP. В противном случае при запуске службы OpenVPN возможны ошибки протокола TCP.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Найдите строку </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">explicit-exit-notify</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в конце файла и измените значение на </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">0</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># Optional!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">explicit-exit-notify </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вам не нужно использовать другие порт и протокол, лучше всего оставить эти настройки без изменений.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">(Необязательно) Указание на учетные данные, отличающиеся от используемых по умолчанию</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы выбрали другое имя при вводе команды </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">./easyrsa gen-req server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> ранее, измените строки </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">cert</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">key​​​</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в файле конфигурации </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​, чтобы они указывали на соответствующие файлы </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Если вы использовали имя по умолчанию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, можно считать, что все уже настроено корректно:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">cert </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">server</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">.crt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">key </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">server</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">.key</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После завершения редактирования сохраните и закройте файл.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вы успешно завершили настройку общих параметров OpenVPN. На следующем шаге мы настроим сетевые параметры сервера.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="8-openvpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 8 — Настройка конфигурации сети сервера OpenVPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Чтобы OpenVPN мог правильно перенаправлять трафик через сеть VPN, необходимо изменить некоторые параметры конфигурации сети сервера. Прежде всего нужно изменить параметр </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-style:italic; color:#000000;">IP forwarding</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, который определяет необходимость перенаправления IP-трафика. Это необходимо для реализации функций VPN, обеспечиваемых вашим сервером.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Чтобы изменить используемые по умолчанию настройки IP-передачи сервера OpenVPN, откройте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/sysctl.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с помощью </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nano</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> или предпочитаемого редактора:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> /etc/sysctl.conf</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Добавьте следующую строку в конец файла:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/sysctl.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">net.ipv4.ip_forward = 1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сохраните файл и закройте его после завершения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Чтобы прочитать файл и загрузить значения для текущей сессии, введите:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> sysctl -p</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">net.ipv4.ip_forward = 1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь ваш сервер OpenVPN сможет перенаправлять входящий трафик из одного сетевого устройства на другое. Эта настройка гарантирует, что сервер сможет направлять трафик от клиентов, подключенных к виртуальному интерфейсу VPN, на другие физические сетевые устройства. Эта конфигурация будет передавать весь веб-трафик от вашего клиента через IP-адрес вашего сервера, а открытый IP-адрес клиента будет фактически скрыт.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">На следующем шаге вам нужно настроить ряд правил брандмауэра, чтобы гарантировать корректную передачу входящего и исходящего трафика на вашем сервере OpenVPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="9"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 9 — Настройка брандмауэра</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">К настоящему моменту вы установили OpenVPN на ваш сервер, настроили его и создали ключи и сертификаты, необходимые вашему клиенту для доступа к VPN. Однако вы еще не предоставили OpenVPN какие-либо инструкции о том, куда нужно отправлять входящий веб-трафик от клиентов. Вы можете указать, как сервер должен обрабатывать клиентский трафик, добавив ряд правил брандмауэра и настроив конфигурацию маршрутизации.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы выполнили предварительные требования, указанные в начале этого обучающего модуля, у вас на сервере должен быть установлен и запущен </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ufw</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Чтобы разрешить OpenVPN через брандмауэр, вам нужно будет включить маскировку. Маскировка — это концепция таблиц iptables, на основе которой выполняется автоматическая трансляция сетевых адресов (NAT) для правильной маршрутизации клиентских соединений.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Прежде чем открыть файл конфигурации брандмауэра для добавления правил маскарадинга, нужно предварительно найти публичный сетевой интерфейс компьютера. Для этого введите:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">ip</span><span style=" font-size:medium;"> route list default</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Строка после слова «dev» в этой команде — это ваш публичный интерфейс. Например, в этом результате показан интерфейс с именем </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">eth0</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, который выделен ниже:</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">default via 159.65.160.1 dev </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">eth0</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"> proto static</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Когда у вас будет интерфейс, связанный с маршрутом по умолчанию, откройте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/ufw/before.rules</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы добавить соответствующую конфигурацию:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> /etc/ufw/before.rules</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Правила UFW обычно добавляются с помощью команды </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ufw</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Правила, перечисленные в файле </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">before.rules</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, считываются и активируются до загрузки обычных правил UFW. Добавьте в верхнюю часть файла выделенные ниже строки. После этого будет задана политика по умолчанию для цепочки </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">POSTROUTING</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в таблице </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nat</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, и любой трафик из VPN будет маскироваться. Обязательно замените </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">eth0</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в строке </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">-A POSTROUTING</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на интерфейс, определенный с помощью следующей команды:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/ufw/before.rules</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">#</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;"># rules.before</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">#</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;"># Rules that should be run before the ufw command line added rules. Custom</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;"># rules should be added to one of these chains:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">#   ufw-before-input</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">#   ufw-before-output</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">#   ufw-before-forward</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">#</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#f3f5f9;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);"># START OPENVPN RULES</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);"># NAT table rules</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">*nat</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">:POSTROUTING ACCEPT [0:0]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);"># Allow traffic from OpenVPN client to </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">eth0</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);"> (change to the interface you discovered!)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">-A POSTROUTING -s 10.8.0.0/8 -o </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">eth0</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);"> -j MASQUERADE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">COMMIT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);"># END OPENVPN RULES</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#f3f5f9;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;"># Don't delete these required lines, otherwise there will be errors</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">*filter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">. . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#f3f5f9;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сохраните файл и закройте его после завершения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем вам нужно будет указать UFW разрешать перенаправление пакетов по умолчанию. Для этого откройте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/default/ufw</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#535772; background-color:#f3f5f9;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> /etc/default/ufw</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Найдите в файле директиву </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">DEFAULT_FORWARD_POLICY</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и измените значение с </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">DROP</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ACCEPT</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/default/ufw</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">DEFAULT_FORWARD_POLICY=&quot;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">ACCEPT</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000;">&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#f3f5f9;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сохраните файл и закройте его после завершения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем измените настройки брандмауэра, чтобы разрешить трафик OpenVPN. Если вы не изменили порт и протокол в файле </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/server.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, вам нужно будет открыть трафик UDP на порту </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">1194</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Если вы изменили порт или протокол, замените выбранные здесь значения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы забыли добавить порт SSH при выполнении обязательного обучающего модуля, добавьте его сейчас:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#535772; background-color:#f3f5f9;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> ufw allow </span><span style=" font-size:medium; color:#225196; background-color:rgba(242,201,76,0.34902);">1194</span><span style=" font-size:medium;">/</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">udp</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#535772;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> ufw allow OpenSSH</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После добавления этих правил отключите и заново включите UFW, чтобы загрузить изменения из всех измененных файлов:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#535772; background-color:#f3f5f9;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> ufw disable</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#535772;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> ufw </span><span style=" font-size:medium; color:#e0276a;">enable</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь ваш сервер настроен для правильной обработки трафика OpenVPN. После создания правил брандмауэра мы можем запустить службу OpenVPN на сервере.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="10-openvpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 10 — Запуск OpenVPN</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">OpenVPN работает как служба </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, поэтому мы можем использовать </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemctl</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для управления. Мы настроим для OpenVPN запуск при загрузке, чтобы вы могли подключаться к вашей VPN в любое время, пока ваш сервер работает. Для этого активируйте службу OpenVPN, добавив ее в </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemctl</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> systemctl -f </span><span style=" font-size:medium; color:#e0276a;">enable</span><span style=" font-size:medium;"> openvpn-server@server.service</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем запустите службу OpenVPN:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> systemctl start openvpn-server@server.service</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Еще раз проверьте, что служба OpenVPN активна, воспользовавшись следующей командой. Вы должны увидеть в выводе </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">active (running)</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> systemctl status openvpn-server@server.service</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">● openvpn-server@server.service - OpenVPN service for server</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; vendor preset: enabled)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">     Active: active (running) since Wed 2020-04-29 15:39:59 UTC; 6s ago</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">       Docs: man:openvpn(8)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">             https://community.openvpn.net/openvpn/wiki/HOWTO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">   Main PID: 16872 (openvpn)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">     Status: &quot;Initialization Sequence Completed&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">      Tasks: 1 (limit: 1137)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">     Memory: 1.0M</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">     CGroup: /system.slice/system-openvpn\x2dserver.slice/openvpn-server@server.service</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">             └─16872 /usr/sbin/openvpn --status /run/openvpn-server/status-server.log --status-version 2 --suppress-timestamps --c&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">. . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">. . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">Apr 29 15:39:59 ubuntu-20 openvpn[16872]: Initialization Sequence Completed</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Мы успешно завершили конфигурацию OpenVPN на стороне сервера. Далее вам нужно будет настроить клиентский компьютер и подключиться к серверу OpenVPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="11"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 11 — Создание инфраструктуры конфигурации клиентских систем</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Создание файлов конфигурации для клиентов OpenVPN может быть связано с этой задачей, поскольку каждый клиент должен иметь собственную конфигурацию, и каждая из этих конфигураций должна соответствовать параметрам, заданным в файле конфигурации сервера. Вместо создания единого файла конфигурации, который можно использовать только для одного клиента, на этом шаге мы определим процесс создания инфраструктуры клиентской конфигурации, который вы сможете использовать для быстрого генерирования файлов конфигурации. Вначале вы создадите «базовый» файл конфигурации, а затем сценарий, который позволит по мере необходимости генерировать уникальные файлы конфигурации клиентов, сертификаты и ключи.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для начала создайте новую директорию для хранения файлов конфигурации клиентов в ранее созданной директории </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client-configs</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">mkdir</span><span style=" font-size:medium;"> -p ~/client-configs/files</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем скопируйте файл с образцом конфигурации клиента в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client-configs</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы использовать ее как базовую конфигурацию:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Откройте новый файл в </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nano</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> или предпочитаемом текстовом редакторе:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> ~/client-configs/base.conf</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Найдите в файле директиву </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">remote</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Она указывает клиенту адрес сервера OpenVPN, т. е. публичный IP-адрес вашего сервера OpenVPN. Если вы решили изменить порт, который будет прослушивать сервер OpenVPN, вам нужно будет заменить </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">1194</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на выбранный порт:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">. . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># The hostname/IP and port of the server.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># You can have multiple remote entries</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># to load balance between the servers.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">remote </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">your_server_ip</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"> </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">1194</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">. . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Протокол должен соответствовать значениям, используемым в конфигурации сервера:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">proto </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">udp</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Разкомментируйте директивы </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">user</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">group</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, удалив символ </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">;</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в начале каждой строки:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># Downgrade privileges after initialization (non-Windows only)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">user nobody</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">group nogroup</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Найдите директивы, задающие </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ca</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">cert</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Поставьте знак комментария перед строками этих директив, поскольку вы вскоре добавите сертификаты и ключи в сам файл:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># SSL/TLS parms.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># See the server config file for more</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># description. It's best to use</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># a separate .crt/.key file pair</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># for each client. A single ca</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># file can be used for all clients.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">ca ca.crt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">cert client.crt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">key client.key</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем закомментируйте директиву </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">tls-auth</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, поскольку вы добавите </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">ta.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> прямо в файл конфигурации клиента (а сервер настроен на использование </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">tls-crypt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">):</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># If a tls-auth key is used on the server</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># then every client must also have the key.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">;</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">tls-auth ta.key 1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Создайте зеркало настроек </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">cipher</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">auth</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, заданных в файле </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/server/server.conf​​​</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">cipher AES-256-GCM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">auth SHA256</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем добавьте в файл директиву </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">key-direction</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Вы </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">должны</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> задать значение «1», чтобы VPN правильно работала на клиентском компьютере:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">key-direction 1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В заключение добавьте несколько </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">закомментированных</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> строк для обработки различных методов, которые клиенты VPN на базе Linux будут использовать для разрешения DNS. Также мы добавим два похожих, но отдельных набора закомментированных строк. Первый набор предназначен для клиентов, которые </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-style:italic; color:#000000;">не</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> используют </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для управления DNS. Эти клиенты используют утилиту </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">resolvconf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для обновления информации DNS для клиентов Linux.</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; script-security 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; up /etc/openvpn/update-resolv-conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; down /etc/openvpn/update-resolv-conf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь добавьте другой набор строк для клиентов, которые используют </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для разрешения DNS:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/base.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; script-security 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; up /etc/openvpn/update-systemd-resolved</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; down /etc/openvpn/update-systemd-resolved</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; down-pre</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">; dhcp-option DOMAIN-ROUTE .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сохраните файл и закройте его после завершения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">На </span><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-configure-an-openvpn-server-on-ubuntu-20-04-ru#step-13-%E2%80%94-installing-the-client-configuration"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">шаге 13 «Установка конфигурации клиента</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">» этого обучающего модуля вы узнаете, как определять, работает ли разрешение DNS для клиентов Linux, и какой раздел нужно разкомментировать.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Далее создайте простой скрипт, который скомпилирует базовую конфигурацию с соответствующим сертификатом, ключом и файлами шифрования, и поместите сгенерированную конфигурацию в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/client-configs/files</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Откройте новый файл с именем </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">make_config.sh</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в директории </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/client-configs</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> ~/client-configs/make_config.sh</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Добавьте в файл следующее:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">~/client-configs/make_config.sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">#!/bin/bash</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;"># First argument: Client identifier</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">KEY_DIR=~/client-configs/keys</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">OUTPUT_DIR=~/client-configs/files</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">BASE_CONFIG=~/client-configs/base.conf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">cat ${BASE_CONFIG} \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    &lt;(echo -e '&lt;ca&gt;') \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    ${KEY_DIR}/ca.crt \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    &lt;(echo -e '&lt;/ca&gt;\n&lt;cert&gt;') \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    ${KEY_DIR}/${1}.crt \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    &lt;(echo -e '&lt;/cert&gt;\n&lt;key&gt;') \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    ${KEY_DIR}/${1}.key \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    &lt;(echo -e '&lt;/key&gt;\n&lt;tls-crypt&gt;') \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    ${KEY_DIR}/ta.key \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    &lt;(echo -e '&lt;/tls-crypt&gt;') \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">    &gt; ${OUTPUT_DIR}/${1}.ovpn</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сохраните файл и закройте его после завершения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Прежде чем продолжить, отметьте этот файл как исполняемый, введя следующую команду:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">chmod</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#225196;">700</span><span style=" font-size:medium;"> ~/client-configs/make_config.sh</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Этот скрипт создает копию созданного вами файла </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">base.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, собирает все созданные вами для клиента файлы сертификатов и ключей, извлекает их содержимое, добавляет их в копию базового файла конфигурации и экспортирует все это в новый файл конфигурации клиента. Это означает, что вся необходимая информация хранится в одном месте, и вам не нужно по отдельности управлять файлами конфигурации клиента, сертификатами и ключами. Преимущество такого метода состоит в том, что если в будущем вам потребуется добавить клиент, вы можете просто запустить этот скрипт, чтобы быстро создать файл конфигурации, а вся важная информация будет храниться в одном удобном для доступа месте.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Учтите, что при добавлении каждого нового клиента вам нужно будет сгенерировать для него новые ключи и сертификаты, прежде чем запускать этот скрипт и генерировать файл конфигурации. На следующем шаге вы сможете потренироваться в использовании этого скрипта.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="12"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 12 — Создание конфигураций клиентов</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы следовали указаниям руководства, на шаге 6 вы создали клиентский сертификат и ключ с именами </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.crt</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.key</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> соответственно. Вы можете сгенерировать файл конфигурации для этих учетных данных, перейдя в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/client-configs</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и запустив скрипт, созданный в конце предыдущего шага:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">cd</span><span style=" font-size:medium;"> ~/client-configs</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">./make_config.sh </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">client1</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">При этом файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> будет создан в директории </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~/client-configs/files</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">ls</span><span style=" font-size:medium;"> ~/client-configs/files</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(0,0,0,0.294118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">client1.ovpn</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Этот файл нужно будет переместить на устройство, которое вы планируете использовать в качестве клиента. Например, это может быть ваш локальный компьютер или мобильное устройство.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Хотя конкретные приложения для передачи зависят от операционной системы устройства и ваших предпочтений, один из наиболее надежных и безопасных способов — использовать SFTP (протокол передачи файлов SSH) или SCP (защищенное копирование) на стороне сервера. При этом файлы аутентификации VPN вашего клиента будут передаваться через шифрованное соединение.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Здесь представлен пример команды SFTP, которую можно запустить с локального компьютера (под управлением macOS или Linux). Она будет копировать файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">client1.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, который мы создали на последнем шаге, в вашу домашнюю директорию:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">sftp</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">sammy</span><span style=" font-size:medium;">@</span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">openvpn_server_ip</span><span style=" font-size:medium;">:client-configs/files/client1.ovpn ~/</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Ниже представлено несколько инструментов и обучающих руководств для безопасной передачи файлов с сервера OpenVPN на локальный компьютер:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://winscp.net/"><span style=" font-size:medium; text-decoration: underline; color:#0000ff; background-color:transparent;">WinSCP</span></a></li>
<li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.digitalocean.com/community/tutorials/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server"><span style=" font-size:medium; text-decoration: underline; color:#0000ff; background-color:transparent;">Использование SFTP для безопасной передачи файлов с удаленного сервера</span></a></li>
<li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.digitalocean.com/community/tutorials/how-to-use-filezilla-to-transfer-and-manage-files-securely-on-your-vps"><span style=" font-size:medium; text-decoration: underline; color:#0000ff; background-color:transparent;">Использование Filezilla для безопасной передачи и управления файлами в VPS</span></a></li></ul>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="13"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 13 — Установка клиентской конфигурации</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В этом разделе рассказывается о том, как установить клиентский профиль VPN в Windows, macOS, Linux, iOS и Android. Эти инструкции не зависят друг от друга, так что вы можете сразу перейти к той, которая относится к вашему устройству.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Подключение OpenVPN будет иметь имя, совпадающее с именем файла </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. В этом обучающем руководстве это означает, что соединение будет иметь имя </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, что соответствует первому сгенерированному клиентскому файлу.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="windows"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">W</span><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">indows</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Установка</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Загрузите клиентское приложение OpenVPN для Windows со </span><a href="https://openvpn.net/index.php/open-source/downloads.html"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">страницы загрузки OpenVPN</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Выберите подходящую версию программы установки для вашей версии Windows.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">. Для установки OpenVPN требуются права администратора.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После установки OpenVPN, скопируйте файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в:</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">C:\Program Files\OpenVPN\config</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2; background-color:#141b2e;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">При запуске OpenVPN профиль будет автоматически обнаружен и сделан доступным.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вы должны запускать OpenVPN от имени администратора каждый раз, даже если используете учетную запись администратора. Чтобы вам не нужно было при каждом запуске VPN нажимать правую кнопку мыши и выбирать </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Запуск от имени администратора</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, такой запуск следует настроить в учетной записи администратора. Это также означает, что обычным пользователям нужно будет ввести пароль администратора, чтобы использовать OpenVPN. Обычные пользователи не смогут правильно подключиться к серверу, если у приложения OpenVPN на клиентской системе нет прав администратора, поэтому необходим повышенный уровень привилегий.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Чтобы настроить приложение OpenVPN для запуска от имени администратора при каждом запуске, нажмите правой кнопкой мыши на его ярлык и выберите пункт </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Свойства</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Внизу вкладки </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Совместимость</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> нажмите кнопку </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Изменить параметры для всех пользователей</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. В новом окне установите отметку </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Запускать эту программу от имени администратора</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключение</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">При каждом запуске графического интерфейса OpenVPN операционная система Windows будет спрашивать, разрешаете или вы этой программме внести изменения на вашем компьютере. Нажмите </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Да</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. При запуске клиентского приложения OpenVPN в области задач появляется значок приложения, с помощью которого вы сможете подключать и отключать соединение VPN; соединение VPN не устанавливается автоматически.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После запуска OpenVPN нажмите правой кнопкой на значок OpenVPN в области задач, чтобы создать соединение. Откроется контекстное меню. Выберите </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">client1</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в верхней части меню (это ваш профиль </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">) и нажмите </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключиться</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Откроется окно состояния, где будут выведены данные журнала при установке соединения, и после подключения клиента будет выведено сообщение.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Отключение от VPN выполняется аналогично: перейдите в область задач, нажмите значок приложения OpenVPN правой кнопкой мыши, выберите профиль клиента и нажмите </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Отключиться</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="macos"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">m</span><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">acOS</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Установка</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://tunnelblick.net/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">Tunnelblick</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> — бесплатный клиент OpenVPN с открытым исходным кодом для macOS. Вы можете загрузить последний образ этого клиентского приложения со </span><a href="https://tunnelblick.net/downloads.html"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">страницы загрузки Tunnelblick</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Дважды нажмите загруженный файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.dmg</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и следуйте указаниям по установке.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В конце процесса установки Tunnelblick спросит, есть ли у вас файлы конфигурации. Укажите ответ </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">У меня есть файлы конфигурации</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и дайте Tunnelblick завершить работу. Откройте окно Finder и дважды нажмите </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">client1.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Tunnelblick установит клиентский профиль. Для этого требуются привилегии администратора.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключение</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Запустите Tunnelblick, дважды щелкнув значок Tunnelblick в папке </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Приложения</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. После запуска Tunnelblick в панели меню в правом верхнем углу экрана появится значок Tunnelblick для управления соединениями. Нажмите на значок, а затем нажмите на пункт меню </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключить client1</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы создать соединение VPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="linux"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">L</span><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">inux</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Установка</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы используете Linux, существуют различные инструменты в зависимости от вашего дистрибутива. Диспетчер окон или среда рабочего стола также могут содержать утилиты для подключения.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Однако проще всего будет использовать для этой цели программное обеспечение OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В Ubuntu или Debian вы можете установить его так же, как и на сервере, введя следующую команду:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#ff4084;">apt</span><span style=" font-size:medium;"> update</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#ff4084;">apt</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#ff4084;">install</span><span style=" font-size:medium;"> openvpn</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">В CentOS вы можете активировать репозитории EPEL и выполнить установку, введя следующую команду:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">sudo</span><span style=" font-size:medium;"> dnf </span><span style=" font-size:medium; color:#ff4084;">install</span><span style=" font-size:medium;"> epel-release</span></li>
<li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">sudo</span><span style=" font-size:medium;"> dnf </span><span style=" font-size:medium; color:#ff4084;">install</span><span style=" font-size:medium;"> openvpn</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="systemd-resolved"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Н</span><span style=" font-family:'Epilogue,sans-serif'; font-size:medium; font-weight:600; color:#000000;">астройка клиентов, использующих </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; font-weight:600; color:#535772; background-color:#f3f5f9;">systemd-resolved</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вначале определите, использует ли ваша система </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для разрешения DNS, проверив файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/resolv.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">cat</span><span style=" font-size:medium;"> /etc/resolv.conf</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(255,255,255,0.694118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;"># This file is managed by man:systemd-resolved(8). Do not edit.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">. . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2; background-color:#141b2e;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">nameserver </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">127.0.0.53</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">options edns0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2; background-color:#141b2e;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если ваша система настроена для использования </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для разрешения DNS , IP-адрес после опции </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nameserver</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> будет иметь значение </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">127.0.0.53</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Также в файле должны быть комментарии, в частности информация о том, как </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> управляет файлом. Если у вас отображается не </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">127.0.0.53</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, а другой IP-адрес, то есть вероятность, что ваша система не использует </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. В этом случае вы можете перейти к следующему разделу, предназначенному для настройки клиентов Linux, использующих скрипт </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">update-resolv-conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для поддержки этих клиентов нужно предварительно установить пакет </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">openvpn-systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Он содержит скрипты, принудительно запускающие использование </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для разрешения DNS сервером VPN.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#ff4084;">apt</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#ff4084;">install</span><span style=" font-size:medium;"> openvpn-systemd-resolved</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После установки пакета настройте клиент для его использования и отправки всех запросов DNS через интерфейс VPN. Откройте файл VPN клиента:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">nano</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">client1</span><span style=" font-size:medium;">.ovpn</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Разкомментируйте следующие строки, добавленные вами ранее:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">client1.ovpn</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">script-security 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">up /etc/openvpn/update-systemd-resolved</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">down /etc/openvpn/update-systemd-resolved</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">down-pre</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">dhcp-option DOMAIN-ROUTE .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2; background-color:#141b2e;"><br /></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="update-resolv-conf"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Н</span><span style=" font-family:'Epilogue,sans-serif'; font-size:medium; font-weight:600; color:#000000;">астройка клиентов, использующих </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; font-weight:600; color:#535772; background-color:#f3f5f9;">update-resolv-conf</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если ваша система не использует </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для управления DNS, проверьте наличие в вашем дистрибутиве скрипта </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/update-resolv-conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">ls</span><span style=" font-size:medium;"> /etc/openvpn</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(255,255,255,0.694118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">update-resolv-conf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2; background-color:#141b2e;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если в вашем клиенте имеется файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">update-resolv-conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, измените ранее переданный файл конфигурации клиента OpenVPN:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">nano</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">client1</span><span style=" font-size:medium;">.ovpn</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Разкомментируйте три добавленные вами строки для изменения настроек DNS:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">client1.ovpn</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">script-security 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">up /etc/openvpn/update-resolv-conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">down /etc/openvpn/update-resolv-conf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2; background-color:#141b2e;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Если вы используете CentOS, измените директиву </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">group</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> с </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nogroup</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">nobody</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для соответствия доступным группам дистрибутива:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">client1.ovpn</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">group </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">nobody</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#141b2e;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сохраните и закройте файл.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключение</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь для подключения к VPN вы можете просто указать команде </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">openvpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> файл конфигурации клиента:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#ff4084;">sudo</span><span style=" font-size:medium;"> openvpn --config </span><span style=" font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">client1</span><span style=" font-size:medium;">.ovpn</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Эта команда должна установить подключение к вашей VPN.</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> Если ваш клиент использует </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolved</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> для управления DNS, проверьте правильность применения настроек, запустив команду </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">systemd-resolve --status</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#f8f8f2; background-color:#141b2e;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">systemd-resolve --status tun0</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">Результат будет выглядеть следующим образом:</span></p>
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:rgba(255,255,255,0.694118);">Output</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">Link 22 (</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">tun0</span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">. . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">         DNS Servers: </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">208.67.222.222</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">                      </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">208.67.220.220</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#141b2e;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#f8f8f2;">          DNS Domain: </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:rgba(242,201,76,0.34902);">~.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#000000; background-color:#141b2e;"><br /></p>
<p style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">Если вы видите IP-адреса серверов DNS, настроенные вами на сервере OpenVPN, и настройку </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">~.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> для </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-style:italic; color:#323232;">DNS Domain</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> в выводе, это означает, что вы правильно настроили клиент для управления DNS на сервере VPN. Также вы можете проверить отправку запросов DNS через VPN используя сайт </span><a href="https://www.dnsleaktest.com/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">DNS leak test.com</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> или другой подобный сайт.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ios"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">i</span><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">OS</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Установка</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Найдите в магазине приложений iTunes App Store приложение </span><a href="https://itunes.apple.com/us/app/id590379981"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">OpenVPN Connect</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, официальный клиент OpenVPN для iOS, и установите его. Чтобы переместить конфигурацию клиента iOS на устройство, подключите его к компьютеру напрямую.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Здесь описан процесс завершения передачи с помощью iTunes. Откройте iTunes на компьютере и нажмите </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">iPhone</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> &gt; </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">приложения</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Прокрутите страницу до раздела </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Общий доступ к файлам</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и нажмите на приложение OpenVPN. Пустое окно справа </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">OpenVPN Documents</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> предназначено для общего доступа к файлам. Перетащите файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в окно OpenVPN Documents.</span><img src="image802260328.png" /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Запустите приложение OpenVPN на iPhone. Вы получите уведомление, что новый профиль готов к импорту. Нажмите зеленый значок плюс, чтобы импортировать его.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2095724440.png" /><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключение</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Приложение OpenVPN готово к использованию нового профиля. Установите соединение, передвинув кнопку </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключиться</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> в положение </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Вкл</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">. Для отключения передвиньте эту же кнопку в положение </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Выкл</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">. Переключатель VPN в разделе </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Настройки</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> нельзя использовать для подключения к VPN. Если вы попробуете сделать это, вы получите уведомление о том, что для подключения нужно использовать приложение OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1094819527.png" /></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="android"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">A</span><span style=" font-family:'Epilogue,sans-serif'; font-size:large; font-weight:600; color:#000000;">ndroid</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Установка</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Откройте магазин приложений Google Play Store. Найдите приложение </span><a href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">Android OpenVPN Connect</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, официальное клиентское приложение OpenVPN для Android, и установите его.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Вы можете переместить профиль </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, подключив устройство Android к вашему компьютеру через интерфейс USB и скопировав файл. Если у вас в компьютере есть разъем для SD-карт, вы можете извлечь SD-карту из устройства, скопировать на нее профиль и вставить карту обратно в устройство Android.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Запустите приложение OpenVPN и нажмите меню </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">FILE</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы импортировать профиль.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image798470715.png" /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем перейдите в местоположение сохраненного профиля (на снимке экрана используется расположение </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/storage/emulated/0/openvpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">) и выберите файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">.ovpn</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">​​​. Нажмите кнопку </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">IMPORT</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы завершить импорт этого профиля.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2128831126.png" /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Подключение</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> После добавления профиля вы увидите следующий экран:</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image962290223.png" /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для подключения нажмите кнопку-переключатель рядом с профилем, который вы хотите использовать. Вы увидите статистические данные вашего подключения в режиме реального времени и трафик, проходящий через ваш сервер OpenVPN:</span><img src="image2107241702.png" /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для отключения просто нажмите кнопку-переключатель слева еще раз. Вам будет предложено подтвердить, что вы хотите отключиться от VPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="14-vpn"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 14 — Тестирование соединения VPN (необязательно)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f4f2d4;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#323232;">Примечание.</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;"> Этот метод тестирования подключения VPN будет работать только в случае, если вы выбрали перенаправление всего трафика через VPN на шаге 7 при редактировании файла </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">server.conf</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232;">​​ для OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После завершения установки нужно провести простую проверку, чтобы убедиться, что все работает нормально. Не активируйте соединение VPN, откройте браузер и перейдите в </span><a href="https://www.dnsleaktest.com/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">DNSLeakTest</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сайт покажет IP-адрес, назначенный вашим интернет-провайдером и видный остальному миру. Чтобы проверить настройки DNS через этот же сайт, нажмите </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Расширенный тест</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, и вы увидите, какие серверы DNS вы используете.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь подключите клиент OpenVPN к VPN вашего дроплета и обновите браузер. Вы увидите совершенно другой IP-адрес (адрес вашего сервера VPN), и именно этот адрес будет виден остальному миру. Итак, в приложении </span><a href="https://www.dnsleaktest.com/"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">DNSLeakTest</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> функция </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">Расширенный тест</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> проверит ваши настройки DNS и подтвердит, что вы используете параметры DNS, заданные вашей VPN.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="15"></a><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Ш</span><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">аг 15 — Отзыв сертификатов клиента</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Иногда вам может понадобиться отозвать клиентский сертификат, чтобы предотвратить дальнейший доступ к серверу OpenVPN.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для этго используйте пример из предварительного обучающего модуля </span><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-configure-a-certificate-authority-ca-on-ubuntu-20-04#optional-%E2%80%94-revoking-a-certificate"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">«Установка и настройка центра сертификации в 20.04»</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> из раздела </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-style:italic; color:#000000;">«Отзыв сертификата»</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">После отзыва сертификата для клиента с помощью этих инструкций вам нужно будет скопировать созданный файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">crl.pem</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> на ваш сервер OpenVPN в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/server</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">cp</span><span style=" font-size:medium;"> /tmp/crl.pem /etc/openvpn/server/</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Затем откройте файл конфигурации сервера OpenVPN:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> </span><span style=" font-size:medium; color:#e0276a;">nano</span><span style=" font-size:medium;"> /etc/openvpn/server/server.conf</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Добавьте в конце файла опцию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">crl-verify</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">, чтобы сервер OpenVPN проверял созданный нами список отзыва сертификатов при каждой попытке подключения:</span></p>
<p align="center" style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#e5e8ed;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#323232; background-color:#e5e8ed;">/etc/openvpn/server/server.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eaf6f6;"><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f;">crl-verify crl.pem</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#00546f; background-color:#eaf6f6;"><br /></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Сохраните и закройте файл.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Перезапустите OpenVPN, чтобы завершить отзыв сертификата:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Courier New,courier'; font-size:medium; color:#00546f; background-color:#eaf6f6;" style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; color:#e0276a;">sudo</span><span style=" font-size:medium;"> systemctl restart openvpn-server@server.service</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:medium; color:#1633ff;">Copy</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Клиент больше не сможет подключаться к серверу, используя старые учетные данные.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Чтобы запретить доступ другим клиентам, повторите эту процедуру:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Для отзыва сертификата используется команда </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">./easyrsa revoke </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; background-color:rgba(242,201,76,0.34902);">client_name</span><span style=" font-size:medium;">.</span></li>
<li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Создайте новый список CRL.</span></li>
<li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Переместите новый файл </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">crl.pem</span><span style=" font-size:medium;"> на сервер OpenVPN и скопируйте его в директорию </span><span style=" font-family:'JetBrains Mono,sans-serif'; font-size:medium; color:#535772; background-color:#f3f5f9;">/etc/openvpn/server/</span><span style=" font-size:medium;">, чтобы перезаписать старый список.</span></li>
<li style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Перезапустите службу OpenVPN.</span></li></ul>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">С помощью этой процедуры вы можете отозвать любые сертификаты, которые ранее выпустили для вашего сервера.</span></p>
<p style=" margin-top:18px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Epilogue,sans-serif'; font-size:x-large; font-weight:600; color:#000000;">Заключение</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Теперь у вас должна быть полностью готовая к использованию виртуальная частная сеть, запущенная на вашем сервере OpenVPN. Вы можете просматривать веб-ресурсы и загружать контент, не беспокоясь о том, что злоумышленники смогут отслеживать вашу активность.</span></p>
<p style=" margin-top:17px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для дальнейшей кастомизации вашей установки OpenVPN можно выполнить несколько шагов, например, настроить для вашего клиента автоматическое подключение к VPN или задать специальные правила и политики доступа для конкретного клиента. При выполнении этих действий по кастомизации OpenVPN вы должны ознакомиться с </span><a href="https://openvpn.net/index.php/open-source/documentation.html"><span style=" font-family:'Inter,sans-serif'; font-size:medium; text-decoration: underline; color:#000000; background-color:transparent;">официальной документацией для OpenVPN</span></a><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:17px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">Для настройки большего числа клиентов вам нужно выполнить шаги </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">6</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">11–13</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;"> для каждого дополнительного устройства. Чтобы запретить доступ клиентским системам, следуйте указаниям в шаге </span><span style=" font-family:'Inter,sans-serif'; font-size:medium; font-weight:600; color:#000000;">15</span><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:50px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f3f5f9;"><span style=" font-family:'Inter,sans-serif'; font-size:medium; color:#031b4e;"><br /> </span></p></body></html>