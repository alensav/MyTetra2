<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tuksik.ru/auto-start-and-shutdown/"><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600; text-decoration: underline; color:#0000ff;">Выполнение скрипта при запуске или выключении linux</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image469348881.png" /><a name="yandex_rtb_R-A-136881-4"></a><span style=" font-family:'Ubuntu';">Е</span><span style=" font-family:'Ubuntu';">сли на вопрос: «как добавить программу в автозагрузку?» — начинающие пользователи находят ответ достаточно быстро, то вопрос о запуске скрипта, при выключении/перезагрузки, ставит их в тупик. В статье будет описан стандартный способ для автоматического выполнения команд при включении и выключении linux, а также более простой способ для пользователей, у которых установлен gdm и графический интерфейс, например ubuntu.<br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Консольный вариант.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Немного теории.</span><span style=" font-family:'Ubuntu';"><br />Следует знать, что в Linux существует 7 уровней запуска. Однако, использоваться могут только 6.<br />Как у всех уважающих себя программ отсчёт начинается с 0-ля.<br />0 — Остановка или выключение системы.<br />1 — Однопользовательский режим.<br />2 — Многопользовательский режим, но без поддержки сети.<br />3 — Тоже самое, но с сетью.<br />4 — Добавили для красоты Не используется.<br />5 — Графический режим с загрузкой X сервера.<br />6 — Перезагрузка.<br />Если перейти в папку /etc (В некоторых дистрибутивах /etc/rc.d) то можно увидеть папки с 7-мью уровнями запуска.<br /></span><img src="image794882241.png" /><span style=" font-family:'Ubuntu';"><br />Например при выключении компьютера, выполнятся все скрипты из папки rc0.d<br /></span><img src="image1259411630.png" /><span style=" font-family:'Ubuntu';"><br />Тут следует остановится по подробнее. Дело в том, что самих скриптов (а точнее сценариев) в этой папке нету, а есть только ссылки на файлы, которые лежат в папке /etc/init.d. Эти сценарии выполняют различные задачи, в зависимости от параметра start или stop (например /etc/init.d/reboot start и /etc/init.d/reboot stop это разные команды, а /etc/init.d/reboot вообще не будет работать). Если в ссылке стоит первая буква S, то значит сценарию подаётся параметр start, а если стоит буква K(от слова kill), то параметр stop. Цифра после буквы обозначает порядок выполнения сценария.<br />Например, на выше вставленном скриншоте вначале выполниться команда /etc/init.d/hddtemp stop, а уже позже /etc/init.d/networking start.<br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">Хватит теории. Переходим к практике.</span><span style=" font-family:'Ubuntu';"><br />Для того, чтобы добавить команду в автозагрузку, достаточно поместить её в файл /etc/rc.local.</span></p>
<p align="right" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">В этой части статьи в качестве редактора будет использоваться nano, но вы можете пользоваться своим любимым редактором, например gedit.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ter"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo nano /etc/rc.local</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">И помещаем наши команды чуть выше строчки с exit 0.<br />Для того, что бы команды выполнялись перед выключением или перезагрузкой нам нужно создать сценарий в папке /etc/init.d</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ter"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo nano /etc/init.d/имя_сценария</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вставляем следующий код:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="cod2"></a><span style=" font-family:'Courier New,courier';"><br /></span><span style=" font-family:'Courier New,courier';">#! /bin/sh<br />case &quot;$1&quot; in<br />start)<br />echo &quot;подан сигнал start&quot;<br />;;<br />stop)<br />echo &quot;подан сигнал stop&quot;<br />;;</span><span style=" font-family:'Ubuntu';">esac</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если будет подаваться только один сигнал, то просто закомментируйте строку поставив в начале команды знак #<br />Например</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="cod2"></a><span style=" font-family:'Courier New,courier';">.</span><span style=" font-family:'Courier New,courier';">..<br />case &quot;$1&quot; in<br />start)<br />#<br />;;<br />...</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь делаем файл исполняемым:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ter"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo chmod +x /etc/init.d/имя_сценария</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Создать ссылки можно вручную, но проще это сделать через команду update-rc.d<br />Например:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ter"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo update-rc.d имя_сценария start 20 0 6 . stop 1 0 6 .</span></p>
<p align="right" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">Точки важны (обе). Исследуя просторы интернета, у меня сложилось впечатление, что синтаксис этой программы иногда меняется. Актуальные примеры можно посмотреть по команде «man update-rc.d». Примеры будут в низу.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Эта команда создаст по 2 ссылки в каталогах /etc/rc</span><span style=" font-family:'Ubuntu'; font-weight:600;">0</span><span style=" font-family:'Ubuntu';">.d (второе число в команде) и /etc/rc</span><span style=" font-family:'Ubuntu'; font-weight:600;">6</span><span style=" font-family:'Ubuntu';">.d (третье число в команде). Причём вначале будет выполняться сценарий с параметром stop (т.к. стоит 1), а уже потом с параметром start (т.к. стоит 20).<br />Если второй параметр не нужен, то можно выполнить команду:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ter"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo update-rc.d имя_сценария stop 1 0 6 .</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Советую ставить приоритет повыше (т.е. число после start или stop должно быть маленьким), желательно меньше 20. В обратном случае у меня иногда зависал компьютер при попытке перезагрузиться.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для пользователей ubuntu, да и многих других современных дистрибутивов с gdm можно воспользоваться…</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Графический вариант.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Что касается автозагрузки то можно воспользоваться способом описанным </span><a href="http://tuksik.ru/autostart/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">здесь</span></a><span style=" font-family:'Ubuntu';">.<br />Или просто открыть «автоматически запускаемые приложения» командой:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ter"></a><span style=" font-family:'Courier New,courier';">g</span><span style=" font-family:'Courier New,courier';">nome-session-properties</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для выполнения скрипта при выключении компьютера, помещаем его в файл /etc/gdm/PostSession/Default</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ter"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo gedit /etc/gdm/PostSession/Default</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Прямо над строчкой exit 0. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="wp_rp_first"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">охожие статьи:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tuksik.ru/show-url-in-nautilus/"><span style=" text-decoration: underline; color:#0000ff;">Показ адреса в nautilus и копирование его в буфер</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tuksik.ru/burg/"><span style=" text-decoration: underline; color:#0000ff;">BURG, кому надоел grub</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tuksik.ru/dropbox-1c/"><span style=" text-decoration: underline; color:#0000ff;">Расшаривание файлов через Dropbox в 1 клик</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tuksik.ru/htop/"><span style=" text-decoration: underline; color:#0000ff;">Htop — консольный системный монитор</span></a> </li></ul></body></html>