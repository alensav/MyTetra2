<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style="-qt-paragraph-type:empty; margin-top:38px; margin-bottom:46px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.4%;"><br /></p>
<p style=" margin-top:38px; margin-bottom:46px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.4%;">sudo blkid</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">         ls -l /dev/disk/by-uuid</p>
<p style=" margin-top:38px; margin-bottom:46px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.4%;">=================================================================================</p>
<p style=" margin-top:38px; margin-bottom:46px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.4%;"><span style=" font-family:'Lato,Arial,sans-serif'; font-size:x-large; font-weight:600; color:#001111;">Подключение usb-диска в Ubuntu 18.04.1</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Начнем с того, что диск мы будем подключать на века, то есть это не сменный носитель, который подключается на время. Мы должны монтировать его при каждой загрузке нашего сервера. Отключение физически диска планируется только когда сервер упадет. По этому нужно трогать fstab — файл, где прописаны подключаемые диски. Перед его редактированием узнаем UUID нашего диска. Выполняем команду:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">ls -l /dev/disk/by-uuid</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">В результате, система покажет нам список всех дисков и указанием их UUID. Примерно это выглядит вот так:</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Я знаю, что мой диск подключен как /dev/sdb и на нем один раздел sdb1. Соответственно UUID этого раздела 7ca29b33-2d5c-4d64-b9b3-0a4e6d89f8b9. Запоминаем это значение и редактируем наш fstab. Выполняем команду:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">nano /etc/fstab</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Добавляем туда строчку «UUID=7ca29b33-2d5c-4d64-b9b3-0a4e6d89f8b9       /mnt/usb1       ext4    defaults        0       0», где UUID заменяем на ваше значение. О чем говорит эта строчка: мы подключаем диск с UUID=7ca29b33-2d5c-4d64-b9b3-0a4e6d89f8b9 в директорию /mnt/usb1 и используем файловую систему ext4. Все параметры подключения у нас установлены «по умолчанию».</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Теперь можно попытаться перезагрузить компьютер и внешний диск при этом должен подключиться автоматически в директорию /mnt/usb1. Если этого не произошло, ищем ошибки и исправляем их. Двигаться дальше будет бесполезно.</span></p>
<p style=" margin-top:38px; margin-bottom:46px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.4%;"><span style=" font-family:'Lato,Arial,sans-serif'; font-size:x-large; font-weight:600; color:#001111;">Настройка AFP протокола на Ubuntu 18.04.1</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Для установки и настройки родного протокола для Apple будем использовать библиотеку netatalk 3.1.11-1. Далее приведу код с комментариями. Выполняйте команды построчно за исключением комментариев.</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"># Переходим в директорию cd /usr/src/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">cd /usr/src/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"># Скачиваем библиотеку</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">wget http://prdownloads.sourceforge.net/netatalk/netatalk-3.1.11.tar.gz?download</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"># Переименовываем полученный файл в netatalk-3.1.11.tar.gz</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">mv netatalk-3.1.11.tar.gz\?download netatalk-3.1.11.tar.gz</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"># Распаковываем архив netatalk-3.1.11.tar.gz</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">tar -zxvf netatalk-3.1.11.tar.gz</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"># Переходим в новый каталог netatalk-3.1.11 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">cd netatalk-3.1.11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"># Устанавливаем программы, которые нам понадобятся для настройки и установки netatalk</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">apt install build-essential libdb-dev libgcrypt20-dev checkinstall</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Courier New,courier'; color:#eeeeee; background-color:#445555;"><br /></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Вот теперь мы все подготовили к установке netatalk. Привычная конструкция </span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; font-style:italic; color:#001111;">make</span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;"> &amp; </span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; font-style:italic; color:#001111;">make install</span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;"> нам не подходит. При настройке будут заданы некоторые вопросы и нам придется на них ответить. Для начала запускаем создание сценария командой </span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; font-style:italic; color:#001111;">make</span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">. По окончании подготовки запускаем </span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; font-style:italic; color:#001111;">checkinstall. </span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Первый вопрос, который нам зададут «Should I create a default set of package docs? [y]: </span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; font-weight:600; color:#001111;">n</span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">«, отвечаем NO (n).</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Далее нас попросят ввести описание пакета. «Please write a description for the package. End your description with an empty line or EOF.» Вводим netatalk и жмем Enter.</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Следующим шагом будет вопросы по редактированию параметров пакета. Нам нужно изменить только 13-й параметр «Replaces». Заменим его на netatalk. Все остальное оставим по умолчанию.</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">Enter a number to change any of them or press ENTER to continue: 13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">Enter the replaced packages: </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">&gt;&gt; netatalk</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Следующим шагом нас спросят хотим ли мы посмотреть содержимое пакета. Мне это было не интересно и я нажал n.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">Do you want me to list them? [n]:</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Ну и в заключении подтверждаем все наши ответы и заканчиваем установку netatalk.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">Should I exclude them from the package? (Saying yes is a good idea) [y]:</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Осталось только настроить протокол afp. Для этого редактируем файл </span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; font-style:italic; color:#001111;">/etc/afp.conf. </span><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Не все настройки там приведены по умолчанию. Их гораздо больше и нам придется внести их руками.</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; Netatalk 3.x configuration file</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; Основные настройки сервера</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">[Global]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; Global server settings</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">uam path = /usr/local/lib/netatalk</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">uam list = uams_dhx.so uams_dhx2.so uams_guest.so</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">guest account = nobody</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">mimic model = RackMac</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Courier New,courier'; color:#eeeeee; background-color:#445555;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Courier New,courier'; color:#eeeeee; background-color:#445555;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; [Homes]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; basedir regex = /xxxx</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Courier New,courier'; color:#eeeeee; background-color:#445555;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; [My AFP Volume]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; path = /path/to/volume</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Courier New,courier'; color:#eeeeee; background-color:#445555;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; [My Time Machine Volume]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; path = /path/to/backup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">; time machine = yes</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Courier New,courier'; color:#eeeeee; background-color:#445555;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">;Настройка доступа к нашему диску для резервных копий</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">[storage]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  path = /mnt/usb1/</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  valid users = nobody</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Что мы здесь добавили в общем разделе:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Georgia,Times New Roman,serif'; font-size:20px; color:#001111;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px;">uam path и uam list — указывает на использование библиотек;</span></li>
<li style=" font-family:'Georgia,Times New Roman,serif'; font-size:20px; color:#001111;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px;">guest account — гостевой пользователь;</span></li>
<li style=" font-family:'Georgia,Times New Roman,serif'; font-size:20px; color:#001111;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px;">mimic model — описание модели нашего сервера;</span></li></ul>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Что мы здесь добавили в разделе с нашим диском:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Georgia,Times New Roman,serif'; font-size:20px; color:#001111;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px;">path — путь к директории, куда подмонтирован наш диск;</span></li>
<li style=" font-family:'Georgia,Times New Roman,serif'; font-size:20px; color:#001111;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px;">valid users — пользователь, которому разрешен доступ к ресурсу;</span></li></ol>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Перезапускаем нашу службу командой systemctl restart netatalk. Доступ настроен. Теперь осталось толко сообщить всем компьютерам о наличии в сети нового сервера. Для этого установим Avahi.</span></p>
<p style=" margin-top:38px; margin-bottom:46px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.4%;"><span style=" font-family:'Lato,Arial,sans-serif'; font-size:x-large; font-weight:600; color:#001111;">Установка Avahi на Ubuntu server 18.04.1</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Здесь все гораздо проще. Пакет Avahi присутствует в репозитарии. Просто выполним две команды:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">sudo apt install avahi-daemon</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">sudo apt install libnss-mdns</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Установив два этих пакета, нужно немного покопаться с настройками. Совсем немого.</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Во первых подправим nsswitch.conf. Откройте его на редактирование командой nano /etc/nsswitch.conf. Найдите строку hosts: files mdns4_minimal [NOTFOUND=return] dns и добавьте в конец mdns4 mdns. В конечном итоге строка должна выглядить так:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4 mdns</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Для соединения службы Avahi с протоколом AFP нужно создать файл /etc/avahi/services/afpd.service со следующим содержанием:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">&lt;?xml version=&quot;1.0&quot; standalone='no'?&gt;&lt;!--*-nxml-*--&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">&lt;!DOCTYPE service-group SYSTEM &quot;avahi-service.dtd&quot;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">&lt;service-group&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"> &lt;name replace-wildcards=&quot;yes&quot;&gt;%h&lt;/name&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"> &lt;service&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;type&gt;_afpovertcp._tcp&lt;/type&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;port&gt;548&lt;/port&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"> &lt;/service&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"> &lt;service&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;type&gt;_device-info._tcp&lt;/type&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;port&gt;0&lt;/port&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;txt-record&gt;model=Xserve&lt;/txt-record&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"> &lt;/service&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"> &lt;service&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;type&gt;_adisk._tcp&lt;/type&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;port&gt;9&lt;/port&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;txt-record&gt;sys=waMa=0,adVF=0x100,adVU=00000000-AAAA-BBBB-CCCC-111111111111&lt;/txt-record&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">  &lt;txt-record&gt;dk0=adVN=TimeCapsule,adVF=0x81&lt;/txt-record&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;"> &lt;/service&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">&lt;/service-group&gt;</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Сохраняем файл, закрываем его и перезапускаем службу Avahi:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#445555;"><span style=" font-family:'Courier New,courier'; color:#eeeeee;">sudo /etc/init.d/avahi-daemon restart</span></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Вот и все, наш сервер для резервного копирования готов. Можно настраивать нашу Time Machine для создания резервных копий.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1985701357.png" /></p>
<p style=" margin-top:15px; margin-bottom:7px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:22px; color:#001111;">Это все, что я хотел рассказать о самодельной Time Capsule на Ubuntu server 18.04.1.</span></p></body></html>