<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://forum.amperka.ru/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#176093; background-color:#f0f7fc;"><br />Форум</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; background-color:#f0f7fc;">&gt;</span><a href="https://forum.amperka.ru/#ehlektronika.1"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#176093; background-color:#f0f7fc;">Электроника</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; background-color:#f0f7fc;">&gt;</span><a href="https://forum.amperka.ru/forums/esp8266-esp32.25/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093; background-color:#f0f7fc;">ESP8266, ESP32</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; background-color:#f0f7fc;">&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Roboto Slab,sans-serif'; font-size:18pt; font-weight:600;">ESP-8266/ESP32 NodeMCU Lua: азы программирования.</span></p>
<p style=" margin-top:2px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="pageDescription"></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">Т</span><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">ема в разделе &quot;</span><a href="https://forum.amperka.ru/forums/esp8266-esp32.25/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ESP8266, ESP32</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">&quot;, создана пользователем </span><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">25 июл 2017</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">.</span></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Страница 14 из 76</span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-13"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">&lt; Назад</span></a><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">1</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#141414; background-color:transparent;">←</span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-12"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">12</span></a><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-13"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">13</span></a><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#2b485c; background-color:#f0f7fc;">14</span></a><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-15"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">15</span></a><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-16"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">16</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#141414; background-color:transparent;">→</span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-76"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">76</span></a><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-15"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#8f6c3f; background-color:#fff4e5;">Вперёд &gt;</span></a></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Чтобы воспользоваться мой библиотекой в прошивке должен быть модуль 1wire</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164475"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164475"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#261</span></a></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a name="likes-post-164475"></a><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#176093;">S</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#176093;">mileOfFortune</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> нравится это.</span></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">ИгорьК сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164475#post-164475"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Чтобы воспользоваться мой библиотекой в прошивке должен быть модуль 1wire</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Вот теперь запустилась.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164476"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164476"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#262</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Еще вопрос... как обратиться к результату функции?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164478"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164478"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#263</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Теперь что касается стандартной библиотек<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">SmileOfFortune сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164478#post-164478"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Еще вопрос... как обратиться к результату функции?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Это вопрос... </span><img src="image1213475066.png" /><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"><br />Результат - в таблице, как вы хотели.<br />Дальше придётся писать следующий раздел, напишу будет время.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">Последнее редактирование: 24 май 2018</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164481"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164481"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#264</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Я конечно не великий программист, но не понятно одно... какой толк от выше написанного, если я не могу оперировать этими данными? как получить доступ к ячейкам таблицы с параметрами датчиков?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164482"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164482"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#265</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">SmileOfFortune сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164482#post-164482"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Я конечно не великий программист, но не понятно одно... какой толк от выше написанного, если я не могу оперировать этими данными? как получить доступ к ячейкам таблицы с параметрами датчиков?</span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (C++):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">print </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">tbl.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">t28FF3A3216150354</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />print </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">tbl.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">t28FF8ACF63150191</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164483"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164483"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#266</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">У меня складывается впечатление, что Вы не читали книгу Иерусалимски. Это не правильный подход, кроме того, я в первом посте указал, что мои заметки - дополнение к ней, а не замена. В книге написано как обращаться к элементам таблицы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164484"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164484"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#267</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Почитайте главу 2.5 Иерусалимски, там все есть.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164485"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164485"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#268</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Как обращаться понятно. Но temp определена только внутри функции... и доступа к ней нет из вне.<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">ИгорьК сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164483#post-164483"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-style:italic; color:#6cb2e4; background-color:#d7edfc;">Код (C++):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#646464;">print </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#646464;">tbl.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#007788;">t28FF3A3216150354</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#646464;"><br />print </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#646464;">tbl.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#007788;">t28FF8ACF63150191</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#008000;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#ffffff; background-color:#0c5f55;">Спойлер: Код</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">now это функция которая обрабатывает датчик и печатает нам значения.<br />tbl.t28FF3A3216150354 - это имя таблицы и индекс ячейки значение который мы хотим получить. только в данном коде нет такой таблицы.<br />Я конечно может криво спрашиваю... но вопрос у меня в следующем...<br />1) есть таблица Temp с параметрами датчиков температуры.<br />2) есть функция считывания температуры датчиков<br />Вопрос, как передать значения параметров датчиков температуры в таблицу Temp.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164487"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164487"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#269</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Данные появляются в таблице после выполнения кода.<br />Уберите оператор &quot;local&quot; перед ней и она станет доступной за пределами функции.<br />(Мы говорим о моей библиотеке, там таблица temp.)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">Последнее редактирование: 24 май 2018</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164488"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">24 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164488"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#270</span></a></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a name="likes-post-164488"></a><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#176093;">S</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#176093;">mileOfFortune</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> нравится это.</span></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Пожалуйста, поймите, без чтения книги вы не сможете писать код.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164490"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">25 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164490"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#271</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">ИгорьК сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164490#post-164490"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Пожалуйста, поймите, без чтения книги вы не сможете писать код.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Книга открыта всегда, когда пишу. Но почему-то в некоторых операциях я не могу понять их логику работы. Пример:<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (C++):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000ff;">do</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br /><br />local now </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />    temp </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">{}</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000040;">--</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> Table </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000ff;">for</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> temperature<br />    local pin </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000dd;">4</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000040;">--</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> DS18b20 pin<br />    local del </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000dd;">750</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000040;">--</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> delay </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000ff;">for</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> counting temperature<br />    local myWork </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">t</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000040;">--</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> callback function<br />        package.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">loaded</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">[</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff0000;">&quot;_ds18b20&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">]</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">nil<br />        ds </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> nil<br />       </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000040;">--</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> table.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">foreach</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">t, print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />      </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000040;">--</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">  print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">node.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">heap</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">())</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />    end<br />    ds </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#000080;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> require</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff0000;">'_ds18b20'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />    ds.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">getTemp</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">temp, myWork, pin, del </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />end<br />now</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br /><br />tmr.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">create</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008080;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">alarm</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000dd;">1000</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">, </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000dd;">1</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">, now </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />tmr.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">create</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008080;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">alarm</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000dd;">2000</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">, </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000dd;">1</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">, function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />   print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">temp.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#007788;">t28FF3A3216150354</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />  end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#008000;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"><br />end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Если правильно понимаю, чтобы обновить таблицу с температурой, надо запустить NOW. для этого есть таймер на 1000мс. Теперь я хочу, к примеру, чтобы каждые 2 секунды у меня печаталось значение первого датчика. Создаем таймер и просим его печатать. На мой взгляд все логично. Но результат - ничего не печатается кроме NIL. На ардуино нано с этими датчиками нет никаких проблем... а тут... элементарная задача, а решить не получается...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164497"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">25 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164497"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#272</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">SmileOfFortune сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164497#post-164497"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">На ардуино нано с этими датчиками нет никаких проблем... а тут... элементарная задача, а решить не получается...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Вы ошибаетесь, что на ардуино нет проблем. Проблема там есть очень большая, но не бросается в глаза. Библиотека для датчика должна быть асинхронной, поскольку между командой на преобразование и чтением датчика должно пройти до 750 мс. Вы выполняете это требование? Нет? Значит вы читаете &quot;прошлые&quot; показания датчика - показания от предыдущего замера.<br /><br />Теперь, что не так в вашем коде. Вы до конца его не додумали.<br /><br /></span><img src="image1449541564.png" /><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"><br /><br />Смотрите, (п .1) вызывает функцию now() каждую секунду.<br />Ее вызов в (п. 2)<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> temp </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">{}</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt;">  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Table for temperature</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">уничтожает все данные в таблице. Преобразование длится 750 мс. и значит, с учетом вызова этого преобразования каждые 1000 мс - 3/4 времени в таблице будут отсутствовать значения.<br /><br />Поскольку таймеры - явления асинхронные, практически одновременно с таймером вызова опроса запускается и (п. 3.) таймер чтения данных из таблицы, но с частотой в два раза меньше.<br />Таким образом, попытка чтения таблицы будет происходить с маленьким запозданием после каждого второго вызова функции запроса температуры. Это значит, что на момент чтения значения датчика в таблице данных не будет.<br /><br />Вы действовали в типичном ардуиновском стиле, это нормально. Но теперь, попробуйте, изменить свой код так, чтобы данные все таки читались.<br /><br />P.S. Я дополнил свои заметки по таблицам, посмотрите их вновь.<br /><br />P.P.S. В целом, ваш вынос функции чтения датчика из callback 'now()' - неправильное решение. Callback функции и пишутся как раз для того, чтобы обработать результат каких-то действий (и у меня там есть функция чтения таблицы, вы ее закомментировали). Но если хочется - можно сделать и как у вас. Осталось только сообразить что нужно поправить.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">Последнее редактирование: 28 май 2018</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164539"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">25 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164539"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#273</span></a></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a name="likes-post-164539"></a><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#176093;">S</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#176093;">mileOfFortune</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> нравится это.</span></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">ИгорьК сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164539#post-164539"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Вы ошибаетесь, что на ардуино нет проблем. Проблема там есть очень большая, но не бросается в глаза. Библиотека для датчика должна быть асинхронной, поскольку между командой на преобразование и чтением датчика должно пройти до 750 мс. Вы выполняете это требование? Нет? Значит вы читаете &quot;прошлые&quot; показания датчика - показания от предыдущего замера.<br /><br />Теперь, что не так в вашем коде. Вы до конца его не додумали.<br /><br /></span><a href="https://forum.amperka.ru/attachments/12421/"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; text-decoration: underline; color:#176093;">Посмотреть вложение 12421</span></a><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;"><br /><br />Смотрите, (п .1) вызывает функцию now() каждую секунду.<br />Ее вызов в (п. 2)<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-style:italic; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#646464;"> temp </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#646464;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#66cc66;">{}</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#646464;">  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Table for temperature</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">уничтожает все данные в таблице. Преобразование длится 750 мс. и значит, с учетом вызова этого преобразования каждые 1000 мс - 3/4 времени в таблице будут отсутствовать значения.<br /><br />Поскольку таймеры - явления асинхронные, практически одновременно с таймером вызова опроса запускается и (п. 3.) таймер чтения данных из таблицы, но с частотой в два раза меньше.<br />Таким образом, попытка чтения таблицы будет происходить с маленьким запозданием после каждого второго вызова функции запроса температуры. Это значит, что на момент чтения значения датчика в таблице данных не будет.<br /><br />Вы действовали в типичном ардуиновском стиле, это нормально. Но теперь, попробуйте, изменить свой код так, чтобы данные все таки читались.<br /><br />P.S. Я дополнил свои заметки по таблицам, посмотрите их вновь.<br /><br />P.P.S. В целом, ваш вынос функции чтения датчика из callback 'now()' - неправильное решение. Callback функции и пишутся как раз для того, чтобы обработать результат каких-то действий (и у меня там есть функция чтения таблицы, вы ее закомментировали). Но если хочется - можно сделать и как у вас. Осталось только сообразить что нужно поправить.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; line-height:1%;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#f9bc6d;">Нажмите, чтобы раскрыть...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#ffffff; background-color:#0c5f55;">Спойлер: Код</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Вот что получилось. Так как в таблице бывают nil, то передаем из таблицы датчиков значения в переменные Т1,Т2 и проверяем на nil. Теперь с какой бы я частотой не обращался к Т1,Т2, в них всегда будет последнее числовое значение.<br />Я правильно делаю?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164953"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">28 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164953"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#274</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">И еще момент. Никак не могу понять, почему у меня один датчик имеет точность 9 бит, а другой 12... в программе везде стоит 9...<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#ffffff; background-color:#0c5f55;">Спойлер: Код</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#ffffff; background-color:#0c5f55;">Спойлер: Результат</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164954"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">28 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164954"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#275</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">SmileOfFortune сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164953#post-164953"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Я правильно делаю?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Есть еще вариант. Вынесите определение &quot;temp = {}&quot; за пределы функции &quot;now()&quot; и все. Сразу после &quot;do&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164955"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">28 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164955"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#276</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">SmileOfFortune сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=164954#post-164954"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">И еще момент. Никак не могу понять, почему у меня один датчик имеет точность 9 бит, а другой 12... в программе везде стоит 9...<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; color:#ffffff; background-color:#0c5f55;">Спойлер: Код</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; color:#ffffff; background-color:#0c5f55;">Спойлер: Результат</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Сложно сказать - чтобы ответить на этот вопрос нужно видеть код модуля ds18b20 от NodeMcu.<br /><br />Можно предположить что эту установку надо делать для каждого датчика отдельно.<br /><br />Оставьте только один датчик, тот что сейчас 12 бит и посмотрите что будет.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">Последнее редактирование: 29 май 2018</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164956"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">28 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-164956"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#277</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369538516.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Нуб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Сложно сказать - чтобы ответить на этот вопрос нужно видеть код модуля ds18b20 от NodeMcu.<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">Такое происходит и с Вашей библиотекой по ссылке выше.<br />с отключением датчиков попробую позже.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/smileoffortune.15654/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">SmileOfFortune</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-165084"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">29 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-165084"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#278</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f3f3f3;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414; background-color:#f3f3f3;">SmileOfFortune сказал(а):</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span><a href="https://forum.amperka.ru/goto/post?id=165084#post-165084"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">↑</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#fafafa;"><span style=" font-family:'Georgia,Times New Roman,serif'; font-size:9pt; font-style:italic; color:#646464;">Такое происходит и с Вашей библиотекой по ссылке выше.<br />с отключением датчиков попробую позже.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;">С моей библиотекой ничего не происходит - она не предусматривает установку разрешения. Разрешение уже установлено вами.<br /><br />Разрешение по умолчанию 12 бит, зачем его менять я не знаю.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-165086"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">29 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-165086"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#969696;">#279</span></a></p>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:14px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1606778605.png" /></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#176093;">ИгорьК</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Гуру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">Скелет программы ч.1</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">.</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">1. WiFi.</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br />ESP-8266 может трудиться как точка доступа, как клиент и как то и другое вместе.<br />Начинающие любят создавать именно точку доступа, завешивать на модуль http сервер, делать странички и через них общаться с модулем.<br />Это невероятно круто, но как только устройств в вашем арсенале становится более трех, разгуливание по точкам доступа и их уникальным страничкам радость не доставляет.<br /><br />Поэтому, я работаю только с клиентом.<br />wifi на модуле устанавливается лишь единожды, после чего включенный модуль устанавливает и восстанавливает соединение самостоятельно.<br /><br />В снипеты ESPlorer добавьте код и забудьте об установках wifi:<br /><br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">do</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">setmode</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">STATION</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">sta</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">clearconfig</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">local</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> scfg </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">{}</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />scfg</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">auto </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">true</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />scfg</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">save </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">true</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />scfg</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">ssid </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'ТочкаДоступа'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />scfg</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">pwd </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'ВашПароль'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">sta</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">config</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">scfg</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">sta</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">connect</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />tmr</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">create</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">():</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">alarm</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">15000</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> tmr</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">ALARM_SINGLE</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#000099;">\n</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">sta</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">getip</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">())</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><img src="image1984131692.png" /><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">2. init.lua</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br />Файл init.lua запускается системой при старте. Если его нет - ничего не происходит. Есть - файл будет выполнен.<br />Некоторые юзеры заталкивают в него весь рабочий скрипт, но опыт показывает, что это не лучшее решение.<br />Считаю, что этот файл должен вызывать на исполнение следующий рабочий файл, а сам обеспечивать лишь удобную отладку всей программы.<br />Предлагаю иметь пару файлов, обеспечивающих удобную работу со скриптами:<br /><br />init.lua:<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Файл для последующего запуска</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">local</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> runfile </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;setglobals.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Если файла нет - переименовываем init.lua</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- чтобы не войти в бесконечный цикл перезагрузки</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />tmr</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">create</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">():</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">alarm</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">5000</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> file</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">exists</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">runfile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />      </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">dofile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">runfile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">else</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />      </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;No &quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> runfile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;, Rename init.lua!&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />      </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> file</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">exists</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />          file</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">rename</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;_init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />          node</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">restart</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />      </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">rename.lua.<br />Файл переименовывает init.lua в _init.lua и обратно:<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> file</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">exists</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  file</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">rename</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;_init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  node</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">restart</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">elseif</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> file</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">exists</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;_init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;Really rename to init.lua? </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#000099;">\n</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;"> 10 sec. delay!&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  tmr</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">create</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">():</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">alarm</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">10000</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />      file</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">rename</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;_init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;init.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />      node</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">restart</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />  </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">3. setmqtt.lua</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br />Этот файл задает параметры и устанавливает соединение с mqtt брокером. Скрипт обеспечивает надежное удержание соединения и его самовосстановление при потере как wifi так и самого брокера по любым причинам.<br /><br />Протокол MQTT решает проблему серых адресов.<br /><br />Клиент шлет простые сообщения на брокер.<br />Сообщение состоит из<br />- топика (признак, определение сообщения);<br />- данных;<br />- специальных флагов.<br /><br />Брокер ловит сообщения и пересылает подписчику.<br />Любое устройство может быть одновременно клиентом и подписчиком.<br /><br />Нюансы.<br />- Сообщения, по-умолчанию, получают подписчики, которые в момент его прихода находятся на связи с брокером.<br />Чтобы сообщения получали и &quot;вновь прибывшие&quot; подписчики (например не было связи в этот момент) - следует установить в сообщении специальный флаг.<br /><br />- &quot;Последняя воля&quot; - специальное сообщение, которое отправляется всем подписчикам, когда клиент потерял связь с брокером.<br />Полагаю, для начала это все что нужно знать о MQTT.<br /><br />Вы можете поднять свой брокер, воспользоваться платным или общедоступным брокером.<br />Наиболее известная халява - &quot;iot.eclipse.org&quot;. Если данные вашего термометра составляют государственную тайну - воспользуйтесь платным брокером или поднимайте свой.<br /><br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">3.1. Параметры.</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br />Создаем объект - соединение MQTT.<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">m </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> mqtt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">Client</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;myClient&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">60</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;user&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;password&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">Сообщение &quot;Последняя воля&quot;, пусть будет так:<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">lwt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'myClient'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'/state'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'OFF'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">Далее определяем callback(и) для двух событий,<br />получение сообщения от брокера:<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">on</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;message&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">conn</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> topic</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- что здесь происходит в целом рассмотрим позже</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">local</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> top </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">string.gsub</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">topic</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;/command/&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">top</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;:&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- помните раздел про таблицы?</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">table.insert</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">killtop</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">{</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">top</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">})</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- dofile(&quot;analize.lua&quot;)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">потеря связи с брокером:<br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">on</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;offline&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">con</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- устанавливаем флаг отсутствия соединения</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   dat</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">broker </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">false</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- вызываем этот же файл повторно</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />   </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">dofile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'setmqtt.lua'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">3.2. Установка соединения.</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br />Соединение установим следующим скриптом:<br /><br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- (Сервер, порт, два неважных пока параметра,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- и два callback)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">connect</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'iot.eclipse.org'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">1883</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- callback на успешное соединение</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">con</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;Connected to Broker&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Подписываемся на получение данных от топика</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- 'myClient/command/'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">subscribe</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;myClient&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;/command/#&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">conn</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;Subscribed.&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Публикем информацию о подключении в топик</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- 'myClient/state'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">publish</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'myClient'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'/state'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;ON&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Выставляем флаг соединения с брокером</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        dat</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">broker </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">true</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- callback на невозможность соединения</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">client</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> reason</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;failed mqtt: &quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> reason</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Вызываем себя рекурсивно</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">dofile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'setmqtt.lua'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">3.3. Итоговый скрипт.</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br /></span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Код (Lua):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:140px; -qt-block-indent:1; text-indent:0px; line-height:1.24%;"><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'Set MQTT'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Если раньше не завели таблицу 'dat' для рабочих параметров - заводим</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">not</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dat </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dat </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">{}</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- 'myClient' - переменная, если ее нет - будет &quot;test001&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">not</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> myClient </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> myClient </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;test001&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- 'killtop' - таблица для приема полученных команд через mqtt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- и отправки на обработку в файл 'analize.lua'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">not</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> killtop </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> killtop </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">{}</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Поскольку этот скрипт будет вызываться рекурсивно,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- нельзя допустить повторных попыток создания объекта 'm'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">not</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> m </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    m </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> mqtt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">Client</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">60</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'passfor'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">lwt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'/state'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;OFF&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">on</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;message&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">conn</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> topic</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- очищаем пришедший от брокера топик до чистого топика-команды</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- приходить они будут в формате 'myClient/command/setTemperature'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- &quot;очищенная&quot; и передаваемая для анализа - 'setTemperature'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">local</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> top </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">string.gsub</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">topic</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;/command/&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">top</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;:&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- заполняем таблицу killtop данными формата</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- '{'setTemperature', '25.5'}'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">table.insert</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">killtop</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">{</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">top</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dt</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">})</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- отправляем для анализа если такой анализ</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- еще не производится (разберемся позже)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">not</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> dat</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">analiz </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />                </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">dofile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;analize.lua&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">on</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;offline&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">con</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        dat</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">broker </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">false</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">dofile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'setmqtt.lua'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Если файл вызывается рекурсивно</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- соединение надо принудительно остановить</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">close</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Счетчик ожидания wifi, нужен для некоторых случаев</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">local</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> count </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">local</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> connecting </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">getmq</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Проверяем wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">if</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> wifi</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">sta</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">status</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">()</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">==</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">5</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">then</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'Got wifi'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        tmr</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">stop</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">getmq</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        tmr</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">unregister</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">getmq</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        getmq </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">nil</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'iot.eclipse.org!!!!!!!'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">connect</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'iot.eclipse.org'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">1883</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">con</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;Connected to Broker&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">subscribe</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;/command/#&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">conn</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />                </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;Subscribed.&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            m</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">:</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">publish</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">myClient</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'/state'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;ON&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">0</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            dat</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">broker </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">true</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            count </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#aa9900;">nil</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">con</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> reason</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;failed mqtt: &quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> reason</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />            </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">dofile</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">'setmqtt.lua'</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">else</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#0000aa;">print</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot;Wating for WiFi &quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">count</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">..</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#ff6666;">&quot; times&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        count </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">=</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> count </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">+</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">1</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />        </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- if count &gt; 20 then node.restart() end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- Таймер периодически запускает функцию соединения</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />tmr</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">.</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">create</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">():</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">alarm</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">5000</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#cc66cc;">1</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">,</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"> </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">function</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">t</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- и передает в нее свои опознавательные знаки</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    </span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-style:italic; color:#808080;">-- чтобы его остановить и &quot;убить&quot;</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br />    connecting</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">(</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;">t</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#141414;"><br /></span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; font-weight:600; color:#aa9900;">end</span><span style=" font-family:'Consolas,Courier New,Courier,monospace'; font-size:10pt; color:#66cc66;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">Таким образом, в приложении к этому посту вы найдете 5 файлов.<br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">init.lua</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> - файл, который запускается системой при старте. Он ничего особого не делает, а выжидает некоторое время, которое необходимо для ручного запуска<br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">renameinit.lua</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> который переименовывает </span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">init.lua </span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">в </span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">_init.lua </span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">и обратно. Если переименования не произошло - запускается<br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">setglobals.lua</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">. Скрипт устанавливает глобальные переменные и является основным, в деле настройки разных параметров, которые будут важны для программы, после чего запускает<br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">setmqtt.lua</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> - тот файл, суть которого мы рассмотрели в этом топике.<br />Исполнение его приводит к наладке связи с открытым брокером iot.clipse.org и подписке на топик 'test001/command'. Если в топик приходит сообщение, оно выводится на печать и вызывается файл<br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; font-weight:600; color:#141414;">analize.lua</span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> который в данном случае опять его печатает.<br /><br />Итого, мы подготовили базу для работы над различными iot устройствами.<br />Надо заметить, что указанные выше файлы настолько универсальны, что могут стать вашими шаблонами очень надолго - вносите в них изменения относительно брокера и имени устройства и пользуйтесь, больше ничего менять не надо.<br /><br />И, наконец, как это все выглядит.<br />Загружаем файлы:<br /></span><img src="image1845467181.png" /><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br />Запускаем на выполнение файл _init.lua<br /><br /></span><img src="image1639966025.png" /><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br />Соединение установлено:<br /><br /></span><img src="image1295430814.png" /><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br /><br /></span><a href="https://github.com/kamilfb/mqtt-spy/wiki/Downloads"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">Запускаем mqttSpy</span></a><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">, заходим на iot.eclipse.org, передаем нашему устройству команду, и получаем ее:<br /><br /></span><img src="image1054958379.png" /><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /><br />Отключаем и включаем wifi - убеждаемся что модуль восстанааливает соединение.<br /><br />Пока все.<br />Наша конечная цель - дистанционно управлять отоплением и охранять что-нибудь.<br /></span><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /></span><a href="http://forum.amperka.ru/threads/esp-8266-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-nodemcu.12558/page-15#post-167368"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">Продолжение</span></a><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"> </span></p>
<p style=" margin-top:15px; margin-bottom:0px; margin-left:140px; margin-right:140px; -qt-block-indent:1; text-indent:0px; background-color:#d7edfc;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#6cb2e4; background-color:#d7edfc;">Вложения:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:140px; margin-right:150px; -qt-block-indent:2; text-indent:0px; line-height:1.5%;"><a href="https://forum.amperka.ru/attachments/wifiinitmqtt-zip.12511/"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#176093;">wifiinitmqtt.zip</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:140px; margin-right:155px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#969696;">Размер файла:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:140px; margin-right:150px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">1,7 КБ</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:140px; margin-right:155px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#969696;">Просмотров:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:140px; margin-right:150px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;">671</span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#969696;">Последнее редактирование: 15 июн 2018</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/members/%D0%98%D0%B3%D0%BE%D1%80%D1%8C%D0%9A.2107/"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#969696;">ИгорьК</span></a><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#969696;">, </span><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-165088"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#969696;">29 май 2018</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:135px; margin-right:-5px; -qt-block-indent:1; text-indent:0px;"><a href="https://forum.amperka.ru/threads/esp-8266-esp32-nodemcu-lua-%D0%B0%D0%B7%D1%8B-%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.12558/page-14#post-165088"><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; text-decoration: underline; color:#969696;">#280</span></a></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:140px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a name="likes-post-165088"></a><span style=" font-family:'Roboto,sans-serif'; font-size:9pt; color:#141414;"><br /></span></p></body></html>