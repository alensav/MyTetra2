<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="title"></a><a href="https://help.ubuntu.com/community/Postfix"><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600; text-decoration: underline; color:#0000ff;">P</span></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600; text-decoration: underline; color:#0000ff;">ostfix</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<hr />
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="cwt-content"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">I</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">ntroduction</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<table border="0" style=" float: right; margin-top:0px; margin-bottom:17px; margin-left:17px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="#f1f1ed">
<tr>
<td style=" padding-left:9; padding-right:9; padding-top:9; padding-bottom:9;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Содержание</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Introduction"><span style=" text-decoration: underline; color:#0000ff;">Introduction</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#What_is_a_Mail_Transfer_Agent"><span style=" text-decoration: underline; color:#0000ff;">What is a Mail Transfer Agent</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Installation"><span style=" text-decoration: underline; color:#0000ff;">Installation</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Configuration"><span style=" text-decoration: underline; color:#0000ff;">Configuration</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Authentication"><span style=" text-decoration: underline; color:#0000ff;">Authentication</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Testing"><span style=" text-decoration: underline; color:#0000ff;">Testing</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Troubleshooting"><span style=" text-decoration: underline; color:#0000ff;">Troubleshooting</span></a></li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Remove_Postfix_from_chroot"><span style=" text-decoration: underline; color:#0000ff;">Remove Postfix from chroot</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Configuring_saslauthd_to_Default"><span style=" text-decoration: underline; color:#0000ff;">Configuring saslauthd to Default</span></a></li></ol>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Using_Port_587_for_Secure_Submission"><span style=" text-decoration: underline; color:#0000ff;">Using Port 587 for Secure Submission</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Other_Postfix_Guides"><span style=" text-decoration: underline; color:#0000ff;">Other Postfix Guides</span></a></li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Postfix_Basic_Setup"><span style=" text-decoration: underline; color:#0000ff;">Postfix Basic Setup</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Postfix_Virtual_Mailbox_and_Antivirus_Filtering"><span style=" text-decoration: underline; color:#0000ff;">Postfix Virtual Mailbox and Antivirus Filtering</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Postfix_Setup_For_Sender_Policy_Framework_.28SPF.29_Checking"><span style=" text-decoration: underline; color:#0000ff;">Postfix Setup For Sender Policy Framework (SPF) Checking</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Postfix_Setup_For_DKIM_email_signing_and_verification"><span style=" text-decoration: underline; color:#0000ff;">Postfix Setup For DKIM email signing and verification</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Add_Dspam_to_Postfix"><span style=" text-decoration: underline; color:#0000ff;">Add Dspam to Postfix</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Postfix_Complete_Solution"><span style=" text-decoration: underline; color:#0000ff;">Postfix Complete Solution</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Dovecot_LDAP"><span style=" text-decoration: underline; color:#0000ff;">Dovecot LDAP</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.com/community/Postfix#Dovecot_SASL"><span style=" text-decoration: underline; color:#0000ff;">Dovecot SASL</span></a></li></ol></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Postfix is the default </span><span style=" font-family:'Ubuntu'; font-weight:600;">Mail Transfer Agent</span><span style=" font-family:'Ubuntu';"> (MTA) for Ubuntu. It is in Ubuntu's main repository, which means that it receives security updates. This guide explains how to install and configure postfix and set it up as an SMTP server using a secure connection. </span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="What_is_a_Mail_Transfer_Agent"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">W</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">hat is a Mail Transfer Agent</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">In other words, it's a mail server not a mail client like Thunderbird, Evolution, Outlook, Eudora, or a web-based email service like Yahoo, GMail, Hotmail, Earthlink, Comcast, SBCGlobal.net, ATT.net etc.... If you worked for a company named Acme and owned acme.com, you could provide your employees with email addresses @acme.com. Employees could send and receive email through your computer, but not without your computer running all the time. If all your email addresses are at a domain (@gmail.com, @yahoo.com) you do not own (you don't own Google) or do not host (acme.com) then you do not need this at all. </span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Installation"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">I</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">nstallation</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">In order to install Postfix with SMTP-AUTH and TLS, first install the </span><span style=" font-family:'Ubuntu'; font-weight:600;">postfix</span><span style=" font-family:'Ubuntu';"> package from the Main repository using your favorite package manager. For example: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo apt-get install postfix</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Simply accept the defaults when the installation process asks questions. The configuration will be done in greater detail in the next stage. </span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Configuration"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">C</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">onfiguration</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">From a terminal prompt: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-1"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo dpkg-reconfigure postfix</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Insert the following details when asked (replacing server1.example.com with your domain name if you have one): </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">General type of mail configuration: <span style=" font-weight:600;">Internet Site</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">NONE <span style=" font-style:italic;">doesn't appear to be requested in current config</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">System mail name: <span style=" font-weight:600;">example.com</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Root and postmaster mail recipient: <span style=" font-weight:600;">&lt;admin_user_name&gt;</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Other destinations for mail: <span style=" font-weight:600;">server1.example.com, example.com, localhost.example.com, localhost</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Force synchronous updates on mail queue?: <span style=" font-weight:600;">No</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Local networks: <span style=" font-weight:600;">127.0.0.0/8</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Yes <span style=" font-style:italic;">doesn't appear to be requested in current config</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Mailbox size limit (bytes): <span style=" font-weight:600;">0</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Local address extension character: <span style=" font-weight:600;">+</span> </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Internet protocols to use: <span style=" font-weight:600;">all</span> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Now is a good time to decide which mailbox format you want to use. By default Postifx will use mbox for the mailbox format. Rather than editing the configuration file directly, you can use the postconf command to configure all postfix parameters. The configuration parameters will be stored in /etc/postfix/main.cf file. Later if you wish to re-configure a particular parameter, you can either run the command or change it manually in the file. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">To configure the mailbox format for Maildir: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-2"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'home_mailbox = Maildir/'</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">You may need to issue this as well: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-3"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'mailbox_command ='</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Note:</span><span style=" font-family:'Ubuntu';"> This will place new mail in /home/username/Maildir so you will need to configure your Mail Delivery Agent to use the same path. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Configure Postfix to do SMTP AUTH using SASL (saslauthd): </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-4"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_sasl_local_domain ='</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_sasl_auth_enable = yes'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_sasl_security_options = noanonymous'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-4"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'broken_sasl_auth_clients = yes'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-5"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination'</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-6"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'inet_interfaces = all'</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Next edit </span><span style=" font-family:'Courier New,courier';">/etc/postfix/sasl/smtpd.conf</span><span style=" font-family:'Ubuntu';"> and add the following lines: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-5"></a><span style=" font-family:'Courier New,courier';">p</span><span style=" font-family:'Courier New,courier';">wcheck_method: saslauthd</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-1"></a><span style=" font-family:'Courier New,courier';">m</span><span style=" font-family:'Courier New,courier';">ech_list: plain login</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Generate certificates to be used for TLS encryption and/or certificate Authentication: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-6"></a><span style=" font-family:'Courier New,courier';">t</span><span style=" font-family:'Courier New,courier';">ouch smtpd.key</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-2"></a><span style=" font-family:'Courier New,courier';">c</span><span style=" font-family:'Courier New,courier';">hmod 600 smtpd.key</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3-1"></a><span style=" font-family:'Courier New,courier';">o</span><span style=" font-family:'Courier New,courier';">penssl genrsa 1024 &gt; smtpd.key</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-4-1"></a><span style=" font-family:'Courier New,courier';">o</span><span style=" font-family:'Courier New,courier';">penssl req -new -key smtpd.key -x509 -days 3650 -out smtpd.crt # has prompts</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-5-1"></a><span style=" font-family:'Courier New,courier';">o</span><span style=" font-family:'Courier New,courier';">penssl req -new -x509 -extensions v3_ca -keyout cakey.pem -out cacert.pem -days 3650 # has prompts</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-6-1"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo mv smtpd.key /etc/ssl/private/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-7"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo mv smtpd.crt /etc/ssl/certs/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-8"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo mv cakey.pem /etc/ssl/private/</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-9"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo mv cacert.pem /etc/ssl/certs/</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Configure Postfix to do TLS encryption for both incoming and outgoing mail: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-7"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtp_tls_security_level = may'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-3"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_security_level = may'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3-2"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_auth_only = no'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-4-2"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtp_tls_note_starttls_offer = yes'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-5-2"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_key_file = /etc/ssl/private/smtpd.key'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-6-2"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_cert_file = /etc/ssl/certs/smtpd.crt'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-7-1"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_CAfile = /etc/ssl/certs/cacert.pem'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-8-1"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_loglevel = 1'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-9-1"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_received_header = yes'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-10"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'smtpd_tls_session_cache_timeout = 3600s'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-11"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'tls_random_source = dev:/dev/urandom'</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-12"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo postconf -e 'myhostname = server1.example.com' # remember to change this to yours</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">The file /etc/postfix/main.cf should now look like this: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-106"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> See /usr/share/postfix/main.cf.dist for a commented, more complete version</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3-3"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-4-3"></a><span style=" font-family:'Courier New,courier';">b</span><span style=" font-family:'Courier New,courier';">iff = no</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-6-3"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> appending .domain is the MUA's job.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-7-2"></a><span style=" font-family:'Courier New,courier';">a</span><span style=" font-family:'Courier New,courier';">ppend_dot_mydomain = no</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-9-2"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> Uncomment the next line to generate &quot;delayed mail&quot; warnings</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-10-1"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">delay_warning_time = 4h</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-12-1"></a><span style=" font-family:'Courier New,courier';">m</span><span style=" font-family:'Courier New,courier';">yhostname = server1.example.com</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-13"></a><span style=" font-family:'Courier New,courier';">a</span><span style=" font-family:'Courier New,courier';">lias_maps = hash:/etc/aliases</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-14"></a><span style=" font-family:'Courier New,courier';">a</span><span style=" font-family:'Courier New,courier';">lias_database = hash:/etc/aliases</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-15"></a><span style=" font-family:'Courier New,courier';">m</span><span style=" font-family:'Courier New,courier';">yorigin = /etc/mailname</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-16"></a><span style=" font-family:'Courier New,courier';">m</span><span style=" font-family:'Courier New,courier';">ydestination = server1.example.com, example.com, localhost.example.com, localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-17"></a><span style=" font-family:'Courier New,courier';">r</span><span style=" font-family:'Courier New,courier';">elayhost =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-18"></a><span style=" font-family:'Courier New,courier';">m</span><span style=" font-family:'Courier New,courier';">ynetworks = 127.0.0.0/8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-19"></a><span style=" font-family:'Courier New,courier';">m</span><span style=" font-family:'Courier New,courier';">ailbox_command = procmail -a &quot;$EXTENSION&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-20"></a><span style=" font-family:'Courier New,courier';">m</span><span style=" font-family:'Courier New,courier';">ailbox_size_limit = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-21"></a><span style=" font-family:'Courier New,courier';">r</span><span style=" font-family:'Courier New,courier';">ecipient_delimiter = +</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-22"></a><span style=" font-family:'Courier New,courier';">i</span><span style=" font-family:'Courier New,courier';">net_interfaces = all</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-23"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_sasl_local_domain =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-24"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_sasl_auth_enable = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-25"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_sasl_security_options = noanonymous</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-26"></a><span style=" font-family:'Courier New,courier';">b</span><span style=" font-family:'Courier New,courier';">roken_sasl_auth_clients = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-27"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-28"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_auth_only = no</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-29"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">Use these on Postfix 2.2.x only</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-30"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">smtp_use_tls = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-31"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">smtpd_use_tls = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-32"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">For Postfix 2.3 or above use:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-33"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtp_tls_security_level = may</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-34"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_security_level = may</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-35"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtp_tls_note_starttls_offer = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-36"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_key_file = /etc/ssl/private/smtpd.key</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-37"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_cert_file = /etc/ssl/certs/smtpd.crt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-38"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_CAfile = /etc/ssl/certs/cacert.pem</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-39"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_loglevel = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-40"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_received_header = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-41"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtpd_tls_session_cache_timeout = 3600s</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-42"></a><span style=" font-family:'Courier New,courier';">t</span><span style=" font-family:'Courier New,courier';">ls_random_source = dev:/dev/urandom</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Restart the postfix daemon like this: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-9"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo /etc/init.d/postfix restart</span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Authentication"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">A</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">uthentication</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">The next steps are to configure Postfix to use SASL for SMTP AUTH. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">First you will need to install the </span><span style=" font-family:'Ubuntu'; font-weight:600;">libsasl2-2</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">sasl2-bin</span><span style=" font-family:'Ubuntu';"> and </span><span style=" font-family:'Ubuntu'; font-weight:600;">libsasl2-modules</span><span style=" font-family:'Ubuntu';"> from the Main repository [i.e. sudo apt-get install them all]. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Note:</span><span style=" font-family:'Ubuntu';"> if you are using Ubuntu 6.06 (Dapper Drake) the package name is </span><span style=" font-family:'Ubuntu'; font-weight:600;">libsasl2</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">We have to change a few things to make it work properly. Because Postfix runs chrooted in </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">/var/spool/postfix</span><span style=" font-family:'Ubuntu';"> we have to change a couple of paths to live in the false root. (ie. </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">/var/run/saslauthd</span><span style=" font-family:'Ubuntu';"> becomes </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">/var/spool/postfix/var/run/saslauthd</span><span style=" font-family:'Ubuntu';">): </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span><img src="image229240120.png" /><a name="line-168"></a><span style=" font-family:'Ubuntu';"> </span><a name="line-169"></a><span style=" font-family:'Ubuntu'; font-weight:600;">N</span><span style=" font-family:'Ubuntu'; font-weight:600;">ote:</span><span style=" font-family:'Ubuntu';"> by changing the </span><span style=" font-family:'Ubuntu'; font-weight:600;">saslauthd</span><span style=" font-family:'Ubuntu';"> path other applications that use saslauthd may be affected. </span><a name="line-170"></a><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">First, we edit /etc/default/saslauthd in order to activate saslauthd. Remove # in front of START=yes, add the PWDIR, PARAMS, and PIDFILE lines and edit the OPTIONS line at the end: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-175"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> This needs to be uncommented before saslauthd will be run automatically</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-5"></a><span style=" font-family:'Courier New,courier';">S</span><span style=" font-family:'Courier New,courier';">TART=yes</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-4-4"></a><span style=" font-family:'Courier New,courier';">P</span><span style=" font-family:'Courier New,courier';">WDIR=&quot;/var/spool/postfix/var/run/saslauthd&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-5-4"></a><span style=" font-family:'Courier New,courier';">P</span><span style=" font-family:'Courier New,courier';">ARAMS=&quot;-m ${PWDIR}&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-6-4"></a><span style=" font-family:'Courier New,courier';">P</span><span style=" font-family:'Courier New,courier';">IDFILE=&quot;${PWDIR}/saslauthd.pid&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-8-3"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> You must specify the authentication mechanisms you wish to use.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-9-3"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> This defaults to &quot;pam&quot; for PAM support, but may also include</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-10-2"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> &quot;shadow&quot; or &quot;sasldb&quot;, like this:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-11-2"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> MECHANISMS=&quot;pam shadow&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-13-1"></a><span style=" font-family:'Courier New,courier';">M</span><span style=" font-family:'Courier New,courier';">ECHANISMS=&quot;pam&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-15-1"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> Other options (default: -c)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-16-1"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> See the saslauthd man page for information about these options.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-17-1"></a><span style=" font-family:'Courier New,courier';">#</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-18-1"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> Example for postfix users: &quot;-c -m /var/spool/postfix/var/run/saslauthd&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-19-1"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';"> Note: See /usr/share/doc/sasl2-bin/README.Debian</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-20-1"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">OPTIONS=&quot;-c&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-22-1"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">make sure you set the options here otherwise it ignores params above and will not work</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-23-1"></a><span style=" font-family:'Courier New,courier';">O</span><span style=" font-family:'Courier New,courier';">PTIONS=&quot;-c -m /var/spool/postfix/var/run/saslauthd&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Note</span><span style=" font-family:'Ubuntu';">: If you prefer, you can use &quot;shadow&quot; instead of &quot;pam&quot;. This will use MD5 hashed password transfer and is perfectly secure. The username and password needed to authenticate will be those of the users on the system you are using on the server. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Next, we update the dpkg &quot;state&quot; of /var/spool/postfix/var/run/saslauthd. The saslauthd init script uses this setting to create the missing directory with the appropriate permissions and ownership: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-206"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo dpkg-statoverride --force --update --add root sasl 755 /var/spool/postfix/var/run/saslauthd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">This may report an error that &quot;--update given&quot; and the &quot;/var/spool/postfix/var/run/saslauthd&quot; directory does not exist. You can ignore this because when you start saslauthd next it will be created. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Update by dominique-ramaekers: On 14.04.2 LTS, Trusty Tahr, I needed to create a symbolic link from /etc/default/saslauthd to /etc/. On starting the service I got this error: &quot;saslauthd[14117] :main : no authentication mechanism specified&quot;. Aparantly, the saslauthd looks for the config file /etc/saslauthd and not for /etc/default/saslauthd. The link fixes this issue. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-214"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo ln -s /etc/default/saslauthd /etc/saslauthd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Finally, start saslauthd: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-220"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo /etc/init.d/saslauthd start</span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Testing"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">T</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">esting</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">To see if SMTP-AUTH and TLS work properly now run the following command: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">telnet localhost 25 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">After you have established the connection to your postfix mail server type </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">ehlo localhost </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">If you see the lines </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-14"></a><span style=" font-family:'Courier New,courier';">2</span><span style=" font-family:'Courier New,courier';">50-STARTTLS</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-6"></a><span style=" font-family:'Courier New,courier';">2</span><span style=" font-family:'Courier New,courier';">50-AUTH</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">among others, everything is working. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Type </span><span style=" font-family:'Courier New,courier';">quit</span><span style=" font-family:'Ubuntu';"> to return to the system's shell. </span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Troubleshooting"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">T</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">roubleshooting</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Remove_Postfix_from_chroot"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">R</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">emove Postfix from chroot</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">If you run into issues while running Postfix you may be asked to remove Postfix from chroot to better diagnose the problem. In order to do that you will need to edit </span><span style=" font-family:'Courier New,courier';">/etc/postfix/master.cf</span><span style=" font-family:'Ubuntu';"> locate the following line: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-15"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtp      inet  n       -       -       -       -       smtpd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">and modify it as follows: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-256"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">mtp      inet  n       -       n       -       -       smtpd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Then restart Postfix: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-262"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo /etc/init.d/postfix restart</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Configuring_saslauthd_to_Default"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">C</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">onfiguring saslauthd to Default</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">If you don't want to run Postfix in a chroot, or you'd like to not use chroot for troubleshooting purposes you will probably also want to return </span><span style=" font-family:'Ubuntu'; font-weight:600;">saslauthd</span><span style=" font-family:'Ubuntu';"> back to its default configuration. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">The first step in accomplishing this is to edit </span><span style=" font-family:'Courier New,courier';">/etc/default/saslauthd</span><span style=" font-family:'Ubuntu';"> comment the following lines we added above: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-272"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">PWDIR=&quot;/var/spool/postfix/var/run/saslauthd&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-7"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">PARAMS=&quot;-m ${PWDIR}&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3-5"></a><span style=" font-family:'Courier New,courier';">#</span><span style=" font-family:'Courier New,courier';">PIDFILE=&quot;${PWDIR}/saslauthd.pid&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Then return the saslauthd dpkg &quot;state&quot; to its default location: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-280"></a><span style=" font-family:'Courier New,courier';">d</span><span style=" font-family:'Courier New,courier';">pkg-statoverride --force --update --add root sasl 755 /var/run/saslauthd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">And restart saslauthd: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-286"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo /etc/init.d/saslauthd restart</span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Using_Port_587_for_Secure_Submission"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">U</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">sing Port 587 for Secure Submission</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">If you want to use port 587 as the submission port for SMTP mail rather than 25 (many ISPs block port 25), you will need to edit /etc/postfix/master.cf and uncomment the line </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-21"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">ubmission inet n      -       n       -       -       smtpd</span></p></body></html>