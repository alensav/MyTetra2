<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a href="https://arduino-kit.ru/"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;"> </span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"> </span><a href="https://arduino-kit.ru/blogs/blog"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#000000; background-color:transparent;">Блог</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">  </span><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#231f20;">● Проект 32: Беспроводная связь. Модуль GSM/GPRS SIM900</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.4%; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:xx-large; font-weight:496; color:#000000; background-color:#ffffff;">● Проект 32: Беспроводная связь. Модуль GSM/GPRS SIM900</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:12px; font-weight:496; color:#555555; background-color:#ffffff;">Опубликовано: 23.04.2018</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:21px; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">В этом эксперименте рассмотрим работу модуля GSM/GPRS shield – платы расширения, позволяющей Arduino работать в сетях сотовой связи по технологиям GSM/GPRS для приёма и передачи данных, SMS и голосовой связи.<br /><br /></span><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:600; color:#000000;">Необходимые компоненты:</span><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"><br /><br />• </span><a href="https://arduino-kit.ru/product/arduino-uno-r3"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;">контроллер Arduino UNO R3</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">;<br />• </span><a href="https://arduino-kit.ru/product/bb-102-maketnaya-plata-dlya-montaja-bez-payki"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;">плата для прототипирования</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">;<br />• </span><a href="https://arduino-kit.ru/product/shield-gprs-gsm-sim900-s-antennoy"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;">GSM/GPRS shield</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">;<br />• работающая SIM-карта любого оператора;<br />• датчик температуры LM335;<br />• </span><a href="http://mbitech.ru/images/userfiles/image/Resistors%20220.jpg"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;">резистор 2,2 кОм</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">;<br />• </span><a href="https://arduino-kit.ru/product/bbj-65-komplekt-tsvetnyih-montajnyih-peremyichek-mm-dlya-maketnyih-plat-bez-payki"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;">провода папа-папа</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">.<br />• </span><a href="https://arduino-kit.ru/product/adapter-blok-pitaniya-robiton-en1500s-1500-ma"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;">блок питания +5 в 1 А</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;">;<br /><br />GSM/GPRS shield на базе модуля SIMCom SIM900 выпускают несколько производителей, и платы имеют незначительные отличия. Также на некоторых платах расположены: слот для SIM-карты, стандартные 3,5 мм джек для аудиовхода и выхода и разъём для внешней антенны. На плате GSM/GPRS shild имеется несколько перемычек, позволяющих выбрать тип serial-соединения (hardware или software). GSM/GPRS shield имеет два способа включения – аппаратный (кратковременное нажатие кнопки PWRKEY) и программный (используется один из выходов Arduino). Рассмотрим пример отправки и получения SMS-сообщений с помощью GSM/GPRS shield. Каждые 30 минут будем отправлять на определенный номер показания аналогового датчика температуры LM335, подсоединенного к выводу A0. Схема соединений эксперимента показана на рис. 32.1.<br /><br /></span><img src="image1431937231.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; font-style:italic; color:#000000;">Рис. 32.1. Схема подключения модуля GSM/GPRS shield и датчика LM335. Шилд SIM900 установлен на Arduino UNO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"><br />Содержимое скетча для отправки SMS показано в листинге 32.1.<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// подключение библиотеки SoftwareSerial</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">#include &lt;SoftwareSerial.h&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// номер телефона для отправки sms (поменяйте на свой)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">#define PHONE &quot;+79031111111&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// Выводы для SoftwareSerial (у вас могут быть 7,8)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">SoftwareSerial Sim900Serial(2, 3);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">const int lm335=A0; // для подключения LM335</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">unsigned long millis1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">void setup()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial(19200); // the Hardware serial rate</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">void loop()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">if (millis()-millis1&gt;30*60*1000) // прошло 30 минут?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">SendTextMessage(); // отправить sms</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">millis1=millis();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// подпрограмма отправки sms</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">void SendTextMessage()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// AT-команда установки text mode</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(&quot;AT+CMGF=1\r&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// номер телефона получателя</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println(&quot;AT + CMGS = \&quot;&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println(PHONE);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println(&quot;\&quot;&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// сообщение – данные температуры</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">double val = analogRead(lm335); // чтение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">double voltage = val*5.0/1024; // перевод в вольты</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">double temp = voltage*100 - 273.15; // в градусы Цельсия</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println(temp);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// ASCII код ctrl+z – окончание передачи</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println((char)26);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println();</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"><br /></span><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:600; color:#000000;">Порядок подключения:</span><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"><br /><br />1. Установим SIM-карту на GSM/GPRS Shield, а GSM/GPRS Shield – на Arduino. С помощью джамперов соединим контакты для работы через SoftwareSerial-эмуляцию.<br />2. Собираем схему, согласно рис. 32.1.<br />3. Загружаем в плату Arduino скетч из листинга 32.1.<br />4. На телефон, указанный в скетче, раз в 30 минут должны приходить sms-сообщения с данными температуры. Теперь изменим скетч таким образом, чтобы Arduino отправляла sms-сообщение с данными температуры только при получении при- ходящего сообщения с текстом «temp».<br />Содержимое скетча показано в листинге 32.2.<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">#include &lt;SoftwareSerial.h&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">SoftwareSerial Sim900Serial(2, 3);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">String currStr = &quot;&quot;; //</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">String phone = &quot;&quot;; //</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// True, если текущая строка является sms-сообщением</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">boolean isStringMessage = false;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">void setup()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Serial.begin(19200);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.begin(19200);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// Настраиваем приём сообщений с других устройств</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(&quot;AT+CMGF=1\r&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(300);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(&quot;AT+IFC=1, 1\r&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(300);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(&quot;AT+CPBS=\&quot;SM\&quot;\r&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(300);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(&quot;AT+CNMI=1,2,2,1,0\r&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(500);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">void loop()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">if (!Sim900Serial.available())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">return;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">char currSymb = Sim900Serial.read();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">if ('\r' == currSymb)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">if (isStringMessage) // текущая строка - sms-сообщение,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">if (!currStr.compareTo(&quot;temp&quot;)) // текст sms - temp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// отправить sms на приходящий номер</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(&quot;AT+CMGF=1\r&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(&quot;AT + CMGS = \&quot;&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.print(phone);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println(&quot;\&quot;&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">double val = analogRead(A0); // чтение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">double voltage = val*5.0/1024; // перевод в вольты</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">double temp = voltage*100 - 273.15; // в градусы Цельсия</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Serial.println(temp);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println(temp);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println((char)26);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">delay(100);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Sim900Serial.println();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Serial.println(currStr);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">isStringMessage = false;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">if (currStr.startsWith(&quot;+CMT&quot;)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Serial.println(currStr);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// выделить из сообщения номер телефона</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">phone=currStr.substring(7,19);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">Serial.println(phone);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// если текущая строка начинается с &quot;+CMT&quot;,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">// то следующая строка является сообщением</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">isStringMessage = true;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">currStr = &quot;&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">else if ('\n' != currSymb)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">currStr += String(currSymb);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace,monospace'; font-size:14px; font-weight:496; color:#000000;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"><br /><br /></span><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:600; color:#008080;">Листинги программ</span><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"> </span><a href="https://static.insales-cdn.com/files/1/2769/5507793/original/33_projects__arduino_listing.zip"><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; text-decoration: underline; color:#231f20; background-color:transparent;">скачать</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:14px; font-weight:496; color:#000000;"><br /><br /><br /><br /> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"> </span></p></body></html>