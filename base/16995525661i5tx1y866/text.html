<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:20px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%; background-color:#222222;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/"><span style=" font-family:'Helvetica,Arial'; font-size:9pt; font-weight:600; text-decoration: underline; color:#808080; background-color:#222222;">ESP-OPEN-SDK: работа с WiFi соединением в режиме клиента (station mode)</span></a></p>
<p style=" margin-top:10px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'Geneva,Arial,Helvetica,sans-serif'; font-size:9pt; font-weight:600; color:#45342e;">разделы: </span><a href="https://count-zero.ru/tags/iot"><span style=" font-family:'Geneva,Arial,Helvetica,sans-serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#337ab7; background-color:transparent;">Интернет вещей </span></a><span style=" font-family:'Geneva,Arial,Helvetica,sans-serif'; font-size:9pt; font-weight:600; color:#45342e;">, дата: 19 мая 2019г.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В данной статье я хочу рассмотреть наиболее простые примеры для работы с сетью средствами SDK. При работе с сетью, SDK использует неблокирующее программирование. В связи с этим, программирование сводиться к написанию коллбек-функций, которые будут вызываться из SDK при наступлении того или иного события. Это затрудняет чтение и разбор алгоритма программы, поэтому в статье я всега стараюсь говорить, что за чем следует.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Статья по структуре будет напоминать предыдущую: &quot;</span><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/2018/esp8266/"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266: подключение, прошивка и работа с AT-командами</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">&quot;, за тем исключением, что в этот раз все будет делаться с помощью программирования через ESP8266-NONOS-SDK.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:-15px; margin-right:-15px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Конфигурация WiFi сети будет, опять же, состоять из двух компонентов: а) точки доступа на роутере с прошивкой OpenWRT; б) и собственно ESP8266 выступающего в роли клиента. На стороне роутера запущен web-сервер для обслуживания ESP8266. Для передачи и получения данных от роутера, ESP8266 будет использовать GET - запросы.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В качестве &quot;транспорта&quot; для работы с TCP/IP я буду использовать штатный интерфейс espconn, который описан в </span><a href="https://www.espressif.com/sites/default/files/documentation/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Для захвата и анализа трафика между ESP8266 и точкой доступа на OpenWRT, я буду использовать программы tcpdump и Wireshark. Все примеры статьи используют SDK версии 2.1.0.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#45342e;">Список используемой документации:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.espressif.com/en/products/hardware/esp8266ex/resources"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266EX Resources | Espressif Systems</span></a><span style=" font-size:16px;"> Страница с доступными ресурсами по ESP8266 на сайте производителя.</span></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.espressif.com/sites/default/files/documentation/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a><span style=" font-size:16px;"> ESP8266 Non-OS SDK API Reference версия 2.2</span></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.espressif.com/sites/default/files/documentation/9b-esp8266-low_power_solutions_en.pdf"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Low Power Solutions</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Статья Михаила Григорьева на хабре: </span><a href="https://habr.com/ru/post/363349/"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Работа с ESP8266: Собираем компилятор и пишем первую прошивку</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Книга </span><a href="https://www.espressif.com/en/media_overview/news/latest-version-kolbans-book-esp8266"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Kolban's Book on ESP8266</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Если вы как и я НЕ учились по специальности &quot;компьютерные сети&quot;, то вам скорее всего понадобиться какой-нибудь мануал с описанием разных сетевых протоколов. Я лично использую &quot;В. Олифер, Н. Олифер «Компьютерные сети. Принципы, технологии, протоколы.&quot;, часть IV: Сети TCP/IP. Это недорогой понятный учебник без лишней воды.</span></li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#45342e;">Содержание:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#1"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Создание базового проекта</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#2"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Установка WiFi соединения в режиме клиента</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#3"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Работа с TCP соединением используя espconn</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#4"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Использование режима энергосбережения &quot;deep sleep&quot;</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#5"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Реализация команды ping</span></a></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#6"><span style=" font-size:16px; text-decoration: underline; color:#337ab7; background-color:transparent;">Получение даты и времени из сети по протоколу SNTP</span></a></li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Посмотреть исходники, сборочные файлы, скачать скомпилированные прошивки, можно с портала GITLAB </span><a href="https://gitlab.com/flank1er/esp8266_sdk_examples"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">https://gitlab.com/flank1er/esp8266_sdk_examples</span></a></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><a name="1"></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">1</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">) Создание базового проекта</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Для на начала нужно будет создать базовый проект, который мы будем постепенно развивать. Отталкиваться при этом будем от последнего проекта </span><a href="https://count-zero.ru/2019/esp_open_sdk/"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">предыдущей статьи</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">. Итак:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Создаем структуру каталогов:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">mkdir -p 06_basic_project/inc</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Переходим в созданную директорию 06_basic_project, и в каталоге </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">inc</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> создаем пустой заголовочный файл &quot;</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">user_config.h</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">&quot;:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">touch ./inc/user_config.h</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">После этого копируем файл &quot;</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">espmissingincludes.h</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">&quot;:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">curl </span><a href="https://gitlab.com/flank1er/esp8266_sdk_examples/raw/master/05_os_print/inc/espmissingincludes.h"><span style=" font-family:'monospace'; font-size:10pt; text-decoration: underline; color:#337ab7; background-color:transparent;">https://gitlab.com/flank1er/esp8266_sdk_examples/raw/master/05_os_print/inc/espmissingincludes.h</span></a><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> &gt; ./inc/espmissingincludes.h</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В главной директории создаем Makefile следующего содержания:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">SDK=/here_should_be_path_to_your_ESP8266_SDK/ESP8266_NONOS_SDK-2.1.0-18-g61248df</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">DRIVER=/here_should_be_path_to_your_ESP8266_SDK/ESP8266_NONOS_SDK-2.1.0-18-g61248df/driver_lib</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">CC=xtensa-lx106-elf-gcc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">SIZE=xtensa-lx106-elf-size</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">ESPTOOL=esptool.py</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">INC  = -I./inc -mlongcalls</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">INC += -I$(DRIVER)/include</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">CFLAGS= -std=c99 -ggdb -O0  -Wall -Wno-unused-variable $(INC)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">LDFLAGS= -L$(SDK)/lib  -T$(SDK)/ld/eagle.app.v6.ld</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">LDLIBS=-nostdlib -Wl,--start-group -lmain -lnet80211 -lwpa -llwip -lpp -lphy -lc -Wl,--end-group -lgcc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">OBJ=main.o gpio16.o uart.o</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">TARGET=blink</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">.PHONY: all clean</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">%.o:	$(DRIVER)/driver/%.c</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">	$(CC) $(CFLAGS) -c -o $@ $&lt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">%.o:	%.c</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">	$(CC) $(CFLAGS) -c -o $@ $&lt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">all:	$(OBJ)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">	$(CC) $(LDFLAGS) -ggdb  -o $(TARGET).elf  $(OBJ) $(LDLIBS)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">	$(SIZE)  $(TARGET).elf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">	$(ESPTOOL) elf2image $(TARGET).elf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">install:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">	$(ESPTOOL) write_flash 0 $(TARGET).elf-0x00000.bin 0x10000 $(TARGET).elf-0x10000.bin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">clean:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">	@rm -v $(TARGET).elf $(OBJ) $(TARGET).elf-0x?0000.bin</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Осталось добавить &quot;</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">main.c</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">&quot; c исходником простой мигалки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ets_sys.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;user_interface.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;osapi.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;gpio.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;driver/gpio16.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;driver/uart.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;espmissingincludes.h&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ff40ff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> os_timer_t gpio16_timer;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">uint8_t</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> led_status;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : blink</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : toggle gpio16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">LOCAL </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> blink(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (led_status)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        gpio16_output_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0x1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);     </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// High</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        gpio16_output_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0x0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);     </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// Low</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#8080ff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    led_status= !led_status;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : user_init</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : entry of user application, init user function here</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR user_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// init varialbles</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    led_status=</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// inti periphery</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio_init();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// map GPIO16 as push-pull  pin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio16_output_conf();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// UART config</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uart_init(BIT_RATE_115200, BIT_RATE_115200);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// blink timer (1000ms, repeating)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_setfn(&amp;gpio16_timer, (os_timer_func_t *)blink, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_arm(&amp;gpio16_timer, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1000</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;SDK version:%s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, system_get_sdk_version());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_rf_pre_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : user_rf_cal_sector_set</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : SDK just reversed 4 sectors, used for rf init data and parameters.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                We add this function to force users to set rf cal sector, since</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                we don't know which sector is free in user's application.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                sector map for last several sectors : ABCCC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                A : rf cal</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                B : rf init data</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                C : sdk parameters</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : rf cal sector</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">uint32 ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_rf_cal_sector_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">enum</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> flash_size_map size_map = system_get_flash_size_map();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint32 rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (size_map) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_4M_MAP_256_256:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">128</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_8M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">256</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">512</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1024</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_64M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2048</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_128M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">4096</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">return</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> rf_cal_sec;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">После компиляции и прошивки, светодиод на плате должен начать мигать с интервалом одну секунду.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Если сравнивать данный пример с примерами из </span><a href="https://count-zero.ru/2019/esp_open_sdk/"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">предыдущей статьи</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">, то можно заметить, что код мигалки реализован через таймер. Кроме того, добавлены две новые функции: user_rf_cal_sector_set() и user_rf_pre_init(). Что это за функции? В самом начале документа к </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> можно увидеть следующие строки:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image287595963.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь говорится, что указанные функции должны быть добавлены в один исходник с user_init(). Самостоятельно вызывать их не надо, они вызываются из SDK. Код функций был взят примера ESP8266_NONOS_SDK/examples/IOT_Demo/user/user_main.c.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">У функции user_rf_cal_sector_set() имеется описание:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">user_rf_cal_sector_set()</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Устанавливает размер сектора в разделе хранения калибровочных параметров wifi модуля - </span><span style=" font-family:'monospace'; color:#8080ff;">RF_CAL</span><span style=" font-family:'monospace'; color:#ff8c00;">.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">uint32 user_rf_cal_sector_set(void)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Размер сектора для хранения </span><span style=" font-family:'monospace'; color:#8080ff;">RF_CAL</span><span style=" font-family:'monospace'; color:#ff8c00;"> параметров.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Примечания</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция <span style=" color:#8080ff;">user_rf_cal_sector_set()</span> должна быть добавлена в приложение, но она НЕ должна вызываться. Её вызов происходит из самого SDK.</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Так как область системных параметров (четыре сектора флеш-памяти) уже используется, то параметры RF_CAL будут сохраняться в секторе заданом  user_rf_cal_sector_set. Поскольку система не знает какой сектор является доступным, пользователю необходимо  задать свободный сектор для хранения RF_CAL в функции user_rf_cal_sector_set. </li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если функцию <span style=" color:#8080ff;">user_rf_cal_sector_set()</span> не была добавлена в приложение, компиляция закончится ошибкой на этапе линковки.</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Загрузите blank.bin для инициализации сектора хранящего параметры <span style=" color:#8080ff;">RF_CAL</span>. Или загрузите esp_init_data.bin на флеш, когда система нуждается в инициализации  или повторной калибровке параметров радио-модуля RF.</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      		</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      </li></ul></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Пример</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Установка пятого сектора от конца флеш-памяти  для сохранения </span><span style=" font-family:'monospace'; color:#8080ff;">RF_CAL</span><span style=" font-family:'monospace'; color:#ff8c00;"> параметра:<br /></span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#ff8c00;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">uint32  user_rf_cal_sector_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">enum</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> flash_size_map size_map = system_get_flash_size_map();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint32 rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (size_map) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_4M_MAP_256_256:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">128</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_8M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">256</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">512</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">512</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_64M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2048</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_128M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">4096</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">return</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">  rf_cal_sec;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Думаю, не сложно заметить, что код из примера используется в вышеприведенной программе.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Итак, если светодиод на плате NodeMCU благополучно мигает и вопросов по коду больше нет, тогда переходим к установке WiFi соединения.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><a name="2"></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">2</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">) Установка WiFi соединения в режиме клиента</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Как бы это не показалось странным (подводные камни, да), но первая функция которая нам понадобится для работы с wifi - это функция проверки статуса соединения </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">wifi_station_get_connect_status()</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_get_connect_status()</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Получить статус WiFi соединения ESP8266, работающего в режиме клиента, с точкой доступа. </span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">uint8 wifi_station_get_connect_status(void)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Параметры</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Отсутствуют.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#00ff00;">enum</span><span style=" font-family:'monospace'; color:#ff8c00;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">    STATION_IDLE = </span><span style=" font-family:'monospace'; color:#ff40ff;">0</span><span style=" font-family:'monospace'; color:#ff8c00;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">    STATION_CONNECTING,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">    STATION_WRONG_PASSWORD,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">    STATION_NO_AP_FOUND,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">    STATION_CONNECT_FAIL,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">    STATION_GOT_IP</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">};</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Примечание</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">В частном случае, если вы вызываете </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_set_reconnect_policy</span><span style=" font-family:'monospace'; color:#ff8c00;"> для отключения автоматического переподключения (реконнекта), и при этом не вызываете </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_set_event_handler_cb</span><span style=" font-family:'monospace'; color:#ff8c00;"> для установки обработчика изменения статуса WiFi соединения, то вызов функции  </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_get_connect_status()</span><span style=" font-family:'monospace'; color:#ff8c00;"> будет бесполезным и вы будет получать некорректный результат.</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">На основе функции wifi_station_get_connect_status() напишем функцию печати через UART статуса wifi-соединения, и добавим ее вызов в blink(). В целом программа будет выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ets_sys.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;user_interface.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;osapi.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;gpio.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;driver/gpio16.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;driver/uart.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;espmissingincludes.h&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ff40ff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ip_info ipConfig;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> os_timer_t gpio16_timer;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">uint8_t</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> led_status;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> print_connect_status();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : blink</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : toggle gpio16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">LOCAL </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> blink(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (led_status)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        gpio16_output_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0x1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);     </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// High</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        gpio16_output_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0x0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);     </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// Low</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#8080ff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    led_status= !led_status;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    print_connect_status();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : user_init</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : entry of user application, init user function here</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR user_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// init varialbles</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    led_status=</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// inti periphery</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio_init();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// map GPIO16 as push-pull  pin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio16_output_conf();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// UART config</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uart_init(BIT_RATE_115200, BIT_RATE_115200);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// blink timer (1000ms, repeating)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_setfn(&amp;gpio16_timer, (os_timer_func_t *)blink, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_arm(&amp;gpio16_timer, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1000</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;SDK version:%s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, system_get_sdk_version());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_rf_pre_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : user_rf_cal_sector_set</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : SDK just reversed </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">4</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> sectors, used for rf init data and paramters.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                We add this function to force users to set rf cal sector, since</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                we don't know which sector is free in user's application.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                sector map for last several sectors : ABCCC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                A : rf cal</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                B : rf init data</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                C : sdk parameters</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : rf cal sector</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">uint32 ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_rf_cal_sector_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">enum</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> flash_size_map size_map = system_get_flash_size_map();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint32 rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (size_map) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_4M_MAP_256_256:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">128</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_8M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">256</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">512</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1024</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_64M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2048</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_128M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">4096</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">return</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> rf_cal_sec;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> print_connect_status() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">uint8_t</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> status=wifi_station_get_connect_status();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (status) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_IDLE :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Idle\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_CONNECTING :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Connecting\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_WRONG_PASSWORD :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Wrong password\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_NO_AP_FOUND :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: No AP found\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_CONNECT_FAIL :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Connect Fail\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_GOT_IP :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Got IP\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">     </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;Current status is: %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,status);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ((status == STATION_GOT_IP) &amp;&amp;  wifi_get_ip_info(STATION_IF, &amp;ipConfig)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ip: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR, IP2STR(&amp;ipConfig.ip.addr));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Для наглядности я еще добавил печать IP-адреса в случае если ESP8266 устанавливает соединение с точкой доступа. Для получения IP используется функция </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">wifi_get_ip_info(STATION_IF, &amp;ipConfig):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_get_ip_info</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Получение структуры ip_info в режиме клиента или Soft-AP.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">bool wifi_set_ip_info(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">	uint8 if_index,	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">	struct ip_info *info</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Параметры</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">uint8 if_index:</span><span style=" font-family:'monospace'; color:#ff8c00;"> интерфейс для получения IP адреса: </span><span style=" font-family:'monospace'; color:#8080ff;">0x00</span><span style=" font-family:'monospace'; color:#ff8c00;"> для </span><span style=" font-family:'monospace'; color:#8080ff;">STATION_IF</span><span style=" font-family:'monospace'; color:#ff8c00;"> и </span><span style=" font-family:'monospace'; color:#8080ff;">0х01</span><span style=" font-family:'monospace'; color:#ff8c00;"> для </span><span style=" font-family:'monospace'; color:#8080ff;">SOFTAP_IF</span><span style=" font-family:'monospace'; color:#ff8c00;">.<br /></span><span style=" font-family:'monospace'; color:#8080ff;">struct ip_info *info:</span><span style=" font-family:'monospace'; color:#ff8c00;"> указатель на возвращаемую структуру ip_info.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">True: успешное выполнение;<br />False: ошибка при выполнении.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Примечание</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Данное API доступно после инициализации, не вызывайте его из user_init().</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">При этом структура ip_info определена в заголовочном файле ip_addr.h, и имеет следующий вид:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ip_addr {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint32 addr;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ip_info {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ip_addr ip;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ip_addr netmask;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ip_addr gw;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Макрос IP2STR для печати IP - определен там же:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr1(ipaddr) (((uint8*)(ipaddr))[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr2(ipaddr) (((uint8*)(ipaddr))[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr3(ipaddr) (((uint8*)(ipaddr))[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2</span><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr4(ipaddr) (((uint8*)(ipaddr))[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">3</span><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">])</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#6495ed; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr1_16(ipaddr) ((uint16)ip4_addr1(ipaddr))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr2_16(ipaddr) ((uint16)ip4_addr2(ipaddr))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr3_16(ipaddr) ((uint16)ip4_addr3(ipaddr))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip4_addr4_16(ipaddr) ((uint16)ip4_addr4(ipaddr))</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#6495ed; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define IP2STR(ipaddr) ip4_addr1_16(ipaddr), \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">    ip4_addr2_16(ipaddr), \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">    ip4_addr3_16(ipaddr), \</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">    ip4_addr4_16(ipaddr)</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Итак, после компиляции прошивки ESP8266, в терминале последовательного порта можно будет увидеть такую картинку:</span><img src="image1342481862.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Т.е. можно видеть, что esp8266 УЖЕ установила соединение с точкой доступа, без всяких телодвижений с нашей стороны.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:696; color:#45342e;">КАК ТАКОЕ ВОЗМОЖНО?!</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь можно только предполагать. В прошлой статье я </span><a href="https://count-zero.ru/2019/esp_open_sdk/#1"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">упоминал о подводном камне</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">, когда прошивка esp_open_sdk начинает работать только после того как ESP8266 предварительно прошить прошивкой с интерпретатором АТ-команд. Теперь вспоминаем. Когда мы через этот интерпретатор устанавливаем соединение с точкой доступа, то после перезагрузки ESP8266, это соединение устанавливается уже автоматически. Т.е. на флешке УЖЕ хранится режим работы WIFI-модуля, SSID точки отступа и парольная фраза. Имея эту информацию, sdk автоматически при старте устанавливает соединение, вне зависимости от того, записан ли AT-интерпретатор или программа esp-open-sdk. Само-собой, в дальнейшем мы будем самостоятельно через функции SDK устанавливать соединение с нужной точкой доступа, но про этот нюанс забывать не стоит.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Печать статуса соединения с определенным интервалом не совсем корректный подход к работе c SDK. Более корректно будет использование </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">wifi_set_event_handler_cb()</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> для установки обработчика изменения статуса соединения:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_set_event_handler_cb</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Установка обработчика событий WiFi</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">void wifi_set_event_handler_cb(wifi_event_handler_cb_t cb)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Параметры</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">wifi_event_handler_cb_t cb</span><span style=" font-family:'monospace'; color:#ff8c00;">: callback-функция</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Отсутствует.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Пример</span></p></td>
<td bgcolor="#333333" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> wifi_handle_event_cb(System_Event_t *evt)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">  os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;event %x\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, evt-&gt;event);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">  </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (evt-&gt;event) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_CONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;connect to ssid %s, channel %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          evt-&gt;event_info.connected.ssid,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          evt-&gt;event_info.connected.channel);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_DISCONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;disconnect from ssid %s, reason %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          evt-&gt;event_info.disconnected.ssid,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          evt-&gt;event_info.disconnected.reason);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_AUTHMODE_CHANGE:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;mode: %d -&gt; %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          evt-&gt;event_info.auth_change.old_mode,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          evt-&gt;event_info.auth_change.new_mode);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_GOT_IP:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ip:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,mask:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,gw:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.ip),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.mask),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.gw));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_SOFTAPMODE_STACONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;station: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> MACSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;join, AID = %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            MAC2STR(evt-&gt;event_info.sta_connected.mac),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.sta_connected.aid);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_SOFTAPMODE_STADISCONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;station: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> MACSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;leave, AID = %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            MAC2STR(evt-&gt;event_info.sta_disconnected.mac),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.sta_disconnected.aid);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">          </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">  }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> user_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">TODO</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">: add your own code here....</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    wifi_set_event_hander_cb(wifi_handle_event_cb);</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Смысл обработчика событий WiFi состоит в том, что при любом изменении статуса WiFi-соединения вызывается данный обработчик. Именно в нём и следует размещать печать статуса соединения.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Теперь приводим программу к следующему виду:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ets_sys.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;user_interface.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;osapi.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;gpio.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;driver/gpio16.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;driver/uart.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;espmissingincludes.h&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ff40ff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ip_info ipConfig;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> os_timer_t gpio16_timer;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">uint8_t</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> led_status;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> print_connect_status();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> wifi_handle_event_cb(System_Event_t *evt);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : blink</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : toggle gpio16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">LOCAL </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> blink(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (led_status)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        gpio16_output_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0x1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);     </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// High</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        gpio16_output_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0x0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);     </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// Low</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#8080ff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    led_status= !led_status;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//  print_connect_status();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : user_init</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : entry of user application, init user function here</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR user_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// init varialbles</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    led_status=</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// inti periphery</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio_init();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// map GPIO16 as push-pull  pin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio16_output_conf();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// UART config</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uart_init(BIT_RATE_115200, BIT_RATE_115200);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// blink timer (1000ms, repeating)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_setfn(&amp;gpio16_timer, (os_timer_func_t *)blink, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_arm(&amp;gpio16_timer, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1000</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;SDK version:%s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, system_get_sdk_version());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// wifi connect</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    wifi_set_event_handler_cb(wifi_handle_event_cb);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_rf_pre_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">/******************************************************************************</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * FunctionName : user_rf_cal_sector_set</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Description  : SDK just reversed </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">4</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> sectors, used for rf init data and paramters.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                We add this function to force users to set rf cal sector, since</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                we don't know which sector is free in user's application.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                sector map for last several sectors : ABCCC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                A : rf cal</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                B : rf init data</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> *                C : sdk parameters</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Parameters   : none</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> * Returns      : rf cal sector</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">*******************************************************************************/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">uint32 ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_rf_cal_sector_set(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">enum</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> flash_size_map size_map = system_get_flash_size_map();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint32 rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (size_map) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_4M_MAP_256_256:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">128</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_8M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">256</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_16M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">512</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_512_512:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_32M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1024</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_64M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2048</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> FLASH_SIZE_128M_MAP_1024_1024:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">4096</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> - </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">5</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            rf_cal_sec = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">return</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> rf_cal_sec;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> print_connect_status() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">uint8_t</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> status=wifi_station_get_connect_status();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (status) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_IDLE :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Idle\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_CONNECTING :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Connecting\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_WRONG_PASSWORD :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Wrong password\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_NO_AP_FOUND :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: No AP found\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_CONNECT_FAIL :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Connect Fail\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> STATION_GOT_IP :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\nCurrent status is: Got IP\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">     </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;Current status is: %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,status);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ((status == STATION_GOT_IP) &amp;&amp;  wifi_get_ip_info(STATION_IF, &amp;ipConfig)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ip: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR, IP2STR(&amp;ipConfig.ip.addr));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> wifi_handle_event_cb(System_Event_t *evt) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;event %x: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, evt-&gt;event);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">switch</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">  (evt-&gt;event)    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    EVENT_STAMODE_CONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_CONNECTED\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;connect to ssid %s, channel %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.connected.ssid,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.connected.channel);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    EVENT_STAMODE_DISCONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_DISCONNECTED\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;disconnect from ssid %s, reason %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.disconnected.ssid,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.disconnected.reason);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    EVENT_STAMODE_AUTHMODE_CHANGE:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_AUTHMODE_CHANGE\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;mode: %d -&gt; %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.auth_change.old_mode,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.auth_change.new_mode);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_GOT_IP:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_GOT_IP\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ip:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,mask:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,gw:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.ip),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.mask),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.gw));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_SOFTAPMODE_STACONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_SOFTAPMODE_STACONNECTED\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;station: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> MACSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;join, AID = %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            MAC2STR(evt-&gt;event_info.sta_connected.mac),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.sta_connected.aid);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_SOFTAPMODE_STADISCONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_SOFTAPMODE_STADISCONNECTED\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;station: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> MACSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;leave, AID = %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            MAC2STR(evt-&gt;event_info.sta_disconnected.mac),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.sta_disconnected.aid);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">default</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">     }</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В случае успешной компиляции и прошивки, в терминале мы должны получть следующую картинку:</span><img src="image2029310598.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь у нас получается уже небольшой лог, по которому можно видеть, что после загрузки WiFi модуль сначала переходит в режим клиента, потом он по о всей видимости сканирует доступные точки доступа, затем устанавливает соединение с своей точкой доступа, и через DHCP получает IP адрес.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Теперь, когда мы представляем в каком состоянии изначально находится WiFi модуль, мы можем осуществить переподключение к нужной нам точке доступа. Для это нам понадобятся следующие функции SDK:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Функция подключения к точке доступа:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_connect</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Подключение WiFi модуля находящегося в режиме клиента (station) к точке доступа (AP).</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">void wifi_station_clear_username (void)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Параметры</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Отсутствуют.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">True: успешное выполнение;<br />False: ошибка при выполнении.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Примечание</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Если ESP8266 уже подключен к роутеру, то перед вызовом wifi_station_connect нужно будет вызвать функцию wifi_station_disconnect().<br /> Вызов данной функции должен происходить после инициализации, а ESP8266 должен находится в режиме клиента (station).</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Функция отключения от точки доступа:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_disconnect</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Отключение WiFi модуля находящегося в режиме клиента (station) от точки доступа (AP).</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">void wifi_station_clear_username (void)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Параметры</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Отсутствуют.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">True: успешное выполнение;<br />False: ошибка при выполнении.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Примечание</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Не вызывайте данную функцию в user_init(). Ее вызов должен происходить после инициализации, а ESP8266 должен находится в режиме клиента (station).</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Функция установки режима работы WiFi модуля:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_set_opmode</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Устанавливает режим работы WiFi модуля: Station, SoftAP или Station + SoftAP режим. По умолчанию устанавливается SoftAP режим.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">bool wifi_set_opmode (uint8 opmode)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Параметры</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">uint8 opmode</span><span style=" font-family:'monospace'; color:#ff8c00;">: режим работы WiFi модуля:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">      	</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#8080ff;">0x01</span>: Station mode;</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#8080ff;">0x02</span>: SoftAP mode;</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      	</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#8080ff;">0x03</span>: Station + SoftAP mode.</li>
<li style=" font-family:'monospace'; color:#ff8c00;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      </li></ul></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">True: успешное выполнение;<br />False: ошибка при выполнении.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Примечание</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">В версиях SDK до  ESP8266_NONOS_SDK_V0.9.2, необходимо вызывать system_restart() после вызова данной функции. В версиях SDK от  ESP8266_NONOS_SDK_V0.9.2 и выше, такой необходимости нет.<br /> <br />Заданная конфигурация будет сохранена в системных параметрах флеш-памяти ESP8266.</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Функция задания массива настроек WiFi модуля в режиме клиента (station):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;"> </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_set_config</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0" bgcolor="transparent">
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Назначение функции</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Устанавливает конфигурацию WiFi модуля для работы в режиме клиента, и сохраняет ее во флеш-памяти.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Прототип</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">bool wifi_station_set_config (struct station_config *config)</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Параметры</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#8080ff;">struct station_config *config</span><span style=" font-family:'monospace'; color:#ff8c00;">: указатель на структуру с конфигурацией WiFi модуля в режиме клиента.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Возвращаемое значение</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">True: успешное выполнение;<br />False: ошибка при выполнении.</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Пример</span></p></td>
<td bgcolor="#333333" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_set_station_config(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ssid[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">32</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">] = SSID;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> password[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">64</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">] = PASSWORD;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> station_config stationConf;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    stationConf.bssid_set = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;      </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//need not check MAC address of AP</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_memcpy(&amp;stationConf.ssid, ssid, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">32</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_memcpy(&amp;stationConf.password, password, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">64</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    wifi_station_set_config(&amp;stationConf);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> user_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    wifi_set_opmode(STATIONAP_MODE); </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//Set softAP + station mode</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    user_set_station_config();</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p></td></tr>
<tr>
<td bgcolor="#00008b" style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00; background-color:#00008b;">Примечание</span></p></td>
<td style=" padding-left:15; padding-right:15; padding-top:15; padding-bottom:15;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">Данная функция может быть вызвана только если WiFi модуль ESP8266 находится в режиме клиента (station).<br /><br />Если функция </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_set_config</span><span style=" font-family:'monospace'; color:#ff8c00;"> вызывается из </span><span style=" font-family:'monospace'; color:#8080ff;">user_init()</span><span style=" font-family:'monospace'; color:#ff8c00;">, тогда отпадает необходимость в последующем вызове </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_connect</span><span style=" font-family:'monospace'; color:#ff8c00;">. Подключение к точке доступа (AP) произойдет автоматически. В противном случае, последующий вызов </span><span style=" font-family:'monospace'; color:#8080ff;">wifi_station_connect</span><span style=" font-family:'monospace'; color:#ff8c00;"> будет необходим. <br /><br />Как правило, </span><span style=" font-family:'monospace'; color:#8080ff;">station_config.bssid_set</span><span style=" font-family:'monospace'; color:#ff8c00;">необходимо сбрасывать в 0, чтобы избежать проверки MAC адреса (BSSID) точки доступа. Иначе, подключение к точке доступа произойдет только при совпадении SSID и MAC адреса (BSSID).<br /><br />Установленная конфигурация WiFi модуля будет сохранена во флеш-памяти ESP8266.</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#ff8c00;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#777777;">    </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'monospace'; font-style:italic; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-style:italic; color:#337ab7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">где структура station_config определена в заголовочном файле user_interface.h и имеет следующий вид:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> station_config {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint8 ssid[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">32</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint8 password[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">64</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint8 bssid_set;    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// Note: If bssid_set is </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">, station will just connect to the router</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">                        </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// with both ssid[] and bssid[] matched. Please check about this.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint8 bssid[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">6</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">];</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">};</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Процедура подключения к точке доступа в режиме клиента состоит из двух шагов: а) переход в режим клиента; б) установка структуры station_config. Структуру можно либо создать во время инициализации, заполнив нужные поля своими значениями, либо получить текущую структуру с помощью функции wifi_station_get_config() и изменив нужные поля, передать её обратно в ESP8266.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">С учетом всего вышесказанного, окончательный вариант user_init() для установки соединения с точной доступа, примет следующий вид:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> station_config wifi_config;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR user_init(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// init varialbles</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    led_status=</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// inti periphery</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio_init();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// map GPIO16 as push-pull  pin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    gpio16_output_conf();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// UART config</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uart_init(BIT_RATE_115200, BIT_RATE_115200);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// blink timer (1000ms, repeating)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_setfn(&amp;gpio16_timer, (os_timer_func_t *)blink, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_timer_arm(&amp;gpio16_timer, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1000</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;SDK version:%s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, system_get_sdk_version());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// wifi connect</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    wifi_set_event_handler_cb(wifi_handle_event_cb);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (wifi_set_opmode(STATION_MODE)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        wifi_station_disconnect();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_memcpy(wifi_config.ssid, SSID, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(SSID));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_memcpy(wifi_config.password, PASSWORD, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(PASSWORD));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        wifi_config.bssid_set=</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        wifi_station_set_config(&amp;wifi_config);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    } </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ERROR: setting the station mode has failed.\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">При этом, в заголовочном файле user_config.h должны находится данные для подключения к точке доступа:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define SSID </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;YOUR_SSID&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define PASSWORD </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;YOUR_PASSWORD&quot;</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><a name="3"></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">3</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">) Работа с TCP соединением используя espconn</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">После того, как мы установили соединение с точкой доступа, следует разобраться с установкой TCP-соединения, чтобы иметь возможность передавать и принимать данные с сервера.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Работа с TCP соединением в SDK ESP8266 осуществляется с помощью механизма espconn. Насколько понимаю, это проприетарный форк LwIP - библиотеки реализации TCP/IP стека для встраиваемых устройств. В SDK входит и сам LwIP, но мне, для начала, хотелось бы разобрать работу со штатной библиотекой. В руководстве </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> она описана в качестве набора функций в главе 4 &quot;TCP/UDP APIs&quot;. К сожалению, в данном руководстве ничего не было сказано про порядок работы с данным API. Поэтому за примерами пришлось лезть на </span><a href="http://github.com/"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">github.com</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">. В принципе, далеко ходить не пришлось, и на небезызвестном </span><a href="https://github.com/esp8266"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">github.com/esp8266</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> был найден </span><a href="https://github.com/esp8266/source-code-examples/blob/master/dweet/user/user_main.c"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">простой пример</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> связи с dweet.io и передачи данных в JSON формате. Другой пример, который мне показался полезным, можно найти в examples SDK под названием &quot;at_espconn&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Для начала, мне хотелось бы разобрать пример подключения по HTTP протоколу с использованием GET запроса. Попробуем просто скачать HTML-станицу со своего сервера, т.е. реализуем программными средствами пример из ноябрьской статьи: &quot;</span><a href="https://count-zero.ru/2018/esp8266/#13"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">13) Получение web-страницы или текстового файла от сервера на OpenWRT</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Итак, работа с TCP соединением через espconn производится через коллбэк-функции. Т.е. вы пришите свои функции на открытие TCP соединения, закрытие TCP соединения, на прием и передачу данных и т.е. Совсем не обязательно писать все коллбэк-функции, пишите только те, что вам необходимо. Очевидно, что перед созданием TCP соединения необходимо будет задать адрес и порт. Т.о., отталкиваясь от предыдущего примера, делаем следующее:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Добавляем заголовочные файлы с объявлением функций espconn и функций для работы с памятью:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;espconn.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#include </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;mem.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Добавляем ip-адрес и порт целевого сервера:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define http_port </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">8010</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;">#define ip_addr </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;192.168.1.10&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#6495ed;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// Alien</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Добавляем буфер, в котором будут храниться передаваемые и получаемые данные:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> buffer[</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">512</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">];</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Если ваши данные небольшие по размеру, то буфер можно задать статично, как показано выше. Иначе имеет смысл использовать динамическое выделение памяти под массив.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Добавляем объявление коллбэк-функций:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> tcp_connected(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR  data_received_cb(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg, </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *pdata, </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">unsigned</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">short</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> len);</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR tcp_disconnected_cb(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg);</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">И теперь собственно пишем функцию установки TCP-соединения:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR send_data() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint32 ip=</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *conn = (</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *)os_zalloc(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (conn != </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        conn-&gt;type = ESPCONN_TCP;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        conn-&gt;state = ESPCONN_NONE;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        conn-&gt;proto.tcp = (esp_tcp *)os_zalloc(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(esp_tcp));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        conn-&gt;proto.tcp-&gt;local_port = espconn_port();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        conn-&gt;proto.tcp-&gt;remote_port = http_port;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        ip = ipaddr_addr(ip_addr);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_memcpy(conn-&gt;proto.tcp-&gt;remote_ip,&amp;ip,</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(ip));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        espconn_regist_connectcb(conn, tcp_connected);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        espconn_regist_disconcb(conn, tcp_disconnected_cb);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        espconn_regist_recvcb(conn, data_received_cb);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        espconn_connect(conn);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    } </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;TCP connect failed!\r\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Принцип работы походит на установку WiFi-соединения. Сначала создается структура типа espconn, далее заполняются ее поля, регестрируются коллбэк функции, после чего структура &quot;скармливается&quot; функции espconn_connect в качестве значения.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Вызов функции send_data() добавим в коллбэк-функцию </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00; background-color:#333333;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"> wifi_handle_event_cb(System_Event_t *evt)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_GOT_IP:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_GOT_IP\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ip:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,mask:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,gw:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.ip),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.mask),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.gw));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#ff0000;">send_data();</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Т.е. функция send_data() будет вызвана сразу после подключения к точке доступа WiFi.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Коллбэк функции: </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">tcp_connected(void *arg), data_received_cb(void *arg, char *pdata, unsigned short len) и tcp_disconnected_cb(void *arg) </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">выглядят следующим образом.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Функция tcp_connected(void *arg):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> tcp_connected(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *conn = arg;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;%s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, __FUNCTION__ );</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_sprintf(buffer, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;GET / HTTP/1.1\r\n\r\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;Sending: %s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, buffer);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    espconn_sent(conn, buffer, os_strlen(buffer));</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Эта функция будет вызываться первой, в начале установки TCP соединения. Здесь строка: os_printf(&quot;%s\n&quot;, __FUNCTION__ ) выполняет отладочную роль, она будет печатать имя функции, т.е. tcp_connected. Далее: os_sprintf(buffer, &quot;GET / HTTP/1.1\r\n\r\n&quot;) - копирует строку c GET-запросом в буфер. Строка: os_printf(&quot;Sending: %s\n&quot;, buffer) - выполняет опять же отладочную функцию, отображает содержимое буфера. И собственно: espconn_sent(conn, buffer, os_strlen(buffer)) передает содержимое буфера на удаленный сервер.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Коллбэк-функция data_received_cb() обрабатывает ответ уделенного сервера:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR  data_received_cb(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg, </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *pdata, </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">unsigned</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">short</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> len )</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *conn = (</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *)arg;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf( </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;%s: %s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, __FUNCTION__, pdata);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    espconn_disconnect(conn);</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Через указатель на массив *pdata передается сам ответ, который функция os_printf( &quot;%s: %s\n&quot;, __FUNCTION__, pdata) передает на последовательный порт. После этого, с помощью espconn_disconnect(conn) TCP-соединение разрывается.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В момент разрыва TCP-соединения вызывается коллбэк-функция tcp_disconnected_cb:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">static</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR tcp_disconnected_cb(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *conn = (</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *)arg;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf( </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;%s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, __FUNCTION__ );</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;esp8266 disconnected\r\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    wifi_station_disconnect();</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Она разрывает соединение с точкой доступа с помощью вызова функции SDK: </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">wifi_station_disconnect()</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Таким образом, алгоритм работы программы выглядит так:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">После старта ESP8266, сразу же устанавливается соединение с точкой доступа с режиме клиента (station mode);</span></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">После установки соединения c точкой доступа, вызывается функция send_data() которая устанавливает TCP-соединение с удаленным сервером.</span></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">При установке TCP-соединения с удаленным сервером, функция tcp_connected() посылает GET-запрос веб-серверу.</span></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">После получения ответа, функция data_received_cb() распечатает его через UART, и разрывает TCP-соединение.</span></li>
<li style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">После разрыва TCP-соединения, функция tcp_disconnected_cb() разрывает соединение с точкой доступа.</span></li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Полный текст программы можно просмотреть под спойлером:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#spoiler-A"><span style=" font-family:'monospace'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent; vertical-align:middle;">показать полный текст программы</span></a></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">После компиляции и прошивки esp8266, лог работы программы будет выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2043667891.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь хочу обратить внимание на то, что в качестве ответа веб-сервера мы получаем лишь 200-ий код ответа.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Теперь напомню, как выглядела TCP-сессия </span><a href="https://count-zero.ru/2018/esp8266/#13"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">с помощью AT-команд</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Recv 18 bytes</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">SEND OK</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">+IPD,17:HTTP/1.0 200 OK</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">+IPD,450:Connection: close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">ETag: &quot;6004-111-5be409c1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Last-Modified: Thu, 08 Nov 2018 10:02:41 GMT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Date: Thu, 15 Nov 2018 20:00:08 GMT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Content-Type: text/html</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Content-Length: 273</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;</span><a href="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><span style=" font-family:'monospace'; font-size:10pt; text-decoration: underline; color:#337ab7; background-color:transparent;">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</span></a><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&quot;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&lt;html xmlns=&quot;</span><a href="http://www.w3.org/1999/xhtml"><span style=" font-family:'monospace'; font-size:10pt; text-decoration: underline; color:#337ab7; background-color:transparent;">http://www.w3.org/1999/xhtml</span></a><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&quot;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&lt;head&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&lt;/head&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&lt;body style=&quot;background-color: white&quot;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&lt;h3&gt;Hello World!&lt;/h3&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&lt;/body&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&lt;/html&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#ff0000;">CLOSED</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь ответ приходил двумя </span><a href="https://ru.wikipedia.org/wiki/Chunked_transfer_encoding"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">&quot;чанками&quot;</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">, после чего сервер САМОСТОЯТЕЛЬНО закрывал TCP-соединение. Т.е. если мы закомментируем строку с &quot;espconn_disconnect(conn);&quot;, то получим полный ответ сервера:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:42.321 -&gt; mode : sta(a0:20:a6:12:5f:05)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:42.321 -&gt; add if0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:42.321 -&gt; event 8: event 2: EVENT_STAMODE_AUTHMODE_CHANGE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:43.680 -&gt; mode: 0 -&gt; 3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.277 -&gt; scandone</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.310 -&gt; state: 0 -&gt; 2 (b0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.310 -&gt; state: 2 -&gt; 3 (0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.310 -&gt; state: 3 -&gt; 5 (10)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.310 -&gt; add 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.310 -&gt; aid 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.310 -&gt; cnt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.343 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.343 -&gt; connected with Alien, channel 11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.343 -&gt; dhcp client start...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.376 -&gt; event 0: EVENT_STAMODE_CONNECTED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:44.376 -&gt; connect to ssid Alien, channel 11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.160 -&gt; ip:192.168.1.13,mask:255.255.255.0,gw:192.168.1.10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.160 -&gt; event 3: EVENT_STAMODE_GOT_IP</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; ip:192.168.1.13,mask:255.255.255.0,gw:192.168.1.10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; tcp_connected</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; Sending: GET / HTTP/1.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; data_received_cb: HTTP/1.1 200 OK</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; data_received_cb: Connection: close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; ETag: &quot;6008-111-5bee9a9f&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; Last-Modified: Fri, 16 Nov 2018 10:23:27 GMT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; Date: Wed, 15 May 2019 08:36:07 GMT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.193 -&gt; Content-Type: text/html</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.227 -&gt; Content-Length: 273</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.227 -&gt; Transfer-Encoding: chunked</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.227 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.227 -&gt; 111</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.227 -&gt; &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">12:35:47.227 -&gt; &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;</span><a href="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><span style=" font-family:'monospace'; font-size:10pt; text-decoration: underline; color:#337ab7; background-color:transparent;">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd</span></a><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&quot;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; &lt;html xmlns=&quot;</span><a href="http://www.w3.org/1999/xhtml"><span style=" font-family:'monospace'; font-size:10pt; text-decoration: underline; color:#337ab7; background-color:transparent;">http://www.w3.org/1999/xhtml</span></a><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">&quot;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; &lt;head&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; &lt;/head&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; &lt;body style=&quot;background-color: white&quot;&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; &lt;h3&gt;Hello World!&lt;/h3&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; &lt;/body&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; &lt;/html&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; tcp_disconnected_cb</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.227 -&gt; esp8266 disconnected</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.259 -&gt; state: 5 -&gt; 0 (0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.259 -&gt; rm 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.259 -&gt; event 1: EVENT_STAMODE_DISCONNECTED</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">12:35:47.259 -&gt; disconnect from ssid Alien, reason 8</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Для контроля, в Wireshark можно посмотреть лог трафика генерируемого esp8266 в течении сессии:</span><img src="image364392100.png" /><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Каких-либо ошибок не наблюдается. Отмечу, что в Wireshark трафик отфильтрован по порту веб-сервера. В данном случае это 8010.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><a name="4"></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">4</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">) Использование режима энергосбережения &quot;deep sleep&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Теперь попробуем адаптировать алгоритм нашей программы ближе к реальной задаче. Для этого, ее работа должна выглядеть следующем образом: 1) esp8266 стартует, соединяется с точкой доступа, передает или принимает какие-то данные, после чего отключается от точки доступа. 2) после выполнения первой задачи, пусть esp8266 уходит в спящий режим, по выходу их которого он будет &quot;дергать&quot; RESET, в результате чего esp8266 перезагрузится и все начнётся заново.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Для осуществления этой задачи нам придется выкинуть из программы мигалку на светодиоде. Т.к. большую часть времени esp8266 будет находиться в режиме пониженного энергопотребления, в котором мигать чем либо уже не получиться. Кроме того, светодиод мигалки находиться на GPIO16 который принадлежит RTC, и он нам понадобится для пробуждения из спящего режима.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Работа eps8266 в режиме энергосбережении описана в следующем руководстве: </span><a href="https://www.espressif.com/sites/default/files/documentation/9b-esp8266-low_power_solutions_en.pdf"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Low Power Solutions</span></a></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Согласно пункту 4.5 этого руководства, чтобы перевести esp8266 в режим пониженного энергосбережения deep_sleep, после завершения соединения с точкой доступа, достаточно будет добавить в CASE функции wifi_handle_event_cb(System_Event_t *evt) две сточки кода:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    EVENT_STAMODE_DISCONNECTED:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_DISCONNECTED\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;disconnect from ssid %s, reason %d\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.disconnected.ssid,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            evt-&gt;event_info.disconnected.reason);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#800000;">system_deep_sleep_instant(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff; background-color:#800000;">60000</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#800000;">*</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff; background-color:#800000;">1000</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#800000;">);</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">      </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">60</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;"> sec</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#800000;">system_deep_sleep_set_option(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff; background-color:#800000;">2</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#800000;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">где system_deep_sleep_instant(60000*1000) - задает время пробуждения в микросекундах, а system_deep_sleep_set_option(2) - задает режим энергосбережения который не требует перекалибровки радочастотного модуля.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Полный текст обновленной программы можно посмотреть под спойлером:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#spoiler-B"><span style=" font-family:'monospace'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent; vertical-align:middle;">показать полный текст программы</span></a></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Не забывайте, что из Makefile следует убрать сборку модуля gpio16.o. Кроме того, вывод D0/GPIO16 нужно будет соединить с RESET, чтобы esp8266 смог &quot;проснуться&quot;:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image471378596.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Есть еще один неприятный </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:696; color:#45342e;">подводный камень</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> при использовании режима пониженного энергопотребления deep_sleep. Проблема проявлется в невозможности прошить плату esp8266 nodemcu с помощью автоматической загрузки прошивки. Выглядит это как-то так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">$ make install</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">esptool.py write_flash 0 connect.elf-0x00000.bin 0x10000 connect.elf-0x10000.bin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">esptool.py v2.3.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Connecting....</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Detecting chip type... ESP8266</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Chip is ESP8266EX</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Features: WiFi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Uploading stub...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Running stub...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Stub running...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Configuring flash size...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Warning: Could not auto-detect Flash size (FlashID=0x0, SizeID=0x0), defaulting to 4MB</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Flash params set to 0x0040</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Compressed 33792 bytes to 23461...</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">A fatal error occurred: Timed out waiting for packet content</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">Makefile:24: ошибка выполнения рецепта для цели «install»</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">make: *** [install] Ошибка 2</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В этом случае, чтобы прошить esp8266 нужно: а) отключить esp8266 от питания; б) зажать кнопку BOOT; в) подключить питание к esp8266 (кнопка BOOT при этом должна быть зажата); г) запустить прошивку esp8266, кнопку BOOT при этом можно освободить; д) после завершения прошивки, следует переподключить питание esp8266 (кнопка BOOT при этом должна быть свободной).</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><a name="5"></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">5</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">) Реализация команды ping</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Еще одной полезной возможностью мне показалась команда ping. Она имеется в AT командах, здесь же я хочу показать как она реализуется возможностями SDK.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Структуры и функции SDK для реализации команды ping объявлены в заголовочном файле ping.h, в папке с заголовочными файлами SDK. Описания в документации нет, т.е. </span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#45342e;">они не документированы</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Рабочий пример реализации команды ping я встретил на форуме espressif: </span><a href="https://bbs.espressif.com/viewtopic.php?t=583"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">Ping_start function - ESP8266 Developer Zone</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">. На всякий случай я скопирую его сюда:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_ping_recv(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg, </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *pdata)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_resp *ping_resp = pdata;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_option *ping_opt = arg;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (ping_resp-&gt;ping_err == -</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ping host fail \r\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ping recv: byte = %d, time = %d ms \r\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,ping_resp-&gt;bytes,ping_resp-&gt;resp_time);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_ping_sent(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg, </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *pdata)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;user ping finish \r\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">user_test_ping(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_option *ping_opt = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">const</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">* ping_ip = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;192.168.1.114&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt = (</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_option *)os_zalloc(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_option));</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt-&gt;count = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">10</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//  try to ping how many times</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt-&gt;coarse_time = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;  </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// ping interval</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt-&gt;ip = ipaddr_addr(ping_ip);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_regist_recv(ping_opt,user_ping_recv);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_regist_sent(ping_opt,user_ping_sent);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_start(ping_opt);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Думаю, что если вы дочитали до этого места, то вопросов здесь возникнуть не должно. Я без изменений скопировал этот код в свою программу, заменил вызов функции send_data() на user_test_ping() и получил такой результат:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1916907203.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь в качестве ip я указал ip точки доступа, т.е. 192.168.1.10.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Лог сетевого трафика в этом с случае выглядит так:</span><img src="image2062180483.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Однако данный вариант реализации команды ping требует указания IP целевого хоста, в то время как часто бывает нужно пропинговать хост по доменному имени. Функция SDK которая возвращает IP доменного имени назвается espconn_gethostbyname(). Наглядное использование этой функции имеется в </span><a href="https://github.com/esp8266/source-code-examples/blob/master/dweet/user/user_main.c"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">приведенном выше</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;"> примере.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Действуя по аналогии, поместим вызов этой функции в кейс функции wifi_handle_event_cb(System_Event_t *evt), который вызывается при установлении соединения с точкой доступа</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_GOT_IP:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_GOT_IP\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ip:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,mask:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,gw:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.ip),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.mask),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.gw));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        espconn_gethostbyname(&amp;ping_conn, ping_host, &amp;ping_ip, dns_done);</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь: ping_conn - это структура espconn, ping_host - доменное имя, ping_ip - IP хоста которое следует найти, а dns_done - это коллбэк функция которая вызвается после получения IP хоста от DNS - сервера.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn ping_conn;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_host[] = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ya.ru&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">ip_addr_t ping_ip;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Функция dns_done() в таком случае примет такой вид:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR dns_done(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">const</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">char</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *name, ip_addr_t *ipaddr, </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg )</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *conn = (</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> espconn *)arg;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    espconn_disconnect(conn);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;%s\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, __FUNCTION__);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> (ipaddr != </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        user_test_ping(ipaddr);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;DNS lookup failed\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Функция user_test_ping() незначительно меняется, она теперь принимает в качестве параметра IP-адрес:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR user_test_ping(ip_addr_t *ipaddr) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_option *ping_opt = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//    const char* ping_ip = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;8.8.8.8&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#8080ff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt = (</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_option *)os_zalloc(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">struct</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ping_option));</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ping to: &quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR, IP2STR(&amp;ipaddr-&gt;addr));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt-&gt;count = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">10</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//  try to ping how many times</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt-&gt;coarse_time = </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;  </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// ping interval</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//    ping_opt-&gt;ip = ipaddr_addr(ping_ip);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_opt-&gt;ip = ipaddr-&gt;addr;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_regist_recv(ping_opt,user_ping_recv);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_regist_sent(ping_opt,user_ping_sent);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    ping_start(ping_opt);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Полный текст программы можно посмотреть под спойлером.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#spoiler-C"><span style=" font-family:'monospace'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent; vertical-align:middle;">показать полный текст программы</span></a></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">При работе программы, в терминале будет наблюдаться такой лог:</span><img src="image1664699468.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В Wireshark можно будет наблюдать два DNS пакета: запрос к DNS серверу, и последующий ответ от него:</span><img src="image646220280.png" /></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.1%;"><a name="6"></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">6</span><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; font-weight:496; color:#45342e;">) Получение даты и времени из сети по протоколу SNTP</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Последний пример, который мне хотелось бы привести - это синхронизация времени по протоколу SNTP. API для работы с протоколом SNTP приведено в части 3.13 руководства </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">. Описание функций очень краткое, формальное. К счастью, там же есть рабочий пример использования этого API.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В качестве основы для портирования (красивое слово для банальной копипасты ;) этого примера, я взял код из части 4 данной статьи, там где речь шла про установку TCP - соединения. Алгоритм пусть будет такой. После соединения с точкой доступа, производится инициализация SNTP. Во время инициализации указывается список SNTP-cерверов и регистрируется коллбек-функция вызываемая по таймеру. После этого запускается таймер этой функции.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">На практике это будет выглядеть так. В кейс функции wifi_handle_event_cb(System_Event_t *evt) отвечающий за установку соединения с точкой доступа помещаем код из примера в части 3.13 руководства </span><a href="https://count-zero.ru/files/esp8266/2c-esp8266_non_os_sdk_api_reference_en.pdf"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">ESP8266 Non-OS SDK API Reference</span></a><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">case</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> EVENT_STAMODE_GOT_IP:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uart0_sendStr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;EVENT_STAMODE_GOT_IP\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;ip:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,mask:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;,gw:&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> IPSTR,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.ip),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.mask),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">            IP2STR(&amp;evt-&gt;event_info.got_ip.gw));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;\n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// SNTP enable</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        ip_addr_t   *addr   =   (ip_addr_t  *)os_zalloc(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(ip_addr_t));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        sntp_setservername(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,   </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;0.ru.pool.ntp.org&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);   </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//  set server  </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">   by  domain  name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        sntp_setservername(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,   </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;1.ru.pool.ntp.org&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);   </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//  set server  </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">1</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">   by  domain  name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//      ipaddr_aton(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;210.72.145.44&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">,    addr);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        uint32 ip = ipaddr_addr(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;192.168.1.10&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// Alien</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_memcpy(addr,&amp;ip,</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">sizeof</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(ip));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        sntp_setserver(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, addr);    </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">//  set server  </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">2</span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">   by  IP  address</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        sntp_set_timezone(+</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">4</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);      </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// set SAMT time zone</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        sntp_init();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_free(addr);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// Set a timer to check SNTP timestamp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_timer_disarm(&amp;sntp_timer);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_timer_setfn(&amp;sntp_timer, (os_timer_func_t *)user_check_sntp_stamp, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">NULL</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_timer_arm(&amp;sntp_timer, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">100</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">break</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь я немного изменил код в сравнении с оригиналом, т.к. функции ipaddr_aton() я не нашел, поэтому пришлось импровизировать. Указано IP моего домашнего сервера с OpenWRT, на котором установлен SNTP сервер. Также добавлена функция с установкой часового пояса. В данном случае устанавливается самарский часовой пояс. По умолчанию время синхронизируется по пекинскому часовому поясу, а не по Гринвичу, как следовало бы ожидать.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В области глобальный переменных нужно не забыть объявить таймер:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;">LOCAL os_timer_t sntp_timer;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Коллбек-функция копируется практически без изменений:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> ICACHE_FLASH_ATTR user_check_sntp_stamp(</span><span style=" font-family:'monospace'; font-size:10pt; color:#00ff00;">void</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;"> *arg){</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    uint32  current_stamp;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    current_stamp = sntp_get_current_timestamp();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:10pt; color:#ffffff; background-color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">if</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">(current_stamp == </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">){</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_timer_arm(&amp;sntp_timer, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">100</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">, </span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">0</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    } </span><span style=" font-family:'monospace'; font-size:10pt; color:#ffff00;">else</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_timer_disarm(&amp;sntp_timer);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        os_printf(</span><span style=" font-family:'monospace'; font-size:10pt; color:#ff40ff;">&quot;sntp: %d, %s \n&quot;</span><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">,current_stamp, sntp_get_real_time(current_stamp));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        </span><span style=" font-family:'monospace'; font-size:10pt; color:#8080ff;">// TCP connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">        send_data();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#333333;"><span style=" font-family:'monospace'; font-size:10pt; color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Здесь, в случае успешного получения текущего времени отключается таймер, и управление передается функции send_data().</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Полный текст программы можно посмотреть под спойлером:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://count-zero.ru/2019/esp_open_sdk_wifi/#spoiler-D"><span style=" font-family:'monospace'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent; vertical-align:middle;">показать полный текст программы</span></a></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Лог работы программы:</span><img src="image1172973735.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Если посмотреть на лог трафика, то можно увидеть DNS запросы на резовлинг домена 0.ru.pool.ntp.org с последующим обращением к ним по NTP протоколу:</span><img src="image852316879.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">В теле ответа NTP сервера можно увидеть дату и время которую мы в итоге получили.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">На этом пока все. Я не стал рассматривать в статье UDP запросы, работу в режиме сервера, LwIP, web-сокеты, внутренний RTC и другие интересные вещи в надежде найти для этого полезные практические примеры, а не ограничиваться голой теорией. Надеюсь, что следующая статья будет более интересной с практической точки зрения.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; color:#45342e;">Еще раз повторю, что посмотреть все исходники, сборочные файлы, скачать скомпилированные прошивки, можно с портала GITLAB </span><a href="https://gitlab.com/flank1er/esp8266_sdk_examples"><span style=" font-family:'Helvetica,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#337ab7; background-color:transparent;">https://gitlab.com/flank1er/esp8266_sdk_examples</span></a></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="disqus_recommendations"></a><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span></p></body></html>