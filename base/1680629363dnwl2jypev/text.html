<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><img src="image829089199.png" /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><br /></li></ul>
<p style=" margin-top:30px; margin-bottom:20px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%; background-color:#ffffff;"><a name="articlestitle"></a><span style=" font-family:'Montserrat,sans-serif'; font-size:xx-large; color:#111111;">У</span><span style=" font-family:'Montserrat,sans-serif'; font-size:xx-large; color:#111111;">становка MQTT брокера Mosquitto на Raspberry Pi и Orange Pi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:30px; margin-bottom:20px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%; font-family:'Montserrat,sans-serif'; font-size:xx-large; color:#111111; background-color:#ffffff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:30px; margin-bottom:20px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%; font-family:'Montserrat,sans-serif'; font-size:xx-large; color:#111111; background-color:#ffffff;"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Montserrat,sans-serif'; font-size:16px; color:#2b2b2b;" style=" margin-top:10px; margin-bottom:0px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/"><span style=" font-size:16px; text-decoration: underline; color:#0000ff; background-color:transparent;">Главная</span></a><span style=" font-size:16px;">  /  </span></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:16px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/articles"><span style=" font-size:16px; text-decoration: underline; color:#0000ff; background-color:transparent;">Статьи</span></a><span style=" font-size:16px;">  / </span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px;"> </span></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:16px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:20px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/category/umnii-dom"><span style=" font-size:16px; text-decoration: underline; color:#0000ff; background-color:transparent;">Умный дом</span></a></li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:41px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-size:11px; font-weight:600; color:#666666;">Автор статьи</span><a href="https://robot-on.ru/teacher/maksim-zakharov"><span style=" font-family:'Montserrat,sans-serif'; font-size:12px; font-weight:600; text-decoration: underline; color:#90a94c; background-color:transparent; text-transform:uppercase;">МАКСИМ ЗАХАРОВ</span></a><span style=" font-size:13px;"> </span></li>
<li style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:41px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-size:11px; font-weight:600; color:#666666;">Категория</span><a href="https://robot-on.ru/category/umnii-dom"><span style=" font-family:'Montserrat,sans-serif'; font-size:12px; font-weight:600; text-decoration: underline; color:#90a94c; background-color:transparent; text-transform:uppercase;">УМНЫЙ ДОМ</span></a><span style=" font-size:13px;"> </span></li>
<li style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:41px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-size:11px; font-weight:600; color:#666666;">Опубликовано</span><span style=" font-size:12px; font-weight:600; color:#666666; text-transform:uppercase;">2017-10-03</span></li></ul>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image117838999.png" /><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для одноплатных компьютеров на Linux cуществует несколько MQTT брокеров. Одним из самых популярных является Mosquitto. Сегодня мы с вами разберемся, как поставить серверную и клиентскую, а также как проверить работу протокола MQTT. Данная инструкция отлично подходит для Raspberry Pi с установленной системой Raspbian и Orange Pi с системой Armbian.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">1. Обновляем систему</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Первым делом перед началом установки нам необходимо обновить систему. Подключаеся к нашему Pi по SSH и вводим:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo apt-get update</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333;"><br />sudo apt-get upgrade</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Подробнее посмотреть как подключаться к Pi по SSH и что потом можно делать вы можете в нашей статье.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">2. Устновка брокера и клиента “mosquitto”</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">К сожалению, обычные библиотеки “apt-get” Raspberry Pi (Orange Pi) не содержат последнюю версию Mosquitto software. Поэтому перед установкой нам нужно будет обновить библиотеки. Если на сервере будет установлена не последняя версия брокера, то могут появляться ошибки в процессе работы.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Добавляем ключ и обновляем репозиторий. Вводим эти строчки по очереди. Иногда надо будет вводить пароль от вашего пользователя и нажимать Y для согласия с установкой.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo wget http://repo.mosquitto.org/debian/mosquitto-repo.gpg.key</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333;"><br />sudo apt-key add mosquitto-repo.gpg.key<br />cd /etc/apt/sources.list.d/<br />sudo wget http://repo.mosquitto.org/debian/mosquitto-jessie.list<br />sudo apt-get update</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Устанавливаем MQTT брокер (сервер):</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo apt-get install mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Устанавливаем MQTT клиент:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo apt-get install mosquitto mosquitto-clients</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">После установки mosquitto сервер будет автоматически запускаться при загрузке системы.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">3. Останавливаем сервер для настройки</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">После установки сервер MQTT сразу запускается. Нам необходимо оставновить его, чтобы произвести последующую настройку.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo /etc/init.d/mosquitto stop</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">4. Настройка</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Открываем файл настроек</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo nano /etc/mosquitto/mosquitto.conf</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">и заменяем его содержимое на следующее:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;"># Place your local configuration in /etc/mosquitto/conf.d/</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333;"><br />#<br /># A full description of the configuration file is at<br /># /usr/share/doc/mosquitto/examples/mosquitto.conf.example<br /><br />pid_file /var/run/mosquitto.pid<br /><br />persistence true<br />persistence_location /var/lib/mosquitto/<br /><br />log_dest topic<br /><br />log_type error<br />log_type warning<br />log_type notice<br />log_type information<br /><br />connection_messages true<br />log_timestamp true<br /><br />include_dir /etc/mosquitto/conf.d</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Сохраняем, закрываем программу nano и выходим обратно в терминал (ctrl+o, Enter, ctrl+x).</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">5.Запускаем сервер MQTT</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo /etc/init.d/mosquitto start</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">6. Проверяем работу MQTT брокера</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для проверки работы нашего MQTT брокера нам понадобится MQTT клиента. Это могут быть смартфоны с MQTT клиентами, которые подключены к той же Wi-Fi сети. Но мы воспользуемся более простым способом - подключимся к серверу 2 терминалами параллельно.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image187999057.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Нам необходимо, чтобы первый терминал подписался на топик hello/world, второй терминал отправил в этот топик сообщение и первый терминал его получил.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Итак, в первом терминале, в котором вы делали все настройки, подписываемся на канал hello/world:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">mosquitto_sub -d -t hello/world</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Открываем второе окно терминала, по SSH подключаемся к нашему серверу и отправляем сообщение в канал hello/world:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">mosquitto_pub -d -t hello/world -m &quot;Hello from Terminal window 2!&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В результате в первом окне появится сообщение: </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">Hello from Terminal window 2!</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image1044826012.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; font-weight:696; color:#3d3d3d;">Поздравляем! Ваш MQTT брокер работает!</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">7. Статус сервера MQTT</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Проверить стаус вашего MQTT брокера вы всегда можете через терминал:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo /etc/init.d/mosquitto status</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">После этой команды в терминале будет показана подробная информация о состоянии вашего сервера.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image887350419.png" /></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">8. Настройка пароля для MQTT</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для тестов и маленьких проектов вы можете использовать подключение к MQTT серверу без пароля, но в больших системах для повышения уровня безопасности необходимо добавить логин и пароль. Это делается достаточно просто.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для того, чтобы клиенты могли подключиться к вашемо брокеру только по логину и паролю, необходимо создать конфигурационный файл, который будет содержать имя пользователя и зашифрованный пароль. Вводим в консоли:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo mosquitto_passwd -c /etc/mosquitto/passwd &lt;username&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Вместо &lt;username&gt; необходимо указать имя пользователя, которому будет разрешен доступ, например, mqtusr. После выполнения этой команды юзер mqtusr будет добавлен в систему. Дальше необходимо будет ввести ваш пароль от юзера pi, а потом 2 раза пароль для доступа юзера mqtusr к mqtt брокеру. В качестве второго пароля не воодите пароль от пользователи pi, лучше придумайте новый.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Теперь необходимо поменять настройки доступа к системе, для этого необходимо отредактировать файл /etc/mosquitto/conf.d/default.conf на вашем pi. Вы можете использовать для этого любой текстовый редактор, я предпочитаю nano, поэтому в консоли ввожу:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo nano /etc/mosquitto/conf.d/default.conf</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В открывшейся файл добавляем 2 строчки:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">allow_anonymous false</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333;"><br />password_file /etc/mosquitto/passwd</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Сохраняем и закрываем файл. Для этого в nano нажимаем ctrl+x, выбираем Y и нажимает Enter. Как вы видите в этом конфиге мы прописали в каком файле хранятся юзеры и пароли для подключения к нашему MQTT брокеру, а также мы запретили подключение к серверу всем пользователям без логина и пароля.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Теперь необходимо перезапустить MQTT сервер, для этого вводим в консоли:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">sudo systemctl restart mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Настройка закончена - безопасность вашей системы теперь на высшем уровне!</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"> </span></p></body></html>