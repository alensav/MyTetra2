<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="s5_split_layout_body_wrap_inner2"></a><span style=" font-family:'Cantarell'; font-size:x-large; font-weight:600;">П</span><span style=" font-family:'Cantarell'; font-size:x-large; font-weight:600;">роверка позиций сайта своими руками (скрипт + yandex XML) </span></h2>
<p style=" margin-top:8px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Details </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Written by Dmitiry Kushavin </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Category: </span><a href="http://kushavin.ru/articles"><span style=" font-family:'Cantarell'; text-decoration: underline; color:#0000ff;">Статьи</span></a><span style=" font-family:'Cantarell';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Published: 24 January 2013 </span></p>
<p style=" margin-top:0px; margin-bottom:8px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Hits: 9845 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Для многих вебмастеров и владельцев блогов существует задача проверять позиции сайта в поисковых системах по определённым позициям. Для этого можно использовать специализированные сервисы, но они требуют оплату за свои услуги и это напрягает. Но есть способ проверять позиции в Яндексе своими силами. Для этого Вам потребуется PHP хостинг и наличие сайта в Яндекс вебмастер. </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell'; font-size:x-large; font-weight:600;">Яндекс XML и лимиты</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Яндекс позволяет работать с запросами к поисковой системе с использовании XML запросов, это достаточно удобно, так как XML достаточно просто обрабатывать. Именно такими запросами мы и можем запрашивать и обрабатывать результаты поисковой выдачи.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Если вы считаете себя вебмастером, то у вас должен быть аккаунт Яндекс с панелью вебмастера, куда Вы добавили свои сайты. Если это так, то по этой ссылке у вас будет доступны так называемые “лимиты”. Чем круче у Вас сайт, тем больше суточных лимитов у вас будет. Как пример: у моего блога (на момент написания: 400 страниц в поиске, 10 ТИЦ, 300+ посетителей в сутки) суточный лимит ровняется 500 запросам.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';"> </span><img src="image586157018.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Лимиты можно передавать, рядом с количеством лимита есть кнопка “передать лимит”, нажмите её и передайте лимит самому себе. Теперь у вас будет показываться в разделе статистика количество Ваших суточных лимитов. </span><span style=" font-family:'Cantarell'; font-weight:600;">Начнут действовать они на следующие сутки</span><span style=" font-family:'Cantarell';">, плюс в течении дня можно будет использовать лишь 10% от вашего лимита, а всё остальное только в вечернее и ночное время.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1495710360.png" /></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell'; font-size:x-large; font-weight:600;">PHP скрипт проверки позиций сайта</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Сам скрипт я нашёл на просторах интернета и автор его мне не известен, однако нормально работающий скрипт попался мне только с десятой попытке, поэтому я и решил его перевыложить.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Для скрипта вам понадобится файл с перечислениями ключевых слов в UTF-8, файл скрипта, хостинг с поддержкой PHP. На хостинге создаём директорию и записываем туда наши файлы. txt с ключевыми  словами сами составите, а вот и сам скрипт:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">&lt;?<br />$keywords = file(‘words.txt’); //файл с ключевыми словами<br />$site =’ВАШ_ДОМЕН‘;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">header (“Content-Type: text/html;charset=utf-8″);<br />foreach($keywords as $word)<br />showPlaseYandex($site, $word);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">function showPlaseYandex($host, $query)<br />{<br />$host = preg_replace(“[^</span><a href="http://|www/"><span style=" font-family:'Fira Code'; text-decoration: underline; color:#0000ff;">http://|www\.</span></a><span style=" font-family:'Fira Code';">]“, ”, $host);<br />$query_esc = htmlspecialchars($query);<br />$host_esc = htmlspecialchars($host);<br />$page = 0;<br />$found = 0;<br />$pages = 5;<br />$error = false;<br />$exit = false;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">while (!$exit &amp;&amp; $page &lt; $pages &amp;&amp; $host)<br />{<br />// XML запрос<br />$doc = &lt;&lt;&lt;DOC<br />&lt;?xml version=’1.0′ encoding=’utf-8′?&gt;<br />&lt;request&gt;<br />&lt;query&gt;$query_esc&lt;/query&gt;<br />&lt;page&gt;$page&lt;/page&gt;<br />&lt;maxpassages&gt;0&lt;/maxpassages&gt;<br />&lt;groupings&gt;<br />&lt;groupby attr=’d’ mode=’deep’ groups-on-page=’10′ docs-in-group=’1′ curcateg=’-1′/&gt;<br />&lt;/groupings&gt;<br />&lt;/request&gt;<br />DOC;<br />$context = stream_context_create(array(<br />‘http’ =&gt; array(<br />‘method’=&gt;”POST”,<br />‘header’=&gt;”Content-type: application/xml\r\n” .<br />“Content-length: ” . strlen($doc),<br />‘content’=&gt;$doc<br />)<br />));</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">$response = file_get_contents(‘</span><a href="http://xmlsearch.yandex.ru/xmlsearch?user=USER&amp;key=00.0000000"><span style=" font-family:'Fira Code'; text-decoration: underline; color:#0000ff;">http://xmlsearch.yandex.ru/xmlsearch?user=USER&amp;key=00.0000000</span></a><span style=" font-family:'Fira Code';">:00000000000000000000000000000000&amp;lr=6‘, true, $context); //lr=6 это указание региона для поиска, замените шестёрку на код вашего региона. Остальная часть строки обязательно заменяется на ту, которую вам выдали в xml.yandex.ru!!!!!<br />if ( $response ) {<br />$xmldoc = new SimpleXMLElement($response);<br />$xmlresponce = $xmldoc-&gt;response;<br />if ($xmlresponce-&gt;error) {<br />print “Возникла следующая ошибка: ” . $xmlresponce-&gt;error . “&lt;br/&gt;\n”;<br />$exit = 1;<br />$error = true;<br />break;<br />}<br />$pos = 1;<br />$nodes = $xmldoc-&gt;xpath(‘/yandexsearch/response/results/grouping/group/doc/url’);<br />foreach ($nodes as $node) {<br />// если URL начинается с имени хоста, выходим из цикла<br />if ( preg_match(‘/^http:\/\/(www\.)?’.$host.’/ui’, $node) ) {<br />$found = $pos + $page * 10;<br />$exit = 1;<br />break;<br />}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">$pos++;<br />}<br />$page++;<br />} else {<br />print “внутренняя ошибка сервера\n”;<br />$exit = 1;<br />}<br />}<br />if (!$error) {</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">if ($found) {<br />$found = colorate($found);<br />print “&lt;p&gt;сайт «$host » находится на месте № $found по запросу «$query »&lt;/p&gt;”;<br />} elseif ($host) {<br />print “&lt;p&gt;сайт «$host » находится далее, чем на “. $pages*10 .” месте в выдаче «Яндекса»”;<br />print” по запросу «$query »&lt;/p&gt;\n”;<br />}<br />}<br />}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Code';">function colorate($int)<br />{<br />$color = ‘#FF0000′; //красный<br />if($int&lt;=10)<br />$color = ‘#008E00′; //зеленый<br />if($int&gt;10 &amp;&amp; $int&lt;=20)<br />$color = ‘#FFE500′; //желтый<br />return ‘&lt;span style=”color: ‘ . $color . ‘”&gt;’ . $int . ‘&lt;/span&gt;&lt;br /&gt;’;<br />}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Cantarell';">Не забываем заполнить поля с доменом и адрес для выполнения запросов (выдаётся на </span><a href="http://xml.yandex.ru/settings.xml"><span style=" font-family:'Cantarell'; text-decoration: underline; color:#0000ff;">http://xml.yandex.ru/settings.xml</span></a><span style=" font-family:'Cantarell';">). Всё можно пользоваться. Информация актуальна на ноябрь 2013 года. Проверенно. </span></p></body></html>