<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="__main-title"></a><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">L</span><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">XC </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="dw__toc"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">С</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">одержание</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#lxc"><span style=" text-decoration: underline; color:#0000ff;">LXC</span></a></li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#установка"><span style=" text-decoration: underline; color:#0000ff;">Установка</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#настройка_основной_системы"><span style=" text-decoration: underline; color:#0000ff;">Настройка основной системы</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#администрирование_контейнеров"><span style=" text-decoration: underline; color:#0000ff;">Администрирование контейнеров</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#файл_настройки"><span style=" text-decoration: underline; color:#0000ff;">Файл настройки</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#обновления_в_контейнерах_ubuntu"><span style=" text-decoration: underline; color:#0000ff;">Обновления в контейнерах Ubuntu</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#libvirt_lxc"><span style=" text-decoration: underline; color:#0000ff;">Libvirt LXC</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#пакет_lxcguest"><span style=" text-decoration: underline; color:#0000ff;">Пакет lxcguest</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#безопасность"><span style=" text-decoration: underline; color:#0000ff;">Безопасность</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#ссылки"><span style=" text-decoration: underline; color:#0000ff;">Ссылки</span></a> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Руководство по Ubuntu Server</span></a><span style=" font-family:'Ubuntu';"> » </span><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Виртуализация</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/ubuntu_cloud"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">&lt;-назад</span></a><span style=" font-family:'Ubuntu';"> | </span><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%BA%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">далее-&gt;</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="lxc"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">L</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">XC</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Контейнеры представляют из себя облегченную технологию виртуализации. Они больше похожи на </span><span style=" font-family:'Ubuntu'; font-weight:600;">chroot</span><span style=" font-family:'Ubuntu';"> чем на полноценную виртуализацию типа </span><span style=" font-family:'Ubuntu'; font-weight:600;">Qemu</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">VMware</span><span style=" font-family:'Ubuntu';">, поскольку они не эмулируют оборудование, а также используют в разделяемом режиме ту же операционную систему, что и основная система. Поэтому контейнеры лучше сравнивать с </span><span style=" font-family:'Ubuntu'; font-weight:600;">зонами (zones) Solaris</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">изоляторами (jails) BSD</span><span style=" font-family:'Ubuntu';">. </span><span style=" font-family:'Ubuntu'; font-weight:600;">Linux-vserver</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">OpenVZ</span><span style=" font-family:'Ubuntu';"> - это две предыдущие разработки контейнеро-подобной функциональности для Linux. На самом деле контейнеры получились как результат работы по слиянию функциональности vserver and OpenVZ. Некоторая функциональность vserver и OpenVZ все еще отсутствует в контейнерах, однако контейнеры могут загружаться множеством дистрибутивов Linux и имеют преимущество, что они могут запускаться на неизмененном ядре. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Существует две реализации пользовательского пространства контейнеров, каждая из которых использует те же самые возможности ядра. </span><span style=" font-family:'Ubuntu'; font-weight:600;">Libvirt</span><span style=" font-family:'Ubuntu';"> позволяет использовать контейнеры через драйвер </span><span style=" font-family:'Ubuntu'; font-weight:600;">LXC</span><span style=" font-family:'Ubuntu';">, подсоединяясь к 'lxc:///'. Это очень удобно, поскольку поддерживается то же использование, что и для других драйверов. Другая реализация, называемая просто </span><span style=" font-family:'Ubuntu'; font-weight:600;">'LXC'</span><span style=" font-family:'Ubuntu';">, несовместима с libvirt, но более гибкая с использованием дополнительных утилит пользовательского пространства. Есть возможность переключаться с одной на другую, хотя существуют особенности, которые могут привести в замешательство. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом документе мы будем рассматривать в основном пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';">. Ближе к концу будет описано как использовать драйвер </span><span style=" font-family:'Ubuntu'; font-weight:600;">libvirt LXC</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом документе будут использоваться имена контейнеров </span><span style=" font-family:'Ubuntu'; font-weight:600;">CN</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">C1</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">C2</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="установка"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">У</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">становка</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';"> может быть установлен с использованием команды: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apt-get install lxc </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Этот способ подтянет все требуемые и рекомендуемые зависимости, включая </span><span style=" font-family:'Ubuntu'; font-weight:600;">cgroup-lite</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lvm2</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">debootstrap</span><span style=" font-family:'Ubuntu';">. Для использования </span><span style=" font-family:'Ubuntu'; font-weight:600;">libvirt-lxc</span><span style=" font-family:'Ubuntu';"> установите </span><span style=" font-family:'Ubuntu'; font-weight:600;">libvirt-bin</span><span style=" font-family:'Ubuntu';">. </span><span style=" font-family:'Ubuntu'; font-weight:600;">LXC</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">libvirt-lxc</span><span style=" font-family:'Ubuntu';"> могут быть установлены и использоваться одновременно. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="настройка_основной_системы"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Н</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">астройка основной системы</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="основное_расположение_файлов_lxc"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">О</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">сновное расположение файлов LXC</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее приведено описание файлов и каталогов, которые устанавливаются и используются LXC. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Существует два задания отслеживания:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  ~~ **/etc/init/lxc-net.conf**: необязательное задание, которое запускается только если в **/etc/default/lxc** определено **USE_LXC_BRIDGE** (по умолчанию true). Оно устанавливает мост на основе NAT для использования контейнером.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  ~~ **/etc/init/lxc.conf**: запускается если **LXC_AUTO** (по умолчанию true) установлена в **/etc/default/lxc**. Оно отслеживает записи в **/etc/lxc/auto/**, которые являются символическими ссылками на файлы конфигураций для контейнеров, которые должны быть запущены при загрузке системы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/etc/lxc/lxc.conf**: Это конфигурационный файл по умолчанию для создания контейнеров, который предписывает контейнерам использовать LXC мост, созданный отслеживающим заданием **lxc-net**. Если при создании контейнера не указывается конфигурационный файл, будет использоваться именно этот.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Примеры других конфигурационных файлов создания контейнеров можно найти в каталоге **/usr/share/doc/lxc/examples**. Они показывают как создавать контейнеры без частной сети или с использованием **macvlan**, **vlan** или иных сетевых расположений.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Различные инструменты администрирования контейнеров можно найти в каталоге **/usr/bin**.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/usr/lib/lxc/lxc-init**: минимальная очень легковесная инициализирующая программа, которая используется **lxc-execute**. Вместо того, чтобы загружать весь контейнер, она вручную монтирует несколько файловых систем, главным образом /proc, и отрабатывает их аргументы. Желательно, чтобы вам не пришлось обращаться к этому файлу.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/usr/lib/lxc/templates/** содержит шаблоны, которые могут быть использованы при создании новых контейнеров для различных дистрибутивов и их разновидностей. На данный момент не все шаблоны поддерживаются.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/etc/apparmor.d/lxc/lxc-default** содержит Apparmor профиль доступа по умолчанию, который обеспечивает защиту основной системы от контейнеров. Дополнительную информацию смотрите в разделе [[wiki:руководство_по_ubuntu_server:безопасность:apparmor|AppArmor]].</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/etc/apparmor.d/usr.bin.lxc-start** содержит профиль для защиты основной системы от **lxc-start** пока он устанавливает контейнер.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/etc/apparmor.d/lxc-containers** заставляет все профили, определенные в **/etc/apparmor.d/lxc**, загружаться при старте системы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Существует множество страниц руководства **man** по средствам администрирования, таким как файл настроек контейнеров **lxc.conf**.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/var/lib/lxc** - место где хранятся контейнеры и информация по их настройкам.</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ **/var/cache/lxc** - место кеширования данных дистрибутивов для ускорения создания множества контейнеров. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="lxcbr0"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">l</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">xcbr0</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Когда </span><span style=" font-family:'Ubuntu'; font-weight:600;">USE_LXC_BRIDGE</span><span style=" font-family:'Ubuntu';"> установлена в true в файле </span><span style=" font-family:'Ubuntu'; font-weight:600;">/etc/default/lxc</span><span style=" font-family:'Ubuntu';"> (как устанавливается по умолчанию), мост с именем </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcbr0</span><span style=" font-family:'Ubuntu';"> создается в процессе старта. Этот мост получает частный адрес 10.0.3.1, а контейнеры его использующие получат адреса из диапазона 10.0.3.0/24. Экземпляр </span><span style=" font-family:'Ubuntu'; font-weight:600;">dnsmasq</span><span style=" font-family:'Ubuntu';"> начинает прослушивать этот мост, поэтому если другой </span><span style=" font-family:'Ubuntu'; font-weight:600;">dnsmasq</span><span style=" font-family:'Ubuntu';"> получает связь со всеми интерфейсами до запуска отслеживающего сервиса </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-net</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-net</span><span style=" font-family:'Ubuntu';"> рушится на старте и </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcbr0</span><span style=" font-family:'Ubuntu';"> не создается. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если у вас есть другой мост, например, </span><span style=" font-family:'Ubuntu'; font-weight:600;">virbr0</span><span style=" font-family:'Ubuntu';"> по умолчанию от </span><span style=" font-family:'Ubuntu'; font-weight:600;">libvirt</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">br0</span><span style=" font-family:'Ubuntu';"> для вашего основного сетевого интерфейса, вы можете использовать его вместо </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcbr0</span><span style=" font-family:'Ubuntu';"> для ваших контейнеров. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="использование_отдельной_файловой_системы_для_хранения_контейнеров"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">И</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">спользование отдельной файловой системы для хранения контейнеров</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">LXC</span><span style=" font-family:'Ubuntu';"> сохраняет информацию контейнеров и корневую файловую систему (с резервным хранилищем по умолчанию) в </span><span style=" font-family:'Ubuntu'; font-weight:600;">/var/lib/lxc</span><span style=" font-family:'Ubuntu';">. Также шаблоны создания контейнеров предпочитают хранить закешированную информацию по дистрибутивам в </span><span style=" font-family:'Ubuntu'; font-weight:600;">/var/cache/lxc</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Дефолтный путь, называемый </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcpath</span><span style=" font-family:'Ubuntu';">, может быть переопределён в командной строке ключом </span><span style=" font-family:'Ubuntu'; font-weight:600;">-P</span><span style=" font-family:'Ubuntu';"> или навсегда через </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcpath = /новый/путь</span><span style=" font-family:'Ubuntu';"> в </span><span style=" font-family:'Ubuntu'; font-weight:600;">/etc/lxc/lxc.conf</span><span style=" font-family:'Ubuntu';"> Если вы переопределяете </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcpath</span><span style=" font-family:'Ubuntu';">, то каталог снимков </span><span style=" font-family:'Ubuntu'; font-weight:600;">snap</span><span style=" font-family:'Ubuntu';"> добавляется к </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcpath</span><span style=" font-family:'Ubuntu';"> и магическим образом за ним следует. Кэш шаблонов, к сожалению, жёстко вшит и не просто его сменить. Но можно всё сделать через символические ссылки. Например, если /srv является большой смонтированной файловой системой, создайте каталог и символьную ссылку на него: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mkdir /srv/lxccache</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo rm -rf /var/cache/lxc</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ln -s /srv/lxccache /var/cache/lxc </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">или, используя монтирование: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mkdir /srv/lxccache</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo sed -i '$a \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">/srv/lxccache /var/cache/lxc none defaults,bind 0 0' /etc/fstab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mount -a </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="контейнеры_с_поддержкой_lvm"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">К</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">онтейнеры с поддержкой lvm</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Существует возможность использовать разделы </span><span style=" font-family:'Ubuntu'; font-weight:600;">LVM</span><span style=" font-family:'Ubuntu';"> в качестве хранилища для контейнеров. Преимуществом этого является, кроме прочего, гибкость в управлении хранилищем и быстрое клонирование контейнеров. По умолчанию используется </span><span style=" font-family:'Ubuntu'; font-weight:600;">VG</span><span style=" font-family:'Ubuntu';"> (группа томов) с именем </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';">, но могут применяться и другие VG при использовании параметров командной строки. Когда </span><span style=" font-family:'Ubuntu'; font-weight:600;">LV</span><span style=" font-family:'Ubuntu';"> (логический том) используется для хранения контейнеров, конфигурационный файл контейнера все еще </span><span style=" font-family:'Ubuntu'; font-weight:600;">/var/lib/lxc/CN/config</span><span style=" font-family:'Ubuntu';">, но корневая точка входа в этом файле (lxc.rootfs) будет указывать на имя блочного устройства логического тома, т.е. </span><span style=" font-family:'Ubuntu'; font-weight:600;">/dev/lxc/CN</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Контейнеры с деревом каталогов и LVM хранилищем могут сосуществовать вместе. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="btrfs"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">B</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">trfs</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если основная система имеет </span><span style=" font-family:'Ubuntu'; font-weight:600;">/var</span><span style=" font-family:'Ubuntu';">, размеченный как </span><span style=" font-family:'Ubuntu'; font-weight:600;">btrfs</span><span style=" font-family:'Ubuntu';">, средства администрирования LXC распознают это и автоматически будут использовать для клонирования контейнеров снимки btrfs. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="zfs"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Z</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">FS</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Подобно </span><span style=" font-family:'Ubuntu'; font-weight:600;">btrfs</span><span style=" font-family:'Ubuntu';">, использование </span><span style=" font-family:'Ubuntu'; font-weight:600;">zfs</span><span style=" font-family:'Ubuntu';"> позволит применять возможности, но уже </span><span style=" font-family:'Ubuntu'; font-weight:600;">ZFS</span><span style=" font-family:'Ubuntu';">: подтом (subvolume) для контейнера, быстрое создание снимков и клонов, более эффективное использование места на диске за счёт дедупликации. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="apparmor"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">A</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">pparmor</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">LXC поставляется с профилем Apparmor, предназначенным для защиты основной системы от случайного неправильного использования привилегий внутри контейнера. Например, контейнер не должен иметь возможности писать в каталог /proc/sysrq-trigger или менять большинство файлов в каталоге /sys. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Профиль </span><span style=" font-family:'Ubuntu'; font-weight:600;">usr.bin.lxc-start</span><span style=" font-family:'Ubuntu';"> используется при запуске </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';">. Этот профиль в основном предотвращает монтирование </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> новых файловых систем вне корневой файловой системы контейнера. Перед инициализацией контейнера LXC запрашивает переключение на профиль контейнера. По умолчанию используется профиль </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-container-default</span><span style=" font-family:'Ubuntu';">, определенный в </span><span style=" font-family:'Ubuntu'; font-weight:600;">/etc/apparmor.d/lxc/lxc-default</span><span style=" font-family:'Ubuntu';">. Этот профиль запрещает контейнеру доступ к многим опасным каталогам и монтирование большинства файловых систем. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если вы обнаружили, что </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> падает из-за попытки легитимного доступа, перекрытого политикой Apparmor, вы можете отключить профиль </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apparmor_parser -R /etc/apparmor.d/usr.bin.lxc-start</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ln -s /etc/apparmor.d/usr.bin.lxc-start /etc/apparmor.d/disabled/ </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Это позволит запускать </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> без ограничений, но продолжит ограничивать собственно контейнер. Если вы хотите также снять ограничения с контейнера, в дополнение к блокировке использования профиля </span><span style=" font-family:'Ubuntu'; font-weight:600;">usr.bin.lxc-start</span><span style=" font-family:'Ubuntu';">, вам потребуется в файл настроек контейнера добавить: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.aa_profile = unconfined </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если вы желаете запускать контейнер в собственном профиле, вы можете создать новый профиль в /etc/apparmor.d/lxc/. Его имя должно начинаться на </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-</span><span style=" font-family:'Ubuntu';"> чтобы </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> имел возможность переключения на этот профиль. После создания политики, загрузите ее используя команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apparmor_parser -r /etc/apparmor.d/lxc-containers </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Профиль автоматически загрузится после перезагрузки системы, поскольку его содержимое учтено в /etc/apparmor.d/lxc-containers. Наконец, чтобы заставить контейнер </span><span style=" font-family:'Ubuntu'; font-weight:600;">CN</span><span style=" font-family:'Ubuntu';"> использовать новый профиль </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-CN-profile</span><span style=" font-family:'Ubuntu';">, добавьте следующие строки в его файл настройки: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.aa_profile = lxc-CN-profile </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-execute</span><span style=" font-family:'Ubuntu';"> не просматривает профиль Apparmor, но контейнер, который он порождает, будет ограничен. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="группы_управления"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Г</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">руппы управления</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Группы управления (</span><span style=" font-family:'Ubuntu'; font-weight:600;">cgroups</span><span style=" font-family:'Ubuntu';">) - это способность ядра предоставлять возможность иерархически группировать задачи, а также назначать и ограничивать ресурсы для каждой </span><span style=" font-family:'Ubuntu'; font-weight:600;">cgroup</span><span style=" font-family:'Ubuntu';">. Они используются в контейнерах для ограничения доступа к блочным и посимвольным устройствам (</span><span style=" font-family:'Ubuntu'; font-style:italic;">block and character device</span><span style=" font-family:'Ubuntu';">) и для заморозки (приостановки) контейнеров. В дальнейшем их можно использовать для ограничения используемой памяти и блочного ввода/вывода, гарантированного минимума использования CPU и для фиксирования определенных CPU за отдельными контейнерами. По умолчанию </span><span style=" font-family:'Ubuntu'; font-weight:600;">LXC</span><span style=" font-family:'Ubuntu';"> устанавливает зависимость на установку пакета </span><span style=" font-family:'Ubuntu'; font-weight:600;">cgroup-lite</span><span style=" font-family:'Ubuntu';">, который предоставляет надлежащую инициализацию </span><span style=" font-family:'Ubuntu'; font-weight:600;">cgroup</span><span style=" font-family:'Ubuntu';"> при загрузке системы. Пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">cgroup-lite</span><span style=" font-family:'Ubuntu';"> монтирует каждую cgroup подсистему отдельно в /sys/fs/cgroup/</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">SS</span><span style=" font-family:'Ubuntu';">, где </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">SS</span><span style=" font-family:'Ubuntu';"> - название подсистемы. Например, подсистема freezer монтируется в /sys/fs/cgroup/freezer. Группы управления LXC хранятся в /sys/fs/cgroup/</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">SS</span><span style=" font-family:'Ubuntu';">/</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">INIT</span><span style=" font-family:'Ubuntu';">/lxc, где </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">INIT</span><span style=" font-family:'Ubuntu';"> - инициализирующая группа управления задачи. По умолчанию это /, поэтому группа управления freezer для контейнера CN будет /sys/fs/cgroup/freezer/lxc/CN. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="привилегии"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">ривилегии</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Утилиты администрирования контейнерами должны запускаться с привилегиями суперпользователя. Утилита с названием </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-setup</span><span style=" font-family:'Ubuntu';"> была написана с намерением предоставлять инструменты с требуемыми правами доступа к файлам, позволяя обычным пользователям запускать эти инструменты с достаточными привилегиями. Однако, поскольку суперпользователь не может пока быть надежно погружен в контейнер, эта особенность бесполезна. Поэтому рекомендуется не использовать lxc-setup и предоставлять администраторам LXC требуемые привилегии </span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Пространство имен пользователя, которое предположительно будет доступно к следующему LTS выпуску, будет позволять ограничивать (сдерживать) суперпользователя контейнера, также как будут уменьшены привилегии, необходимые для создания и администрирования контейнеров. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="отслеживающие_задания_lxc"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">О</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">тслеживающие задания LXC</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Как отмечалось выше, пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';"> включает два отслеживающих задания. Первое, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-net</span><span style=" font-family:'Ubuntu';">, стартует всегда когда другое, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';">, собирается стартовать и останавливается, когда то останавливается. Если переменная </span><span style=" font-family:'Ubuntu'; font-weight:600;">USE_LXC_BRIDGE</span><span style=" font-family:'Ubuntu';"> установлена в </span><span style=" font-family:'Ubuntu'; font-weight:600;">false</span><span style=" font-family:'Ubuntu';"> в файле /etc/defaults/lxc, то оно завершится немедленно. Если переменная </span><span style=" font-family:'Ubuntu'; font-weight:600;">true</span><span style=" font-family:'Ubuntu';"> и возникает ошибка организации моста, то задание </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';"> не стартует. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-net</span><span style=" font-family:'Ubuntu';"> отключает мост, когда останавливается, хотя использующий его контейнер работает. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Задание </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';"> запускается на 2-5 уровне выполнения. Если переменная </span><span style=" font-family:'Ubuntu'; font-weight:600;">LXC_AUTO</span><span style=" font-family:'Ubuntu';"> установлена в </span><span style=" font-family:'Ubuntu'; font-weight:600;">true</span><span style=" font-family:'Ubuntu';">, оно ищет в /etc/lxc контейнеры, которые должны запускаться автоматически. Когда задание </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';"> останавливается, вручную или при установке уровня выполнения 0, 1 или 6, оно останавливает эти контейнеры. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для регистрации автоматического запуска контейнера, создайте символическую ссылку /etc/default/lxc/</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">name</span><span style=" font-family:'Ubuntu';">.conf, указывающую на конфигурационный файл контейнера. Например, конфигурационный файл для контейнера CN - /var/lib/lxc/CN/config. Чтобы автоматически запускать этот контейнер, используйте команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ln -s /var/lib/lxc/CN/config /etc/lxc/auto/CN.conf </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="администрирование_контейнеров"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">А</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">дминистрирование контейнеров</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="создание_контейнеров"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">С</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">оздание контейнеров</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Самый простой способ создать контейнер - использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-create</span><span style=" font-family:'Ubuntu';">. Этот сценарий использует специфические для дистрибутива шаблоны в /usr/lib/lxc/templates/ для установки дружественных контейнеру настроек chroots в /var/lib/lxc/CN/rootfs и инициализации конфигурации в /var/lib/lxc/CN/fstab и /var/lib/lxc/CN/config, где CN - название контейнера. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Команда на создание простейшего контейнера будет выглядеть следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t ubuntu -n CN </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Она говорит </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-create</span><span style=" font-family:'Ubuntu';"> использовать шаблон ubuntu (-t ubuntu) и вызывать контейнер CN (-n CN). Поскольку не указан файл настроек (что можно сделать с помощью параметра '-f file'), будет использован файл настроек по умолчанию /etc/lxc/lxc.conf. Это предоставит контейнеру единственный </span><span style=" font-family:'Ubuntu'; font-weight:600;">veth</span><span style=" font-family:'Ubuntu';"> сетевой интерфейс, подключенный к мосту </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcbr0</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Шаблоны создания контейнеров также могут воспринимать аргументы. Они могут быть перечислены после --. Например: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t ubuntu -n oneiric1 -- -r oneiric </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">передает параметры '-r oneiric1' шаблону ubuntu. </span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="помощь"></a><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">омощь</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Помощь по команде </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-create</span><span style=" font-family:'Ubuntu';"> можно увидеть используя lxc-create -h. Однако шаблоны также забирают свои собственные параметры. Если вы выполните </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t ubuntu -h </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">то после общего экрана помощи </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-create</span><span style=" font-family:'Ubuntu';"> будет следовать вывод помощи, касающийся шаблона </span><span style=" font-family:'Ubuntu'; font-weight:600;">ubuntu</span><span style=" font-family:'Ubuntu';">. Если не указывать шаблон, то будет показана помощь только по </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-create</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="шаблон_ubuntu"></a><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">аблон Ubuntu</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Шаблон </span><span style=" font-family:'Ubuntu'; font-weight:600;">ubuntu</span><span style=" font-family:'Ubuntu';"> может использоваться для создания контейнеров системы Ubuntu любой редакции, по крайней мере начиная с 10.04 LTS. Он использует </span><span style=" font-family:'Ubuntu'; font-weight:600;">debootstrap</span><span style=" font-family:'Ubuntu';"> для создания кешированной файловой системы контейнера, с которой будет создаваться копия каждый раз как стартует контейнер. Кешированный образ сохраняется и только пересоздается когда вы создаете контейнер с использованием опции </span><span style=" font-family:'Ubuntu'; font-weight:600;">-F</span><span style=" font-family:'Ubuntu';"> (flush), передаваемой шаблону, т.е.: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t ubuntu -n CN -- -F </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Редакция Ubuntu, установленная в контейнер, будет той же самой, что и на основной системе, если не указать опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">-r</span><span style=" font-family:'Ubuntu';">, т.е.: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t ubuntu -n CN -- -r lucid </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если вы хотите создать 32-битный контейнер на 64-битной системе, передайте в контейнер параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">-a i386</span><span style=" font-family:'Ubuntu';">. Если у вас установлен пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">qemu-user-static</span><span style=" font-family:'Ubuntu';">, то вы можете создать контейнер, используя любую архитектуру, поддерживаемую </span><span style=" font-family:'Ubuntu'; font-weight:600;">qemu-user-static</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В контейнере будет присутствовать пользователь </span><span style=" font-family:'Ubuntu'; font-weight:600;">ubuntu</span><span style=" font-family:'Ubuntu';"> с паролем </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">ubuntu</span><span style=" font-family:'Ubuntu';">, входящий в группу </span><span style=" font-family:'Ubuntu'; font-weight:600;">sudo</span><span style=" font-family:'Ubuntu';">. Если вы хотите хотите добавить открытый ключ ssh для этого пользователя, вы можете это сделать параметром </span><span style=" font-family:'Ubuntu'; font-weight:600;">-S sshkey.pub</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вы можете связать пользователя основной системы </span><span style=" font-family:'Ubuntu'; font-weight:600;">jdoe</span><span style=" font-family:'Ubuntu';"> (например) с контейнером, используя опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">-b jdoe</span><span style=" font-family:'Ubuntu';">. Это позволит скопирует пароль и shadow записи пользователя jdoe в контейнер, удостоверится, что его группа по умолчанию и оболочка доступны, добавит его в группу sudo и смонтирует связыванием (bind-mount) его домашний каталог в контейнер при запуске контейнера. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Когда создается контейнер, архив </span><span style=" font-family:'Ubuntu'; font-weight:600;">release-updates</span><span style=" font-family:'Ubuntu';"> добавляется в его </span><span style=" font-family:'Ubuntu'; font-weight:600;">sources.list</span><span style=" font-family:'Ubuntu';">, тем самым его архив пакетов будет обновляться. Если редакция контейнера старше 12.04 LTS, автоматически устанавливается пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcguest</span><span style=" font-family:'Ubuntu';">. В качестве альтернативы, если указать опцию --trim , пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcguest</span><span style=" font-family:'Ubuntu';"> установлен не будет и множество сервисов будет удалено из контейнера. В результате получится контейнер с более быстрой загрузкой, но менее обновляемый. </span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="шаблон_облака_ubuntu"></a><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">аблон облака Ubuntu</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Шаблон </span><span style=" font-family:'Ubuntu'; font-weight:600;">ubuntu-cloud</span><span style=" font-family:'Ubuntu';"> создает контейнеры Ubuntu, загружая и извлекая опубликованные образы для облака Ubuntu. Он воспринимает некоторые из опций шаблона ubuntu, а именно </span><span style=" font-family:'Ubuntu'; font-weight:600;">-r release</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">-S sshkey.pub</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">-a arch</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">-F</span><span style=" font-family:'Ubuntu';"> для сброса кешированных образов. Он воспринимает также некоторые дополнительные опции. Опция </span><span style=" font-family:'Ubuntu'; font-weight:600;">-C</span><span style=" font-family:'Ubuntu';"> создает облачный контейнер, настроенный на использование с сервисом metedata. Опция </span><span style=" font-family:'Ubuntu'; font-weight:600;">-u</span><span style=" font-family:'Ubuntu';"> позволяет инициализирующему облачному файлу с пользовательскими данными настраивать контейнер при старте. Если передается </span><span style=" font-family:'Ubuntu'; font-weight:600;">-L</span><span style=" font-family:'Ubuntu';">, то не будет установлено никаких национальных настроек. Опция </span><span style=" font-family:'Ubuntu'; font-weight:600;">-T</span><span style=" font-family:'Ubuntu';"> может быть использована для выбора размещения извлекаемой свертки (tarball) вместо использования опубликованной свертки облачного образа. Наконец, опция </span><span style=" font-family:'Ubuntu'; font-weight:600;">-i</span><span style=" font-family:'Ubuntu';"> устанавливает id системы для </span><span style=" font-family:'Ubuntu'; font-weight:600;">cloud-init</span><span style=" font-family:'Ubuntu';">, который по умолчанию приравнивается к случайной строке. </span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="другие_шаблоны"></a><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">Д</span><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">ругие шаблоны</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Шаблоны ubuntu и ubuntu-cloud хорошо поддерживаются. Тем не менее поддерживаются и другие шаблоны. Шаблон </span><span style=" font-family:'Ubuntu'; font-weight:600;">debian</span><span style=" font-family:'Ubuntu';"> создает контейнер на основе Debian, используя </span><span style=" font-family:'Ubuntu'; font-weight:600;">debootstrap</span><span style=" font-family:'Ubuntu';"> почти как для шаблона ubuntu. По умолчанию он устанавливает образ debian squeeze. Другие редакции могут быть выбраны с использованием переменной окружения </span><span style=" font-family:'Ubuntu'; font-weight:600;">SUITE</span><span style=" font-family:'Ubuntu';">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo SUITE=sid lxc-create -t debian -n d1 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Поскольку debian не может быть безопасно загружен внутри контейнера, контейнеры debian будут урезаны как при использовании опции </span><span style=" font-family:'Ubuntu'; font-weight:600;">--trim</span><span style=" font-family:'Ubuntu';"> для шаблона ubuntu. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для очистки кеша образа контейнера вызывайте шаблон напрямую и передавайте ему опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">--clean</span><span style=" font-family:'Ubuntu';">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo SUITE=sid /usr/lib/lxc/templates/lxc-debian --clean </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Существующие шаблоны fedora создают контейнеры на базе редакций fedora не выше 14. Редакции fedora, начиная с 15 основаны на </span><span style=" font-family:'Ubuntu'; font-weight:600;">systemd</span><span style=" font-family:'Ubuntu';">, который шаблоны пока не могут преобразовать в установку, загружаемую в контейнере. Перед тем как запускать шаблон </span><span style=" font-family:'Ubuntu'; font-weight:600;">fedora</span><span style=" font-family:'Ubuntu';"> вам следует убедиться, что установлены </span><span style=" font-family:'Ubuntu'; font-weight:600;">yum</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">curl</span><span style=" font-family:'Ubuntu';">. Контейнер с fedora 12 может быть установлен следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t fedora -n fedora12 -- -R 12 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Существуют шаблоны OpenSuSE, но они требуют программу </span><span style=" font-family:'Ubuntu'; font-weight:600;">zypper</span><span style=" font-family:'Ubuntu';">, которая пока не имеет пакета. Таким образом шаблоны OpenSuSE не поддерживаются. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Еще два шаблона созданы в основном для экспериментальных целей. Шаблон </span><span style=" font-family:'Ubuntu'; font-weight:600;">busybox</span><span style=" font-family:'Ubuntu';"> создает очень маленький системный контейнер, основанный целиком на busybox. Шаблон </span><span style=" font-family:'Ubuntu'; font-weight:600;">sshd</span><span style=" font-family:'Ubuntu';"> создает контейнер приложений, запускающий sshd в области имен частной сети. Каталоги библиотек и двоичных файлов монтируются связыванием внутрь контейнера, хотя не /home или /root. Для создания, запуска и соединения по ssh с контейнером, вы можете использовать следующее: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t sshd -n ssh1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ssh-keygen -f id</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mkdir /var/lib/lxc/ssh1/rootfs/root/.ssh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo cp id.pub /var/lib/lxc/ssh1/rootfs/root/.ssh/authorized_keys</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-start -n ssh1 -d</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ssh -i id root@ssh1. </span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="резервные_хранилища"></a><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">Р</span><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">езервные хранилища</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">По умолчанию </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-create</span><span style=" font-family:'Ubuntu';"> помещает корневую файловую систему контейнера в каталог /var/lib/lxc/CN/rootfs. Другим вариантом является использование логических томов LVM. Если существует группа томов </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';">, вы можете создать контейнер на основе lvm с названием CN, используя команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t ubuntu -n CN -B lvm </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если вы хотите использовать группу томов с именем </span><span style=" font-family:'Ubuntu'; font-weight:600;">schroots</span><span style=" font-family:'Ubuntu';"> с файловой системой </span><span style=" font-family:'Ubuntu'; font-weight:600;">xfs</span><span style=" font-family:'Ubuntu';"> на 5 Гб, вы можете использовать: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-create -t ubuntu -n CN -B lvm --vgname schroots --fssize 5G --fstype xfs </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="клонирование"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">К</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">лонирование</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для быстрой подготовки к работе вы можете решить изменить canonical контейнер в соответствии с вашими требованиями и затем сделать множество его копий. Это можно осуществить с помощью программы lxc-clone. Дан существующий контейнер с именем C1, новый контейнер C2 может быть создан: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-clone -o C1 -n C2 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если файловой системой /var/lib/lxc является </span><span style=" font-family:'Ubuntu'; font-weight:600;">btrfs</span><span style=" font-family:'Ubuntu';">, то lxc-clone создаст файловую систему C2 как снимок от C1. Если корневая файловая система контейнера поддерживается lvm, то вы можете указать опцию -s для создания новой rootfs как снимок lvm оригинала следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-clone -s -o C1 -n C2 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">И lvm и btrfs снимки обеспечивают быстрое клонирование с очень небольшим изначально использованием дискового пространства. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="запуск_и_остановка"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">З</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">апуск и остановка</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Чтобы запустить контейнер используйте lxc-start -n CN. По умолчанию </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> выполнит /sbin/init внутри контейнера. Вы можете предоставить другую программу для выполнения плюс аргументы, как дополнительные аргументы для </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-start -n container /sbin/init loglevel=debug </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если вы не укажете опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">-d</span><span style=" font-family:'Ubuntu';"> (daemon - сервис), то вы увидите консоль (по поводу контейнерной /dev/console смотрите секцию </span><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#консоли"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Консоли</span></a><span style=" font-family:'Ubuntu';">) в терминале. Если вы укажете опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">-d</span><span style=" font-family:'Ubuntu';">, то эту консоль вы не увидите, а </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> завершится без ошибок немедленно, даже если дальнейшая часть запуска контейнера завершится неудачей. Вы можете использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-wait</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-monitor</span><span style=" font-family:'Ubuntu';"> (смотрите </span><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#отслеживание_статуса_контейнеров"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Отслеживание статуса контейнеров</span></a><span style=" font-family:'Ubuntu';">) для проверки удачно или нет запустился контейнер. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для получения отладочной информации LXC, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">-o filename -l debuglevel</span><span style=" font-family:'Ubuntu';">, например: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-start -o lxc.debug -l DEBUG -n container </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Наконец, вы можете указать параметры настройки, используя опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">-s</span><span style=" font-family:'Ubuntu';">. Однако в общем случае рекомендуется вместо этого указывать их в конфигурационном файле контейнера. Аналогичным образом можно указать целиком иной файл настроек с помощью опции </span><span style=" font-family:'Ubuntu'; font-weight:600;">-f</span><span style=" font-family:'Ubuntu';">, но это тоже в общем случае не рекомендуется. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В то время как </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> запускает в контейнерный /sbin/init, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-execute</span><span style=" font-family:'Ubuntu';"> использует программу минимальной инициализации </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-init</span><span style=" font-family:'Ubuntu';">, которая пытается монтировать /proc, /dev/mqueue и /dev/shm, выполняет программы, указанные в командной строке, и ждет их завершения. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';"> предназначена для использования системными контейнерами, в то время как </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-execute</span><span style=" font-family:'Ubuntu';"> для использования контейнерами приложений (смотрите </span><a href="https://www.ibm.com/developerworks/linux/library/l-lxc-containers/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">эту статью</span></a><span style=" font-family:'Ubuntu';"> для дополнительной информации). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Остановить контейнер вы можете разными способами. Вы можете использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">shutdown</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">poweroff</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">reboot</span><span style=" font-family:'Ubuntu';"> когда подсоединились к контейнеру. Для чистого завершения работы контейнера извне (т.е. из основной системы), вы можете выполнить команду </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">sudo lxc-shutdown -n CN</span><span style=" font-family:'Ubuntu';">. Она воспринимает необязательный параметр задержки. Если он не указан, команда посылает сигнал </span><span style=" font-family:'Ubuntu'; font-weight:600;">SIGPWR</span><span style=" font-family:'Ubuntu';"> в контейнер и немедленно завершается. Если опция указана, как, например, </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">sudo lxc-shutdown -n CN -t 10</span><span style=" font-family:'Ubuntu';">, то команда ожидает указанное количество секунд завершения работы контейнера. Затем, если контейнер все еще работает, она убивает (kill) его, а также все работающие в нем приложения. Вы можете также немедленно убить контейнер (не оставляя шансов для приложений завершиться аккуратно), используя команду </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">sudo lxc-stop -n CN</span><span style=" font-family:'Ubuntu';">. Наконец, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-kill</span><span style=" font-family:'Ubuntu';"> может быть использована в общем случае для отправки любого сигнала процедуре инициализации контейнера. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В процессе завершения работы контейнера вы можете получить несколько (безопасных) сообщений об ошибке, как например: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">$ sudo poweroff</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[sudo] password for ubuntu: =</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">$ =</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Broadcast message from ubuntu@cn1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        (/dev/lxc/console) at 18:17 ...</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">The system is going down for power off NOW!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> * Asking all remaining processes to terminate...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   ...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> * All processes ended within 1 seconds....</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   ...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> * Deconfiguring network interfaces...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   ...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> * Deactivating swap...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   ...fail!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">umount: /run/lock: not mounted</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">umount: /dev/shm: not mounted</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">mount: / is busy</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> * Will now halt </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Кроме того, контейнер может быть &quot;заморожен&quot; командой </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">sudo lxc-freeze -n CN</span><span style=" font-family:'Ubuntu';">. Это заблокирует все его процессы до тех пор, пока он не будет &quot;разморожен&quot; командой </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">sudo lxc-unfreeze -n CN</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="отслеживание_статуса_контейнеров"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">О</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">тслеживание статуса контейнеров</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Две команды доступны для отслеживания изменения статуса контейнера. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-monitor</span><span style=" font-family:'Ubuntu';"> отслеживает один или более контейнеров на любые изменения статусов. Она как правило получает имя контейнера с помощью опции </span><span style=" font-family:'Ubuntu'; font-weight:600;">-n</span><span style=" font-family:'Ubuntu';">, однако в этом случае имя контейнера может быть регулярным выражением posix, чтобы позволять отслеживать желаемые наборы контейнеров. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-monitor</span><span style=" font-family:'Ubuntu';"> продолжает выполнение пока выводит статусы контейнеров. Вторая команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-wait</span><span style=" font-family:'Ubuntu';"> ожидает специфического изменения статуса контейнера и затем завершается. Например, </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-monitor -n cont[0-5]* </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">будет выводить все изменения статусов контейнеров с именами, попадающими под приведенное регулярное выражение, в то время как </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-wait -n cont1 -s 'STOPPED|FROZEN' </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">будет ожидать пока контейнер </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">cont1</span><span style=" font-family:'Ubuntu';"> не войдет в состояния </span><span style=" font-family:'Ubuntu'; font-weight:600;">STOPPED</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">FROZEN</span><span style=" font-family:'Ubuntu';"> и затем завершится. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="консоли"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">К</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">онсоли</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Контейнеры имеют настраиваемое количество консолей. Одна всегда существует в контейнерном /dev/console. Она видна в терминале из которого вы запустили </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';">, если не указана опция </span><span style=" font-family:'Ubuntu'; font-weight:600;">-d</span><span style=" font-family:'Ubuntu';">. Вывод в /dev/console может быть перенаправлен в файл при использовании опции </span><span style=" font-family:'Ubuntu'; font-weight:600;">-c console-file</span><span style=" font-family:'Ubuntu';"> с </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-start</span><span style=" font-family:'Ubuntu';">. Количество дополнительных консолей указывается переменной </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.tty</span><span style=" font-family:'Ubuntu';"> и обычно равно 4. Эти консоли видны как </span><span style=" font-family:'Ubuntu'; font-weight:600;">/dev/tty</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">N</span><span style=" font-family:'Ubuntu';"> (где 1 ⇐ </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">N</span><span style=" font-family:'Ubuntu';"> ⇐ 4). Для соединения с консолью 3 из основной системы используйте </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-console -n container -t 3 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">в противном случае, если </span><span style=" font-family:'Ubuntu'; font-weight:600;">-t N</span><span style=" font-family:'Ubuntu';"> не указано, будет автоматически выбрана неиспользуемая консоль. Для входа из консоли используйте последовательность </span><span style=" font-family:'Ubuntu'; font-weight:600;">Ctrl-a q</span><span style=" font-family:'Ubuntu';">. Обратите внимание, что последовательность не сработает в консоли при использовании lxc-start без опции -d. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Каждая консоль контейнера фактически является </span><span style=" font-family:'Ubuntu'; font-weight:600;">Unix98 pty</span><span style=" font-family:'Ubuntu';">, смонтированной в </span><span style=" font-family:'Ubuntu'; font-weight:600;">pty</span><span style=" font-family:'Ubuntu';"> основной (не гостевой) системы через связанное монтирование гостевых </span><span style=" font-family:'Ubuntu'; font-weight:600;">/dev/ttyN</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">/dev/console</span><span style=" font-family:'Ubuntu';">. Следовательно, если гостевая система размонтирует их или с другой стороны попытается получить доступ к символьному устройству 4:N, она не будет обслужена </span><span style=" font-family:'Ubuntu'; font-weight:600;">getty</span><span style=" font-family:'Ubuntu';"> на LXC консолях. (При настройках по умолчанию контейнер не сможет получить доступ к этому символьному устройству и getty, соответственно, завершится с ошибкой). Это может легко случиться, когда загрузочный сценарий вслепую монтирует новые устройства в /dev. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="исследование_контейнеров"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">И</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">сследование контейнеров</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Некоторые команды способны собирать информацию по созданным контейнерам. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-ls</span><span style=" font-family:'Ubuntu';"> выведет все существующие контейнеры в своей первой строке вывода и все запущенные контейнеры во второй. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-list</span><span style=" font-family:'Ubuntu';"> предоставит ту же информацию в более развернутом формате, перечислив запущенные контейнеры сначала и остановленные в конце. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-ps</span><span style=" font-family:'Ubuntu';"> предоставит список процессов в контейнере. Для передачи </span><span style=" font-family:'Ubuntu'; font-weight:600;">ps</span><span style=" font-family:'Ubuntu';"> аргументов в </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-ps</span><span style=" font-family:'Ubuntu';">, предварите их </span><span style=" font-family:'Ubuntu'; font-weight:600;">--</span><span style=" font-family:'Ubuntu';">. Например, для получения списка всех процессов в контейнере </span><span style=" font-family:'Ubuntu'; font-weight:600;">plain</span><span style=" font-family:'Ubuntu';">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-ps -n plain -- -ef </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-info</span><span style=" font-family:'Ubuntu';"> возвращает статус контейнера и </span><span style=" font-family:'Ubuntu'; font-weight:600;">pid</span><span style=" font-family:'Ubuntu';"> его инициирующего процесса. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-cgroup</span><span style=" font-family:'Ubuntu';"> может быть использована для получения и установки переменных ограничений и информации управляющих групп контейнера. Это может оказаться более удобным чем взаимодействовать с файловой системой cgroup. Например для получения списка устройств к которым контейнер имеет доступ, вы можете использовать: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-cgroup -n CN devices.list </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">или для добавления прав доступа mknod, read и write к /dev/sda: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-cgroup -n CN devices.allow &quot;b 8:* rwm&quot; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">и для ограничения памяти до 300M: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc-cgroup -n CN memory.limit_in_bytes 300000000 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-netstat</span><span style=" font-family:'Ubuntu';"> выполняет </span><span style=" font-family:'Ubuntu'; font-weight:600;">netstat</span><span style=" font-family:'Ubuntu';"> в запущенном контейнере, давая вам представление о статусе его сети. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-backup</span><span style=" font-family:'Ubuntu';"> создаст резервные копии корневой файловой системы всех существующих контейнеров (за исключением основанных на lvm), используя </span><span style=" font-family:'Ubuntu'; font-weight:600;">rsync</span><span style=" font-family:'Ubuntu';"> для сохранения содержимого в /var/lib/lxc/CN/rootfs.backup.1. Эти резервные копии могут использоваться для восстановления с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-restore</span><span style=" font-family:'Ubuntu';">. Однако </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-backup</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-restore</span><span style=" font-family:'Ubuntu';"> неустойчивы благодаря модификациям и, соответственно, не рекомендуются к использованию. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="уничтожение_контейнеров"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">У</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">ничтожение контейнеров</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-destroy</span><span style=" font-family:'Ubuntu';"> для уничтожения контейнера. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-destroy -n CN </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если контейнер запущен, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-destroy</span><span style=" font-family:'Ubuntu';"> завершится с сообщением о возможности остановить и уничтожить контейнер с помощью команды </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-destroy -n CN -f </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="использование_расширенного_пространства_имен"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">И</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">спользование расширенного пространства имен</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Одной из особенностей ядра Linux, используемой в LXC для создания контейнеров, являются частные пространства имен. Пространства имен позволяют ряду задач иметь частные отображения имен ресурсов для таких вещей как пути и ID процессов. (Смотрите </span><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#ссылки"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Ссылки</span></a><span style=" font-family:'Ubuntu';"> для дополнительной информации). В отличие от групп управления и других особенностей монтирования, которые также используются при создании контейнеров, пространствами имен невозможно манипулировать при помощи интерфейса файловой системы. Поэтому LXC поставляется с программой </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-unshare</span><span style=" font-family:'Ubuntu';">, которая большей частью используется для тестирования. Она предоставляет возможность создавать новую задачу в частном пространстве имен. Например, </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo lxc-unshare -s 'MOUNT|PID' /bin/bash </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">создаст оболочку </span><span style=" font-family:'Ubuntu'; font-weight:600;">shell</span><span style=" font-family:'Ubuntu';"> с частными </span><span style=" font-family:'Ubuntu'; font-weight:600;">pid</span><span style=" font-family:'Ubuntu';"> и пространством имен монтирования. В этой оболочке вы можете выполнить </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">root@ubuntu:~# mount -t proc proc /proc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">root@ubuntu:~# ps -ef</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">UID        PID  PPID  C STIME TTY          TIME CMD</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">root         1     0  6 10:20 pts/9    00:00:00 /bin/bash</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">root       110     1  0 10:20 pts/9    00:00:00 ps -ef </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">притом, что </span><span style=" font-family:'Ubuntu'; font-weight:600;">ps</span><span style=" font-family:'Ubuntu';"> покажет только задачи в вашем новом пространстве имен. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="недолговечные_контейнеры"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Н</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">едолговечные контейнеры</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Недолговечные (эфемерные - ephemeral) контейнеры - это одноразовые контейнеры. Имея созданный контейнер CN, вы можете выполнить команду в недолговечном контейнере, созданном на основе CN, подсоединив пользователя </span><span style=" font-family:'Ubuntu'; font-weight:600;">jdoe</span><span style=" font-family:'Ubuntu';"> в контейнер, используя команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc-start-ephemeral -b jdoe -o CN -- /home/jdoe/run_my_job </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После завершения задания, контейнер будет сброшен. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="команды_для_работы_с_контейнерами"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">К</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">оманды для работы с контейнерами</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее приведена таблица всех контейнерных команд: </span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="container_commands"></a><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">C</span><span style=" font-family:'Ubuntu'; font-size:small; font-weight:600;">ontainer commands</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0"><thead>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Команда </span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Описание </span></p></td></tr></thead>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-attach </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">(НЕ ПОДДЕРЖИВАЕТСЯ) Выполняет команду в запущенном контейнере </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-backup </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Создает резервную копию корневой системы для всех контейнеров, основанных на lvm </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-cgroup </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Просмотр и установка параметров групп управления </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-checkconfig </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Проверка основной системы на поддержку контейнеров </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-checkpoint </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">(НЕ ПОДДЕРЖИВАЕТСЯ) Контрольная точка для запущенного контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-clone </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Создание копии существующего контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-console </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Открытие консоли работающего контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-create </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Создание нового контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-destroy </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Уничтожение существующего контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-execute </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Запуск команды в (незапущенном) контейнере приложений </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-freeze </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Приостановка работающего контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-info </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вывод информации о состоянии контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-kill </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Передача сигнала в инициализирующий процесс контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-list </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Получение списка всех контейнеров </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-ls </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Получения списка всех контейнеров с меньшим выводом, чем у lxc-list </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-monitor </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Отслеживание изменения состояния одного или нескольких контейнеров </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-netstat </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Выполнение команды netstat в запущенном контейнере </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-ps </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Просмотр информации по процессам в работающем контейнере </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-restart </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">(НЕ ПОДДЕРЖИВАЕТСЯ) Сброс контейнера, остановленного в контрольной точке </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-restore </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Восстановление контейнеров из резервных копий, сделанных lxc-backup </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-setcap </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">(НЕ РЕКОМЕНДУЕТСЯ) Установка характеристик файлов (file capabilities) на инструменты LXC </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-setuid </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">(НЕ РЕКОМЕНДУЕТСЯ) Установка или сброс setuid битов для инструментов LXC </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-shutdown </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Безопасное завершение работы контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-start </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Запуск остановленного контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-start-ephemeral </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Запуск недолговечного (одноразового) контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-stop </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Немедленная остановка работающего контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-unfreeze </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Восстановление работы приостановленного контейнера </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-unshare </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Инструмент тестирования вручную объединенных пространств имен </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-version </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вывод версии инструментов LXC </span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">lxc-wait </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Ожидание перехода контейнера в определенное состояние </span></p></td></tr></table>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="файл_настройки"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Ф</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">айл настройки</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Контейнеры LXC очень гибкие. Пакет Ubuntu </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc</span><span style=" font-family:'Ubuntu';"> устанавливает умолчания таким образом, чтобы создание контейнеров в системе Ubuntu было настолько простым, насколько это возможно. Если вам требуется большая гибкость, то в этой главе будет показано как сделать тонкую настройку ваших контейнеров под ваши нужды. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Детальная информация доступна на странице </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.conf(5)</span><span style=" font-family:'Ubuntu';"> руководства </span><span style=" font-family:'Ubuntu'; font-weight:600;">man</span><span style=" font-family:'Ubuntu';">. Обратите внимание, что конфигурации по умолчанию, созданные по </span><span style=" font-family:'Ubuntu'; font-weight:600;">ubuntu</span><span style=" font-family:'Ubuntu';"> шаблонам, подходят для системных контейнеров и не требуют настройки. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="выбор_файлов_и_опций_настройки"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">В</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">ыбор файлов и опций настройки</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Установка контейнера управляется параметрами настроек LXC. Параметры могут быть указаны в нескольких местах: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В процессе создания контейнера можно указать конфигурационный файл. Однако шаблоны создания часто вставляют собственные опции настройки, поэтому на данном этапе мы обычно определяем только опции настройки сети. Другие настройки лучше изменять редактированием конфигурационного файла после создания контейнера. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файл <span style=" font-weight:600;">/var/lib/lxc/CN/config</span>, используемый по умолчанию при запуске контейнера. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc-start</span> воспринимает альтернативный файл настроек с помощью параметра <span style=" font-weight:600; font-style:italic;">-f filename</span>. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Отдельные переменные настроек могут быть переопределены в команде <span style=" font-weight:600;">lxc-start</span> с использованием параметра <span style=" font-weight:600; font-style:italic;">-s key=value</span>. В общем случае лучше редактировать конфигурационный файл. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="настройка_сети"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Н</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">астройка сети</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Настройки сети в LXC контейнерах очень гибкие. Они переключаются </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.network.type</span><span style=" font-family:'Ubuntu';"> записями в файле настроек. Если таких записей нет, то контейнер будет разделять сетевой стек основной системы. Сервисы и соединения, запущенные в контейнере, будут использовать IP адрес основной системы. Если хотя бы одна запись </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.network.type</span><span style=" font-family:'Ubuntu';"> присутствует, то контейнер получит частный (уровня 2) сетевой стек. Он будет иметь собственные сетевые интерфейсы и правила firewall. Существует несколько опций для </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.network.type</span><span style=" font-family:'Ubuntu';">: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.type=empty</span>: Контейнер не будет иметь других сетевых интерфейсов, кроме loopback. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.type=veth</span>: Это выбор по умолчанию, когда используются шаблоны <span style=" font-weight:600;">ubuntu</span> или <span style=" font-weight:600;">ubuntu-cloud</span>, и в этом случае создается <span style=" font-weight:600;">veth</span> сетевой туннель. Один конец этого туннеля становится сетевым интерфейсом внутри контейнера, другой подключается к интерфейсу моста основной системы. Любое количество таких туннелей может быть создано добавлением записей <span style=" font-weight:600;">lxc.network.type=veth</span> в конфигурационный файл. Мост, к которому будут подсоединяться туннели, определяется с помощью <span style=" font-weight:600;">lxc.network.link = lxcbr0</span>. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.type=phys</span>: Физический сетевой интерфейс (т.е. eth2) передается в контейнер. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Еще две опции, которые можно использовать, это </span><span style=" font-family:'Ubuntu'; font-weight:600;">vlan</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">macvlan</span><span style=" font-family:'Ubuntu';">, однако их использование более сложное и не будет здесь рассматриваться. Существует еще несколько других сетевых параметров: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.flags</span> может быть установлено только в <span style=" font-weight:600;">up</span> и требуется для проверки, что сетевой интерфейс поднят. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.hwaddr</span> определяет mac адрес для присвоения сетевой карте внутри контейнера. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.ipv4</span> и <span style=" font-weight:600;">lxc.network.ipv6</span> устанавливают соответствующие IP адреса, если они должны быть статичными. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.name</span> определяет имя для присвоения внутри контейнера. Если не определено, выбираются правильные умолчания (т.е. eth0 для первой сетевой карты). </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.network.lxcscript.up</span> определяет сценарий, который должен быть вызван после поднятия сети со стороны основной системы. Смотрите страницу <span style=" font-weight:600;">lxc.conf(5)</span> руководства <span style=" font-weight:600;">man</span> для деталей. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="настройка_групп_управления"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Н</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">астройка групп управления</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Опции </span><span style=" font-family:'Ubuntu'; font-weight:600;">cgroup</span><span style=" font-family:'Ubuntu';"> могут быть указаны с использованием записей </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.cgroup</span><span style=" font-family:'Ubuntu';">. </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.cgroup.</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">subsystem</span><span style=" font-family:'Ubuntu'; font-weight:600;">.</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">item</span><span style=" font-family:'Ubuntu'; font-weight:600;"> = </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">value</span><span style=" font-family:'Ubuntu';"> указывает LXC установить для элемента </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">item</span><span style=" font-family:'Ubuntu';"> подсистемы </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">subsystem</span><span style=" font-family:'Ubuntu';"> значение </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">value</span><span style=" font-family:'Ubuntu';">. Это возможно проще реализовать, чем просто записать значение в файл группы управления контейнера для подсистемы. Например, чтобы установить ограничение для памяти в 320M вам следует добавить </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.cgroup.memory.limit_in_bytes = 320000000 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">что заставит записать значение 320000000 в файл /sys/fs/cgroup/memory/lxc/CN/limit_in_bytes. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rootfs_mounts_и_fstab"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">R</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">ootfs, mounts и fstab</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Важной частью настройки контейнера является монтирование различных файловых систем в надлежащее место. Далее приведена часть конфигурационного файла в качестве примера для демонстрации часто используемых опций настройки: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.rootfs = /var/lib/lxc/CN/rootfs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount.entry=proc /var/lib/lxc/CN/rootfs/proc proc nodev,noexec,nosuid 0 0</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.mount = /var/lib/lxc/CN/fstab </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Первая строка говорит, что корневая файловая система контейнера уже смонтирована в /var/lib/lxc/CN/rootfs. Если файловая система является блоковым устройством (таким как логический том LVM), то вместо этого потребуется указать путь до блокового устройства. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Каждая строка </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.mount.entry</span><span style=" font-family:'Ubuntu';"> должна содержать элемент для монтирования в правильном формате </span><span style=" font-family:'Ubuntu'; font-weight:600;">fstab</span><span style=" font-family:'Ubuntu';">. Целевой каталог должен предваряться /var/lib/lxc/CN/rootfs, даже если lxc.rootfs указывает на блочное устройство. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Наконец, </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc.mount</span><span style=" font-family:'Ubuntu';"> указывает на файл в формате </span><span style=" font-family:'Ubuntu'; font-weight:600;">fstab</span><span style=" font-family:'Ubuntu';">, содержащий дополнительные элементы монтирования. Обратите внимание, что все эти записи будут смонтированы основной системой до запуска инициализации контейнера. Таким образом существует возможность связанного монтирования различных каталогов из основной системы в контейнер. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="другие_опции_настройки"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">Д</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">ругие опции настройки</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.cap.drop</span> может быть использована для предотвращения получения контейнером указанных возможностей. Например, добавление </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lxc.cap.drop = sys_admin </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Ubuntu';">предотвратит возможность монтирования файловых систем, так же как другие действия, которые требуют </span><span style=" font-family:'Ubuntu'; font-weight:600;">cap_sys_admin</span><span style=" font-family:'Ubuntu';">. Смотрите страницу </span><span style=" font-family:'Ubuntu'; font-weight:600;">capabilities(7)</span><span style=" font-family:'Ubuntu';"> руководства </span><span style=" font-family:'Ubuntu'; font-weight:600;">man</span><span style=" font-family:'Ubuntu';"> для перечня возможностей и их толкований. </span></p>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.aa_profile = lxc-CN-profile</span> определяет специальные профили Apparmor в которых запускать контейнер. Смотрите <a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#apparmor"><span style=" text-decoration: underline; color:#0000ff;">Apparmor</span></a> для дополнительной информации. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.console=/path/to/consolefile</span> определяет что консольные сообщения должны записываться в указанный файл. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.arch</span> определяет архитектуру контейнера, например, <span style=" font-weight:600;">x86</span> или <span style=" font-weight:600;">x86_64</span>. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.tty=5</span> определяет что 5 консолей (в дополнение к <span style=" font-weight:600;">/dev/console</span>) должны быть созданы. Соответственно консоли будут доступны от <span style=" font-weight:600;">/dev/tty1</span> до <span style=" font-weight:600;">/dev/tty5</span>. Шаблоны <span style=" font-weight:600;">ubuntu</span> устанавливают это значение в 4. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.pts=1024</span> определяет что контейнер должен иметь смонтированную частную (Unix98) файловую систему <span style=" font-weight:600;">devpts</span>. Если не указано, то контейнер будет разделять (иметь в совместном доступе) <span style=" font-weight:600;">/dev/pts</span> с основной системой, что редко бывает желательным. Число 1024 означает, что 1024 <span style=" font-weight:600;">pty</span> должны быть доступны в контейнере, однако это число в настоящее время игнорируется. Перед запуском инициализации контейнера, LXC (по существу) выполняет </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mount -t devpts -o newinstance devpts /dev/pts </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Ubuntu';">внутри контейнера. Важно понимать, что контейнер не может монтировать файловые системы </span><span style=" font-family:'Ubuntu'; font-weight:600;">devpts</span><span style=" font-family:'Ubuntu';"> сам по себе. Он может безопасно присоединить или переместить точки монтирования своих смонтированных </span><span style=" font-family:'Ubuntu'; font-weight:600;">/dev/pts</span><span style=" font-family:'Ubuntu';">. Но если он выполнит </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mount -t devpts devpts /dev/pts </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Ubuntu';">он перемонтирует экземпляры </span><span style=" font-family:'Ubuntu'; font-weight:600;">devpts</span><span style=" font-family:'Ubuntu';"> основной системы. Если добавлена опция монтирования newinstance, то это смонтирует новые частные (пустые) экземпляры. Ни в одном случае он не может перемонтировать экземпляры, определенные LXC. По этой причине и для предотвращения использования контейнером </span><span style=" font-family:'Ubuntu'; font-weight:600;">pty</span><span style=" font-family:'Ubuntu';"> основной системы, политика </span><span style=" font-family:'Ubuntu'; font-weight:600;">Apparmor</span><span style=" font-family:'Ubuntu';"> по умолчанию не позволяет контейнерам монтировать файловые системы </span><span style=" font-family:'Ubuntu'; font-weight:600;">devpts</span><span style=" font-family:'Ubuntu';"> после запуска инициализации контейнера. </span></p>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">lxc.devttydir</span> определяет каталог внутри /dev, в котором LXC будет создавать свои консольные устройства. Если эта опция не определена, то все <span style=" font-weight:600;">pty</span> будут монтироваться связыванием с /dev/console и /dev/ttyN. Однако изредка обновления пакетов могут пытаться слепо выполнять <span style=" font-weight:600;">rm -f</span> и затем <span style=" font-weight:600;">mknod</span> для этих устройств. Это будет приводить к сбоям (поскольку используется монтирование связыванием), что приведет к сбою установки обновлений. Когда <span style=" font-weight:600;">lxc.devttydir</span> установлен на LXC, например, то LXC будет монтировать связыванием консоли <span style=" font-weight:600;">pty</span> в <span style=" font-weight:600;">/dev/lxc/console</span> и <span style=" font-weight:600;">/dev/lxc/ttyN</span>. Это позволит обновлениям пакетов удачно устанавливаться, из-за риска последующего получения сбоя при выполнении gettys на этих консолях до следующей перезагрузки ( <img src="image1112632298.png" /> This allows the package updates to succeed, at the risk of making future gettys on those consoles fail until the next reboot). Эта проблема идеально решается с помощью пространств имен устройств. </li></ol>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="обновления_в_контейнерах_ubuntu"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">О</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">бновления в контейнерах Ubuntu</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Из-за некоторых ограничений, присутствующих в контейнерах, обновления пакетов временами могут завершаться с ошибкой. Например, установка или обновление пакета может закончиться неудачей, если не позволено создавать или открывать блочные устройства. Это часто блокирует все дальнейшие обновления, пока не разрешится данная проблема. В некоторых случаях вы можете обойти проблему, используя </span><span style=" font-family:'Ubuntu'; font-weight:600;">chroot</span><span style=" font-family:'Ubuntu';"> внутри контейнера, чтобы обойти ограничения и завершить обновления внутри chroot. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Некоторые известные специфические вещи, которые могут время от времени препятствовать обновлению пакетов, включают: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Изменения в контейнере, выполненные при создании контейнера с помощью опции <span style=" font-weight:600; font-style:italic;">--trim</span>. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Действия, выполненные <span style=" font-weight:600;">lxcguest</span>. Например, если /lib/init/fstab смонтирован связыванием с другим файлом, обновления <span style=" font-weight:600; font-style:italic;">mountall</span>, которые настаивают на замене этого файла, могут завершиться неудачей. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Перемонтированные консольные устройства с <span style=" font-weight:600;">pty</span> из основной системы могут иметь проблемы с обновлениями <span style=" font-weight:600;">udev</span>. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Политики <span style=" font-weight:600;">Apparmor</span> и ограничения <span style=" font-weight:600;">cgroup</span> для устройств могут мешать обновлениям при выполнении определенных действий. </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разрешения, сброшенные с помощью <span style=" font-weight:600;">lxc.cap.drop</span>, могут аналогично остановить обновления пакетов при выполнении определенных действий. </li></ol>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="libvirt_lxc"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">L</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">ibvirt LXC</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Libvirt</span><span style=" font-family:'Ubuntu';"> является мощным решением по управлению гипервизорами (программами управления операционными системами), с помощью которой можно администрировать виртуальные машины под </span><span style=" font-family:'Ubuntu'; font-weight:600;">Qemu</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">Xen</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">LXC</span><span style=" font-family:'Ubuntu';">, как локально так и удаленно. Драйвер </span><span style=" font-family:'Ubuntu'; font-weight:600;">libvirt LXC</span><span style=" font-family:'Ubuntu';"> - это отдельная реализация того, что мы обычно называем LXC. Некоторые отличия включают: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Конфигурация сохраняется в XML формате </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нет инструментов, облегчающих создание контейнера </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По умолчанию отсутствует консоль /dev/console </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Не поддерживается (пока) перезагрузка или полная остановка контейнеров </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="преобразование_контейнера_lxc_в_libvirt-lxc"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">реобразование контейнера LXC в libvirt-lxc</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В разделе </span><a href="https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/lxc#создание_контейнеров"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Создание контейнеров</span></a><span style=" font-family:'Ubuntu';"> показано как создавать LXC контейнеры. Если вы создали рабочий LXC контейнер таким способом, то вы можете управлять им при помощи </span><span style=" font-family:'Ubuntu'; font-weight:600;">libvirt</span><span style=" font-family:'Ubuntu';">. Загрузите xml файл в качестве примера: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">wget http://people.canonical.com/~serge/o1.xml </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Отредактируйте этот файл, заменив название контейнера и расположение корневой файловой системы. Затем вы можете зарегистрировать контейнер командой: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virsh -c lxc:/// define o1.xml </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="создание_контейнера_из_облачного_образа"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">С</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">оздание контейнера из облачного образа</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если вы предпочитаете создавать новые оригинальные контейнеры только под LXC, вы можете загрузить образ для облака ubuntu, извлечь его и указать его расположение в xml файле libvirt LXC. Например, найдем адрес образа последней ежедневной корневой сборки Ubuntu 12.04 LTS следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">url1=`ubuntu-cloudimg-query precise daily $arch --format &quot;%{url}\n&quot;`</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">url=`echo $url1 | sed -e 's/.tar.gz/-root\0/'`</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">wget $url</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">filename=`basename $url` </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Распакуем загруженный образ, например, так: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">mkdir $HOME/c1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">cd $HOME/c1</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo tar zxf $filename </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Загрузим шаблон xml: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">wget http://people.canonical.com/~serge/o1.xml </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В шаблоне заменим </span><span style=" font-family:'Ubuntu'; font-weight:600;">o1</span><span style=" font-family:'Ubuntu';"> на </span><span style=" font-family:'Ubuntu'; font-weight:600;">c1</span><span style=" font-family:'Ubuntu';"> и каталог расположения </span><span style=" font-family:'Ubuntu'; font-weight:600;">/var/lib/lxc/o1/rootfs</span><span style=" font-family:'Ubuntu';"> на </span><span style=" font-family:'Ubuntu'; font-weight:600;">$HOME/c1</span><span style=" font-family:'Ubuntu';">. Затем зарегистрируем контейнер с помощью: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virsh define o1.xml </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="взаимодействие_с_контейнерами_libvirt"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">В</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">заимодействие с контейнерами libvirt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Как мы видели, вы можете создавать libvirt-lxc контейнеры с помощью: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virsh -c lxc:/// define container.xml </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для запуска контейнера с именем </span><span style=" font-family:'Ubuntu'; font-weight:600;">container</span><span style=" font-family:'Ubuntu';"> используйте: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virsh -c lxc:/// start container </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для остановки запущенного контейнера: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virsh -c lxc:/// destroy container </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Обратите внимание, что хотя команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxc-destroy</span><span style=" font-family:'Ubuntu';"> уничтожает контейнер, команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">virsh destroy</span><span style=" font-family:'Ubuntu';"> только останавливает работающий контейнер. Для удаления регистрации контейнера используйте: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virsh -c lxc:/// undefine container </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для получения консоли работающего контейнера используйте: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">virsh -c lxc:/// console container </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для выхода из консоли нажмите комбинацию </span><span style=" font-family:'Ubuntu'; font-weight:600;">Ctrl-]</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="пакет_lxcguest"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">П</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">акет lxcguest</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В выпусках Ubuntu 11.04 (Natty) и 11.10 (Oneiric) был представлен пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcguest</span><span style=" font-family:'Ubuntu';">. Немодифицированный коревой образ не может быть безопасно загружен внутри контейнера, однако образ с установленным пакетом </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcguest</span><span style=" font-family:'Ubuntu';"> может быть загружен как контейнер на голом железе или под виртуальной машиной </span><span style=" font-family:'Ubuntu'; font-weight:600;">Xen</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">kvm</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">VMware</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Что касается сборки </span><span style=" font-family:'Ubuntu'; font-weight:600;">12.04 LTS</span><span style=" font-family:'Ubuntu';">, функции, выполнявшиеся ранее пакетом </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcguest</span><span style=" font-family:'Ubuntu';">, были погружены пакеты ядра, а пакет </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcguest</span><span style=" font-family:'Ubuntu';"> был удален. Как результат, оригинальный образ </span><span style=" font-family:'Ubuntu'; font-weight:600;">12.04 LTS</span><span style=" font-family:'Ubuntu';"> без изменений может быть загружен в качестве контейнера как на голом железе, так и под виртуальными машинами </span><span style=" font-family:'Ubuntu'; font-weight:600;">Xen</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-weight:600;">kvm</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">VMware</span><span style=" font-family:'Ubuntu';">. Использование более ранних выпусков все еще требует использование пакета </span><span style=" font-family:'Ubuntu'; font-weight:600;">lxcguest </span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="безопасность"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Б</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">езопасность</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Пространство имен сопоставляет идентификаторы с ресурсами. Чтобы не предоставлять доступ контейнерам к любым идентификаторам (id) , указывающим на ресурсы, ресурсы должны быть защищены. Это является основой некоторой безопасности, предоставляемой пользователям контейнеров. Например, пространство имен IPC (взаимодействия между процессами) полностью изолировано. Однако другие пространства имен имеют различные уязвимости, которые позволяют получать неправильно предоставленные привилегии из одного контейнера в другой или в основную систему. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">По умолчанию LXC контейнеры запускаются под управлением политики Apparmor для ограничения некоторых действий. Несмотря на то, что более строгая безопасность является задачей следующих редакций, в 12.04 LTS задачей политики Apparmor является не прекращение злонамеренных действий, а предупреждения случайных повреждений основной системы из гостевой. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Смотрите </span><a href="http://wiki.ubuntu.com/LxcSecurity"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">LxcSecurity wiki</span></a><span style=" font-family:'Ubuntu';"> страницу для дополнительной актуальной информации. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="используемые_системные_вызовы"></a><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">И</span><span style=" font-family:'Ubuntu'; font-size:medium; font-weight:600;">спользуемые системные вызовы</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Возможность совместного использования ядра системы контейнерами является базовой особенностью. Поэтому, если ядро содержит некоторые потенциально опасные вызовы, контейнеры также могут их использовать. Как только контейнер сможет контролировать ядро системы, он сможет полностью управлять любыми ресурсами, доступными основной системе. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ссылки"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">С</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">сылки</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Статья в DeveloperWorks [[https://www.ibm.com/developerworks/linux/library/l-lxc-containers/|LXC: Linux container tools]] является введением в использование контейнеров.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ [[http://www.ibm.com/developerworks/linux/library/l-lxc-security/index.html|The Secure Containers Cookbook]] демонстрирует использование модулей безопасности с целью сделать контейнеры более безопасными.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Страницы руководств могут быть найдены по данным ссылкам:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  ~~ [[http://manpages.ubuntu.com/manpages/en/man7/capabilities.7.html|capabilities]].</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  ~~ [[http://manpages.ubuntu.com/manpages/en/man5/lxc.conf.5.html|lxc.conf]].</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Основное развитие проекта LXC на [[http://lxc.sf.net/|Sourceforge]].</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Проблемы безопасности приведены и обсуждаются на странице [[http://wiki.ubuntu.com/LxcSecurity|LxcSecurity wiki]].</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Для дополнительной информации по пространствам имен в Linux смотрите: [[http://dl.acm.org/citation.cfm?id=1400097.1400109&amp;coll=DL&amp;dl=GUIDE&amp;CFID=133158545&amp;CFTOKEN=80778967|S.Bhattiprolu, E.W.Biederman, S.E.Hallyn, and D.Lezcano. Virtual Servers and Checkpoint/Restart in Mainstream Linux. SIGOPS Operating Systems Review, 42(5), 2008]].</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">~~ Стефан Грабер (Stéphane Graber), в предверии выхода 20 февраля 2014 года релиза LXC 1.0, опубликовал цикл статей о Linux Containers. [[https://www.stgraber.org/2013/12/20/lxc-1-0-blog-post-series/|LXC 1.0: Blog post series]] ([[http://vasilisc.com/lxc-1-0-blog-post-series|перевод]]).</span></p>
<hr /></body></html>