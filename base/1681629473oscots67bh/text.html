<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><img src="image1610645635.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="kode-responsive-navigation"></a><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#000000; background-color:#333333;">O</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#000000; background-color:#333333;">pen Menu</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/course"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Курсы</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://roboton-online.ru/"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Онлайн-курсы</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/page/robototehnicheskie-komplekty-roboton"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Наши Роботы</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/page/robot-on-studio"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Среда программирования</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/news"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Новости</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/articles"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Статьи</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/page/contacts"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Контакты</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/register"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Регистрация</span></a></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/articles/prostaya-rabota-s-mqtt-v-openhab-2#login"><span style=" font-size:16px; font-weight:296; text-decoration: underline; color:#ffffff; background-color:transparent;">Вход</span></a></li></ul>
<p style=" margin-top:30px; margin-bottom:20px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%; background-color:#ffffff;"><a name="articlestitle"></a><span style=" font-family:'Montserrat,sans-serif'; font-size:xx-large; color:#111111;">П</span><span style=" font-family:'Montserrat,sans-serif'; font-size:xx-large; color:#111111;">ростая работа с MQTT в openHAB 2.x</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Montserrat,sans-serif'; font-size:16px; color:#2b2b2b;" style=" margin-top:10px; margin-bottom:0px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/"><span style=" font-size:16px; text-decoration: underline; color:#0000ff; background-color:transparent;">Главная</span></a><span style=" font-size:16px;">  /  </span></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:16px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/articles"><span style=" font-size:16px; text-decoration: underline; color:#0000ff; background-color:transparent;">Статьи</span></a><span style=" font-size:16px;">  / </span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px;"> </span></li>
<li style=" font-family:'Montserrat,sans-serif'; font-size:16px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:20px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><a href="https://robot-on.ru/category/umnii-dom"><span style=" font-size:16px; text-decoration: underline; color:#0000ff; background-color:transparent;">Умный дом</span></a></li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:41px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-size:11px; font-weight:600; color:#666666;">Автор статьи</span><a href="https://robot-on.ru/teacher/maksim-zakharov"><span style=" font-family:'Montserrat,sans-serif'; font-size:12px; font-weight:600; text-decoration: underline; color:#90a94c; background-color:transparent; text-transform:uppercase;">МАКСИМ ЗАХАРОВ</span></a><span style=" font-size:13px;"> </span></li>
<li style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:41px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-size:11px; font-weight:600; color:#666666;">Категория</span><a href="https://robot-on.ru/category/umnii-dom"><span style=" font-family:'Montserrat,sans-serif'; font-size:12px; font-weight:600; text-decoration: underline; color:#90a94c; background-color:transparent; text-transform:uppercase;">УМНЫЙ ДОМ</span></a><span style=" font-size:13px;"> </span></li>
<li style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;" style=" margin-top:0px; margin-bottom:0px; margin-left:21px; margin-right:41px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-size:11px; font-weight:600; color:#666666;">Опубликовано</span><span style=" font-size:12px; font-weight:600; color:#666666; text-transform:uppercase;">2019-08-26</span></li></ul>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image347431799.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Здесь вы найдёте перевод статьи &quot;</span><a href="https://www.openhab.org/blog/2018-12-16-mqtt-arrives-in-the-modern-openhab-2-x-architecture.html"><span style=" font-family:'Montserrat,sans-serif'; font-size:13px; text-decoration: underline; color:#90a94c; background-color:transparent;">MQTT Arrives in the Modern openHAB 2.x Architecture</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">&quot; с дополнительными пояснениями и примерами. </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">С выходом openHAB 2.4 обновился один из самых важных модулей для создания собственного умного дома - MQTT Binding, который отвечает за способность openHAB общаться с MQTT серверам. Модуль был поностью переписан под версию 2.x и дополнен большим количеством новых функций.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Согласно Википедии, MQTT протокол - это упрощённый сетевой протокол, работающий поверх TCP/IP, используемый для обмена сообщениями между устройствами по принципу издатель-подписчик. Он был разработан специально для общения умных устройств между собой.</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image436640145.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Принцип работы протокола похож на YouTube: датчики создают каналы на MQTT сервере и постоянно отправляют туда данные. Openhab может подключиться к MQTT серверу, подписаться на эти каналы и получать данные с датчиков. Для исполнительных устройств, например, Wi-Fi розеток, система работает наоборот. OpenHAB создает канал на MQTT сервере и отправляет туда команды типа ON/OFF, розетка подключается к серверу, подписывается на этот канал и слушает его. Когда в канал приходит новая команда - розетка выполняет её (включает или выключает реле).</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Установка и настройка сервера</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для работы по протоколу MQTT вам необходим как минимум один сервер и клиенты (умные устройства, которые будут общаться между собой). MQTT сервер называется Broker. Удобвство в том, что брокеров может быть несколько, каждый может отвечать за определенную подсистему, а openHAB может всех их объединить в один большой умный дом.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Создание собственного брокера заключается в том, что вам необходимо установить софт для работы брокера на предполагаемый сервер. Это может быть как реальный удаленный сервер, так и обычный ноутбук, миникомпьютер или даже wi-fi роутер. Главное, чтобы у этого сервера был IP адрес, к которому может подключится клиент.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">После установки и быстрой настройки вы должны получить: IP адрес и порт для подключения. По-умолчанию большинство брокеров работает через порт 1883 и поддерживает анонимное подключение клиентов. В этом случае для подключения вам даже не нужны будут логин и пароль. Позже вы можете настроить безопасное соединение и добавить подключение по логину и паролю.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Одним из самых популярных MQTT брокером является Mosquitto. В следующей статье вы можете найти подробную инструкцию как его поставить и настроить </span><a href="https://robot-on.ru/articles/ystanovka-mqtt-brokera-mosquitto-raspberry-orange-pi"><span style=" font-family:'Montserrat,sans-serif'; font-size:13px; text-decoration: underline; color:#90a94c; background-color:transparent;">Инструкция по установке и настройке на Raspberry Pi и Oragne Pi</span></a><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Также начиная с версии 2.4 в openHAB есть свой собственный MQTT брокер. Его можно найти в PaperUI в дополнениях по названию Embedded MQTT broker.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image5038463.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Устанавливаете его и брокер сразу готов к работе. Вы можете зайти в его настройки в PaperUI и выбрать дополнительные опции, например, защищённое соединение или подключение по логину и паролю. Но для первых шагов работы с MQTT хватит стандартных настроек.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image1446520567.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В результате настройки на том же ip адресе что и ваш openHAB будет доступен еще и MQTT брокер, к которому можно подключиться без пароля.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Предположим, что вам удалось настроить MQTT брокер одим из способов, которые описаны выше. В результате у вас есть сервер с ip адресом, например, 192.168.1.60, который разрешает подключения без пароля. Теперь попробуем разобраться как клиенты могут с ним работать.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Работа с MQTT в openHAB 1.x</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В openHAB версии 1.x работа с MQTT происходила следующим образом: сначала ставился MQTT Binding, потом в текстовом файле добавлялись данные для подключения к брокеру (ip адрес, порт, логин, пароль). После этого в файле с элементами системы (*.items) мы прописывали какое устройство соответсвует какому каналу на MQTT брокере.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Например, для того, чтобы получить данные с датчика температуры мы могли добавить элемент:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">Number Out_temp &quot;Температура на улице [%.1f °C]&quot;  {mqtt=&quot;&lt;[mainbroker:/easywolf1/dallas1/temperature:state:default]&quot;} </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Out_temp - системное название элемента, mqtt - работает через байндинг для MQTT протокола, mainbroker - подключаемся к брокеру с название mainbroker, подписываемся на канал /easywolf1/dallas1/temperature и смотрим какие данные на него приходят. Датчик делает новый замер, передает данные в канал /easywolf1/dallas1/temperature, openHAB сразу получает эти данные и отображает в системе.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для добавления wi-fi розетки можно было использовать следующий код элемента:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">Switch  SONOFF5 &quot;Wi-Fi розетка&quot; { mqtt=&quot;&gt;[mainbroker:sonoffnode5/gpio/12:command:ON:1],&gt;[mainbroker:sonoffnode5/gpio/12:command:OFF:0]&quot; }</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В этом коде openhab подключается к брокеру mainbroker и в канал sonoffnode5/gpio/12 отправляет команды 1 или 0, которые соответствуют включению и выключению.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Проблема первой версии MQTT байндинга была в том, что всю настройку работы с MQTT приходилось выполнять в текстовых файлах.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Работа с MQTT в openHAB 2.4</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В openHAB 2.4 впервые появился новый MQTT Binding, который позволяет делать все настройки MQTT через графический интерфейс Paper UI. Для начала установите MQTT Binding, для этого зайдите в Add-ons, перейдите во вкладку Binding и найдите там &quot;MQTT Binding&quot;. Нажмите кнопку INSTALL.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image1849769351.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Новый модуль может параллельно работать со старым &quot;openHAB 1.x binding&quot;, но разработчики не рекомендуют пользоваться одновременно сразу несколькими модулями.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Добавляем MQTT брокер</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Обратите внимание на то, что для работы с MQTT протоколом вам необходимо сначала настроить MQTT сервер, который обычно не входит в MQTT binding (мы описали процесс установки выше). Настройка MQTT байндинга - это только настройка подключения openHAB к уже существующему MQTT серверу. </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Первое, что вам необходимо сделать для работы с MQTT брокером, это настроить подключение опенхаба к нему. Для этого необходимо перейти в раздел Configuration -&gt; Things и добавить новое устройство иконкой &quot;+&quot;. В списке возможных устройств вы выбираете MQTT Binding. Скорее всего никакие устройства не найдутся, поэтому нажимаете &quot;ADD MANUALLY&quot;. В появившемся списке выбираете &quot;MQTT Broker&quot;. В форме вводите название брокера, Thing ID и IP адрес сервера MQTT. Дальше с этим брокером мы будем работать по Thing ID.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image1955665284.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В зависимости от конфигураций на вашем MQTT сервере при подключении может использоваться много разных параметров. Например, кроме IP адреса вам может понадобиться логин и пароль. Переключатель &quot;Secure connection&quot; выбирает по какому порту вы подключаетесь к брокеру. Все эти параметры можно посмотреть нажав &quot;SHOW MORE&quot;. В нашем примере мы использовали подключение без пароля, поэтому ничего дополнительно указывать не надо.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Если подключение прошло успешно, то в списке ваших устройств Configuration -&gt; Things появится подключение к MQTT брокеру со статусом &quot;ONLINE&quot;.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image601582265.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Теперь когда ваш openHAB может подключиться к MQTT серверу пора добавить новые элементы в систему.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Добавление MQTT Generic Things</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">После того как вы добавили MQTT брокер вы можете работать с каналами, которые у него есть. Многие разработчики используют свои обозначения для названий каналов и команд, например, для включения устройств может быть </span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; font-style:italic; color:#2b2b2b;">ON</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">, </span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; font-style:italic; color:#2b2b2b;">1</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> или </span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; font-style:italic; color:#2b2b2b;">true, </span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">поэтому достаточно трудно сделать автоматическое распознавание каналов и вам необходимо будет добавлять их вручную.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Если в первой версии модуля сразу происходила привязка определенного канала к элементу системы item, то в новой версии мы создаем устройство (Thing), которое может содержать в себе несколько каналов. И уже эти каналы привязываются к элементами системы (items). Расскажем об этом подробнее.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Предположим, у вас в комнате есть датчик температуры, который отправляет данные в канал /easywolf1/dallas1/temperature каждую минуту, а также есть wi-fi розетка Sonoff, которая ждет команды на канале sonoffnode5/gpio/12. Вы можете объединить их в одно устройство под название &quot;Кабинет&quot;. Для этого переходите в Configuration -&gt; Things, добавляете новое устройство через MQTT Binding, но в списке выбираете не Broker, а Generic MQTT Thing. Вписываете название в поле &quot;Name&quot; и в поле &quot;Bridge Selection&quot; выбираете брокер, который вы добавили в предыдущем шаге:</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image819563679.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Новое MQTT устройство появится в списке устройств в Configuration -&gt; Things. Нажмите на него и откроется окно добавления каналов.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image1411736611.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Нажмите на иконку &quot;+&quot; рядом с заголовком &quot;Channels&quot;. Для датчика температуры добавляете канал типа &quot;Number value&quot; с &quot;/easywolf1/dallas1/temperature&quot; в &quot;MQTT state topic&quot;.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image639604800.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Теперь добавляете канал типа &quot;ON/OFF Switch&quot; со значением &quot;sonoffnode5/gpio/12&quot; в поле &quot;MQTT command topic&quot;, а также &quot;1&quot; и &quot;0&quot; в полях &quot;ON&quot; и &quot;OFF&quot;.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image1112071422.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">При добавлении каналов вы можете использовать следующие типы.</span></p>
<table border="0" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px;" cellspacing="2" cellpadding="0" bgcolor="transparent"><thead>
<tr>
<td style=" vertical-align:bottom; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; font-weight:600; color:#2b2b2b;">Тип</span></p></td>
<td style=" vertical-align:bottom; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; font-weight:600; color:#2b2b2b;">Параметры</span></p></td>
<td style=" vertical-align:bottom; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; font-weight:600; color:#2b2b2b;">Описание</span></p></td></tr></thead>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">String</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> </span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Показывает текст, полученный в топике или отправленный в топик</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Number</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">min, max</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Получает и отправляет данные в виде цифр в определенный топик</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Percentage</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">min, max, step</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Позволяет передавать/получать значения в процентах, например, для диммеров</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Contact</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> </span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Топик для устройст со статусом Открыто/Закрыто</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Switch</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">custom on/off</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Позволяет отправлять значения Включить/Выключить в топик устройства</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Color RGB/HSB</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">custom on/off</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Передает данные о цвете в RGB / HSB формате</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">DateTime</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> </span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Канал для передачи данных в формате date/time</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Image</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> </span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для передачи картинок в формате (bmp,jpg,png)</span></p></td></tr>
<tr>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Location</span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> </span></p></td>
<td style=" vertical-align:top; padding-left:7; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:2.5%;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Позволяет передавать геоданные о местоположении</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Попробуйте добавить в систему пару MQTT каналов, с которыми работают ваши умные устройства.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Что дальше делать с этими каналами?</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">После того как вы добавили элемент MQTT Thing в openHAB и добавили в него несколько каналов необходимо привязать их к элементам items. Вся последующая работа опенхаба с вашим умным устройством будет происходить по именам этих items.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Если у вас в настройках Configuration-&gt;System в блоке Item Linking включена функция Simple_mode, то элементы items будут добавляться автоматически. Если вы добавили новый канал в MQTT Thing, например, mqtt:topic:wolfmother_broker_generic:ESOCKET1, то для него создаcтся элемента item c названием mqtt_topic_wolfmother_broker_generic_ESOCKET1. Этот элемент будет отображаться на главной странице Paper UI.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В нашем случае эта функция была включена, поэтому в Paper UI на главной странице &quot;Control&quot; появится новое устройство с параметрами &quot;Температура&quot; и &quot;Свет&quot;. Обратите внимание на то, что значение параметра &quot;Температура&quot; обновится только тогда, когда с датчика придут новые данные. Данные, которые приходили в систему до добавления этого канала, не сохранены. А вот выключатель света должен заработать сразу.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><img src="image1361667536.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Для более тонкой настройки системы вы можете отключить функцию Simple_mode. В этом случае вам придется добавлять элементы item вручную через текстовый конфигурационный файл. В openHAB 2 все настройки хранятся в специальный папке, например, в линукс системах это /etc/openhab2/. Находите в этой папке папку items и создаете в ней новый файл с расшинерием *.items, например, demo.items. Добавляем в него следующие строчки для элементов с именами Out_temp и ESOCKET1:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">Number Out_temp &quot;На улице [%.1f °C]&quot; { channel=&quot;mqtt:topic:wolfmother_broker_generic:temperature&quot; }</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333;"><br />Switch ESOCKET1 &quot;Wi-fi розетка&quot; { channel=&quot;mqtt:topic:wolfmother_broker_generic:ESOCKET1&quot; }</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Сохраняем. Эти элементы также должны появиться на главном экране в PaperUI. В отличии от автоматического добавления, во время ручной настройки элементов item мы можем указать дополнительные параметры, например, задать иконку элемента, добавить его в группу устройств, добавить лэйбл с дополнительной информацией, добавить данные для подключения в умному дому Apple и Google. Также, если у вас в системе много элементов, то через файл их править намного быстрее.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Это все что вам нужно сделать, чтобы ваше умное устройство на MQTT появилось в системе openHAB. Теперь вы можете получать данные с датчиков и управлять wi-fi розетками. Что ещё можно сделать с этими данными?</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Использование items графических интерфейсах</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Элементы items являются одними из основных элементов в openHAB. Вы связали параметры умных устройств с элементами items - Out_temp и ESOCKET1, дальше вся работа будет происходить только с ними. Теперь вас больше не волнует по какому протоколу и как подключено устройство.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В openHAB есть несколько способов отобразить элементы умного дома в графическом виде - отображение с помощью файлов sitemaps (в Classic и Basic UI) или в HABPanel. Отображение через sitemaps позволяет отличается очень быстрой и стабильной работой, эти отображения вы можете использовать в приложении на телефоне для удаленного подключения к системе, также их легко переносить из системы в систему. Из минусов: их надо прописывать в текстовых файлах. Добавление файлов в HABPanel является более простым, все можно сделать прямо в графическом интерфейсе, просто добавляя и перетаскивая элементы. </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Добавление с Sitemap</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Добавление в HabAdmin</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Использование Items в правилах</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">OpenHAB имеет большой функционал для автоматизации умного дома. Мы можем создавать правила для разных устройств и сценариев. Все что нам для этого необходимо - знать названия айтемой устройств. </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Также в правилах можно использовать MQTT Actions в правилах</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Как перевести item с MQTT Binding 1.x на 2.x?</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Если вы обновите старую систему openHAB до версии 2.4 или новее, то скорее всего у вас перестанут работать все MQTT items, которые были настроены ранее. Чтобы это поправить вам необходимо установить новый MQTT binding, добавить свой MQTT брокер через веб интерфейс, добавить MQTT Thing, добавить в него все  каналы, с которыми вы работали раньше. А теперь в старых файлах item просто пропишите работу напрямую с этими каналами. Если раньше вы писали байндинг, канал, команду, то теперь просто прописываем название канала, который был добавлен через PaperUI.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Было:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">Number Out_temp &quot;Температура на улице [%.1f °C]&quot; {mqtt=&quot;&lt;[mainbroker:/easywolf1/dallas1/temperature:state:default]&quot;} </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Стало:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">Number Out_temp &quot;Температура на улице [%.1f °C]&quot; { channel=&quot;mqtt:topic:wolfmother_broker_generic:temperature&quot; }</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">В файлах sitemaps и rules никаких изменений делать не надо. Теперь все ваши старые MQTT айтемы снова заработают.</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Ручная настройка подключения к брокеру</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Если вы не доверяете веб интерфейсу и хотите как и в первой версии MQTT байндинга настраивать подключения к брокерам вручную в конфигурационном файле, то можете это сделать следующим образом. В папку настроек /things/ добавьте файл broker.things, в нем укажите необходимые вам брокеры в следующем виде:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">mqtt:broker:mySecureBroker [ host=&quot;192.168.0.41&quot;, secure=true, certificatepin=true, publickeypin=true ]</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333;"><br />mqtt:broker:myUnsecureBroker [ host=&quot;192.168.0.42&quot;, secure=false ]<br />mqtt:broker:myAuthentificatedBroker [ host=&quot;192.168.0.43&quot;,secure=true, username=&quot;user&quot;, password=&quot;password&quot; ]<br />mqtt:broker:pinToPublicKey [ host=&quot;192.168.0.44&quot;, secure=true , publickeypin=true, publickey=&quot;SHA-256:9a6f30e67ae9723579da2575c35daf7da3b370b04ac0bde031f5e1f5e4617eb8&quot; ]</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Тут представлены разные по уровню безопасности подключения к MQTT брокерам.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Также в файлах .things вы можете создавать Generic MQTT Thing устройства и прописывать им каналы для связи с умными устройствами:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333; background-color:#f5f5f5;">Bridge mqtt:broker:myUnsecureBroker [ host=&quot;192.168.0.42&quot;, secure=false ]</span><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#333333;"><br />{<br />    Thing mqtt:topic:mything {<br />    Channels:<br />        Type switch : lamp &quot;Kitchen Lamp&quot; [ stateTopic=&quot;lamp/enabled&quot;, commandTopic=&quot;lamp/enabled/set&quot; ]<br />        Type switch : fancylamp &quot;Fancy Lamp&quot; [ stateTopic=&quot;fancy/lamp/state&quot;, commandTopic=&quot;fancy/lamp/command&quot;, on=&quot;i-am-on&quot;, off=&quot;i-am-off&quot; ]<br />        Type string : alarmpanel &quot;Alarm system&quot; [ stateTopic=&quot;alarm/panel/state&quot;, commandTopic=&quot;alarm/panel/set&quot;, allowedStates=&quot;ARMED_HOME,ARMED_AWAY,UNARMED&quot; ]<br />        Type color : lampcolor &quot;Kitchen Lamp color&quot; [ stateTopic=&quot;lamp/color&quot;, commandTopic=&quot;lamp/color/set&quot;, rgb=true ]<br />        Type dimmer : blind &quot;Blind&quot; [ stateTopic=&quot;blind/state&quot;, commandTopic=&quot;blind/set&quot;, min=0, max=5, step=1 ]<br />    }<br />}</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:1.2%;"><span style=" font-family:'Montserrat,sans-serif'; font-size:x-large; color:#111111;">Итог</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Давайте ещё раз рассмотрим как работать с MQTT устройствами через openHAB:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">1. Настраиваем MQTT сервер (брокер), к которому будут подключаться все клиенты, включая openHAB;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">2. Создаём умное устройство, которое подключается к MQTT серверу и передает данные с датчиков в каналы данных или подписывается на управляющие каналы и ждет команд;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">3. В openHAB мы ставим новый MQTT binding, который позволяет опенхабу подключаться к брокеру как клиенту;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">4. В openHAB добавляем новое подключение к брокеру;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">5. Добавляем новое MQTT Generic устройство, которое использует это подключение;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">6. В устройство добавляем MQTT каналы, которые используют наши умные девайсы;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">7. Для каждого канала создаем элемент item. Теперь вся работа с умными девайсами в системе происходит через имена этих айтемов;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">8. Добалвяем items в графические интерфейсы и используем в правилах!</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px; line-height:24px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;">Мы надеемся, что вам удалось разобраться как работать с MQTT протоколом!</span></p>
<p style=" margin-top:20px; margin-bottom:10px; margin-left:21px; margin-right:21px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,sans-serif'; font-size:13px; color:#2b2b2b;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>