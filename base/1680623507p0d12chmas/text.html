<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.2308%;"><span style=" font-family:'inherit'; font-size:12pt; font-weight:696; color:#333333;">Установка Mosquitto брокера MQTT на Orange Pi Zero с UBUNTU</span></p>
<p style=" margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.2308%;"><span style=" font-family:'inherit'; font-size:12pt; font-weight:696; color:#333333;"> 16.04.2</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.2308%; font-family:'inherit'; font-size:xx-large; font-weight:696; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">В основе современных проектов умного дома и интернета вещей все чаще используется протокол MQTT  (Message Queuing Telemetry Transport), имеющий на сегодня несколько вариантов реализации сервера, так называемого брокера. Из всех вариантов я решил остановить свой выбор на MQTT брокере Mosquitto, устанавливать его будем на Orange Pi Zero с Armbian UBUNTU Xenial 16.04.2</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more-603"></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;">В</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">се о чём пойдет речь ниже написано по мотивам статьи Виктора Бруцкого и Александра Суслова размещенной в сообществе разработчиков </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">esp8266.ru</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">: </span><a href="https://esp8266.ru/orange-pi-mosquitto-websockets"><span style=" font-family:'inherit'; font-size:19px; text-decoration: underline; color:#333333;">https://esp8266.ru/orange-pi-mosquitto-websockets</span></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;">. Описанный им процесс установки </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">MQTT брокера</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> отличается тем, что </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> компилируется из исходного кода, а не устанавливается из реппозитария, и отличается поддержкой </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">WebSockets</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> для управления устройствами через </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">IoT Manager</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> и прочие приложения требующие WebSockets.</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Сразу отвечу на очевидный вопрос: «Для чего нужен </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">собственный MQTT брокер </span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">когда уже есть несколько бесплатных облачных сервисов?». В первую очередь </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Mosquitto MQTT брокер</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> нужен для тестирования проектов в локальной сети, а так же неограниченная возможность изучать и экспериментировать. Начнём!</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Установку </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Mosquitto MQTT брокер</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> на </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Ubuntu 16.04.2</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> будем производить используя недавно приобретенную для подобных экспериментов плату </span><a href="http://am-diary.ru/ustanovka-armbian-ubuntu-xenial-16-04-2-na-orange-pi-zero/"><span style=" font-family:'inherit'; font-size:19px; font-weight:696; text-decoration: underline; color:#333333;">Orange Pi Zero</span></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">В прошлой публикации на </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Orange Pi</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> была установлена ОС </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Armbian</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> (UBUNTU Xenial 16.04.2), система не настраивалась и на сегодня осталась в первозданном виде, поэтому перед установкой </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">MQTT брокера</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> выполним несколько стандартных процедур. Для работы с устройством будем пользоваться SSH-клиентом PUTTY.</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">1 Войдем в систему и обновим кэш репозитариев:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-58a8bfe4e695f145251315-1"></a><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">s</span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">udo apt update</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">затем обновим пакеты</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo apt up</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">grade</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">2 Для удобства работы с файлами установим Midnight Commander:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-58a8bfe4e6965779802378-1"></a><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">s</span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">udo apt install mc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="admitad_shuffle27923178"></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">3 До устанавливаем необходимые библиотеки и утилиты:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo apt -y install libssl-dev cmake libc-ares-dev uuid-dev daemon</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">4 Запускаем Midnight Commander (</span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; font-style:italic; color:#333333;">sudo mc</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">) и переходим в домашний каталог (можно ввести команду </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; font-style:italic; color:#333333;">cd ~</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> из консоли). Создадим папку с любым именем, например </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; font-style:italic; color:#333333;">vrem</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> и зайдем в нее.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:0%;"><a name="mailru_ad_953975_1680622978912"></a><a href="https://t.mail.ru/redir/AADc9QEZcAP9DCI_fbYcqapEHV-XxglafDQnlNNEAK0yIwijcL6WT8SrMoSPRIhmx_4jUNP_ujDs4-XgmLSQ-eeQJCTJJT6xKlDArm1LJr6sqZoJsc4RaG4elDc_fuMjweaI_DeAqP6nE3VW4qovko-XO80gsho0tTtddpYIYE-Te7R9K9_iZECfBwAAULYQMGco8p0pAfMUXN0U-VOfoZHiW75-NWIrsP2iXTaY7UpEQ2ibeBxIUMTjTt0SAjKcoQg6c1bjIIMmgCQobs2UUABWls9EW0Po90w27Dp_9My-lIRhfCcLNBmd4kLrW8iaCO1dKmmnsnz0sHRGuMs9X3sF3ROGkL4iWryRSo68xeImbheHq7ngfmveB2_RHE5g13dTRzR3-MH34HMX_lVw21lZ2R5_iEXCIMca7_n7jF3zGXmyTr4mDail0w7chFapqZIAQRpuX0nbj6Zm0gUONq7AvmuXlfSb0m8ZyF-em5W5rgnIB7Rl30ZcVr0GVQPmeY60ZqnZK4oSvP8aGu6i-2F-m3-ldATl-vr2re62ciyrKAw_QKL9N3BBqzuF0UtJHck3XDxD0cvcSO0dvU82VG05FCD2BuGXRMP0XYFvKHcGMhB0arYj0PDxaV8xkt-ADNy6JRuGLOwh3rMaHupvxwjSIxVulfHtt2FVfY1c3Tza2jJNwmMuRnxjLcRWd6OHgTeuCxcZBSnGItJHtGwEOac_Cj_zvYYoxhGgdUbfzLSsUskfsA-JKaubKrCT3dJRlZoekJsCHsizeVhzrys1sGi11nPQK7CB-9AVHjli-rtle2zb6J7ffJanxHkuLJGAQczp3gwkxqF1urDr97FdL3LSe5BeXX0oSyGEGDhTvMuEFf9lf-3trAAevMmZaS8V1-nrwrw1V-hC4-LsiACAQky3A0bY-GMIdtbxaIHPjNnQOlGHFgAnTenRwakAsvWNhRFbJJuk-afhbTUfUQhh9XBC4h4J6XHQPrk2megcpmQ_cmyL621fhr5csCNk9RZGyh-Ueve6sScDa8Tm_qtgpGarLz7O6UiKmYsQbZIvqM0D1JzM43YIRkbzC5TLnyS0aFVH7VYMpIx_KqZW1QLZEKzh9_4s1_DHGwSFVOxfrHatbTQwV5smMhA5N70EUxGuTlofZoblHKEoYZ_Py9kuQliG97xWdM0NcSz9FQlcy8bkqzW-YlpUaGYkUyBvhRLs5MkVuNy6L2bgAz1qQsZwnTyb8s4hv0q6j65KuBrSjLvUyTnyNUprOztjVCtGGyFLY14Lt--WJ0Ygd1TuRZzmxKpSa_JV17uAa30gMp0018VIqcqVZUFtPgnNBm-ilBbCh__2eh4uYZfI07m9VZMjEQcgif2VssSyii_9kDszA6BO_klNvcVsTUQQ107SrKDGKjtHTvB1mArumGUixi0W5xx2fNqs0noW2tCNmGZ-d3RIfgPX2-yNURT6cuBkNvt7l7UEBSEyBvn-RZqidqT3HSIc4JGAu5tJzp9VugtI-_LT8aC9PurBgoMhHTBmGrOqXKhJKcT0HT0Z5M0r2oE6Kg8ildEIIIBcfBRd1GHLxpj8YmN6DVjb2Fp4yVkctbFr9zdB_20CJlMaaFU2g7xwRn_ymlHlGQ9V_N4jLOGWyPBcevrPmyj5tulIgqbfKQbuP6JkSM6R_YHKT7Jx1d-WMwAyi_WN10zwVrSyzsXd7ptXPT604iX59EMXOMxj6PG4j8dV5MsLxCTYsw7b64-w_NRs-wAiJddGB2D3Goe0hKBVrXwKW_GGsWzOZ4hnvNFO1OTohSOtLyBgEP2BDHOZMd2ZB5UzoGHWy2N5iwSkkearLPdHk3dtocqVnCRQWpa2-BSX-opQH-s9kYB8JJcjfXuApUa74uO4VK5AQSGuhf8vcQiZa8ZePXJbHIjRMgOAlHad-Vr33ZwvoYIGtbC2Q6LFGRMJar7TTfmYzKY8p7Gc0cHE9DYKdJW3ZGsP_Qk3BosbGhb8doKsen9ZkWi0vVgJ8K6wWdAvfPin1jNZaDG2yqE-tT9MRkFHbMOfI7M-wFwltXxhc9I2qzKPJpogB1XZT8zv-By5-85H5ViutPaDfGlkrw0xxn6vemTvdb3NHwIMM7L8VtyY59M4PDdedam1TO8GoxE1xTAcOKzBOW_u2dfBBLVbDXS-Zwme_x77MQ58r36oSxhCgU_lVqmnL0oqWUqWDdpwLoBoWcfT4sZFWDBADUKT6GUYxwbF1z4a7204Q6X-KLiraT2o3uzhZVYNn7ZZptqRJJJHqC6KaW7WlKuPPTAs_E0Pvbs60nrIZAnh0V47UaHuvt3knsz2BncKjPlKFdKJo3j1yMXt-Se9gy0AtY7_exnhBBnK24FRkMrDqhLbR6jo1Jr3eoqukYXGxiKhyCVcl1mskuT-SpnxzfGOjzU-hduBJ8zjpo-9sCcf4ieG11MlS4b2uRJwSyXn4zBBawDzvYA06kHLQpj8mlUkQgUbhnJJ_jg1AC_QmjTUKkraejoecqdwz2FFLmU-Ua_srkvsMJARYqWoxt94J0s3vvyELtURdyB-39nu2hanm0ww7RQ29smrnQ4A4278uk-ISDzQlNrcwRYv1ceotrKd9awguHizzcIiD_YInQJ297ohCYZBHHsYRNW89d3Jf5Nu0JtA2WzzKDZZD_GOpvXW6JHyBZQ5OBe_8tUk6le7EbOzLzWEcMwLgdwRviPo9_4MpQEBXoo3zXxJa4TIH3MHw9zulYQLRv3z13k4HpPeygmPfTiUk2ZJn_30Hv4d5gZiTbYIlIWu05U:2VtzquyqEF8"><span style=" font-family:'inherit'; font-size:10px; font-weight:496; text-decoration: underline; color:#ffffff; background-color:rgba(0,0,0,0.239216);">Р</span></a><span style=" font-family:'inherit'; font-size:10px; font-weight:496; color:#ffffff; background-color:rgba(0,0,0,0.239216);">еклама</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1670034558.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="mailru_ad_595528_1680622978704"></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;">З</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">агрузим последнюю версию </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">libwebsockets</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> (на момент написания этой статьи это версия </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">2.0.2</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">wget </span><a href="https://libwebsockets.org/git/libwebsockets/snapshot/libwebsockets-2.0.2.tar.gz"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; text-decoration: underline; color:#333333;">https://libwebsockets.org/git/libwebsockets/snapshot/libwebsockets-2.0.2.tar.gz</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">и распакуем её</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">tar zxf libwebsockets-2.0.2.tar.gz</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">cd libwebsockets-2.0.2/cmake</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">5 Соберём из исходников и инсталлируем </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">libwebsockets</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo cmake ..</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo make install</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Процесс занимает около 5-10 минут. По готовности создадим необходимые связи и сформируем кэш динамических библиотек с помощью утилиты ldconfig:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo ldconfig</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">6 Приступим к установке </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> (актуальная версия на момент написания статьи </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">1.4.10</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">cd ../..</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">wget </span><a href="http://mosquitto.org/files/source/mosquitto-1.4.14.tar.gz"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; text-decoration: underline; color:#333333;">http://mosquitto.org/files/source/mosquitto-1.4.14.tar.gz</span></a></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">tar zxf mosquitto-1.4.14.tar.gz</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">cd mosquitto-1.4.14</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="medium-r-267774"></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">7 Вносим правки в файл </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">config.mk</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> (ищем строку </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">WITH_WEBSOCKETS:=no</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">  заменяем на </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">WITH_WEBSOCKETS:=yes</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">) или делаем это командой в консоли, а затем собираем пакет:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sed -i — ‘s/WITH_WEBSOCKETS:=no/WITH_WEBSOCKETS:=yes/g’ config.mk</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo make</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo make install</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Процесс сборки на моем железе занял около 7-8 минут.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">В случае если процесс останавливается с похожими ошибками:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">«…/mosquitto-1.4.1 $ make</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">set -e; for d in lib client src; do make -C ${d}; done</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">make[1]: Entering directory ‘/home/pi/projects/leoMatthias/software/Mosquitto_MQTT/mosquitto-1.4.1/lib’</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">cc -Wall -ggdb -O2 -I. -I.. -I../lib -fPIC -DWITH_TLS -DWITH_TLS_PSK -DWITH_THREADING -DWITH_SOCKS -DWITH_SRV -c mosquitto.c -o mosquitto.o</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">In file included from mosquitto.c:33:0:</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">./mosquitto_internal.h:40:20: fatal error: ares.h: No such file or directory</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">compilation terminated.</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">Makefile:51: recipe for target ‘mosquitto.o’ failed</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">make[1]: *** [mosquitto.o] Error 1</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">make[1]: Leaving directory ‘/home/pi/projects/leoMatthias/software/Mosquitto_MQTT/mosquitto-1.4.1/lib’</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">Makefile:21: recipe for target ‘mosquitto’ failed</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">make: *** [mosquitto] Error 2″</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="medium-r-558633"></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Меняем в файле </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">config.mk</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> параметр WITH_SRV=yes на no и сохраняем его.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="admitad_shuffle74513179"></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">8 Создадим для Mosquitto конфигурационный файл и добавим пользователя под которым будет запускаться наш MQTT брокер:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo cp mosquitto.conf /etc/mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">echo «listener 1883» &gt;&gt; /etc/mosquitto/mosquitto.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">echo «listener 9001» &gt;&gt; /etc/mosquitto/mosquitto.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">echo «protocol websockets» &gt;&gt; /etc/mosquitto/mosquitto.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo useradd -r -m -d /var/lib/mosquitto -s /usr/sbin/nologin -g nogroup mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Командами </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; font-style:italic; color:#333333;">echo</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> мы добавим несколько строк в конфигурационный файл </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; font-style:italic; color:#333333;">mosquitto.conf</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">. У меня не получилось добавить строки через консоль и я сделал это вручную в редакторе </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">nano</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">, поместив строки </span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">listener 1883</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> в раздел </span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">Default listener</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">, а </span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">listener 9001</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> и </span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">protocol websockets</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> в </span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">Extra listeners</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">,  эти разделы в </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> условные, отличаются только комментариями и мы будем использовать такой вариант только для удобства.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">9 Создадим скрипт для автозапуска Mosquitto. Для меня удобнее сделать это в Midnight Commander (</span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; font-style:italic; color:#333333;">sudo mc</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">), идем в каталог </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; font-style:italic; color:#333333;">/etc/init.d</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> и создаем (Shift+F4) новый файл, скопируем в него следующие строки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">#!/bin/bash</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">#/etc/init.d/mosquittocase «$1» in</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">start)</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">echo «Starting mosquitto»</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">/usr/local/sbin/mosquitto -d -c /etc/mosquitto/mosquitto.conf</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;"> &gt;&gt; /var/log/mosquitto/mosquitto.log</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;"> 2&gt;&gt; /var/log/mosquitto/mosquitto.error</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">;;</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">stop)</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">echo «Stopping mosquitto»</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">killall mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">;;</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">*)</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">echo «Usage: /etc/init.d/mosquitto start|stop»</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">exit 1</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">;;</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"><br /></span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">esacexit 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Сохраним файл с именем </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Устанавливаем атрибут исполняемого файла для нашего скрипта автозапуска и создаём каталог для хранения логов:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo chmod +x /etc/init.d/mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo mkdir -p /var/log/mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">9 Включаем скрипт </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> в автозагрузку и запускаем его:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo update-rc.d mosquitto defaults</span></p>
<p style=" margin-top:0px; margin-bottom:37px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo /etc/init.d/mosquitto start</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">При этом </span><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">update-rc.d</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> скорее всего ругнется на синтаксис нашего файла, который не соответствует некоторым правилам оформления содержимого скриптов автозапуска Ubuntu, но на работе это не должно отразиться.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="large-r-611049"></a><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">10 Для чистоты эксперимента перезагружаемся:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo reboot</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">11 Дождавшись загрузки ОС, вновь подключаемся к плате через PUTTY и проверяем работу </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">MQTT брокера Mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> командой:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; font-style:italic; color:#333333;">sudo ps acx | grep mosquitto</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">В случае успеха видим следующее:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image540771956.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Если что то пошло не так, идем смотреть логи в </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">/var/log/mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">, если там пусто, тогда настройте подробный лог командой </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">log_type</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> в файле </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">/etc/mosquitto/mosquitto.conf</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">В моём случае конфигурация исправно работает, что проверено через MQTT SPY и мобильное приложение для Android.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;">Получившийся </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">MQTT</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> брокер слушает подключения на стандартном порту </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">1883</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> и </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">MQTT </span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">через</span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;"> WebSockets </span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">на порту </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">9001</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;">. Для доступа к нашему </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">Mosquitto</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> не только из локальной сети, «прокидываем» на роутере порт </span><span style=" font-family:'inherit'; font-size:19px; font-weight:696; color:#333333;">9001</span><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> во внешний мир.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:19px; color:#333333;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>