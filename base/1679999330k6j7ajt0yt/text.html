<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">Как подключить второй MQTT брокер к Home Assistant или мостовое (bridge) соединения MQTT брокеров Mosquitto⁠⁠</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Привет Пикабу!</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом посте рассмотрим реализацию подключения </span><span style=" font-family:'Ubuntu'; font-weight:600;">второго MQTT брокера к Home Assistant</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">мостовое (bridge) соединения MQTT брокеров Mosquitto</span><span style=" font-family:'Ubuntu';">. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1688521073.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Сразу опишу своё исходное ТЗ (задачу), решение которой будет описано в этом посте, чтобы вы могли понять на сколько эта &quot;инструкция&quot; подходит под решение именно вашей задачи (задач).<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Имеется:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">1) </span><span style=" font-family:'Ubuntu'; font-weight:600;">IoT устройства</span><span style=" font-family:'Ubuntu';"> на ESP8266 (ESP32) </span><span style=" font-family:'Ubuntu'; font-weight:600;">дома (в локальной сети)</span><span style=" font-family:'Ubuntu';">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">2)</span><span style=" font-family:'Ubuntu'; font-weight:600;"> IoT устройства</span><span style=" font-family:'Ubuntu';"> на ESP8266 (ESP32) </span><span style=" font-family:'Ubuntu'; font-weight:600;">НЕ дома</span><span style=" font-family:'Ubuntu';"> (internet / за nat);<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Задача: </span><span style=" font-family:'Ubuntu';">- собирать данные с датчиков установленных на этих устройствах </span><span style=" font-family:'Ubuntu'; font-style:italic;">(и/или управлять подключенными модулями)</span><span style=" font-family:'Ubuntu';"> в единый центр. </span><span style=" font-family:'Ubuntu'; font-style:italic;">В качестве единого центра уже  выбрана система &quot;Умного дома&quot; Home Assistant.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Дополнительное условие (требование): </span><span style=" font-family:'Ubuntu';">- порты для взаимодействия с сервером, где установлен &quot;Умный дом&quot; доступны только в локальной сети. </span><span style=" font-family:'Ubuntu'; font-style:italic;">Исключение только для портов 80, 433-й  для HTTPS для &quot;Яндекс.Станции&quot; и 500, 4500 для VPN, но решения связанные с VPN по ряду причин не рассматриваются.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В качестве решения моей задачи был выбран протокол обмена сообщениями между устройствами - </span><span style=" font-family:'Ubuntu'; font-weight:600;">MQTT</span><span style=" font-family:'Ubuntu';">. А в качестве брокера сообщений был выбран  </span><span style=" font-family:'Ubuntu'; font-weight:600;">Eclipse Mosquitto</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Установка на локальный сервер (</span><span style=" font-family:'Ubuntu'; font-style:italic;">вместе/рядом с &quot;Умным домом&quot;</span><span style=" font-family:'Ubuntu';">) и базовая настройка </span><span style=" font-family:'Ubuntu'; font-weight:600;">MQTT брокера Eclipse Mosquitto</span><span style=" font-family:'Ubuntu';"> была проведена по </span><a href="https://github.com/huny-huny/CheatSheet-MQTT-Eclipse-Mosquitto"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">этой инструкции</span></a><span style=" font-family:'Ubuntu';">. Все локальные  IoT устройства общаются с Home Assistant через него.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В качестве сервера для</span><span style=" font-family:'Ubuntu'; font-weight:600;"> второго MQTT брокера вне дома</span><span style=" font-family:'Ubuntu';"> был выбран </span><a href="https://pikabu.ru/story/registriruem_besplatnyiy_always_free_vps__server_ot_oracle_navsegda_dlya_servisov_umnogo_doma_ili_chegoto_drugogo_7972646"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">бесплатный VPS - сервер от Oracle</span></a><span style=" font-family:'Ubuntu'; font-weight:600;">. </span><span style=" font-family:'Ubuntu';">Брокер также был установлен </span><a href="https://pikabu.ru/story/besplatnyiy_i_lichnyiy_mqtt_broker_mosquitto_dlya_iotustroystv_na_bazeubuntu_2004_na_always_free_vps_serverot_oracle_7982336"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">по этой инструкции</span></a><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Осталось &quot;научить&quot; Home Assistant &quot;общаться&quot; с двумя MQTT брокерами)))</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для этого был найден &quot;обходной путь&quot; из </span><a href="https://mosquitto.org/man/mosquitto-conf-5.html"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">документации Eclipse Mosquitto</span></a><span style=" font-family:'Ubuntu'; font-weight:600;">,</span><span style=" font-family:'Ubuntu';"> который имеет название bridge (мост). Т.е. фактически мы сделаем мостовое (bridge) соединения внешнего MQTT брокера с локальным (домашним), через которое они будут &quot;общаться&quot;. А наш локальный MQTT брокер как и раньше будет &quot;общаться&quot; с </span><span style=" font-family:'Ubuntu'; font-weight:600;">Home Assistant, </span><span style=" font-family:'Ubuntu';">позволяя через себя (мост | bridge) &quot;общаться&quot; Home Assistant со вторым (внешним) брокером. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-style:italic;">На этапе написания последних двух предложений мне вспомнился </span><a href="https://pikabu.ru/story/sozdayom_svoy_vpnserver_ipsec__l2tp_za_paru_minut_na_besplatnom_vps_servere_ot_oracle_s_os_ubuntu_2004_avtomatizirovannaya_nastroyka_7976146?cid=190676816"><span style=" font-family:'Ubuntu'; font-style:italic; text-decoration: underline; color:#0000ff;">этот</span></a><span style=" font-family:'Ubuntu'; font-style:italic;"> комментарий ))))</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1071264016.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Итак, поехали выполнять задачу)))</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Открываем через </span><a href="https://winscp.net/eng/download.php"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">WinSCP</span></a><span style=" font-family:'Ubuntu';"> или </span><a href="https://www.putty.org/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">PuTTY</span></a><span style=" font-family:'Ubuntu';"> конфигурационный файл </span><span style=" font-family:'Ubuntu'; font-weight:600;">локального </span><span style=" font-family:'Ubuntu';">Eclipse Mosquitto для </span><span style=" font-family:'Ubuntu'; font-weight:600;">редактирования </span><span style=" font-family:'Ubuntu';">(я предпочитаю для этих целей использовать  WinSCP).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Путь к файлу, если вы устанавливали брокер про </span><a href="https://github.com/huny-huny/CheatSheet-MQTT-Eclipse-Mosquitto"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">моей инструкции</span></a><span style=" font-family:'Ubuntu';">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">/etc/mosquitto/mosquitto.conf</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1068373532.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">И вставляем туда, предварительно отредактировав под свои учётные данные, такой текст:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"># HUNY External Bridge Configuration<br />connection external-bridge<br />address </span><span style=" font-family:'Ubuntu'; font-weight:600;">193.125.125.125:1883</span><span style=" font-family:'Ubuntu';"><br />cleansession true<br />topic </span><span style=" font-family:'Ubuntu'; font-weight:600;">+</span><span style=" font-family:'Ubuntu';">/# in </span><span style=" font-family:'Ubuntu'; font-weight:600;">PICABU</span><span style=" font-family:'Ubuntu';">/ &quot;&quot;<br />try_private true<br />remote_username </span><span style=" font-family:'Ubuntu'; font-weight:600;">pickabu</span><span style=" font-family:'Ubuntu';"><br />remote_password </span><span style=" font-family:'Ubuntu'; font-weight:600;">Pikabu1234</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image63215875.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">address</span><span style=" font-family:'Ubuntu'; font-weight:600;"> 193.125.125.125:1883</span><span style=" font-family:'Ubuntu';"> - adress(ip) вашего второго брокера.<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">remote_username</span><span style=" font-family:'Ubuntu'; font-weight:600;"> pickabu </span><span style=" font-family:'Ubuntu';">- логин вашего второго брокера.<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">remote_password </span><span style=" font-family:'Ubuntu'; font-weight:600;">Pikabu1234 - </span><span style=" font-family:'Ubuntu';">пароль вашего второго брокера.<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">topic </span><span style=" font-family:'Ubuntu'; font-weight:600;">+</span><span style=" font-family:'Ubuntu';">/# in </span><span style=" font-family:'Ubuntu'; font-weight:600;">PICABU</span><span style=" font-family:'Ubuntu';">/ &quot;&quot; - здесь &quot;</span><span style=" font-family:'Ubuntu'; font-weight:600;">+</span><span style=" font-family:'Ubuntu';">&quot; означает забирать все топики со второго брокера, </span><span style=" font-family:'Ubuntu'; font-weight:600;">PICABU </span><span style=" font-family:'Ubuntu';">- так будет называться топик в первом брокере (в моём случае - локальном), где будут публиковаться все топики со второго.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">topic [read|write|readwrite|deny] &lt;topic&gt;</span><span style=" font-family:'Ubuntu';"><br />The access type is controlled using &quot;read&quot;, &quot;write&quot;, &quot;readwrite&quot; or &quot;deny&quot;. This parameter is optional (unless &lt;topic&gt; includes a space character) - if not given then the access is read/write. &lt;topic&gt; can contain the + or # wildcards as in subscriptions. The &quot;deny&quot; option can used to explicity deny access to a topic that would otherwise be granted by a broader read/write/readwrite statement. Any &quot;deny&quot; topics are handled before topics that grant read/write access.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Расширенные или просто другие настройки смотрим в </span><a href="https://mosquitto.org/man/mosquitto-conf-5.html"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">документации </span></a><span style=" font-family:'Ubuntu';">и делимся в комментариях своими вариантами ;-)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">ПОСЛЕ ВНЕСЕНИЯ ПРАВОК В КОНФИГ - ПЕРЕЗАПУСТИТЕ ЛОКАЛЬНЫЙ БРОКЕР.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Проверить, что всё работает </span><span style=" font-family:'Ubuntu'; font-style:italic;">(Первый брокер публикует все топики второго брокера)</span><span style=" font-family:'Ubuntu';"> переде тем как вносить правки в  Home Assistant можно, например, с помощью программы </span><a href="http://mqtt-explorer.com/"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">MQTT Explorer</span></a><span style=" font-family:'Ubuntu'; font-weight:600;">:</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2014256606.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Напомню, если забыли или не знали ))), базовые настройки Mqtt в Home Assistant:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">1) В файле configiration.yaml указываем путь к настройкам mqtt:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">mqtt: !include mqtt.yaml</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1011071248.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">2) В файле </span><span style=" font-family:'Ubuntu'; font-weight:600;">mqtt.yaml </span><span style=" font-family:'Ubuntu';">указываем параметры подключения к своему локальному брокеру:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">ВАЖНО СОБЛЮДАТЬ ТАБУЛЯЦИЮ!!!</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">broker: </span><span style=" font-family:'Ubuntu'; font-weight:600;">192.168.1.150</span><span style=" font-family:'Ubuntu';"><br />port: </span><span style=" font-family:'Ubuntu'; font-weight:600;">1883</span><span style=" font-family:'Ubuntu';"><br />client_id: home-assistant<br />keepalive: 60<br />username: </span><span style=" font-family:'Ubuntu'; font-weight:600;">Local</span><span style=" font-family:'Ubuntu';"><br />password: </span><span style=" font-family:'Ubuntu'; font-weight:600;">Local7777</span><span style=" font-family:'Ubuntu';"><br />protocol: 3.1<br />birth_message:<br />topic: &quot;HomeAssistant&quot;<br />payload: &quot;Online&quot;<br />qos: 1<br />retain: true<br />will_message:<br />topic: &quot;HomeAssistant&quot;<br />payload: &quot;Offline&quot;<br />qos: 1<br />retain: true</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">ВАЖНО СОБЛЮДАТЬ ТАБУЛЯЦИЮ!!!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1080444247.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">3) в </span><span style=" font-family:'Ubuntu'; font-weight:600;">sensor.yaml </span><span style=" font-family:'Ubuntu';">указываем свои параметры &quot;топиков&quot; локального и второго брокера:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">ВАЖНО СОБЛЮДАТЬ ТАБУЛЯЦИЮ!!!</span><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"># Платформа MQTT брокер.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"># ESP8266 на улице: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-ulica/ESP-ULICA/bmet&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Тепература на улице (Самара Дом)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;°C&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: temperature</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-ulica/ESP-ULICA/bmeh&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Влажность на улице (Самара Дом)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;%&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: humidity</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-ulica/ESP-ULICA/bmep&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Давление на улице (Самара Дом)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;mmHg&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: pressure</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-ulica/ESP-ULICA/bhl&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Освещённость на улице (Самара Дом)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;lm&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: illuminance</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"># ESP8266 в офисе:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-office/ESP-OFFICE/dsw1&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Тепература на улице (ОФИС)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;°C&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: temperature</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-office/ESP-OFFICE/bmet&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Тепература в ОФИСЕ</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;°C&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: temperature</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-office/ESP-OFFICE/bmeh&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Влажность в ОФИСЕ</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;%&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: humidity</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-office/ESP-OFFICE/bmep&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Давление на улице (ОФИС)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;mmHg&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">device_class: pressure</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">- platform: mqtt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">state_topic: &quot;esp-office/ESP-OFFICE/co2mh&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">name: Углекислый газ в ОФИСЕ</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">unit_of_measurement: &quot;ppm&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">ВАЖНО СОБЛЮДАТЬ ТАБУЛЯЦИЮ!!!</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image80318291.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Ну и в завершении настройте панель Lovelace в Home Assistant на своё усмотрение. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Например так (тестовый вариант): </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image264232513.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">На этом у меня  В С Ё.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p></body></html>