<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">Как работает SAMBA? часть 2</span><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Июнь 15th, 2011 Рубрики: </span><a href="http://www.k-max.name/category/linux/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Linux</span></a><span style=" font-family:'Ubuntu';">, </span><a href="http://www.k-max.name/category/linux/samba/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">SAMBA</span></a><span style=" font-family:'Ubuntu';">, </span><a href="http://www.k-max.name/category/windows/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Windows</span></a><span style=" font-family:'Ubuntu';">, </span><a href="http://www.k-max.name/category/linux/server/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Настройка сервера Linux</span></a><span style=" font-family:'Ubuntu';">, </span><a href="http://www.k-max.name/category/linux/osnovy-linux/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">основы Linux</span></a><span style=" font-family:'Ubuntu';">, </span><a href="http://www.k-max.name/category/zhelezo/printer/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">Принтер</span></a><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1789708235.png" /><a name="Ya_sync_0"></a><span style=" font-family:'Ubuntu';">Д</span><span style=" font-family:'Ubuntu';">оброго времени, гости и читатели </span><a href="http://www.k-max.name/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">блога</span></a><span style=" font-family:'Ubuntu';">! Сегодня продолжу рассматривать возможности</span><span style=" font-family:'Ubuntu'; font-weight:600;"> пакета SAMBA</span><span style=" font-family:'Ubuntu';">. Перед прочтением данного материала я бы посоветовал ознакомиться со статьями </span><a href="http://www.k-max.name/linux/kak-rabotaet-samba/"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">основы SAMBA</span></a><span style=" font-family:'Ubuntu';"> и </span><a href="http://www.k-max.name/linux/server-pechati-na-linux-common-unix-printing-system/"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">CUPS</span></a><span style=" font-family:'Ubuntu';">. Итак, из прошлых статей мы знаем</span><span style=" font-family:'Ubuntu'; font-style:italic;"> как </span><a href="http://www.k-max.name/linux/kak-rabotaet-samba#install"><span style=" font-family:'Ubuntu'; font-style:italic; text-decoration: underline; color:#0000ff;">установить пакет samba</span></a><span style=" font-family:'Ubuntu';">. После установки, файлы пакета могут располагаться в следующих каталогах:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Демоны и утилиты помещаются в каталог:<span style=" font-style:italic;"> /usr/sbin</span></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файлы настройки в: <span style=" font-style:italic;">/etc/samba/</span></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файлы журналов в: <span style=" font-style:italic;">/var/log/samba/</span></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Некоторые управляющие файлы помещаются в: <span style=" font-style:italic;">/var/lib/samba</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">конечно, возможны некоторые отклонения, например в старых версиях </span><span style=" font-family:'Ubuntu'; font-weight:600;">SAMBA </span><span style=" font-family:'Ubuntu';">настройки хранятся в </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc</span><span style=" font-family:'Ubuntu';">, а логи в </span><span style=" font-family:'Ubuntu'; font-style:italic;">/var/log</span><span style=" font-family:'Ubuntu';">, при сборке из исходников, samba устанавливается в </span><span style=" font-family:'Ubuntu'; font-style:italic;">/usr/local/samba</span><span style=" font-family:'Ubuntu';">. Т.о. можно убедиться, что </span><span style=" font-family:'Ubuntu'; font-weight:600;">SAMBA </span><span style=" font-family:'Ubuntu';">у нас установлена.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Настройка SAMBA</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Настройка SAMBA</span><span style=" font-family:'Ubuntu';"> заключается в редактировании конфигурационного файла </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/samba/smb.conf</span><span style=" font-family:'Ubuntu';">. Структура конфига самба схожа с форматом файлов </span><span style=" font-family:'Ubuntu'; font-style:italic;">.ini</span><span style=" font-family:'Ubuntu';"> в Windows и представляет собой </span><a name="more-2634"></a><span style=" font-family:'Ubuntu';">з</span><span style=" font-family:'Ubuntu';">аписи вида:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[stanza0]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   key0=value0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   key1=value1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[stanza1]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   key0=value0</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   key1=value1</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">То есть параметры, они же ключи (</span><span style=" font-family:'Ubuntu'; font-style:italic;">key0</span><span style=" font-family:'Ubuntu';">, </span><span style=" font-family:'Ubuntu'; font-style:italic;">key1 </span><span style=" font-family:'Ubuntu';">и т.д.) собраны в группы, которые называют </span><span style=" font-family:'Ubuntu'; font-style:italic;">стансами </span><span style=" font-family:'Ubuntu';">или </span><span style=" font-family:'Ubuntu'; font-style:italic;">строфами </span><span style=" font-family:'Ubuntu';">(</span><span style=" font-family:'Ubuntu'; font-style:italic;">stanza0, stanza1</span><span style=" font-family:'Ubuntu';"> и т.д.), название которых заключены в фигурные скобки. Каждый </span><span style=" font-family:'Ubuntu'; font-style:italic;">каталог </span><span style=" font-family:'Ubuntu';">или </span><span style=" font-family:'Ubuntu'; font-style:italic;">принтер</span><span style=" font-family:'Ubuntu';">, предоставляемый в общий доступ в Windows называется </span><span style=" font-family:'Ubuntu'; font-weight:600;">разделяемым ресурсом</span><span style=" font-family:'Ubuntu';"> (</span><span style=" font-family:'Ubuntu'; font-style:italic;">share</span><span style=" font-family:'Ubuntu';">) или </span><span style=" font-family:'Ubuntu'; font-weight:600;">сервисом </span><span style=" font-family:'Ubuntu';">(</span><span style=" font-family:'Ubuntu'; font-style:italic;">service</span><span style=" font-family:'Ubuntu';">), или в простой терминологии - </span><span style=" font-family:'Ubuntu'; font-style:italic;">шАра </span><img src="image640282516.png" /><span style=" font-family:'Ubuntu';"> Каждый ресурс можно представить в Linux отдельным разделом строфой с особым именем и набором параметров. </span><span style=" font-family:'Ubuntu'; font-weight:600;">SAMBA </span><span style=" font-family:'Ubuntu';">понимает громадное количество параметров, с которыми можно ознакомиться тут </span><a href="http://www.opennet.ru/man.shtml?topic=smb.conf&amp;category=5&amp;russian=2"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">man smb.conf</span></a><span style=" font-family:'Ubuntu';">. Я опишу основные. Существует так же </span><span style=" font-family:'Ubuntu'; font-style:italic;">специальный раздел</span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;"> [global]</span><span style=" font-family:'Ubuntu';">, хранящий параметры по умолчанию ко всем сервисам и к серверу в целом. Для начала, я бы посоветовал </span><a href="http://www.k-max.name/linux/osnovnye-komandy-linux-ili-shpargalka-nachinayushhego-linuksojda/#file"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">скопировать оригинальный файл</span></a><span style=" font-family:'Ubuntu';"> (т.к. в нем большое количество комментариев, с которыми на досуге можно ознакомиться) и создать (например, с </span><a href="http://www.k-max.name/linux/tekstovyj-redaktor-vim-osnovy-raboty/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">помощью редактора vi</span></a><span style=" font-family:'Ubuntu';">) на его месте новый, со следующими параметрами:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:~# cp /etc/samba/smb.conf /etc/samba/smb.conf.orig</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:~# cat /etc/samba/smb.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[global]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> workgroup = WORKGROUP</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> netbios name = SAMBA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> printing = CUPS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> wins support = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[homes]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> browsable = no</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> read only = no</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[printers]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> printable = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> printing = CUPS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> path = /var/spool/samba</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[data]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> path = /export/data</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> read only = no</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> map archive = no</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Давайте разберем параметры и разделы по порядку:</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">[global]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Как уже говорилось - содержит параметры, настраивающие </span><span style=" font-family:'Ubuntu'; font-weight:600;">пакет SAMBA</span><span style=" font-family:'Ubuntu';"> в целом. </span><span style=" font-family:'Ubuntu'; font-weight:600;">Параметр workgroup</span><span style=" font-family:'Ubuntu';"> определяет </span><span style=" font-family:'Ubuntu'; font-style:italic;">имя рабочей группы</span><span style=" font-family:'Ubuntu';">, к которой принадлежит сервер samba. Соответственно, если есть необходимость - нужно переименовать группу на подходящую Вам. Данный параметр необязательный, если его не указывать, то сервер будет принадлежать группе </span><span style=" font-family:'Ubuntu'; font-style:italic;">WORKGROUP</span><span style=" font-family:'Ubuntu';">. Далее,</span><span style=" font-family:'Ubuntu'; font-weight:600;"> параметр netbios name</span><span style=" font-family:'Ubuntu';">, который указывает на </span><span style=" font-family:'Ubuntu'; font-style:italic;">имя сервера</span><span style=" font-family:'Ubuntu';">, которое будет отображаться в сетевом окружении Windows. Данный параметр так же необязательный, если его не указывать, то сервер будет отображаться под именем локального хоста (которое можно узнать командой</span><span style=" font-family:'Ubuntu'; font-style:italic;"> echo $HOSTNAME</span><span style=" font-family:'Ubuntu';">). Тут необходимо сделать акцент на том, что указывать значение localhost в данном параметре </span><span style=" font-family:'Ubuntu'; font-weight:600;">неприемлемо</span><span style=" font-family:'Ubuntu';">, т.к. данное имя на машинах Wondows всегда будет разрешаться в адрес 127.0.0.1. Так же, в данном станзе можно указать параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">encrypt passwords</span><span style=" font-family:'Ubuntu';">, который указывает SAMBA </span><span style=" font-family:'Ubuntu'; font-style:italic;">шифровать пароли</span><span style=" font-family:'Ubuntu';">. Это необходимо для клиентов с ОС версией выше windows 98. Если используется версия SAMBA выше 3.0, то данный параметр указывать не обязательно, т.к. он используется по умолчанию. Параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">wins support</span><span style=" font-family:'Ubuntu';"> требует от samba работать в качестве </span><span style=" font-family:'Ubuntu'; font-style:italic;">WINS сервера</span><span style=" font-family:'Ubuntu';">, это не обязательно, но способствует более эффективной работе, о чем я говорил в </span><a href="http://www.k-max.name/linux/kak-rabotaet-samba/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">прошлой статье о SAMBA</span></a><span style=" font-family:'Ubuntu';">. Если Ваш </span><span style=" font-family:'Ubuntu'; font-weight:600;">Samba сервер</span><span style=" font-family:'Ubuntu';"> использует несколько сетевых интерфейсов, то можно явно указать, на каком из интерфейсов слушать подключения с помощью параметра:</span><span style=" font-family:'Ubuntu'; font-weight:600;"> interfaces</span><span style=" font-family:'Ubuntu'; font-style:italic;"> = 192.168.1.1/24</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">[homes]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Раздел </span><span style=" font-family:'Ubuntu'; font-weight:600;">[homes]</span><span style=" font-family:'Ubuntu';"> определяет </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">виртуальный </span><span style=" font-family:'Ubuntu'; font-style:italic;">сервис</span><span style=" font-family:'Ubuntu';">, указывая SAMBA</span><span style=" font-family:'Ubuntu'; font-style:italic;"> автоматически расшаривать домашний каталог пользователя</span><span style=" font-family:'Ubuntu';">. То есть, при подключении к серверу SAMBA производится поиск имени </span><a href="http://www.k-max.name/linux/upravlenie-polzovatelyami-v-linux/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">пользователя </span></a><span style=" font-family:'Ubuntu';">в </span><a href="http://www.k-max.name/linux/fajlovaya-sistema-linux-i-struktura-katalogov/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">файле /etc/passwd</span></a><span style=" font-family:'Ubuntu';"> и если в локальной системе есть учетная запись пользователя и она имеет домашний каталог, то данный каталог раcшаривается для подключенного пользователя. Параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">read only</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-style:italic;">= no</span><span style=" font-family:'Ubuntu';"> указывает предоставлять домашние каталоги </span><span style=" font-family:'Ubuntu'; font-style:italic;">в режиме чтения-записи</span><span style=" font-family:'Ubuntu';">. Параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">browsable</span><span style=" font-family:'Ubuntu';">=no указывает </span><span style=" font-family:'Ubuntu'; font-style:italic;">не отображать каталог</span><span style=" font-family:'Ubuntu';"> homes в списке расшаренных ресурсов (но домашний каталог подключенного пользователя будет виден пользователю). Данное разрешение учитывает права доступа в Linux, то есть если файл в расшаренной папке с правами только на чтение, то он не станет доступным на запись. Иначе сказав: сервер не предоставит доступа больше чем UNIX система. В данной директории так же полезно указать параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">path </span><span style=" font-family:'Ubuntu';">= </span><span style=" font-family:'Ubuntu'; font-style:italic;">/path/to/homedir/%S</span><span style=" font-family:'Ubuntu';">, если вы хотите разделить системные домашние папки от расшариваемых.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">[printers]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Раздел</span><span style=" font-family:'Ubuntu'; font-weight:600;"> [printers]</span><span style=" font-family:'Ubuntu';">, в  SAMBA, хранит </span><span style=" font-family:'Ubuntu'; font-style:italic;">настройки печати</span><span style=" font-family:'Ubuntu';">, то есть SAMBA получает указание сделать принтеры, подключенные к системе Linux, доступными клиентам сети. Точнее будет сказать, что данный раздел </span><span style=" font-family:'Ubuntu'; font-style:italic;">определяет доступ ко </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">всем </span><span style=" font-family:'Ubuntu'; font-style:italic;">принтерам</span><span style=" font-family:'Ubuntu';">, указанным в файле </span><a href="http://www.k-max.name/linux/server-pechati-na-linux-common-unix-printing-system#printcap"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">/etc/printcap</span></a><span style=" font-family:'Ubuntu';">. Разделы, они же строфы, которые определяют совместно используемый принтер, включая </span><span style=" font-family:'Ubuntu'; font-style:italic;">раздел [printers]</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600;">должен </span><span style=" font-family:'Ubuntu';">содержать строку </span><span style=" font-family:'Ubuntu'; font-weight:600;">printable</span><span style=" font-family:'Ubuntu';"> = yes. Для доступа к принтерам, необходимо прописать в </span><a href="http://www.k-max.name/linux/server-pechati-na-linux-common-unix-printing-system#printcap"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">файле /etc/printcap</span></a><span style=" font-family:'Ubuntu';"> настройки доступа к принтеру. Параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">printing </span><span style=" font-family:'Ubuntu';">= </span><span style=" font-family:'Ubuntu'; font-style:italic;">CUPS</span><span style=" font-family:'Ubuntu';"> указывает использовать </span><a href="http://www.k-max.name/linux/server-pechati-na-linux-common-unix-printing-system/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">систему печати CUPS</span></a><span style=" font-family:'Ubuntu';"> (возможно так же указать более старые системы печати, такие как BSD и LPRNG). Для того чтобы использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">свой </span><span style=" font-family:'Ubuntu';">файл printcap, необходимо его создать и указать в виде параметра </span><span style=" font-family:'Ubuntu'; font-weight:600;">printcap </span><span style=" font-family:'Ubuntu';">= </span><span style=" font-family:'Ubuntu'; font-style:italic;">/path/to/printcap</span><span style=" font-family:'Ubuntu';">. Параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">path </span><span style=" font-family:'Ubuntu';">= </span><span style=" font-family:'Ubuntu'; font-style:italic;">/var/spool/samba</span><span style=" font-family:'Ubuntu';"> указывает, где будет размещен </span><a href="http://www.k-max.name/linux/server-pechati-na-linux-common-unix-printing-system#spool"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">спулер </span></a><span style=" font-family:'Ubuntu'; font-style:italic;">(каталог временного хранилища очереди печати)</span><span style=" font-family:'Ubuntu';">. Для данного каталога необходим установленный </span><a href="http://www.k-max.name/linux/prava-dostupa-v-linux-eshhe-odna-malenkaya-shpargalka#stycky"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">StickyBit</span></a><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">[data]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Данный раздел приведен в качестве примера,</span><span style=" font-family:'Ubuntu'; font-style:italic;"> как открыть совместный доступ к каталогу</span><span style=" font-family:'Ubuntu';">. Следуя данному примеру можно расшарить сколько угодно каталогов, указав для каждого свое</span><span style=" font-family:'Ubuntu'; font-weight:600;"> имя раздела</span><span style=" font-family:'Ubuntu';"> и значение </span><span style=" font-family:'Ubuntu'; font-weight:600;">path</span><span style=" font-family:'Ubuntu';">. Название раздела используется в качестве имени разделяемого ресурса и отображается клиентам Windows, как папка с таким именем. Параметр, отвечающий за функциональность, описанную ниже - </span><span style=" font-family:'Ubuntu'; font-weight:600;">map archive</span><span style=" font-family:'Ubuntu';"> - установлен в </span><span style=" font-family:'Ubuntu'; font-style:italic;">no</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">SAMBA </span><span style=" font-family:'Ubuntu';">не всегда выполняет задачу - заставить </span><span style=" font-family:'Ubuntu'; font-style:italic;">файловую систему UNIX</span><span style=" font-family:'Ubuntu';"> выглядеть как </span><span style=" font-family:'Ubuntu'; font-style:italic;">файловая система Windows</span><span style=" font-family:'Ubuntu';"> для клиентов Windows. Одно из различий между файловыми системами Windows и UNIX в том, что в Windows существует </span><span style=" font-family:'Ubuntu'; font-style:italic;">атрибут </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">archive</span><span style=" font-family:'Ubuntu';">, с помощью которого программы резервного копирования определяют, был ли файл модифицирован с момента последнего копирования. В UNIX прямого аналога данного атрибута нет. </span><span style=" font-family:'Ubuntu'; font-weight:600;">SAMBA </span><span style=" font-family:'Ubuntu';">моделирует данный атрибут архивации с помощью </span><a href="http://www.k-max.name/windows/linux/prava-dostupa-v-linux-eshhe-odna-malenkaya-shpargalka/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">бита исполнения для владельца файла UNIX</span></a><span style=" font-family:'Ubuntu';">. Данный костыль позволяет программам резервного копирования Windows корректно производить инкрементальное резервное копирование с ресурсов SAMBA. Но есть побочный эффект - файлы с данным атрибутом выглядят в Linux как исполняемые. В конфиге SAMBA в странсе [data] параметр, отвечающий за данную функцию называется </span><span style=" font-family:'Ubuntu'; font-weight:600;">map archive.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Хочу отметить кое-какие </span><span style=" font-family:'Ubuntu'; font-weight:600;">характеристики при разборе файла smb.conf</span><span style=" font-family:'Ubuntu';">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Имена разделов и параметров не чувствительны к регистру.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Только первый символ равенства значимый.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пробелы до и после первого символа равенства игнорируются.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Начальные, концевые и внутренние пробелы некорректны в названиях секций и именах параметров.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Начальные и концевые пробелы в значении параметров игнорируются.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Внутренний пробел в значении параметра сохраняется дословно.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все строки начинающиеся с символа &quot;;&quot; с запятой или &quot;#&quot; игнорируются как строки содержащие только пробел (комментируются).</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все строки оканчивающиеся символом «\» продолжаются на следующей строке в стиле UNIX.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значения после символа равенства в параметрах содержат строку (без кавычек) или логическое значение, как то да/нет, 0/1 или истина/ложь.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Регистр не имеет значения в логических значениях, но сохраняется в строковых значениях.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После внесения изменений в конфигурационный файл, необходимо проверить его на корректность. Для этого есть команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">testparm</span><span style=" font-family:'Ubuntu';">. Данная программа </span><span style=" font-family:'Ubuntu'; font-style:italic;">проверяет наличие ошибок и несовместимостей в конфигурационном файле SAMBA</span><span style=" font-family:'Ubuntu';">. Очень хорошая практика - документировать конфигурационные файлы. Но данная практика вступает в противоречие со способом, которым работает самба. Конфигурационный файл очень часто перечитывается </span><span style=" font-family:'Ubuntu'; font-style:italic;">демоном </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">smbd</span><span style=" font-family:'Ubuntu';">, т.о. чем больше строк в файле и чем больше его объем, тем больше это сказывается на производительности системы. Для решения данной проблемы необходимо создать &quot;</span><span style=" font-family:'Ubuntu'; font-style:italic;">редактируемый</span><span style=" font-family:'Ubuntu';">&quot; конфиг, в котором все описано как нужно и из редактируемого файла создать </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">рабочий </span><span style=" font-family:'Ubuntu';">с помощью команды:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server: ~# testparam -s /etc/samba/smb.conf.edit &gt; /etc/samba/smb.conf</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Из редактируемого файла будут удалены все комментарии и будут находится только те параметры, которые отличаются от значения по умолчанию. Так же, стоит отметить, что из файла будут удалены все макросы, которые необходимо будет восстановить вручную. Например, строка </span><span style=" font-family:'Ubuntu'; font-style:italic;">include=/etc/samba/%m.conf </span><span style=" font-family:'Ubuntu';">превратиться в строку</span><span style=" font-family:'Ubuntu'; font-style:italic;"> include=/etc/samba/.conf</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После запуска проверки параметров командой </span><span style=" font-family:'Ubuntu'; font-weight:600;">testparm </span><span style=" font-family:'Ubuntu';">возможно вы увидите дамп конфига, в котором отсутствуют некоторые наши параметры. Это говорит о том, что данные параметры совпадают с </span><span style=" font-family:'Ubuntu'; font-style:italic;">параметрами Samba по-умолчанию</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Запуск сервера SAMBA</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">Основу Samba</span><span style=" font-family:'Ubuntu'; font-style:italic;"> составляют </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">три демона</span><span style=" font-family:'Ubuntu'; font-style:italic;">, два из которых необходимы всегда</span><span style=" font-family:'Ubuntu';">:</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">nmbd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Демон nmbd</span><span style=" font-family:'Ubuntu';"> отвечает за регистрацию всех имен и обслуживание запросов их разрешения. Обеспечивает основной механизм, обеспечивающий возможность обзора сети. </span><span style=" font-family:'Ubuntu'; font-weight:600;">Обрабатывает все протоколы на базе UDP</span><span style=" font-family:'Ubuntu';">. </span><span style=" font-family:'Ubuntu'; font-weight:600;">Демон nmbd</span><span style=" font-family:'Ubuntu';"> должен запускаться </span><span style=" font-family:'Ubuntu'; font-weight:600;">первым</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">smbd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Демон smbd</span><span style=" font-family:'Ubuntu';"> обслуживает все соединения на базе</span><span style=" font-family:'Ubuntu'; font-weight:600;"> протоколов TCP/IP</span><span style=" font-family:'Ubuntu';"> к сервисам доступа к файлам и к принтерам. Кроме этого, демон заведует </span><span style=" font-family:'Ubuntu'; font-style:italic;">процессом локальной аутентификации</span><span style=" font-family:'Ubuntu';">. Должен запускаться сразу после nmbd.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">winbindd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Демон winbindd</span><span style=" font-family:'Ubuntu';"> должен запускаться, когда </span><span style=" font-family:'Ubuntu'; font-weight:600;">сервер Samba</span><span style=" font-family:'Ubuntu';"> выступает в роли </span><span style=" font-family:'Ubuntu'; font-weight:600;">члена домена Win NT4</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">Active Directory</span><span style=" font-family:'Ubuntu';">. Запуск так же необходим, когда Samba вступает в </span><span style=" font-family:'Ubuntu'; font-weight:600;">доверительные отношения с другим доменом</span><span style=" font-family:'Ubuntu';">. </span><span style=" font-family:'Ubuntu'; font-weight:600;">Демон winbindd</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-style:italic;">проверяет </span><span style=" font-family:'Ubuntu';">файл smb.conf на наличие параметров</span><span style=" font-family:'Ubuntu'; font-style:italic;"> idmap id</span><span style=" font-family:'Ubuntu';"> и</span><span style=" font-family:'Ubuntu'; font-style:italic;"> idmap gid</span><span style=" font-family:'Ubuntu';">, которые затем будут использоваться для отображения идентификаторов </span><span style=" font-family:'Ubuntu'; font-style:italic;">системы безопасности Windows (SID)</span><span style=" font-family:'Ubuntu';">.  Указываемый в этих параметрах диапазон не должен находится в противоречии с уже используемыми в системе идентификаторами (начало значений пользовательских ID указывается </span><a href="http://www.k-max.name/linux/upravlenie-polzovatelyami-v-linux#defs"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">в файле </span></a><a href="http://www.k-max.name/linux/upravlenie-polzovatelyami-v-linux#defs"><span style=" font-family:'Ubuntu'; font-style:italic; text-decoration: underline; color:#0000ff;">/etc/login.defs</span></a><span style=" font-family:'Ubuntu';">). Если указанные параметры не заданы, то </span><span style=" font-family:'Ubuntu'; font-weight:600;">демон winbindd </span><span style=" font-family:'Ubuntu';">не будет выполнять отображение Windows SID, а аутентификация будет выполняться только на уровне аутентификации пользователей.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Запуск данных демонов возможен как в</span><span style=" font-family:'Ubuntu'; font-weight:600;"> standealone режиме</span><span style=" font-family:'Ubuntu';">, так и с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">супердемона xinetd</span><span style=" font-family:'Ubuntu';">. В первом случае службы </span><span style=" font-family:'Ubuntu'; font-weight:600;">запущены постоянно</span><span style=" font-family:'Ubuntu';"> и прослушивают сетевой интерфейс, во втором, службы запускаются с помощью </span><span style=" font-family:'Ubuntu'; font-style:italic;">демона inetd/xinetd</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">отвечают </span><span style=" font-family:'Ubuntu';">на запросы </span><span style=" font-family:'Ubuntu'; font-weight:600;">только при поступлении запроса</span><span style=" font-family:'Ubuntu';"> от клиента. Для запуска Samba с помощью  супердемона необходимо добавить описание запуска в конфигурационный файл </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/inetd.conf</span><span style=" font-family:'Ubuntu';"> для </span><span style=" font-family:'Ubuntu'; font-weight:600;">inetd </span><span style=" font-family:'Ubuntu';">или </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/xinetd.conf</span><span style=" font-family:'Ubuntu';"> для </span><span style=" font-family:'Ubuntu'; font-weight:600;">xinetd</span><span style=" font-family:'Ubuntu';">. Супердемону xinetd обязательно посвящу отдельную тему и на сегодня с xinetd остановим обсуждение.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Запуск демонов Samba</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Об </span><a href="http://www.k-max.name/linux/nachalo-etapy-zagruzki-os-linux-v-sxeme/#init"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">уровнях выполнения</span></a><span style=" font-family:'Ubuntu';">, можно почитать </span><a href="http://www.k-max.name/linux/nachalo-etapy-zagruzki-os-linux-v-sxeme/#init"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">тут</span></a><span style=" font-family:'Ubuntu';">. Данный демон должен быть разрешен для запуска на </span><a href="http://www.k-max.name/windows/linux/nachalo-etapy-zagruzki-os-linux-v-sxeme#runlevel"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">необходимых уровнях выполнения ОС</span></a><span style=" font-family:'Ubuntu';"> (команда в RedHat-подобных дистрибутивах -</span><span style=" font-family:'Ubuntu'; font-style:italic;"> /sbin/chkconfig samba on</span><span style=" font-family:'Ubuntu';">, в Debian - </span><span style=" font-family:'Ubuntu'; font-style:italic;">/usr/sbin/update-rc.d samba defaults</span><span style=" font-family:'Ubuntu';">). Хотя я и не делал акцент на сборку Samba из исходников, но описание запуска все же затрону для общего понимания. Итак, после сборки Samba, в двоичном пакете необходимо отыскать сценарий, который будет запускать и останавливать демоны в необходимом порядке. При этом необходимо проверить сценарий на корректность имен каталогов, где лежит исполняемый файл демона. Сценарий необходимо сделать </span><a href="http://www.k-max.name/linux/prava-dostupa-v-linux-eshhe-odna-malenkaya-shpargalka/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">исполняемым</span></a><span style=" font-family:'Ubuntu';"> с помощью </span><a href="http://www.k-max.name/linux/osnovnye-komandy-linux-ili-shpargalka-nachinayushhego-linuksojda#chmod"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">команды chmod</span></a><span style=" font-family:'Ubuntu';"> +x,  </span><a href="http://www.k-max.name/linux/osnovnye-komandy-linux-ili-shpargalka-nachinayushhego-linuksojda#file"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">положить </span></a><span style=" font-family:'Ubuntu';">в каталог /etc/init.d/ и создать соответствующие ссылки на скрипт в каталогах </span><span style=" font-family:'Ubuntu'; font-style:italic;">уровней запуска Linux</span><span style=" font-family:'Ubuntu';"> (</span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/rc*.d</span><span style=" font-family:'Ubuntu';">), в которых необходим запуск демона и соответственно - остановка.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Запуск демона из bash вручную</span><span style=" font-family:'Ubuntu';"> производится командой:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server: ~# /etc/init.d/samba start</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">соответственно, </span><span style=" font-family:'Ubuntu'; font-weight:600;">для остановки </span><span style=" font-family:'Ubuntu';">заменить </span><span style=" font-family:'Ubuntu'; font-style:italic;">start </span><span style=" font-family:'Ubuntu';">на </span><span style=" font-family:'Ubuntu'; font-style:italic;">stop</span><span style=" font-family:'Ubuntu';">, для </span><span style=" font-family:'Ubuntu'; font-weight:600;">перезапуска </span><span style=" font-family:'Ubuntu';">- </span><span style=" font-family:'Ubuntu'; font-style:italic;">restart</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Проверка Samba</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После </span><span style=" font-family:'Ubuntu'; font-style:italic;">установки</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-style:italic;">настройки сервера</span><span style=" font-family:'Ubuntu';">, естественно, необходимо проверить работоспособность сервера. Для этого необходимо воспользоваться </span><span style=" font-family:'Ubuntu'; font-weight:600;">утилитой </span><a href="http://www.k-max.name/linux/kak-rabotaet-samba#client"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">smbclient</span></a><span style=" font-family:'Ubuntu';">, чтобы получить список разделяемых ресурсов:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:~# smbclient -L localhost -U%</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.5.6]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> Sharename       Type      Comment</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> ---------       ----      -------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> data            Disk</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> IPC$            IPC       IPC Service (Samba 3.5.6)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> it_216          Printer   Printer</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.5.6]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> Server               Comment</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> ---------            -------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> HOST</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> SAMBA                Samba 3.5.6</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> Workgroup            Master</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> ---------            -------</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> WORKGROUP            SAMBA</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Полученные результаты показывают, что </span><span style=" font-family:'Ubuntu'; font-weight:600;">сервер SAMBA </span><span style=" font-family:'Ubuntu';">допускает возможность анонимного подключения. В данном случае подключившийся пользователь получает права доступа гостевой учетной записи, которая обычно соответствует учетной записи пользователя </span><span style=" font-family:'Ubuntu'; font-style:italic;">nobody </span><span style=" font-family:'Ubuntu';">в файле </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/passwd</span><span style=" font-family:'Ubuntu';">. Если на данном шаге получить информацию не удалось, то это означает, что трафик Samba блокируется фаерволом, либо гостевая учетка не была найдена в файле</span><span style=" font-family:'Ubuntu'; font-style:italic;"> /etc/passwd</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Так же, в диагностике отлично помогает </span><span style=" font-family:'Ubuntu'; font-weight:600;">утилита smbstatus</span><span style=" font-family:'Ubuntu';">, которая отображает текущих подключенных клиентов.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Добавление пользователей</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В нашей конфигурации </span><span style=" font-family:'Ubuntu'; font-weight:600;">клиенты </span><span style=" font-family:'Ubuntu';">должны быть </span><span style=" font-family:'Ubuntu'; font-style:italic;">аутентифицированы Samba</span><span style=" font-family:'Ubuntu';">, чтобы получить доступ к разделяемым ресурсам. От клиента требуется указать имя и пароль, которые имеются на хосте Linux, а так же, если в </span><span style=" font-family:'Ubuntu'; font-weight:600;">smb.conf</span><span style=" font-family:'Ubuntu';"> есть</span><span style=" font-family:'Ubuntu'; font-weight:600;"> раздел [homes]</span><span style=" font-family:'Ubuntu';">, то у пользователя должен быть </span><span style=" font-family:'Ubuntu'; font-style:italic;">домашний каталог</span><span style=" font-family:'Ubuntu';">. Об </span><span style=" font-family:'Ubuntu'; font-weight:600;">управлении пользователями в Linux</span><span style=" font-family:'Ubuntu';"> можно почитать </span><a href="http://www.k-max.name/linux/upravlenie-polzovatelyami-v-linux/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">тут</span></a><span style=" font-family:'Ubuntu';">. Обычно, добавление пользователей в Linux производится командой:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server: ~# useradd -m username</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Кроме того, у Samba есть свой файл паролей </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/samba/smbpasswd</span><span style=" font-family:'Ubuntu';">, хранящий </span><span style=" font-family:'Ubuntu'; font-style:italic;">Microsoft Windows-совместимые зашифрованные пароли</span><span style=" font-family:'Ubuntu';">. Для каждого пользователя необходимо выполнить </span><span style=" font-family:'Ubuntu'; font-weight:600;">команду smbpasswd</span><span style=" font-family:'Ubuntu';">, чтобы </span><span style=" font-family:'Ubuntu'; font-weight:600;">добавить учетную запись Samba</span><span style=" font-family:'Ubuntu';"> для этого пользователя. При этом, имя и пароль </span><span style=" font-family:'Ubuntu'; font-weight:600;">должны соответствовать</span><span style=" font-family:'Ubuntu';"> тем, которые имеются у </span><span style=" font-family:'Ubuntu'; font-weight:600;">учетных записей Linux</span><span style=" font-family:'Ubuntu';">:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:~# smbpasswd -a username</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">New SMB password:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Retype new SMB password:</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="server"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">С</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">оздание простейшего файлового сервера и сервера печати с полным доступом всем без авторизации (абсолютная файлопомойка)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Итак, давайте рассмотрим простейший </span><span style=" font-family:'Ubuntu'; font-weight:600;">пример организации файловой помойки</span><span style=" font-family:'Ubuntu';">, когда нет необходимости</span><span style=" font-family:'Ubuntu'; font-style:italic;"> запрашивать имя пользователя и пароль для доступа к серверу</span><span style=" font-family:'Ubuntu';">. Давайте предположим, что есть какой-то каталог, например /tmp/obmen, а так же принтеры, подключенные к локальной системе, к которым необходим общий доступ, при этом используется</span><a href="http://www.k-max.name/linux/server-pechati-na-linux-common-unix-printing-system/"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;"> система печати CUPS</span></a><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для начала, необходимо понимание, </span><span style=" font-family:'Ubuntu'; font-weight:600;">как организовать гостевой доступ к серверу samba</span><span style=" font-family:'Ubuntu';">. В разделе глобальных параметров</span><span style=" font-family:'Ubuntu'; font-weight:600;"> [global] </span><span style=" font-family:'Ubuntu';">есть такой параметр как </span><a href="http://smb-conf.ru/security-g.html"><span style=" font-family:'Ubuntu'; font-style:italic; text-decoration: underline; color:#0000ff;">security</span></a><span style=" font-family:'Ubuntu';">, который отвечает за </span><span style=" font-family:'Ubuntu'; font-weight:600;">порядок доступа к расшаренным ресурсам</span><span style=" font-family:'Ubuntu';">. Данный параметр определяет</span><span style=" font-family:'Ubuntu'; font-weight:600;"> режим безопасности</span><span style=" font-family:'Ubuntu';"> для доступа к серверу и может принимать следующие значения:</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">USER</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Значение USER</span><span style=" font-family:'Ubuntu';"> используется по-умолчанию (в версиях Samba от 3.0 и выше), даже если параметр не задан в smb.conf. При этом параметре, </span><span style=" font-family:'Ubuntu'; font-weight:600;">клиент должен сначала произвести вход</span><span style=" font-family:'Ubuntu';">, с существующим </span><span style=" font-family:'Ubuntu'; font-style:italic;">именем пользователя</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-style:italic;">паролем </span><span style=" font-family:'Ubuntu';">Linux.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">SHARE</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Значение SHARE</span><span style=" font-family:'Ubuntu';"> в </span><span style=" font-family:'Ubuntu'; font-style:italic;">старых версиях Samba </span><span style=" font-family:'Ubuntu';">использовалось по-умолчанию. При подключении к ресурсу с параметром </span><span style=" font-family:'Ubuntu'; font-weight:600;">security </span><span style=" font-family:'Ubuntu';">= </span><span style=" font-family:'Ubuntu'; font-style:italic;">SHARE </span><span style=" font-family:'Ubuntu';">клиентам </span><span style=" font-family:'Ubuntu'; font-weight:600;">не нужно регистрироваться с использованием действительного имени пользователя и пароля</span><span style=" font-family:'Ubuntu';">. Вместо этого, клиенты посылают информацию аутентификации (пароли) на конкретный ресурс, в тот момент, когда хотят получить доступ к этому ресурсу. Заметьте, что </span><span style=" font-family:'Ubuntu'; font-weight:600;">демон smbd </span><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline;">ВСЕГДА </span><span style=" font-family:'Ubuntu';">использует реального пользователя UNIX, когда обслуживает клиента, даже если установлено </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">security </span><span style=" font-family:'Ubuntu'; font-style:italic;">= SHARE</span><span style=" font-family:'Ubuntu';">. Т.к. в</span><span style=" font-family:'Ubuntu'; font-weight:600;"> режиме SHARE</span><span style=" font-family:'Ubuntu';"> от пользователя не требуется посыла его имени, </span><span style=" font-family:'Ubuntu'; font-weight:600;">smbd </span><span style=" font-family:'Ubuntu';">использует несколько приемов для определения пользователя UNIX.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Список предполагаемых имен пользователей UNIX и соответствующих им паролей определяется следующим образом:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="guest"></a>Если установлен<span style=" font-weight:600;"> параметр guest only</span>, тогда все остальные сценарии пропускаются и используется только имя <span style=" font-style:italic;">гостевой учетки (guest account)</span>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если имя пользователя послано вместе с запросом на установление соединения после сопоставления (см. <span style=" font-weight:600;">параметр username map</span>), добавляется в список.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если клиент выполнял <span style=" font-weight:600;">запрос logon</span> (вызов SessionSetup SMB), тогда имя пользователя, использовавшееся в этом вызове будет добавлено в список.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если <span style=" font-weight:600;">параметр guest only</span> не установлен, тогда этот список пользователей обрабатывается с соответствующими паролями. Первый пользователь, пароль которого совпадет с реальным будет использован в качестве действующего пользователя UNIX.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если<span style=" font-weight:600;"> параметр guest only</span> установлен или не найдено подходящего имени пользователя, тогда, если Samba разрешено &quot;принимать гостей&quot; (<span style=" font-style:italic;">usershare allow guests</span>), будет использоваться гостевая учетка, в противном случае доступ будет запрещен.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Существуют так же такие значения параметра security, как </span><span style=" font-family:'Ubuntu'; font-weight:600;">SERVER, </span><a href="http://www.k-max.name/windows/samba-in-domain-active-directory/"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">ADS</span></a><span style=" font-family:'Ubuntu';"> и </span><a href="http://www.k-max.name/linux/domen-nt4-na-samba/"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">DOMAIN</span></a><span style=" font-family:'Ubuntu';">, которые используют удаленную аутентификацию. Но в данной статье я не буду затрагивать данные параметры.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Итак, из изложенного становиться понятно, что </span><span style=" font-family:'Ubuntu'; font-weight:600;">для гостевого доступа к серверу необходимо использовать параметр </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">security = SHARE</span><span style=" font-family:'Ubuntu'; font-weight:600;">. </span><span style=" font-family:'Ubuntu';">Чтобы не вникать в схему работы сопоставления пользователей запрашивающих доступ к ресурсам samba и локальных системных пользователей linux, предлагаю пойти по пути </span><a href="http://www.k-max.name/windows/file-print-server-na-samba-cups/#guest"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">первого шага</span></a><span style=" font-family:'Ubuntu';"> и задать параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">guest only.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">При этом, чтобы система знала, с кем ассоциировать гостевую учетную запись, то есть с какой учетной записью UNIX ассоциировать неизвестного подключенного клиента, </span><span style=" font-family:'Ubuntu'; font-style:italic;">необходимо указать</span><span style=" font-family:'Ubuntu';"> </span><span style=" font-family:'Ubuntu'; font-weight:600;">параметр guest account</span><span style=" font-family:'Ubuntu';">, равный одной из системной учетной записи Linux. Естественно, данная </span><span style=" font-family:'Ubuntu'; font-weight:600;">учетная запись Linux</span><span style=" font-family:'Ubuntu';"> должна иметь необходимый доступ к разделяемым ресурсам, чтобы не возникло вопросов с удалением/добавлением/изменением файлов. Давайте взглянем на рабочий файл файлопомойки:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:~# cat /etc/samba/smb.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[global]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> netbios name = SAMBA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> security = SHARE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest account = dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> wins support = Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[printers]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> path = /var/spool/samba</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest only = Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> read only = No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> printable = Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> browseable = No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[obmennik]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> path = /tmp/obmen</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest only = Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> force user = dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> force group = dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> read only = No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> create mask = 0777</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> directory mask = 0777</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest only = Yes</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Как видно, в нашем конфиге появилось несколько уже известных нам параметров и параметров, о которых мы не говорили... Итак по порядку:</span><span style=" font-family:'Ubuntu'; font-weight:600;"> параметр guest account </span><span style=" font-family:'Ubuntu';">задает </span><span style=" font-family:'Ubuntu'; font-style:italic;">имя учетной записи Linux</span><span style=" font-family:'Ubuntu';">, с помощью которой анонимные пользователи будут получать доступ к разделяемым ресурсам. Данный пользователь (в нашем случае - dostup) должен  иметь права на чтение и запись в каталог, который будет указан в разделяемом ресурсе (в нашем примере</span><span style=" font-family:'Ubuntu'; font-weight:600;"> - раздел [obmennik]</span><span style=" font-family:'Ubuntu';"> и каталог </span><span style=" font-family:'Ubuntu'; font-weight:600;">/tmp/obmen</span><span style=" font-family:'Ubuntu';">). Следующий </span><span style=" font-family:'Ubuntu'; font-weight:600;">параметр guest only</span><span style=" font-family:'Ubuntu';"> - разрешает </span><span style=" font-family:'Ubuntu'; font-weight:600;">только гостевые</span><span style=" font-family:'Ubuntu';"> соединения к общему ресурсу, то есть для сетевого ресурса нет необходимости указывать пароль. Далее появились 2 параметра -</span><span style=" font-family:'Ubuntu'; font-weight:600;"> force user </span><span style=" font-family:'Ubuntu';">и</span><span style=" font-family:'Ubuntu'; font-weight:600;"> force group</span><span style=" font-family:'Ubuntu';">, которые определяют</span><span style=" font-family:'Ubuntu'; font-weight:600;"> владельца и группу Linux</span><span style=" font-family:'Ubuntu';">, с правами которых в разделяемом ресурсе будут создаваться файлы и каталоги при гостевом доступе. </span><span style=" font-family:'Ubuntu'; font-weight:600;">Параметры create mask и directory mask</span><span style=" font-family:'Ubuntu';">, не трудно догадаться, что это </span><a href="http://www.k-max.name/linux/prava-dostupa-v-linux-eshhe-odna-malenkaya-shpargalka/#umask"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">маски прав доступа </span></a><span style=" font-family:'Ubuntu';">для создания файлов. (Без данных параметров у меня на Debian 6 и samba присваивались права rwxr--r-- на файлы в подкаталогах расшаренного ресурса, в результате чего было невозможно удалить созданные файлы.) Вот собственно и весь конфиг.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">Примечание:</span><span style=" font-family:'Ubuntu';"> указывать параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">guest account</span><span style=" font-family:'Ubuntu';"> нет особой необходимости. При установке samba через пакетный менеджер, по умолчанию уже будет задан некий пользователь (скорей всего nobody). Узнать, какой пользователь задан по умолчанию можно командой </span><span style=" font-family:'Ubuntu'; font-style:italic;">/usr/bin/testparm -sv /etc/samba/smb.conf | grep acco</span><span style=" font-family:'Ubuntu';">. При этом, необходимо учитывать права доступа заданного пользователя на файловую систему.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Автоматическая загрузка драйвера принтера</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Давайте рассмотрим возможность упрощения своей работы за счет</span><span style=" font-family:'Ubuntu'; font-weight:600;"> хранения драйверов принтера на сервере </span><span style=" font-family:'Ubuntu';">и возможность </span><span style=" font-family:'Ubuntu'; font-weight:600;">автоматической установки драйвера при подключении принтера</span><span style=" font-family:'Ubuntu';">. Но давайте сначала немного теории.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Итак, в Linux есть </span><span style=" font-family:'Ubuntu'; font-weight:600;">два способа сделать системный принтер доступным</span><span style=" font-family:'Ubuntu';"> для совместного использования клиентами Windows.  </span><span style=" font-family:'Ubuntu'; font-style:italic;">Первый </span><span style=" font-family:'Ubuntu';">- в режиме неформатированных данных (</span><span style=" font-family:'Ubuntu'; font-style:italic;">raw mode</span><span style=" font-family:'Ubuntu';">), </span><span style=" font-family:'Ubuntu'; font-style:italic;">второй </span><span style=" font-family:'Ubuntu';">- интеллектуальный режим (</span><span style=" font-family:'Ubuntu'; font-style:italic;">smart mode</span><span style=" font-family:'Ubuntu';">). Давайте рассмотрим оба способа.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="raw"></a><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">р</span><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">ежим неформатированных данных (raw mode)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">В raw mode </span><span style=" font-family:'Ubuntu';">система печати просто передает на принтер полученное задание для печати без какой-либо обработки. Для работы CUPS в </span><span style=" font-family:'Ubuntu'; font-weight:600;">режиме неформатированных данных</span><span style=" font-family:'Ubuntu';">, необходимо указать в конфиге параметр </span><span style=" font-family:'Ubuntu'; font-weight:600; font-style:italic;">cups option</span><span style=" font-family:'Ubuntu'; font-style:italic;"> - raw</span><span style=" font-family:'Ubuntu';">. Если данный параметр отсутствует и CUPS получит задание для печати, которое содержит последовательность фильтров не известное системе печати, то задание может быть удалено так и не увидев бумагу. Чтобы исправить данную ситуацию, необходимо отредактировать файлы </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/cups/mime.types</span><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-style:italic;">/etc/cups/mime.convs</span><span style=" font-family:'Ubuntu';"> и раскомментировать строку</span><span style=" font-family:'Ubuntu'; font-style:italic;"> application/octet-stream</span><span style=" font-family:'Ubuntu';">. Данное действие позволит CUPS отправлять на принтер задания с неизвестными последовательностями символов.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Данный режим требует установки корректного драйвера на все клиенты Windows. То есть </span><span style=" font-family:'Ubuntu'; font-weight:600;">клиент Windows должен сам выполнить обработку задания печати и подготовить к непосредственной передаче на принтер</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">интеллектуальный режим (smart mode)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Для </span><span style=" font-family:'Ubuntu'; font-weight:600;">режима smart mode</span><span style=" font-family:'Ubuntu';"> необходимо установить на </span><span style=" font-family:'Ubuntu'; font-weight:600;">сервере CUPS </span><span style=" font-family:'Ubuntu';">локальную систему фильтрации. В данном режиме, сервер будет пытаться интерпретировать тип файла, отправленный на принтер, и затем фильтровать данные, автоматически выбирая преобразование соответствующие принтеру. При работе CUPS в </span><span style=" font-family:'Ubuntu'; font-weight:600;">интеллектуальном режиме</span><span style=" font-family:'Ubuntu';">, на клиенты Windows допускается использовать драйвер </span><span style=" font-family:'Ubuntu'; font-weight:600;">CUPS Post Script</span><span style=" font-family:'Ubuntu';">. Данный режим мы рассматривать не будем.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Итак, </span><span style=" font-family:'Ubuntu'; font-weight:600;">режим RAW</span><span style=" font-family:'Ubuntu';">. Давайте подредактируем </span><span style=" font-family:'Ubuntu'; font-weight:600;">конфигурационный файл /etc/samba/smb.conf</span><span style=" font-family:'Ubuntu';"> до следующего вида и рассмотрим его параметры:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:# cat /etc/samba/smb.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[global]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> workgroup = WORKGROUP</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> printing = CUPS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> wins support = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> netbios name = SAMBA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> security = SHARE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest account = dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> cups options = raw</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> show add printer wizard = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> printer admin = root, dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[printers]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> comment = Очередь печати SMB</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> printable = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> path = /var/spool/samba</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest only = Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest ok = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> read only = No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[print$]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> comment = Драйверы принтера</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> path = /var/lib/samba/drivers</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest only = Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest ok = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> read only = No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> create mask = 0777</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> directory mask = 0777</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> force user = dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> force group = dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> write list = root, dostup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[obmennik]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> path = /share/obmen</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest only = Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> guest ok = yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> read only = No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> create mask = 0777</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> directory mask = 0777</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> force user = dostup</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> force group = dostup</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1149343325.png" /><span style=" font-family:'Ubuntu';">У нас добавились следующие пункты: </span><span style=" font-family:'Ubuntu'; font-weight:600;">параметр cups options</span><span style=" font-family:'Ubuntu';">, который определяет </span><a href="http://www.k-max.name/windows/file-print-server-na-samba-cups/#raw"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">режим raw</span></a><span style=" font-family:'Ubuntu';"> и </span><span style=" font-family:'Ubuntu'; font-weight:600;">раздел [print$]</span><span style=" font-family:'Ubuntu';">, аналогичный общему ресурсу Windows (</span><span style=" font-family:'Ubuntu'; font-style:italic;">\\host\print$</span><span style=" font-family:'Ubuntu';">), в котором хранятся файлы драйверов, </span><span style=" font-family:'Ubuntu'; font-weight:600;">параметр printer admin</span><span style=" font-family:'Ubuntu';"> задает </span><span style=" font-family:'Ubuntu'; font-style:italic;">пользователей Linux</span><span style=" font-family:'Ubuntu';">, которым разрешено иметь полный доступ для управления свойствами расшаренных принтеров, а так же</span><span style=" font-family:'Ubuntu'; font-weight:600;"> параметр write list</span><span style=" font-family:'Ubuntu';">, задающий</span><span style=" font-family:'Ubuntu'; font-weight:600;"> список пользователей Linux</span><span style=" font-family:'Ubuntu';">, имеющих право добавлять драйвер в</span><span style=" font-family:'Ubuntu'; font-weight:600;"> ресурс [print$]</span><span style=" font-family:'Ubuntu';">. Для корректной работы </span><span style=" font-family:'Ubuntu'; font-weight:600;">ресурса [print$]</span><span style=" font-family:'Ubuntu';">, нам необходимо создать указанный в </span><span style=" font-family:'Ubuntu'; font-weight:600;">параметре path </span><span style=" font-family:'Ubuntu';">каталог со структурой аналогичной Windows, для этого необходимо выполнить следующее:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:~# mkdir /var/lib/samba/drivers</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:~# cd /var/lib/samba/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:/var/lib/samba# mkdir -p drivers/{W32ALPHA,W32MIPS,W32PPC}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:/var/lib/samba# mkdir -p drivers/{W32X86/{2,3},WIN40,COLOR,IA64,x64}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:/var/lib/samba# chown -R dostup:root drivers</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">samba-server:/var/lib/samba# chmod -R u+rwx,g+rwx,o+rx-w drivers</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее, необходимо </span><a href="http://www.k-max.name/linux/server-pechati-na-linux-common-unix-printing-system/#add"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#0000ff;">установить и настроить локальные принтеры в систему печати</span></a><span style=" font-family:'Ubuntu';">. Для </span><span style=" font-family:'Ubuntu'; font-weight:600;">загрузки драйверов в SAMBA</span><span style=" font-family:'Ubuntu';">, после </span><span style=" font-family:'Ubuntu'; font-style:italic;">установки принтеров</span><span style=" font-family:'Ubuntu';">, необходимо выполнить </span><span style=" font-family:'Ubuntu'; font-style:italic;">следующие шаги</span><span style=" font-family:'Ubuntu';"> (шаги рассматриваются на ОС Windows XP):</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Загрузить Windows и залогинется.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image765915492.png" />В сетевом окружении найти машину, которую мы планируем использовать для общего доступа и как <span style=" font-weight:600;">сервер печати</span>. (в нашем случае - <span style=" font-style:italic;">samba</span>). При этом, должен отобразиться список общих ресурсов и расшаренных принтеров, а так же специальная папка &quot;<span style=" font-weight:600;">Принтеры и факсы</span>&quot;. Если данного каталога нет, то скорее всего удален куст реестра, отвечающий за его отображение. Для восстановления, необходимо скачать <a href="http://www.k-max.name/wp-content/uploads/2011/06/PrintFax.zip"><span style=" text-decoration: underline; color:#0000ff;">файл</span></a> и из архива импортировать в реестр его параметры.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном каталоге будет список <span style=" font-weight:600;">принтеров Samba</span>. Из списка выбираем правой кнопкой необходимый нам принтер (тот, для которого хотим организовать загрузку драйверов), нажимаем &quot;<span style=" font-weight:600;">Свойства</span>&quot;. При этом появиться предложение на установку драйверов данного принтера - <span style=" font-weight:600;">НЕ соглашаемся</span>. Далее появиться сообщение &quot;Сервер для данного принтера не имеет требуемого установленного драйвера принтера сервер печати....&quot; - нажимаем <span style=" font-weight:600;">Отмена</span>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1312689988.png" />Переходим на вкладку &quot;<span style=" font-weight:600;">Дополнительно</span>&quot; и напротив поля &quot;<span style=" font-style:italic;">Драйвер</span>&quot; нажимаем &quot;<span style=" font-weight:600;">Сменить...</span>&quot;. При этом запуститься<span style=" font-style:italic;"> &quot;Мастер установки драйверов принтера на &quot;имя_сервера_печати&quot;&quot;</span>, нажимаем <span style=" font-weight:600;">Далее </span>и отвечаем на вопросы местера. На втором шаге, драйвер желательно устанавливать свежий, скачанный с сайта производителя принтера. После выбора драйвера и нажатия кнопки &quot;<span style=" font-weight:600;">Готово</span>&quot; начнется копирование драйвера<span style=" font-weight:600;"> на сервер-samba!!!</span></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После данной процедуры при установке принтера на клиента Windows, драйвер должен <span style=" font-weight:600;">устанавливаться автоматически</span>.</li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Фух, тяжелая получилась статься и немного размытая. Надеюсь, что будет понятно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Резюме.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В сегодняшней статье я продолжил</span><a href="http://www.k-max.name/linux/kak-rabotaet-samba/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;"> первую часть изучения пакета SAMBA</span></a><span style=" font-family:'Ubuntu';">. Были рассмотрены примеры работы абсолютной файлопомойки и сервера печати на Linux. А так же, описан процесс настройки сервера печати на SAMBA и CUPS с автоматической загрузкой драйверов. Про самба можно писать тома книг, всех моментов не затронешь, но надеюсь, что полученных знаний будет вполне достаточно для быстрого старта и дальнейшего развития. С радостью отвечу на Ваши комментарии.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">Upd 2012.05.08:</span><span style=" font-family:'Ubuntu';"> дополнил раздел с файлопомойкой</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:small; font-weight:600;">Другие материалы в категории SAMBA</span> </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.k-max.name/windows/howto-samba-na-2-interfejsa-i-2-seti-s-raznymi-smb-conf/"><span style=" text-decoration: underline; color:#0000ff;">HOWTO SAMBA на 2 интерфейса и 2 сети с разными smb.conf</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.k-max.name/windows/samba-in-domain-active-directory/"><span style=" text-decoration: underline; color:#0000ff;">Samba, как член домена Active Directory</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.k-max.name/linux/domen-nt4-na-samba/"><span style=" text-decoration: underline; color:#0000ff;">Домен NT4 на SAMBA</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.k-max.name/windows/file-print-server-na-samba-cups/"><span style=" text-decoration: underline; color:#0000ff;">Как работает SAMBA? часть 2</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.k-max.name/linux/kak-rabotaet-samba/"><span style=" text-decoration: underline; color:#0000ff;">Как работает SAMBA?</span></a> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.k-max.name/linux/oshibka-cifs-vfs-cifs_mount-failed-wreturn-code-22/"><span style=" text-decoration: underline; color:#0000ff;">Ошибка CIFS VFS: cifs_mount failed w/return code = -22</span></a> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">===============================================</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">================================================</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Вступление</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом руководстве расскажем, как установить FTP сервер на VPS с ОС Ubuntu. Будем использовать сервер </span><a href="https://security.appspot.com/vsftpd.html"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">vsftpd</span></a><span style=" font-family:'Ubuntu';">, который считается самым быстрым и безопасным FTP сервером для UNIX-систем.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:600;">FTP</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">F</span><span style=" font-family:'Ubuntu';">ile </span><span style=" font-family:'Ubuntu'; font-weight:600;">T</span><span style=" font-family:'Ubuntu';">ransfer </span><span style=" font-family:'Ubuntu'; font-weight:600;">P</span><span style=" font-family:'Ubuntu';">rotocol – протокол приема и передачи файлов в сети. Используя модель клиент/сервер и безопасность SSL/TLS, FTP позволяет пользователям обмениваться файлами с удаленными компьютерами безопасно, эффективно и надежно, передавая данных по протоколу TCP/IP.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">FTP работает подобно HTTP или SMTP, с единственным отличием, что он ответственен за безопасную передачу данных от отправителя к получателю, а не веб-страницы с сервера к пользователю или электронного письма через интернет. В этом руководстве рассмотрено создание FTP сервера на ОС Ubuntu версии 16.04.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Примечание: Текущее руководство основывается на версии ОС Ubuntu 16.04. Но вы можете применить те же шаги по созданию FTP сервера на Ubuntu 14.04.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="toc_container"></a><span style=" font-family:'Ubuntu';">С</span><span style=" font-family:'Ubuntu';">одержание</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-ftp-server-na-ubuntu-vps/#-1-Vsftpd"><span style=" text-decoration: underline; color:#0000ff;">Шаг 1 – Установка Vsftpd</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-ftp-server-na-ubuntu-vps/#-2-FTP"><span style=" text-decoration: underline; color:#0000ff;">Шаг 2 – Разрешение FTP трафика на фаерволе</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-ftp-server-na-ubuntu-vps/#-3"><span style=" text-decoration: underline; color:#0000ff;">Шаг 3 – Создание каталога пользователя</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-ftp-server-na-ubuntu-vps/#-4-vsftpd"><span style=" text-decoration: underline; color:#0000ff;">Шаг 4 – Настройка vsftpd</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-ftp-server-na-ubuntu-vps/#-5-FTP"><span style=" text-decoration: underline; color:#0000ff;">Шаг 5 – Делаем защищенный FTP</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-ftp-server-na-ubuntu-vps/#-6--FileZilla"><span style=" text-decoration: underline; color:#0000ff;">Шаг 6 – Проверка подключения, используя FileZilla</span></a></li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-ftp-server-na-ubuntu-vps/#i"><span style=" text-decoration: underline; color:#0000ff;">Заключение</span></a></li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="-1-Vsftpd"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">аг 1 – Установка Vsftpd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Прежде всего, давайте сделаем обновление всех пакетов перед началом установки демона vsftpd. Для этого выполним команду:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apt-get update</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Дождитесь завершения всех процессов и вы увидите подтверждающее сообщение:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image424926988.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Затем установим демон vsftpd следующей командой:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo apt-get install vsftpd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вы получите уведомление требующее подтверждения, нажмите </span><span style=" font-family:'Ubuntu'; font-weight:600;">Y </span><span style=" font-family:'Ubuntu';">и </span><span style=" font-family:'Ubuntu'; font-weight:600;">Enter </span><span style=" font-family:'Ubuntu';">для продолжения установки.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1081739855.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">По завершению установки, сделаем бэкап оригинального файла конфигурации, чтобы начать с чистого файла настроек:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.original</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь мы можем переходить к следующему шагу и настраивать фаервол.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="-2-FTP"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">аг 2 – Разрешение FTP трафика на фаерволе</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Чтобы позволить серверу FTP, развёрнутому на ОС Ubuntu взаимодействовать с внешним миром, нужно настроить путь через фаервол. Для начала посмотрим включён ли фаервол. Запустите следующую команду для определения статуса:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ufw status</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если вы увидите такое сообщение:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ufw: command not found</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Это значит, что фаервол не установлен и можно перходить к следующему шагу.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Если же на выходе будут показаны правила или сообщение о том, что фаервол активен, нужно определить, как он будет обрабатывать FTP-трафик. Давайте сделаем следующее, откроем порты 20 и 21 для трафика FTP; порты 40000-50000 будут зарезервированы, как диапазон пассивных портов, который в конечном итоге будет установлен в файле конфигурации; порт 990 будет использоваться, когда TLS будет включен. Выполним следующие команды:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ufw allow 20/tcp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ufw allow 21/tcp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ufw allow 990/tcp</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ufw allow 40000:50000/tcp</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь посмотрим на статус:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd38f1163821732"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo ufw status</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Результат будет выглядеть где-то так:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd38f4835198228-1"></a><span style=" font-family:'Courier New,courier';">O</span><span style=" font-family:'Courier New,courier';">utput</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Status: active</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">To                         Action      From</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">--                              ------      ----</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">990/tcp                    ALLOW       Anywhere</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">20/tcp                     ALLOW       Anywhere</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">21/tcp                     ALLOW       Anywhere</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">40000:50000/tcp            ALLOW       Anywhere</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">20/tcp (v6)                ALLOW       Anywhere (v6)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">21/tcp (v6)                ALLOW       Anywhere (v6)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">990/tcp (v6)               ALLOW       Anywhere (v6)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">40000:50000/tcp (v6)       ALLOW       Anywhere (v6)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь, все необходимые порты открыты и доступны для нас и мы можем переходит к следующему шагу.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="-3"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">аг 3 – Создание каталога пользователя</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На третьем шаге создания Ubuntu FTP сервера, нужно выбрать пользователя, который будет подключатся по FTP. Для этого создадим нового пользователя, выполнив такую команду:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo adduser alex</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Заполните пароль и другие детали, когда запросит. В идеале, с точки зрения безопасности, FTP должен быть ограничен одним специальным каталогом. Vsftpd использует chroot для создания этой защиты. Со включённым chroot, локальный пользователь ограничивается его домашним каталогом (по умолчанию). Однако, может оказаться, что из-за защиты vsftpd, пользователь не сможет ничего создавать в каталоге. Мы не убираем права на запись в домашнем каталоге, вместо этого мы сделаем каталог ftp, который будет вести себя как chroot вместе с сохранением способности к записи, что будет позволять хранить файлы. Используйте такую команду для создания каталога FTP:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo mkdir /home/alex/ftp</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Установите права владения:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo chown nobody:nogroup /home/alex/ftp</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Наконец, удалите права на запись:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo chmod a-w /home/alex/ftp</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь, используя следующую команду проверьте права доступа:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo ls -la /home/alex/ftp</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На выходе мы увидим приблизительно это:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd3900312576175-1"></a><span style=" font-family:'Courier New,courier';">t</span><span style=" font-family:'Courier New,courier';">otal 8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">dr-xr-xr-x 2 nobody nogroup 4096 Jun 29 11:32 .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwxr-xr-x 3 alex   alex    4096 Jun 29 11:32 ..</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">На следующем этапе мы создадим файл, содержащий каталоги и права доступа к ним:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd3902864443741-1"></a><span style=" font-family:'Courier New,courier';">s</span><span style=" font-family:'Courier New,courier';">udo mkdir /home/alex/ftp/files</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo chown alex:alex /home/alex/ftp/files</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">И наконец, добавим в каталог тестовый файл, который мы будет использовать во время тестирования чего-либо:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">echo &quot;vsftpd sample file&quot; | sudo tee /home/alex/ftp/files/sample.txt</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="-4-vsftpd"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">аг 4 – Настройка vsftpd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Чтобы продолжить устанавливать FTP сервер на Ubuntu VPS, нам нужно настроить vsftpd и наш FTP-доступ. В этом руководстве мы разрешим одному пользователю подключаться по FTP, используя локальную консоль. Необходимая для этого двух этапная настройка уже установлена в конфигурационном файле (</span><span style=" font-family:'Ubuntu'; font-weight:600;">vsftpd.conf</span><span style=" font-family:'Ubuntu';">). Вначале проверьте, чтобы настройки в файле совпадали с указанными ниже, </span><a href="https://www.hostinger.ru/rukovodstva/kak-ustanovit-tekstoviy-redaktor-linux-nano"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">используя команду nano</span></a><span style=" font-family:'Ubuntu';">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo nano /etc/vsftpd.conf</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd3908138702405-1"></a><span style=" font-family:'Courier New,courier';">.</span><span style=" font-family:'Courier New,courier';"> . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># Allow anonymous FTP? (Disabled by default).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">anonymous_enable=NO</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># Uncomment this to allow local users to log in.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">local_enable=YES</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">. . .</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом же файле, продолжим удаляя </span><span style=" font-family:'Ubuntu'; font-weight:600;">#</span><span style=" font-family:'Ubuntu';"> включаем </span><span style=" font-family:'Ubuntu'; font-weight:600;">write_enable</span><span style=" font-family:'Ubuntu';">:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd3909850205764-1"></a><span style=" font-family:'Courier New,courier';">.</span><span style=" font-family:'Courier New,courier';"> . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">write_enable=YES</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">. . .</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Chroot также раскоментируем, чтобы убедиться, что пользователь, подключившийся по FTP имеет доступ к файлам внутри разрешённой директории:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd390d315549351-1"></a><span style=" font-family:'Courier New,courier';">.</span><span style=" font-family:'Courier New,courier';"> . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chroot_local_user=YES</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">. . .</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Несколько новых значений будут также нужны для добавления вручную. Вы можете просто вставить их в конец файла. Вначале, </span><span style=" font-family:'Ubuntu'; font-weight:600;">user_sub_token</span><span style=" font-family:'Ubuntu';"> добавим к пути каталога local_root. Это позволит конфигурации работать с текущим пользователем и любым другим пользователем, который будет добавлен позже:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd390f792967932-1"></a><span style=" font-family:'Courier New,courier';">u</span><span style=" font-family:'Courier New,courier';">ser_sub_token=$USER</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">local_root=/home/$USER/ftp</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Чтобы быть уверенным, что доступно достаточное количество соединений, мы ограничим количество портов, используемое в конфигурационном файле:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd3911820626369-1"></a><span style=" font-family:'Courier New,courier';">p</span><span style=" font-family:'Courier New,courier';">asv_min_port=40000</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">pasv_max_port=50000</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом руководстве мы планируем дать доступ индивидуальной основе, поэтому давайте установим настройки так, чтобы дать доступ только тем пользователям, которые непосредственно добавлены в список:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a6e113bd3913046975171-1"></a><span style=" font-family:'Courier New,courier';">u</span><span style=" font-family:'Courier New,courier';">serlist_enable=YES</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">userlist_file=/etc/vsftpd.userlist</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">userlist_deny=NO</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Флаг </span><span style=" font-family:'Ubuntu'; font-weight:600;">userlist_deny</span><span style=" font-family:'Ubuntu';"> отвечает за переключение логики, когда он установлен в “NO”, только те пользователи, которые есть в списке имеет доступ. По завершению нажмите </span><span style=" font-family:'Ubuntu'; font-weight:600;">CTRL+X</span><span style=" font-family:'Ubuntu';"> и подтвердите сохранения изменений в файле.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В завершение, продолжим создание и добавление нашего пользователя в файл:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">echo &quot;alex&quot; | sudo tee -a /etc/vsftpd.userlist</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Проверим, что пользователь действительно активен запуском команды:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">cat /etc/vsftpd.userlist</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вывод должен быть “</span><span style=" font-family:'Ubuntu'; font-weight:600;">alex</span><span style=" font-family:'Ubuntu';">”, как показано на скриншоте:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1418146825.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Перезапустите демона, используя следующую команду, чтобы запустить изменения настроек:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo systemctl restart vsftpd</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="-5-FTP"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">аг 5 – Делаем защищенный FTP</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">По умолчанию, FTP не делает никакого шифрование данных, поэтому мы будем использовать TLS/SSL, чтобы позаботиться о безопасности. В качестве первого шага нам нужно создать SSL сертификат и использовать его для защиты Ubuntu FTP сервера. Для начала выполним следующую команду:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Флаг –</span><span style=" font-family:'Ubuntu'; font-weight:600;">days</span><span style=" font-family:'Ubuntu';"> делает сертификат действующим в течение года и мы включаем 2048-битный приватный ключ RSA в этой же команде. Когда запросит нужные данные введите их в предоставленном поле.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После создания сертификата ещё раз откройте конфигурационный файл:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo nano /etc/vsftpd.conf</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В конце файла есть строка с “</span><span style=" font-family:'Ubuntu'; font-weight:600;">_rsa</span><span style=" font-family:'Ubuntu';">”. Закомментируйте эти две строки:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вместо этого мы направим конфиг файл на сертификат, который мы создали. Добавьте такие строки:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">rsa_cert_file=/etc/ssl/private/vsftpd.pem</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">rsa_private_key_file=/etc/ssl/private/vsftpd.pem</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь мы включим SSL и убедимся, что только пользователи со включённым SSL могут с нами связываться. Измените значение </span><span style=" font-family:'Ubuntu'; font-weight:600;">ssl_enable</span><span style=" font-family:'Ubuntu';"> на </span><span style=" font-family:'Ubuntu'; font-weight:600;">YES</span><span style=" font-family:'Ubuntu';">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ssl_enable=YES</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь добавьте следующие строки для продолжения создания защиты (это запретить какие-либо анонимные соединения с использованием SSL):</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">allow_anon_ssl=NO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">force_local_data_ssl=YES</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">force_local_logins_ssl=YES</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Настройте TLS используя:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ssl_tlsv1=YES</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ssl_sslv2=NO</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ssl_sslv3=NO</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Здесь мы добавим ещё 2 опции. Во-первых, повторное использование SSL не будет необходимым, потому что это может привести к разрывам у большого количества клиентов. Во-вторых, мы будем использовать высокозащищенный код шифрования, что будет означать, что длина ключа соответствует (или больше, чем) 128 бит.</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">require_ssl_reuse=NO</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ssl_ciphers=HIGH</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Сделаем ещё раз перезапуск, для вступления изменений в силу:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sudo systemctl restart vsftpd</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Прекрасно! Вот вы и настроили FTP сервер на вашем Ubuntu VPS для работы с протоколом SSL/TLS.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="-6--FileZilla"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Ш</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">аг 6 – Проверка подключения, используя FileZilla</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Сегодня FTP клиенты поддерживают настройку шифрования TLS, поэтому это прекрасная возможность проверить, работает ли наш Ubuntu FTP сервер как следует. Чтобы проверить соединение, будем использовать </span><a href="https://www.hostinger.ru/rukovodstva/nastroika-filezilla"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">FileZilla FTP клиент</span></a><span style=" font-family:'Ubuntu';">. Для начала запустите FileZilla, нажатием на иконку </span><span style=" font-family:'Ubuntu'; font-weight:600;">Site Manager</span><span style=" font-family:'Ubuntu';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1224341600.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Нажмите на кнопку </span><span style=" font-family:'Ubuntu'; font-weight:600;">New Site</span><span style=" font-family:'Ubuntu';"> в появившемся окне начните заполнять данные о Ubuntu FTP сервере.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2066340144.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Заполните необходимые поля информацией о недавно созданном Ubuntu FTP сервере. Так как мы настроили его с использованием TLS, мы может отметить настройку шифрования в “</span><span style=" font-family:'Ubuntu'; font-weight:600;">explicit FTP over TLS” </span><span style=" font-family:'Ubuntu';">положение. Окончательное окно настроек выглядит так:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image479208721.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Как только настроите, нажимайте </span><span style=" font-family:'Ubuntu'; font-weight:600;">Connect </span><span style=" font-family:'Ubuntu';">и появится окошко с запросом для введения пароля пользователя FTP.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image664150528.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В заключение вам нужно будет подтвердить SSL сертификат на вашем FTP сервере на Ubuntu VPS.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image114638398.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">После подтверждения, корневой root-каталог с тестовым файлом появятся на вашем экране.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1946748036.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Это всё! Теперь вы можете производить любую передачу файлов с вашего компьютера на Ubuntu FTP сервер и обратно.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="i"></a><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">З</span><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">аключение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В этом руководстве мы прошли шаг за шагом путь создания для локального пользователя безопасного способа передачи файлов через FTP с SSL/TLS на Ubuntu FTP сервере. Также мы протестировали соединения, используя FileZilla, чтобы убедиться, что всё работает.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"> </span></p></body></html>