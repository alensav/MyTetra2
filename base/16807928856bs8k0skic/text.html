<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:72px; margin-right:72px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a href="https://habr.com/ru/flows/popsci/"><span style=" font-family:'Ubuntu'; font-weight:496; text-decoration: underline; color:#909090; background-color:#000000;">Научпоп</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image958971751.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/users/ivizil/"><span style=" font-family:'Ubuntu'; font-weight:696; text-decoration: underline; color:#414b50; background-color:#000000; vertical-align:middle;">ivizil</span></a><span style=" font-family:'Ubuntu'; font-weight:496; color:#777777; vertical-align:middle;">25 апр 2016 в 11:00</span></p>
<p style=" margin-top:0px; margin-bottom:8px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.3%;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:xx-large; font-weight:496; color:#333333;">Esp8266 управление через интернет по протоколу MQTT</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:8px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.3%; font-family:'Fira Sans,sans-serif'; font-size:xx-large; font-weight:496; color:#333333;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:8px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Fira Sans,sans-serif'; font-size:xx-large; font-weight:496; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%;"><img src="image494238546.png" /><a name="post-content-body"></a><span style=" font-family:'Ubuntu'; color:#111111;"><br /></span><span style=" font-family:'Ubuntu'; color:#111111;">Всем привет! В этой статье будет подробно рассказано и показано как буквально за 20 минут свободного времени настроить дистанционное управление модулем esp8266 с помощью приложения на Android по протоколу MQTT.<br /><br />Идея дистанционного управления и мониторинга всегда будоражила умы увлеченных в электронике и программировании людей. Ведь возможность в любой момент времени получить или отправить нужные данные, не зависимо от своего местоположения, дает широкие возможности. В своих прошлых статьях ( </span><a href="https://geektimes.ru/post/255546/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#548eaa; background-color:#000000;">Статья 1</span></a><span style=" font-family:'Ubuntu'; color:#111111;"> и </span><a href="https://geektimes.ru/post/258504/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#548eaa; background-color:#000000;">Статья 2</span></a><span style=" font-family:'Ubuntu'; color:#111111;">) я пытался рассмотреть несколько доступных и относительно простых вариантах реализации дистанционного управления микроконтроллерами через интернет. Однако время и весь мир не стоит на месте – прогресс продолжает свое неумолимое движение вперед. За это небольшое время приобрел широкую популярность модуль esp8266 который благодаря низкой цене и встроенному wi-fi стал одним из основных составляющих «Умного дома».<br /></span><a name="habracut"></a><span style=" font-family:'Ubuntu'; color:#111111;"><br /></span><span style=" font-family:'Ubuntu'; color:#111111;">На данный момент MQTT является передовым и наиболее популярным протоколом передачи данных между отдельными устройствами в рамках систем «Умного дома». Он обладает рядом преимуществ по отношению к другим протоколам:<br />— низкое потребление трафика;<br />— соединение между клиентом и сервером всегда открыто;<br />— не нагружает интернет канал;<br />— отсутствие задержек в передаче данных;<br />— удобная система подписок на топики;<br />Всё это дает возможность мониторинга и управления в режиме реального времени. Однако MQTT требует наличие своего собственного сервера, который выполняет роль посредника между клиентами сети. Тут есть два выхода либо создавать свой сервер либо использовать сторонние сервисы.<br /><br />Описываемая система управления состоит из двух основных частей: сервера MQTT (он как правило один) и клиентов, которых может быть довольно много. В нашем случае в качестве клиентов будут выступать приложение на Android и сам модуль esp8266.<br /><br />Алгоритм работы системы следующий. Клиенты подключаются к серверу и сразу после подключения каждый из них осуществляет подписку на и интересующие его топики. Всё общение между клиентами проходит транзитом через сервер, который перенаправляет данные другим клиентам с учетом их подписок.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#111111;">MQTT сервер.</span><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br />В нашем случае мы будем использовать крайне удобный сервис </span><a href="https://www.cloudmqtt.com/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#548eaa; background-color:#000000;">www.cloudmqtt.com</span></a><span style=" font-family:'Ubuntu'; color:#111111;"> у которого есть бесплатный тарифный план (Cute Cat), который полностью покроет потребности для реализации небольшой собственной системы «умного дома».<br /></span><img src="image1562723636.png" /><span style=" font-family:'Ubuntu'; color:#111111;"><br />Пройдём регистрацию на сайте и получаем необходимые данные для доступа к серверу. При настройке клиентов необходимо использовать обычный Порт ( без SSL и TLS).<br /></span><img src="image598719576.png" /><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#111111;">Приложение на Android.</span><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br />Наше приложение будет выступать в качестве пульта управления для микроконтроллера, а так же будет принимать и отображать всю получаемую информацию от esp8266.<br /><br />Приложение называется </span><a href="https://play.google.com/store/apps/details?id=com.thn.iotmqttdashboard&amp;hl=ru"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#548eaa; background-color:#000000;">IoT MQTT Dashboard</span></a><span style=" font-family:'Ubuntu'; color:#111111;"> и представляет собой готовый mqtt клиент с небольшим количеством очень удобных виджетов. Более подробно о работе с приложением можно посмотреть на видео.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#111111;">Esp8266.</span><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br />Модуль прошивается в среде программирования Arduino, однако хочу заметить что у модуля проблемы с прошивкой в последних версиях Arduino, поэтому рекомендую использовать версию 1.6.4.<br />Для примера к esp8266 подключены светодиод (5 пин) и датчик температуры ds18b20 (2 пин).<br />Так как для управления светодиода необходимо получать данные, то esp после подключения должно оформить подписку на соответствующий топик «test/led» иначе все отправленные данные пройдут мимо нашего микроконтроллера.<br />Для отправки данных температуры подписка не нужно, но при передаче значений температуры необходимо указывать топик в который эти данные пойдут.<br /><br />Ниже приведен скетч с подробными комментариями.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#548eaa;">Скетч Esp8266_mqtt.ino</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br />В результате мы получаем удобный инструмент для дистанционного управления и мониторинга данных, который довольно прост в освоении и будет по силу даже начинающим.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#111111;">Видео с демонстрацией работы системы управления</span><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#111111;">Подробная видеоинструкция по настройке системы</span><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#111111;">Один из вариантов применения управления esp8266 через MQTT протокол</span><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600; color:#111111;">Управление светодиодной лентой через интернет</span><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br /><br />Если у вас возникли вопросы по данному материалу, то рекомендую посмотреть вторую часть видео, где материал изложен более наглядно.<br /><br />В архиве находятся скетч и все необходимые библиотеки для прошивки микроконтроллера скетчем из примера.<br />Обращаю ваше внимание, что библиотека ESP8266WiFi.h не входит в данный архив, она устанавливается через Boards manager в среде Arduino.<br /><br /></span><a href="https://cloud.mail.ru/public/44nnTMk9dBFu/Files.zip"><span style=" font-family:'Ubuntu'; font-weight:600; text-decoration: underline; color:#548eaa; background-color:#000000;">АРХИВ</span></a><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br />MQTT сервер — </span><a href="https://www.cloudmqtt.com/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#548eaa; background-color:#000000;">www.cloudmqtt.com</span></a><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br />Ссылка на приложение IoT MQTT Dashboard — </span><a href="https://play.google.com/store/apps/details?id=com.thn.iotmqttdashboard&amp;hl=ru"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#548eaa; background-color:#000000;">play.google.com/store/apps/details?id=com.thn.iotmqttdashboard&amp;hl=ru</span></a><span style=" font-family:'Ubuntu'; color:#111111;"><br /><br />Всем спасибо за внимание.</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:28.8px;"><span style=" font-family:'Ubuntu'; font-weight:696; color:#444444;">Теги:</span><span style=" font-family:'Ubuntu'; color:#548eaa;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu'; color:#548eaa;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Barduino%5D"><span style=" font-weight:496; text-decoration: underline; color:#0000ff; background-color:#000000;">arduino</span></a></li>
<li style=" font-family:'Ubuntu'; color:#548eaa;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Besp8266%5D"><span style=" font-weight:496; text-decoration: underline; color:#0000ff; background-color:#000000;">esp8266</span></a></li>
<li style=" font-family:'Ubuntu'; color:#548eaa;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmqtt%5D"><span style=" font-weight:496; text-decoration: underline; color:#0000ff; background-color:#000000;">mqtt</span></a></li>
<li style=" font-family:'Ubuntu'; color:#548eaa;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bandroid%5D"><span style=" font-weight:496; text-decoration: underline; color:#0000ff; background-color:#000000;">android</span></a></li>
<li style=" font-family:'Ubuntu'; color:#548eaa;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsmart%20home%5D"><span style=" font-weight:496; text-decoration: underline; color:#0000ff; background-color:#000000;">smart home</span></a></li></ul>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-weight:696; color:#444444;">Хабы:</span><span style=" font-family:'Ubuntu'; color:#548eaa;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu'; color:#548eaa;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/home_automation/"><span style=" font-weight:496; text-decoration: underline; color:#0000ff; background-color:#000000;">Умный дом</span></a></li>
<li style=" font-family:'Ubuntu'; color:#548eaa;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/DIY/"><span style=" font-weight:496; text-decoration: underline; color:#0000ff; background-color:#000000;">DIY или Сделай сам</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:108px; margin-right:108px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="counter-rating"></a><span style=" font-family:'Ubuntu';"><br /></span></p></body></html>