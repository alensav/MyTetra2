<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:xx-large; font-weight:600;">Права в Linux (chown, chmod, SUID, GUID, sticky bit, ACL, umask) </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/linux/"><span style=" text-decoration: underline; color:#0000ff;">Настройка Linux</span></a>, </li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/sys_admin/"><span style=" text-decoration: underline; color:#0000ff;">Системное администрирование</span></a> </li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/sandbox/"><span style=" text-decoration: underline; color:#0000ff;">Из песочницы</span></a> </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-content-body"></a><span style=" font-family:'Ubuntu';">В</span><span style=" font-family:'Ubuntu';">сем привет. Это перевод статьи из книги RedHat RHCSA RHCE 7 RedHat Enterprise Linux 7 EX200 and EX300.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">От себя:</span><span style=" font-family:'Ubuntu';"> Надеюсь статья будет полезна не только начинающим, но и поможет более опытным администраторам упорядочить свои знания.<br /><br />Итак, поехали.<br /><br /></span><img src="image1003001824.png" /><span style=" font-family:'Ubuntu';"><br /></span><a name="habracut"></a><span style=" font-family:'Ubuntu';"><br /></span><span style=" font-family:'Ubuntu';">Чтобы получить доступ к файлам в Linux, используются разрешения. Эти разрешения назначаются трем объектам: файлу, группе и другому объекту (то есть всем остальным). В этой статье вы узнаете, как применять разрешения.<br /><br />Статья начинается с обзора основных понятий, после чего обсуждаются специальные разрешения (Special permissions) и списки контроля доступа (ACL). В конце этой статьи рассматривается настройка прав доступа по умолчанию через umask, а также управление расширенными атрибутами пользователя.<br /><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Управление владением файлами</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Прежде чем обсуждать разрешения, вы должны знать о роли владельца файла и каталога. Владение файлами и каталогами жизненно важно для работы с разрешениями. В этом разделе вы сначала узнаете, как вы можете увидеть владельца. Затем вы узнаете, как изменить владельца группы и пользователя для файлов и каталогов.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Отображение владельца файла или каталога</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />В Linux у каждого файла и каждого каталога есть два владельца: пользователь и группа.<br /><br />Эти владельцы устанавливаются при создании файла или каталога. Пользователь, который создаёт файл становится владельцем этого файла, а первичная группа, в которую входит этот же пользователь, так же становится владельцем этого файла. Чтобы определить, есть ли у вас как у пользователя права доступа к файлу или каталогу, оболочка проверяет владение ими.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">Это происходит в следующем порядке:</span><span style=" font-family:'Ubuntu';"><br /><br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Оболочка проверяет, являетесь ли вы владельцем файла, к которому вы хотите получить доступ. Если вы являетесь этим владельцем, вы получаете разрешения и оболочка прекращает проверку.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы не являетесь владельцем файла, оболочка проверит, являетесь ли вы участником группы, у которой есть разрешения на этот файл. Если вы являетесь участником этой группы, вы получаете доступ к файлу с разрешениями, которые для группы установлены, и оболочка прекратит проверку.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы не являетесь ни пользователем, ни владельцем группы, вы получаете права других пользователей (Other).</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Чтобы увидеть текущие назначения владельца, вы можете использовать команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">ls -l</span><span style=" font-family:'Ubuntu';">. Эта команда показывает пользователя и группу-владельца. Ниже вы можете увидеть настройки владельца для каталогов в каталоге /home.<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@server1 home]# ls -l</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">total 8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 3  bob            bob            74     Feb   6   10:13 bob</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 3  caroline       caroline       74     Feb   6   10:13 caroline</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 3  fozia          fozia          74     Feb   6   10:13 fozia</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 3  lara           lara           74     Feb   6   10:13 lara</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 5  lisa           lisa           4096   Feb   6   10:12 lisa</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 14 user           user           4096   Feb   5   10:35 user</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />С помощью команды </span><span style=" font-family:'Ubuntu'; font-weight:600;">ls</span><span style=" font-family:'Ubuntu';"> вы можете отобразить владельца файлов в данном каталоге. Иногда может оказаться полезным получить список всех файлов в системе, в которых в качестве владельца указан данный пользователь или группа. Для этого вы можете использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">find</span><span style=" font-family:'Ubuntu';">. Аргумент </span><span style=" font-family:'Ubuntu'; font-weight:600;">find -user</span><span style=" font-family:'Ubuntu';"> может быть использован для этой цели. Например, следующая команда показывает все файлы, у которых в качестве владельца указан пользователь linda:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">find / -user linda</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Вы также можете использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">find </span><span style=" font-family:'Ubuntu';">для поиска файлов, у которых определенная группа является их владельцем.<br /><br />Например, следующая команда ищет все файлы, принадлежащие группе </span><span style=" font-family:'Ubuntu'; font-style:italic;">users</span><span style=" font-family:'Ubuntu';">:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">find / -group users</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Изменение владельца</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Чтобы применить соответствующие разрешения, первое, что нужно учитывать, это владение. Для этого есть команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">chown</span><span style=" font-family:'Ubuntu';">. Синтаксис этой команды несложен для понимания:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chown кто что</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Например, следующая команда меняет владельца каталога /home/account на пользователя linda:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chown linda /home/account</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">chown </span><span style=" font-family:'Ubuntu';">имеет несколько опций, одна из которых особенно полезна: </span><span style=" font-family:'Ubuntu'; font-weight:600;">-R</span><span style=" font-family:'Ubuntu';">. Вы можете догадаться, что она делает, потому что эта опция доступна и для многих других команд. Это позволяет вам рекурсивно устанавливать владельца, что позволяет вам установить владельца текущего каталога и всего, что находится ниже. Следующая команда меняет владельца для каталога /home и всего, что находится под ним, на пользователя lisa:<br /><br />Сейчас владельцы выглядят так:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@localhost ~]# ls -l /home</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">total 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 2 account account 62 Sep 25 21:41 account</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 2 lisa    lisa    62 Sep 25 21:42 lisa</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Выполним:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@localhost ~]# chown -R lisa /home/account</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@localhost ~]#</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Теперь пользователь lisa стал владельцем каталога account:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@localhost ~]# ls -l /home</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">total 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 2 lisa account 62 Sep 25 21:41 account</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwx------. 2 lisa lisa    62 Sep 25 21:42 lisa</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Изменение владельца группы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Есть два способа изменить владение группой. Вы можете сделать это, используя </span><span style=" font-family:'Ubuntu'; font-weight:600;">chown</span><span style=" font-family:'Ubuntu';">, но есть специальная команда с именем </span><span style=" font-family:'Ubuntu'; font-weight:600;">chgrp</span><span style=" font-family:'Ubuntu';">, которая выполняет эту работу. Если вы хотите использовать команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">chown</span><span style=" font-family:'Ubuntu';">, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">.</span><span style=" font-family:'Ubuntu';"> или </span><span style=" font-family:'Ubuntu'; font-weight:600;">: </span><span style=" font-family:'Ubuntu';">перед названием группы.<br /><br />Следующая команда изменяет какого-либо владельца группы /home/account на группу account:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chown .account /home/account</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Вы можете использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">chown </span><span style=" font-family:'Ubuntu';">для изменения владельца пользователя и/или группы несколькими способами. Вот несколько примеров:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">chown lisa myfile1</span> устанавливает пользователя lisa владельцем файла myfile1.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">chown lisa.sales myfile</span> устанавливает пользователя lisa владельцем файла myfile, а так же устанавливает группу sales владельцем этого же файла.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">chown lisa:sales myfile</span> то же самое, что и предыдущая команда.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">chown .sales myfile</span> устанавливает группу sales владельцем файла myfile без изменения владельца пользователя.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">chown :sales myfile</span> то же самое, что и предыдущая команда.</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Вы можете использовать команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">chgrp</span><span style=" font-family:'Ubuntu';">, чтобы изменить владельца группы. Рассмотрим следующий пример, где вы можете с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">chgrp </span><span style=" font-family:'Ubuntu';">установить владельцем каталога account группу sales:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chgrp .sales /home/account</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Как и в случае с </span><span style=" font-family:'Ubuntu'; font-weight:600;">chown</span><span style=" font-family:'Ubuntu';">, вы можете использовать опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">-R</span><span style=" font-family:'Ubuntu';"> с </span><span style=" font-family:'Ubuntu'; font-weight:600;">chgrp</span><span style=" font-family:'Ubuntu';">, а также рекурсивно менять владельца группы.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Понимание владельца по умолчанию</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Вы могли заметить, что когда пользователь создает файл, применяется владение по умолчанию.<br />Пользователь, который создает файл, автоматически становится владельцем этого файла, а основная группа этого пользователя автоматически становится владельцем этого файла. Обычно это группа, которая указана в файле /etc/passwd в качестве основной группы пользователя. Однако если пользователь является членом нескольких групп, он может изменить эффективную основную группу.<br /><br />Чтобы показать текущую эффективную первичную группу, пользователь может использовать команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">groups</span><span style=" font-family:'Ubuntu';">:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@server1 ~]# groups lisa</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lisa : lisa account sales</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Если текущий пользователь linda хочет изменить эффективную первичную группу, он будет использовать команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">newgrp</span><span style=" font-family:'Ubuntu';">, за которой следует имя группы, которую он хочет установить в качестве новой эффективной первичной группы. После использования команды </span><span style=" font-family:'Ubuntu'; font-weight:600;">newgrp</span><span style=" font-family:'Ubuntu';"> первичная группа будет активна, пока пользователь не введет команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">exit </span><span style=" font-family:'Ubuntu';">или не выйдет из системы.<br /><br />Ниже показано, как пользователь lisa использует эту команду, что бы первичной группой стала группа sales:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lisa@server1 ~]$ groups</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">lisa account sales</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[lisa@server1 ~]$ newgrp sales</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[lisa@server1 ~]$ groups</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sales lisa account</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[lisa@server1 ~]$ touch file1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[lisa@server1 ~]$ ls -l</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">total 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">-rw-r--r--. 1 lisa sales 0 Feb 6 10:06 file1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />После изменения действующей основной группы все новые файлы, созданные пользователем, получат эту группу в качестве группы-владельца.Чтобы вернуться к исходной настройке первичной группы, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">exit</span><span style=" font-family:'Ubuntu';">.<br /><br />Чтобы иметь возможность использовать команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">newgrp</span><span style=" font-family:'Ubuntu';">, пользователь должен быть членом той группы, которую он хочет использовать в качестве первичной. Кроме этого, групповой пароль может быть использован для группы с помощью команды </span><span style=" font-family:'Ubuntu'; font-weight:600;">gpasswd</span><span style=" font-family:'Ubuntu';">. Если пользователь использует команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">newgrp</span><span style=" font-family:'Ubuntu';">, но не является членом целевой группы, оболочка запрашивает пароль группы. После того, как вы введете правильный групповой пароль, будет установлена новая эффективная первичная группа.<br /><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Управление основными правами</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Система разрешений Linux была изобретена в 1970-х годах. Поскольку вычислительные потребности были ограничены в те годы, базовая система разрешений была довольно ограничена. Эта система разрешений использует три разрешения, которые можно применять к файлам и каталогам. В этом разделе вы узнаете, как использовать и изменять эти разрешения.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Понимание прав на чтение, запись и выполнение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Три основных разрешения позволяют вам читать, записывать и выполнять файлы. Эффект этих разрешений отличается при применении к файлам или каталогам. Применительно к файлу разрешение на чтение дает вам право открыть файл для чтения. Следовательно, вы можете прочитать его содержимое, но это означает, что ваш компьютер может открыть файл, чтобы что-то с ним сделать. <br /><br />Программный файл, которому требуется доступ к библиотеке, должен, например, иметь доступ для чтения к этой библиотеке. Из этого следует, что разрешение на чтение — это самое основное разрешение, которое вам нужно для работы с файлами.<br /><br />Применительно к каталогу чтение позволяет отображать содержимое этого каталога. Вы должны знать, что это разрешение не позволяет вам читать файлы в каталоге. Система разрешений Linux не знает наследования, и единственный способ прочитать файл — использовать разрешения на чтение для этого файла.<br /><br />Как вы, вероятно, можете догадаться, разрешение на запись, если оно применяется к файлу, позволяет записывать в файл. Иначе говоря, позволяет изменять содержимое существующих файлов. Однако он не позволяет создавать или удалять новые файлы или изменять права доступа к файлу. Для этого вам нужно дать разрешение на запись каталогу, где вы хотите создать файл. В каталогах это разрешение также позволяет создавать и удалять новые подкаталоги.<br /><br />Разрешение на выполнение — это то, что вам нужно для выполнения файла. Оно никогда не будет установлено по умолчанию, что делает Linux практически полностью невосприимчивым к вирусам. Только кто-то с правами записи на каталог может применять разрешение на выполнение.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">Ниже обобщается использование основных разрешений:</span><span style=" font-family:'Ubuntu';"><br /><br /></span><img src="image130274669.png" /><span style=" font-family:'Ubuntu';"><br /><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Использование chmod</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Для управления правами используется команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod</span><span style=" font-family:'Ubuntu';">. При использовании </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod </span><span style=" font-family:'Ubuntu';">вы можете устанавливать разрешения для пользователя (user), группы (group) и других (other). Вы можете использовать эту команду в двух режимах: относительный режим и абсолютный режим. В абсолютном режиме три цифры используются для установки основных разрешений.<br /><br /></span><img src="image392946618.png" /><span style=" font-family:'Ubuntu';"><br /><br />При настройке разрешений рассчитайте необходимое вам значение. Если вы хотите установить чтение, запись и выполнение для пользователя, чтение и выполнение для группы, а также чтение и выполнение для других в файле /somefile, то вы используете следующую команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod</span><span style=" font-family:'Ubuntu';">:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chmod 755 /somefile</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Когда вы используете </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod </span><span style=" font-family:'Ubuntu';">таким способом, все текущие разрешения заменяются установленными вами разрешениями.<br /><br />Если вы хотите изменить разрешения относительно текущих разрешений, вы можете использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod </span><span style=" font-family:'Ubuntu';">в относительном режиме. При использовании </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod </span><span style=" font-family:'Ubuntu';">в относительном режиме вы работаете с тремя индикаторами, чтобы указать, что вы хотите сделать:<br /><br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сначала вы указываете, для кого вы хотите изменить разрешения. Для этого вы можете выбрать между пользователем (<span style=" font-weight:600;">u</span>), группой (<span style=" font-weight:600;">g</span>) и другими (<span style=" font-weight:600;">o</span>).</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Затем вы используете оператор для добавления или удаления разрешений из текущего режима или устанавливаете их абсолютно.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В конце вы используете <span style=" font-weight:600;">r</span>, <span style=" font-weight:600;">w </span>и <span style=" font-weight:600;">x</span>, чтобы указать, какие разрешения вы хотите установить.</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />При изменении разрешений в относительном режиме вы можете пропустить часть «кому», чтобы добавить или удалить разрешение для всех объектов. Например, эта команда добавляет разрешение на выполнение для всех пользователей:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chmod +x somefile</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />При работе в относительном режиме вы также можете использовать более сложные команды. Например, эта команда добавляет разрешение на запись в группу и удаляет чтение для других:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chmod g+w,o-r somefile</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />При использовании </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod -R o+rx /data</span><span style=" font-family:'Ubuntu';"> вы устанавливаете разрешение на выполнение для всех каталогов, а также для файлов в каталоге /data. Чтобы установить разрешение на выполнение только для каталогов, а не для файлов, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod -R o+ rX /data</span><span style=" font-family:'Ubuntu';">. <br /><br />Верхний регистр X гарантирует, что файлы не получат разрешение на выполнение, если файл уже не установил разрешение на выполнение для некоторых объектов. Это делает X более разумным способом работы с разрешениями на выполнение; это позволит избежать установки этого разрешения на файлы, где оно не требуется.<br /><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Расширенные права</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Помимо основных разрешений, о которых вы только что прочитали, в Linux также есть набор расширенных разрешений. Это не те разрешения, которые вы устанавливаете по умолчанию, но иногда они предоставляют полезное дополнение. В этом разделе вы узнаете, что они из себя представляют и как их настроить.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Понимание расширенных прав SUID, GUID и sticky bit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Есть три продвинутых разрешения. Первое из них — это разрешение на установку идентификатора пользователя (SUID). В некоторых особых случаях вы можете применить это разрешение к исполняемым файлам. По умолчанию пользователь, запускающий исполняемый файл, запускает этот файл со своими собственными разрешениями. <br /><br />Для обычных пользователей это обычно означает, что использование программы ограничено. Однако в некоторых случаях пользователю требуются специальные разрешения, только для выполнения определенной задачи.<br /><br />Рассмотрим, например, ситуацию, когда пользователю необходимо сменить пароль. Для этого пользователь должен записать свой новый пароль в файл /etc/shadow. Однако этот файл недоступен для записи пользователям, не имеющим прав доступа root:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">root@hnl ~]# ls -l /etc/shadow</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------. 1 root root 1184 Apr 30 16:54 /etc/shadow</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Разрешение SUID предлагает решение этой проблемы. В утилите /usr/bin/passwd это разрешение применяется по умолчанию. Это означает, что при смене пароля пользователь временно получает права root, что позволяет ему записывать в файл /etc/shadow. Вы можете видеть разрешение SUID с </span><span style=" font-family:'Ubuntu'; font-weight:600;">ls -l</span><span style=" font-family:'Ubuntu';"> как </span><span style=" font-family:'Ubuntu'; font-weight:600;">s </span><span style=" font-family:'Ubuntu';">в позиции, где обычно вы ожидаете увидеть </span><span style=" font-family:'Ubuntu'; font-weight:600;">x </span><span style=" font-family:'Ubuntu';">для пользовательских разрешений:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@hnl ~]# ls -l /usr/bin/passwd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">-rwsr-xr-x. 1 root root 32680 Jan 28 2010 /usr/bin/passwd</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Разрешение SUID может выглядеть полезным (и в некоторых случаях так оно и есть), но в то же время оно потенциально опасно. При неправильном применении вы можете случайно раздать права доступа root. Поэтому я рекомендую использовать его только с максимальной осторожностью. <br /><br />Большинству администраторов никогда не придется его использовать; вы увидите его только в некоторых файлах, где операционная система должна установить его по умолчанию.<br /><br />Второе специальное разрешение — это идентификатор группы (SGID). Это разрешение имеет два эффекта. При применении к исполняемому файлу, он дает пользователю, который исполняет файл, разрешения владельца группы этого файла. Таким образом, SGID может выполнить более или менее то же самое, что SUID. Однако для этой цели SGID практически не используется.<br /><br />Как и в случае с разрешением SUID, SGID применяется к некоторым системным файлам в качестве настройки по умолчанию.<br /><br />Когда применяется к каталогу, SGID может быть полезен, потому что вы можете использовать его для установки владельца группы по умолчанию для файлов и подкаталогов, созданных в этом каталоге. По умолчанию, когда пользователь создает файл, его эффективная первичная группа устанавливается как владелец группы для этого файла. <br /><br />Это не всегда очень полезно, особенно потому, что у пользователей Red Hat/CentOS в качестве основной группы задана группа с тем же именем, что и у пользователя, и из которых пользователь является единственным участником. Таким образом, по умолчанию файлы, которые создает пользователь, будут групповыми для общего доступа.<br /><br />Представьте себе ситуацию, когда пользователи linda и lori работают в бухгалтерии и являются членами группы </span><span style=" font-family:'Ubuntu'; font-style:italic;">account</span><span style=" font-family:'Ubuntu';">. По умолчанию эти пользователи являются членами частной группы, единственным членом которой они являются. Однако оба пользователя являются членами группы account, но также и в качестве параметра вторичной группы.<br /><br />Ситуация по умолчанию состоит в том, что когда любой из этих пользователей создает файл, основная группа становится владельцем. Поэтому по умолчанию linda не может получить доступ к файлам, созданным lori, и наоборот. Однако, если вы создаете общий каталог группы (скажем, /groups/account) и убедитесь, что разрешение SGID применено к этому каталогу и что учет группы установлен как владелец группы для этого каталога, все файлы, созданные в этом каталоге и во всех его подкаталогах, также получают account группы как владельца группы по умолчанию. <br /><br />По этой причине разрешение SGID является очень полезным разрешением для установки в каталогах общих групп.<br /><br />Разрешение SGID показывается в выводе </span><span style=" font-family:'Ubuntu'; font-weight:600;">ls -ld</span><span style=" font-family:'Ubuntu';"> как </span><span style=" font-family:'Ubuntu'; font-weight:600;">s </span><span style=" font-family:'Ubuntu';">в позиции, где вы обычно находите разрешение на выполнение группы:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@hnl data]# ls -ld account</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwxr-sr-x. 2 root account 4096 Apr 30 21:28 account</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Третий из специальных разрешений — sticky bit. Это разрешение полезно для защиты файлов от случайного удаления в среде, где несколько пользователей имеют права на запись в один и тот же каталог. Если применяется закрепленный sticky bit, пользователь может удалить файл, только если он является пользователем-владельцем файла или каталога, в котором содержится файл. По этой причине он применяется в качестве разрешения по умолчанию для каталога /tmp и может быть полезен также для каталогов общих групп.<br /><br />Без sticky bit, если пользователь может создавать файлы в каталоге, он также может удалять файлы из этого каталога. В общедоступной групповой среде это может раздражать. Представьте себе пользователей linda и lori, которые оба имеют права на запись в каталог /data/account и получают эти разрешения благодаря участию в группе account. Поэтому linda может удалять файлы, созданные lori, и наоборот.<br /><br />Когда вы применяете sticky bit, пользователь может удалять файлы, только если выполняется одно из следующих условий:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пользователь является владельцем файла;</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пользователь является владельцем каталога, в котором находится файл.</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />При использовании </span><span style=" font-family:'Ubuntu'; font-weight:600;">ls -ld</span><span style=" font-family:'Ubuntu';">, вы можете видеть sticky bit как </span><span style=" font-family:'Ubuntu'; font-weight:600;">t</span><span style=" font-family:'Ubuntu';"> в позиции, где вы обычно видите разрешение на выполнение для других:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@hnl data]# ls -ld account/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwxr-sr-t. 2 root account 4096 Apr 30 21:28 account/</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Применение расширенных прав</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Чтобы применить SUID, SGID и sticky bit, вы также можете использовать </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod</span><span style=" font-family:'Ubuntu';">. SUID имеет числовое значение 4, SGID имеет числовое значение 2, а sticky bit имеет числовое значение 1.<br /><br />Если вы хотите применить эти разрешения, вам нужно добавить четырехзначный аргумент в </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod</span><span style=" font-family:'Ubuntu';">, первая цифра которого относится к специальным разрешениям. Следующая строка, например, добавит разрешение SGID на каталог и установит rwx для пользователя и rx для группы и других:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">chmod 2755 /somedir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Это довольно непрактично, если вам нужно посмотреть текущие права доступа, которые установлены, прежде чем работать с </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod </span><span style=" font-family:'Ubuntu';">в абсолютном режиме. (Вы рискуете перезаписать разрешения, если вы этого не сделаете.) Поэтому я рекомендую работать в относительном режиме, если вам нужно применить какое-либо из специальных разрешений:<br /><br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для SUID используйте <span style=" font-weight:600;">chmod u+s</span>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для SGID используйте <span style=" font-weight:600;">chmod g+s</span>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для sticky bit используйте <span style=" font-weight:600;">chmod +t</span>, а затем имя файла или каталога, для которого вы хотите установить разрешения.</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />В таблице обобщено все, что важно знать об управлении специальными разрешениями.<br /><br /></span><img src="image922483811.png" /><span style=" font-family:'Ubuntu';"><br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Пример работы со специальными правами</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />В этом примере вы используете специальные разрешения, чтобы членам группы было проще обмениваться файлами в каталоге общей группы. Вы назначаете ID-бит установленного идентификатора группы, а также sticky bit, и видите, что после их установки добавляются функции, облегчающие совместную работу членов группы.<br /><br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Откройте терминал, в котором вы являетесь пользователем linda. Создать пользователя можно командой <span style=" font-weight:600;">useradd linda</span>, добавить пароль <span style=" font-weight:600;">passwd linda</span>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создайте в корне каталог /data и подкаталог /data/sales командой <span style=" font-weight:600;">mkdir -p /data/sales</span>. Выполните <span style=" font-weight:600;">cd /data/sales</span>, чтобы перейти в каталог sales. Выполните <span style=" font-weight:600;">touch linda1</span> и <span style=" font-weight:600;">touch linda2</span>, чтобы создать два пустых файла, владельцем которых является linda.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">su — lisa</span> для переключения текущего пользователя на пользователя lisa, который также является членом группы sales.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">cd /data/sales</span> и из этого каталога выполните <span style=" font-weight:600;">ls -l</span>. Вы увидите два файла, которые были созданы пользователем linda и принадлежат группе linda. Выполните <span style=" font-weight:600;">rm -f linda*</span>. Это удалит оба файла.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">touch lisa1</span> и <span style=" font-weight:600;">touch lisa2</span>, чтобы создать два файла, которые принадлежат пользователю lisa.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">su -</span> для повышения ваших привилегий до уровня root.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">chmod g+s,o+t /data/sales</span>, чтобы установить бит идентификатора группы (GUID), а также sticky bit в каталоге общей группы.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">su — linda</span>. Затем выполните <span style=" font-weight:600;">touch linda3</span> и <span style=" font-weight:600;">touch linda4</span>. Теперь вы должны увидеть, что два созданных вами файла принадлежат группе sales, которая является владельцем группы каталога /data/sales.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">rm -rf lisa*</span>. Sticky bit предотвращает удаление этих файлов от имени пользователя linda, поскольку вы не являетесь владельцем этих файлов. Обратите внимание, что если пользователь linda является владельцем каталога /data/sales, он в любом случае может удалить эти файлы!</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Управление ACL (setfacl, getfacl) в Linux</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Даже если расширенные права, которые обсуждались выше, добавляют полезную функциональность к тому, как Linux работает с разрешениями, это не позволяет вам предоставлять разрешения более чем одному пользователю или одной группе в одном файле. <br /><br />Списки контроля доступа предлагают эту функцию. Кроме того, они позволяют администраторам устанавливать разрешения по умолчанию сложным способом, при котором установленные разрешения могут различаться в разных каталогах.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Понимание ACL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Хотя подсистема ACL добавляет отличные функциональные возможности вашему серверу, у нее есть один недостаток: не все утилиты поддерживают ее. Следовательно, вы можете потерять настройки ACL при копировании или перемещении файлов, а программное обеспечение для резервного копирования может не выполнить резервное копирование настроек ACL.<br /><br />Утилита tar не поддерживает ACL. Чтобы убедиться, что настройки ACL не будут потеряны при создании резервной копии, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">star </span><span style=" font-family:'Ubuntu';">вместо tar. </span><span style=" font-family:'Ubuntu'; font-weight:600;">star </span><span style=" font-family:'Ubuntu';">работает с теми же параметрами, что и tar; он просто добавляет поддержку настроек ACL.<br /><br />Вы также можете создать резервную копию ACL с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">getfacl</span><span style=" font-family:'Ubuntu';">, которую можно восстановить с помощью команды setfacl. Чтобы создать резервную копию, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">getfacl -R /directory &gt; file.acls</span><span style=" font-family:'Ubuntu';">. Чтобы восстановить настройки из файла резервной копии, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl --restore=file.acl</span><span style=" font-family:'Ubuntu';">.<br /><br />Отсутствие поддержки некоторыми инструментами не должно быть проблемой. Списки ACL часто применяются к каталогам как структурная мера, а не к отдельным файлам.<br />Поэтому их будет не много, а всего лишь несколько, примененных в умных местах файловой системы. Следовательно, восстановить исходные списки ACL, с которыми вы работали, относительно легко, даже если ваше ПО для резервного копирования их не поддерживает.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Подготовка файловой системы для ACL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Перед началом работы с ACL может потребоваться подготовить файловую систему для поддержки ACL. Поскольку метаданные файловой системы необходимо расширять, не всегда есть поддержка по умолчанию для ACL в файловой системе. Если при настройке списков ACL для файловой системы вы получаете сообщение «operation not supported», возможно, в вашей файловой системе отсутствует поддержка ACL. <br /><br />Чтобы это исправить, вам нужно добавить опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">acl mount</span><span style=" font-family:'Ubuntu';"> в файле /etc/fstab, чтобы файловая система была смонтирована с поддержкой ACL по умолчанию.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Изменение и просмотр настроек ACL с помощью setfacl и getfacl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Чтобы установить ACL, вам нужна команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl</span><span style=" font-family:'Ubuntu';">. Чтобы увидеть текущие настройки ACL, вам нужен </span><span style=" font-family:'Ubuntu'; font-weight:600;">getfacl</span><span style=" font-family:'Ubuntu';">. Команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">ls -l</span><span style=" font-family:'Ubuntu';"> не показывает никаких существующих ACL; он просто показывает + после списка разрешений, который указывает, что списки ACL применяются и к файлу. <br /><br />Перед настройкой списков ACL всегда полезно показать текущие настройки ACL с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">getfacl</span><span style=" font-family:'Ubuntu';">. Ниже на примере вы можете увидеть текущие права доступа, как показано с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">ls -ld</span><span style=" font-family:'Ubuntu';">, а также как показано с </span><span style=" font-family:'Ubuntu'; font-weight:600;">getfacl</span><span style=" font-family:'Ubuntu';">. Если вы посмотрите достаточно внимательно, вы увидите, что показанная информация точно такая же.<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@server1 /]# ls -ld /dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">drwxr-xr-x. 2 root root 6 Feb 6 11:28 /dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@server1 /]# getfacl /dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">getfacl: Removing leading '/' from absolute path names</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># file: dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># owner: root</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># group: root</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">user::rwx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">group::r-x</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">other::r-x</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />В результате выполнения команды </span><span style=" font-family:'Ubuntu'; font-weight:600;">getfacl </span><span style=" font-family:'Ubuntu';">ниже видно, что разрешения показаны для трех разных объектов: пользователя, группы и других. Теперь давайте добавим ACL, чтобы дать права на чтение и выполнение и группе sales. Команда для этого </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl -m g:sales:rx /dir</span><span style=" font-family:'Ubuntu';">. В этой команде </span><span style=" font-family:'Ubuntu'; font-weight:600;">-m</span><span style=" font-family:'Ubuntu';"> указывает, что текущие настройки ACL необходимо изменить. После этого </span><span style=" font-family:'Ubuntu'; font-weight:600;">g:sales:rx</span><span style=" font-family:'Ubuntu';"> сообщает команде установить ACL для чтения и выполнения (</span><span style=" font-family:'Ubuntu'; font-weight:600;">rx</span><span style=" font-family:'Ubuntu';">) для группы (</span><span style=" font-family:'Ubuntu'; font-weight:600;">g</span><span style=" font-family:'Ubuntu';">) sales. Ниже вы можете увидеть, как выглядит команда, а также вывод команды getfacl после изменения текущих настроек ACL.<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@server1 /]# setfacl -m g:sales:rx /dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[root@server1 /]# getfacl /dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">getfacl: Removing leading '/' from absolute path names</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># file: dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># owner: root</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"># group: root</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">user::rwx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">group::r-x</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">group:sales:r-x</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">mask::r-x</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">other::r-x</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Теперь, когда вы понимаете, как установить групповой ACL, легко понять ACL для пользователей и других пользователей. Например, команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl -m u:linda:rwx /data</span><span style=" font-family:'Ubuntu';"> дает разрешения пользователю linda в каталоге /data, не делая его владельцем и не изменяя назначение текущего владельца.<br /><br />Команда </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl </span><span style=" font-family:'Ubuntu';">имеет много возможностей и опций. Один вариант особенно важен, параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">-R</span><span style=" font-family:'Ubuntu';">. Если используется, опция делает настройку ACL для всех файлов и подкаталогов, которые в настоящее время существуют в каталоге, где вы устанавливаете ACL. Рекомендуется всегда использовать эту опцию при изменении списков ACL для существующих каталогов.<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Работа с ACL по умолчанию</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Одним из преимуществ использования списков ACL является то, что вы можете давать разрешения нескольким пользователям или группам в каталоге. Еще одним преимуществом является то, что вы можете включить наследование, работая с ACL по умолчанию. <br /><br />Установив ACL по умолчанию, вы определите разрешения, которые будут установлены для всех новых элементов, создаваемых в каталоге. Имейте в виду, что ACL по умолчанию не меняет разрешения для существующих файлов и подкаталогов. Чтобы изменить их, нужно добавить и обычный ACL!<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">Это важно знать.</span><span style=" font-family:'Ubuntu';"> Если вы хотите использовать ACL для настройки доступа нескольких пользователей или групп к одному и тому же каталогу, вы должны установить ACL дважды. Сначала используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl -R -m</span><span style=" font-family:'Ubuntu';">, чтобы изменить ACL для текущих файлов. Затем используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl -m d:</span><span style=" font-family:'Ubuntu';">, чтобы позаботиться обо всех новых элементах, которые также будут созданы.<br /><br />Чтобы установить ACL по умолчанию, вам просто нужно добавить опцию </span><span style=" font-family:'Ubuntu'; font-weight:600;">d </span><span style=" font-family:'Ubuntu';">после опции </span><span style=" font-family:'Ubuntu'; font-weight:600;">-m</span><span style=" font-family:'Ubuntu';"> (порядок имеет значение!). Поэтому используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl -m d:g:sales:rx /data</span><span style=" font-family:'Ubuntu';">, если вы хотите, чтобы группа sales имела доступ на чтение и выполнение всего, что когда-либо будет создано в каталоге /data.<br /><br />При использовании списков ACL по умолчанию также может быть полезно установить ACL для других. Обычно это не имеет особого смысла, потому что вы также можете изменить разрешения для других, используя </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod</span><span style=" font-family:'Ubuntu';">. Однако, что вы не можете сделать с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod</span><span style=" font-family:'Ubuntu';">, это указать права, которые должны быть предоставлены другим пользователям для каждого нового файла, который когда-либо будет создан. Если вы хотите, чтобы другие не получали никаких разрешений на что-либо, созданное в /data, например, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">setfacl -m d:o::- /data</span><span style=" font-family:'Ubuntu';">.<br /><br />ACL и обычные разрешения не всегда хорошо интегрированы. Проблемы могут возникнуть, если вы применили ACL по умолчанию к каталогу, после чего элементы были добавлены в этот каталог, и затем попытаетесь изменить обычные разрешения. Изменения, которые применяются к обычным разрешениям, не будут хорошо отражены в обзоре ACL. Чтобы избежать проблем, сначала установите обычные разрешения, после чего установите ACL по умолчанию (и после этого старайтесь не изменять их снова).<br /><br /></span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:large; font-weight:600;">Пример управления расширенными правами с использованием ACL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />В этом примере вы продолжите работу с каталогами /data/account и /data/sales, которые вы создали ранее. В предыдущих примерах вы гарантировали, что группа sales имеет разрешения на /data/sales, а группа account имеет разрешения на /data/account.<br /><br />Сначала убедитесь, что группа account получает разрешения на чтение в каталоге /data/sales, а группа sales получает разрешения на чтение в каталоге /data/account.<br /><br />Затем вы устанавливаете списки ACL по умолчанию, чтобы убедиться, что для всех новых файлов правильно установлены разрешения для всех новых элементов.<br /><br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Ubuntu';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Откройте терминал.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">setfacl -m g:account:rx /data/sales</span> и <span style=" font-weight:600;">setfacl -m g:sales:rx /data/account</span>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">getfacl</span>, чтобы убедиться, что права доступа были установлены так, как вы хотели.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполните <span style=" font-weight:600;">setfacl -m d:g:account:rwx,g:sales:rx /data/sales</span>, чтобы установить ACL по умолчанию для каталога sales.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Добавьте ACL по умолчанию для каталога /data/account, используя <span style=" font-weight:600;">setfacl -m d:g:sales:rwx,g:account:rx /data/account</span>.</li>
<li style=" font-family:'Ubuntu';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Убедитесь, что настройки ACL действуют, добавив новый файл в /data/sales. Выполните <span style=" font-weight:600;">touch /data/sales/newfile</span> и выполните <span style=" font-weight:600;">getfacl /data/sales/newfile</span> для проверки текущих разрешений.</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Установка прав по умолчанию с помощью umask</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Выше вы узнали, как работать с ACL по умолчанию. Если вы не используете ACL, есть параметр оболочки, который определяет права по умолчанию, которые вы получите: </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask </span><span style=" font-family:'Ubuntu';">(обратная маска). В этом разделе вы узнаете, как изменить разрешения по умолчанию с помощью </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask</span><span style=" font-family:'Ubuntu';">.<br /><br />Вы, наверное, заметили, что при создании нового файла устанавливаются некоторые разрешения по умолчанию. Эти разрешения определяются настройкой </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask</span><span style=" font-family:'Ubuntu';">. Этот параметр оболочки применяется ко всем пользователям при входе в систему. В параметре </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask </span><span style=" font-family:'Ubuntu';">используется числовое значение, которое вычитается из максимальных разрешений, которые могут быть автоматически установлены для файла; максимальная настройка для файлов — 666, а для каталогов — 777.<br /><br />Однако некоторые исключения относятся к этому правилу. Вы можете найти полный обзор настроек </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask </span><span style=" font-family:'Ubuntu';">в таблице внизу.<br /><br />Из цифр, используемых в </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask</span><span style=" font-family:'Ubuntu';">, как и в случае числовых аргументов для команды </span><span style=" font-family:'Ubuntu'; font-weight:600;">chmod</span><span style=" font-family:'Ubuntu';">, первая цифра относится к разрешениям пользователя, вторая цифра относится к разрешениям группы, а последняя относится к разрешениям по умолчанию, установленным для других. Значение </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask </span><span style=" font-family:'Ubuntu';">по умолчанию 022 дает 644 для всех новых файлов и 755 для всех новых каталогов, созданных на вашем сервере.<br /><br />Полный обзор всех числовых значений </span><span style=" font-family:'Ubuntu'; font-weight:600;">umask </span><span style=" font-family:'Ubuntu';">и их результатов в таблице ниже.<br /><br /></span><img src="image492083088.png" /><span style=" font-family:'Ubuntu';"><br /><br />Простой способ увидеть, как работает параметр umask, выглядит следующим образом: начните с разрешений по умолчанию для файла, установленного на 666, и вычтите umask, чтобы получить действующие разрешения. Сделайте то же самое для каталога и его разрешений по умолчанию 777.<br /><br />Есть два способа изменить настройку umask: для всех пользователей и для отдельных пользователей. Если вы хотите установить umask для всех пользователей, вы должны убедиться, что параметр umask учитывается при запуске файлов среды оболочки, как указано в /etc/profile. Правильный подход — создать сценарий оболочки с именем umask.sh в каталоге /etc/profile.d и указать umask, который вы хотите использовать в этом сценарии оболочки. Если в этом файле изменяется umask, он применяется ко всем пользователям после входа на сервер.<br /><br />Альтернативой настройке umask через /etc/profile и связанные файлы, где он применяется ко всем пользователям, входящим в систему, является изменение настроек umask в файле с именем .profile, который создается в домашнем каталоге каждого пользователя.<br /><br />Настройки, примененные в этом файле, применяются только для отдельного пользователя; следовательно, это хороший метод, если вам нужно больше детализации. Мне лично нравится эта функция, чтобы изменить значение umask по умолчанию для пользователя root на 027, тогда как обычные пользователи работают с umask по умолчанию 022.<br /><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Работа с расширенными атрибутами пользователя</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />Это заключительный раздел о правах в Linux.<br /><br />При работе с разрешениями всегда существует связь между объектом пользователя или группы и разрешениями, которые эти объекты пользователя или группы имеют для файла или каталога. Альтернативный метод защиты файлов на сервере Linux — работа с атрибутами.<br />Атрибуты выполняют свою работу независимо от пользователя, который обращается к файлу.<br /><br />Как и в случае с ACL, для атрибутов файла может потребоваться включить параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">mount</span><span style=" font-family:'Ubuntu';">.<br /><br />Это опция </span><span style=" font-family:'Ubuntu'; font-weight:600;">user_xattr</span><span style=" font-family:'Ubuntu';">. Если вы получаете сообщение «operation not supported» при работе с расширенными атрибутами пользователя, обязательно установите параметр </span><span style=" font-family:'Ubuntu'; font-weight:600;">mount </span><span style=" font-family:'Ubuntu';">в файле /etc/fstab.<br /><br />Многие атрибуты задокументированы. Некоторые атрибуты доступны, но еще не реализованы. Не используйте их; они ничего вам не принесут.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">Ниже приведены наиболее полезные атрибуты, которые вы можете применить:</span><span style=" font-family:'Ubuntu';"><br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">A</span><span style=" font-family:'Ubuntu';"> Этот атрибут гарантирует, что время доступа к файлу файла не изменяется.<br />Обычно каждый раз, когда файл открывается, время доступа к файлу должно быть записано в метаданные файла. Это отрицательно влияет на производительность; поэтому для файлов, к которым осуществляется регулярный доступ, атрибут </span><span style=" font-family:'Ubuntu'; font-weight:600;">A</span><span style=" font-family:'Ubuntu';"> можно использовать для отключения этой функции.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">a</span><span style=" font-family:'Ubuntu';"> Этот атрибут позволяет добавлять, но не удалять файл.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">c</span><span style=" font-family:'Ubuntu';"> Если вы используете файловую систему, в которой поддерживается сжатие на уровне тома, этот атрибут файла гарантирует, что файл будет сжат при первом включении механизма сжатия.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">D </span><span style=" font-family:'Ubuntu';">Этот атрибут гарантирует, что изменения в файлах записываются на диск немедленно, а не в кэширование в первую очередь. Это полезный атрибут в важных файлах базы данных, позволяющий убедиться, что они не теряются между файловым кешем и жестким диском.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">d </span><span style=" font-family:'Ubuntu';">Этот атрибут гарантирует, что файл не будет сохранен в резервных копиях, где используется утилита дампа.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">I</span><span style=" font-family:'Ubuntu';"> Этот атрибут включает индексирование для каталога, в котором он включен. Это обеспечивает более быстрый доступ к файлам для примитивных файловых систем, таких как Ext3, которые не используют базу данных B-tree для быстрого доступа к файлам.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">i</span><span style=" font-family:'Ubuntu';"> Этот атрибут делает файл неизменным. Следовательно, в файл нельзя вносить изменения, что полезно для файлов, которые нуждаются в дополнительной защите.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">j</span><span style=" font-family:'Ubuntu';"> Этот атрибут гарантирует, что в файловой системе ext3 файл сначала записывается в журнал, а затем — в блоки данных на жестком диске.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">s</span><span style=" font-family:'Ubuntu';"> Перезаписать блоки, в которых файл был сохранен, на 0 с после удаления файла. Это гарантирует, что восстановление файла невозможно после того, как он был удален.<br /><br /></span><span style=" font-family:'Ubuntu'; font-weight:600;">u</span><span style=" font-family:'Ubuntu';"> Этот атрибут сохраняет информацию об удалении. Это позволяет разрабатывать утилиту, которая работает с этой информацией для спасения удаленных файлов.<br /><br />Если вы хотите применить атрибуты, вы можете использовать команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">chattr</span><span style=" font-family:'Ubuntu';">. Например, используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">chattr +s somefile</span><span style=" font-family:'Ubuntu';">, чтобы применить атрибуты к somefile. Нужно удалить атрибут? Тогда используйте </span><span style=" font-family:'Ubuntu'; font-weight:600;">chattr -s somefile</span><span style=" font-family:'Ubuntu';">, и он будет удален. Чтобы получить обзор всех атрибутов, которые в настоящее время применяются, используйте команду </span><span style=" font-family:'Ubuntu'; font-weight:600;">lsattr</span><span style=" font-family:'Ubuntu';">.<br /><br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu'; font-size:x-large; font-weight:600;">Резюме</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br />В этой статье вы узнали, как работать с разрешениями. Вы прочитали о трех основных разрешениях, расширенных разрешениях и о том, как применять ACL-списки в файловой системе. Вы также узнали, как использовать параметр umask для применения разрешений по умолчанию. В конце этой статьи вы узнали, как использовать расширенные пользователем атрибуты для применения дополнительного уровня безопасности файловой системы.<br /><br />Если вам понравился этот перевод, то прошу написать об этом в комментариях. Будет больше мотивации делать полезные переводы.<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В статье исправил некоторые опечатки и грамматические ошибки. Уменьшил некоторые громоздкие абзацы на более мелкие для удобства восприятия. <br /><br />Вместо «Только кто-то с административными правами на каталог может применять разрешение на выполнение.» исправил на «Только кто-то с правами записи на каталог может применять разрешение на выполнение.», что будет более правильным. <br /><br />За замечания спасибо </span><a href="https://habr.com/ru/users/berez/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">berez</span></a><span style=" font-family:'Ubuntu';">.<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Заменил:<br />Если вы не являетесь владельцем пользователя, оболочка проверит, являетесь ли вы участником группы, которая также называется группой файла.<br /><br />На:<br />Если вы не являетесь владельцем файла, оболочка проверит, являетесь ли вы участником группы, у которой есть разрешения на этот файл. Если вы являетесь участником этой группы, вы получаете доступ к файлу с разрешениями, которые для группы установлены, и оболочка прекратит проверку.<br /><br />Спасибо за замечание </span><a href="https://habr.com/ru/users/cryptopirate/"><span style=" font-family:'Ubuntu'; text-decoration: underline; color:#0000ff;">CryptoPirate</span></a></p></body></html>