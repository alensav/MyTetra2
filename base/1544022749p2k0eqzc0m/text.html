<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Настройка rsnapshot</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />rsnapshot — утилита для создания копий состояния файловых систем на базе rsync. Она упрощает создание периодических копий с локальной и удаленных машин по ssh. Она использует, по возможности, жесткие связи, что позволяет существенно уменьшить объем необходимого дискового пространства. (цитата <a href="http://citkit.ru/package/rsnapshot/"><span style=" text-decoration: underline; color:#0000ff;">отсюда</span></a>)<br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Установка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Устанавливаем rsnapshot:<br /><br /><span style=" font-family:'Courier New,courier';">$ sudo apt-get install rsnapshot</span><br /><br />Если вы используете не debian-подобный дистрибутив, rsnapshot наверняка тоже есть в репозиториях вашего дистрибутива. Для CentOS, при включенных RPMForge это делается, например, так:<br /><br /><span style=" font-family:'Courier New,courier';"># yum install rsnapshot</span><br /><br />Теперь нам нужно создать директорию, где мы собираемся хранить наши «снимки»:<br /><br /><span style=" font-family:'Courier New,courier';">$ sudo mkdir /var/snapshots</span><br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Настройка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Теперь можно перейти к настройке, собственно, rsnapshot:<br /><br /><span style=" font-family:'Courier New,courier';">$ sudo nano /etc/rsnapshot.conf</span><br /><br />Вместо nano вы можете использовать любой другой редактор, например vi, или gedit, если работаете в GNOME.<br />Настроить нужно следующие параметры:<br /><br /><span style=" font-family:'Courier New,courier';">snapshot_root - директория, в которую вы хотите сохранять &quot;снимки&quot;.<br /><br />interval xxx yy - ххх - название интервала(например hourly, daily), yy - количество снимков для каждого. Например:<br />interval hourly 6<br />interval daily 7</span><br /><br />Означает, что мы хотим хранить 6 ежечасных копий и 7 ежемесячных. Если уже доступно указанное количество копий, rsnapshot будет заменить старую более новой.<br /><br />Расскомментируйте cmd_cp. cmd_ssh расскоментируйте и измените на<br /><br /><span style=" font-family:'Courier New,courier';">cmd_ssh /usr/bin/ssh</span><br /><br />Настройка бэкапа осуществляется командой backup &lt;откуда&gt; &lt;куда&gt;:<br /><br /><span style=" font-family:'Courier New,courier';">#Добавляем папку /etc/ с локальной машины в папку localhost/<br />backup /etc/ local/<br />#Добавляем папку /var/svn с удаленной машины в папку remotehost/<br />backup backup@remotehost.ru:/var/svn/ remotehost/<br /></span><br /><br /><span style=" font-weight:600;">Помните, что в конфигурационном файле недопустимы пробелы — используйте только табы.</span><br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Пробный запуск</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Запустим rsnapshot:<br /><span style=" font-family:'Courier New,courier';">$ rsnapshot hourly</span><br /><br />Второй параметр означает интервал, который мы задали в конфигурационном файле.<br />Команда может выполняется продолжительное время. После выполнения, смотрим, что она создала:<br /><span style=" font-family:'Courier New,courier';">$ ls -l /var/snapshots</span><br /><br />Пока что в директории должен быть один каталог: hourly.0. При следующем запуске rsnapshot будет создавать каталоги hourly.1, hourly.2 и т.д., пока не упрется в максимум, указанный нами в конфигурационном файле.<br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Настройка cron</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />В Ubuntu автоматически создается файл /etc/cron.d/rsnapshot со следующим содержанием:<br /><span style=" font-family:'Courier New,courier';">0 */4 * * * root /usr/bin/rsnapshot hourly<br />30 3 * * * root /usr/bin/rsnapshot daily<br />0 3 * * 1 root /usr/bin/rsnapshot weekly<br />30 2 1 * * root /usr/bin/rsnapshot monthly</span><br /><br />Вот и все. Теперь у вас 6 раз в сутки должен автоматически создаваться снимок данных с вашего удаленного сервера. Данные в сохранности, да еще и географически распределены.<br /><br />Кстати, 6 раз в сутки не означает, что размер будет в 6 раз больше, чем если копировать всего 1 раз в сутки. Если в промежутки между копированиями не будет изменений в файлах, то общий размер копий почти не изменится.<br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Дополнительная информация</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />С помощью параметра backup_script можно также настроить резервное копирование баз данных MySQL, да и вообще всего, чего угодно. Я не описывал сей процесс, т.к. у меня он не используется и ничего конкретного сказать не могу.<br />Подробнее можно почитать в гугле. По запросу rsnapshot вылезает куча релевантных ссылок, правда на английском языке.</p></body></html>