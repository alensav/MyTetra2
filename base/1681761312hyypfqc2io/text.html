<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Arduino с сетевым модулем и mqtt в openHAB</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Добавить комментарий</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Настало время попробовать хотя бы тестово подключить Arduino с сетевым модулем на базе w5100 к openHAB по протоколу mqtt. Установку openHAB на raspberry pi мы рассматривали в этой статье, поэтому будем считать, что openHAB уже установлен и mqtt брокер mosquitto тоже, а вот что с этим делать дальше — не понятно. Будем разбираться. Для Arduino потребуется библиотека pubsubclient. Именно из неё мы возмём пример. Для подключения к брокеру mosquitto в моём случае (и это правильный путь) необходима авторизация, логин и пароль для которой мы так же указывали при установке по статье «openHAB 2 и mqtt брокер на raspberry pi«. Для прошивки Arduino буду использовать стандартную Arduino IDE. Как установить библиотеку в Arduino ide, здесь рассказывать не стану, это довольно просто и можно с лёгкостью найти не одну статью в интернете по этой теме.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Для теста нам нужны сделующие компоненты:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Arduino UNO или MEGA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Ethernet shield W5100</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Светодиод с резистором</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">В результате будем моргать светодиодом, поключенным к пину №3 Arduino (подключен в gnd и в pin №3).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Сразу сообщу, что все необходимые файлы можно будет скачать одним архивом по ссылке в конце статьи, советую сразу это сделать и использовать их, чтобы не было проблем с синтаксисом и пробелами, так как конфигурационные файлы yaml очень чувствительны к пробелам, если их расставить не верно, то просто ничего не заработает.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Соединяем Ethernet шилд с Arduino, сетевой кабель вставляем в разъём шилда, а саму Arduino подключаем по usb к компьютеру.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Снчала проверим работу mosquitto. Версия mosquitto у меня такая</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">sudo service mosquitto status</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">● mosquitto.service - Mosquitto MQTT v3.1/v3.1.1 Broker</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Loaded: loaded (/lib/systemd/system/mosquitto.service; enabled; vendor preset: enabled)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Active: active (running) since Wed 2020-04-15 07:21:49 BST; 2 weeks 5 days ago</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Docs: man:mosquitto.conf(5)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">man:mosquitto(8)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Main PID: 396 (mosquitto)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Tasks: 1 (limit: 2200)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Memory: 2.8M</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">CGroup: /system.slice/mosquitto.service</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">└─396 /usr/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">ВАЖНО! Пока абстрагруемся от openHAB и переключимся на Mosquitto . Вся суть заключается в том, что на брокере под названием Mosquitto создаются темы, в которые публикуется информация(можно провести аналогию с форумами в интернете), клиент брокера может читать эту информацию, подписавшись на неё и публиковать в нужную тему новые данные. Давайте проверим это на деле.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Логинимся на наш raspberry pi (у меня он имеет ip 10.36.1.18) по ssh в 2 консоли. В одной консоли пишем:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Подпишемся на тему test в брокере с ip адресом 10.36.1.18 с использованием логина pi и пароля, который мы указывали при настройке mosquitto в прошлой статье:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">mosquitto_sub -h 10.36.1.18 -p 1883 -u pi -P &quot;пароль_от_mosquitto_без_ковычек&quot; -t test</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Номер порта я не менял, стандартный порт — 1883.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">А теперь в другой консоли опубликуем данные в тему test брокера следующей командой:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">mosquitto_pub -h 10.36.1.18 -p 1883 -u pi -P &quot;пароль_от_mosquitto_без_ковычек&quot; -t test -m &quot;test passed successfully&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">После публикации на первой консоли мы увидим пришедшее сообщение «test passed successfully».</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Давайте попробуем опубликовать сообщение в брокере в подтему test/t1:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">mosquitto_pub -h 10.36.1.18 -p 1883 -u pi -P &quot;пароль_от_mosquitto_без_ковычек&quot; -t test/t1 -m &quot;test t1 passed successfully&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">На первой консоли, где мы подписались на тему, мы ничего не увидели. Почему?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Потому, что мы подписались только на конкретную тему test, без подтем. Чтобы было видно все подтемы в пределах темы test, то в первой консоли надо было подписаться не так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">mosquitto_sub -h 10.36.1.18 -p 1883 -u pi -P &quot;пароль_от_mosquitto_без_ковычек&quot; -t test</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">а вот так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">mosquitto_sub -h 10.36.1.18 -p 1883 -u pi -P &quot;пароль_от_mosquitto_без_ковычек&quot; -t test/#</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Теперь, опубликовав во второй консоли сообщение в тему любым из способов:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">mosquitto_pub -h 10.36.1.18 -p 1883 -u pi -P &quot;пароль_от_mosquitto_без_ковычек&quot; -t test -m &quot;test passed successfully&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">mosquitto_pub -h 10.36.1.18 -p 1883 -u pi -P &quot;пароль_от_mosquitto_без_ковычек&quot; -t test/t1 -m &quot;test t1 passed successfully&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">В первой консоли получим отправленные сообщения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">В этой статье я буду делать подписку на топик /r1 для управления светодиодом на arduino через OpenHAB.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">На этому микро ликбез по топикам в mosquitto закончим.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Возвращаемся в OpenHAB, версию я использую следующую:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">sudo systemctl status openhab2.service</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">● openhab2.service - openHAB 2 - empowering the smart home</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Loaded: loaded (/usr/lib/systemd/system/openhab2.service; enabled; vendor preset: enabled)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Active: active (running) since Wed 2020-04-15 07:21:49 BST; 2 weeks 5 days ago</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Docs: https://www.openhab.org/docs/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">https://community.openhab.org</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Main PID: 397 (java)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Tasks: 101 (limit: 2200)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Memory: 250.1M</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">CGroup: /system.slice/openhab2.service</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">└─397 /usr/bin/java -Dopenhab.home=/usr/share/openhab2 -Dopenhab.conf=/etc/openhab2 -Dope</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">Переходим на веб-интерфейс не так давно установленного openHAB сервера http://10.36.1.18:8080/start/index в раздел «home builder», чтобы создать основу нашей квартиры/дома. Я буду считать, что у нас стандартная 2 комнатная квартира и в ней только один mqtt клиент (Arduino UNO и Ethernet shield W5100).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">— В разделе «Please select your language» выбираем «Ressian».</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">— В разделе «Home Setup Name» пишем название нашей квартиры, я вписал «first apartment»</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">— В разделе «Floors» указываем какая площадь у нас есть. Я указал «первый этаж».</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">— В разделе «Rooms» укзываем из списка имеющиеся комнаты. Можно указывать свои названия комнат, но только на английском языке. Потом в итоговых конфигурационных файлах home.items и home.sitemap надо будет исправить на ваше название комнаты.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">— В разделе «Objects» выбираем имеющееся у нас умное оборудование/датчики. Везде должно быть освещение, а остальное указывайте на своё успотрение по текущему состоянию и по перспективе появления новых устройств. Я укажу свет и датчик температуры в комнате отдыха.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt; color:#444444;">После выбора всех позиций эти данные можно сохранить как в текстовый файл так и во внутреннюю базу, я буду сохранять в текстовый файл. То, что мы будем сохранять в текстовые файлы видно в правой части home builder, нас интересуют items и sitemap.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2008904404.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">--------------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image237794672.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">---------------------------------------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Страничку, где мы формировали каркас квартиры не закрываем, а переходим в консоль на сервер с установленным openHAB. Конфигурационные файлы лежат в директории /etc/openhab2/, в директории /etc/openhab2/items/ создаём home.items :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sudo nano /etc/openhab2/items/home.items</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Вставляем туда всё, что у нас получилось во вкладке «items» на веб интерфейсе в разделе «home builder». У меня это:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Home «first apartment» [«Building»]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group GF «Первый этаж» (Home) [«GroundFloor»]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Bathroom «Ванная комната» (Home) [«Bathroom»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Kitchen «Кухня» (Home) [«Kitchen»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Hallway «Прихожая» (Home) [«Corridor»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Balcony «Балкон» (Home) [«Outdoor»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Office «Офис» (Home) [«Room»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Lounge «Комната отдыха» (Home) [«Room»]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Switch Lounge_Light «Освещение» (Lounge, gLight) [«Lighting», «Switchable»] {channel=»»}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Number Lounge_Temperature «Температура» (Lounge, gTemperature) [«Temperature»] {channel=»»}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group:Switch:OR(ON, OFF) gLight «Освещение» (Home) [«Lighting», «Switchable»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group:Number:AVG gTemperature «Температура» (Home) [«Temperature»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Проверьте, чтобы в конце файла осталась пустая строка. Сохраняем и закрываем файл home.items</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">В директории /etc/openhab2/sitemaps создаём home.sitemap</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sudo nano /etc/openhab2/sitemaps/home.sitemap</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">и так же вставляем туда всё содержимое из вкладки «sitemap» на веб интерфейсе в разделе «home builder». У меня это:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sitemap first_apartment label=»first apartment» {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Frame {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Bathroom</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Kitchen</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Hallway</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Balcony</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Office</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Lounge</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Frame {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Text label=»Освещение» icon=»light» {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Default item=Lounge_Light label=»Комната отдыха»</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Text label=»Температура» icon=»temperature» {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Default item=Lounge_Temperature label=»Комната отдыха»</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Тоже проверяем, чтобы была пустая строка в конце, сохраняем, закрываем.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Переходим на первую страницу http://10.36.1.18:8080/ , в раздел «BasicUI» выбираем «Home» и увидим нашу сформированную квартиру.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">-------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image181405431.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Теперь надо добавить наш светодиод на 3 пине arduino. В директории /etc/openhab2/items/ на сервере создаём файл ard.items :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sudo nano /etc/openhab2/items/ard.items</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">вписываем туда:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Switch R1 &quot;светодиод 3 пин&quot; {channel=&quot;mqtt:topic:test:R1&quot;}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Не забываем про дополнительную пустую строку в конце файла, созраняем, закрываем.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Открываем снова /etc/openhab2/sitemaps/home.sitemap и вписываем туда:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Frame label=&quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Switch item=R1 label=&quot;светодиод 3 пин&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Сохраняем, закрываем.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Переходим на веб-интерфейс openHAB http://10.36.1.18:8080/start/index в раздел «Paper UI», нажимаем «Inbox» и «+», чтобы добавить Binding.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Выбираем «MQTT Binding» — «ADD MANUALLY» — «Generic MQTT Thing».</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Имя указываю «Arduino MQTT Thing»</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Bridge Selection выбираем наш MQTTBrokerPi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1843849082.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Синей галкой, подтверждаем введённое. У нас уже получается список из двух «Things».</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image435861328.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Сохраняем.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image950605820.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">--------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Переходим в консоль и редактируем /etc/openhab2/items/ard.items, там меняем строку channel=»mqtt:topic:test:R1″ на ту, что сгенерировалась для канала R1 автоматически при создании «Channels»(см. предыдущее изображение). Строка должна стать похожа что что-то подобное:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Switch R1 «светодиод 3 пин» {channel=»mqtt:topic:f3de6be2:R1″}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Сохраняем, закрываем и теперь в веб-интерфейсе в синем кружке должнен появиться ещё и белый:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1055801093.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">-------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Посетив страницу basic ui мы увидим:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image14956571.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">--------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">кнопка управления светодиодом расположилась отдельно внизу и никак не связана с освещением в жилой комнате. При желании исправить это можно отредактировав /etc/openhab2/sitemaps/home.sitemap и /etc/openhab2/items/home.items</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Редактируем /etc/openhab2/items/home.items до следующего состояния:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Home «first apartment» [«Building»]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group GF «Первый этаж» (Home) [«GroundFloor»]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Bathroom «Ванная комната» (Home) [«Bathroom»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Kitchen «Кухня» (Home) [«Kitchen»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Hallway «Прихожая» (Home) [«Corridor»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Balcony «Балкон» (Home) [«Outdoor»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Office «Офис» (Home) [«Room»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group Lounge «Комната отдыха» (Home) [«Room»]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Switch R1 «Освещение» (Lounge, gLight) [«Lighting», «Switchable»] {channel=»»}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Number Lounge_Temperature «Температура» (Lounge, gTemperature) [«Temperature»] {channel=»»}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group:Switch:OR(ON, OFF) gLight «Освещение» (Home) [«Lighting», «Switchable»]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group:Number:AVG gTemperature «Температура» (Home) [«Temperature»]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">а файл /etc/openhab2/sitemaps/home.sitemap редактируем до следующего состояния:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">sitemap first_apartment label=»first apartment» {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Frame {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Bathroom</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Kitchen</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Hallway</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Balcony</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Office</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Group item=Lounge</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Frame {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Text label=»Освещение» icon=»light» {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Switch item=R1 label=»Комната отдыха»</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Text label=»Температура» icon=»temperature» {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Default item=Lounge_Temperature label=»Комната отдыха»</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">в итоге выключатель освещения в «комнате отдыха» не будет выбиваться из интерфейса, а включить/выключить его можно будет перейдя в раздел «Комната отдыха».</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Переходим к коду arduino. Во первых Вам нужна будет библиотека PubSubClient (она есть в архиве по ссылке в конце статьи) для Arduino, а вот код скетча, который надо загрузить в Arduino можно скачать здесь и здесь.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Измениле логин, пароль и ip адреса на ваши.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Загружаем скетч в Arduino и можем переходить на http://10.36.1.18:8080/ в раздел «basic ui» — «home» — «Комната отдыха» и пощёлкать кнопкой «Освещение», при этом светодиод будет то включаться то выключаться.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">БОНУС.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Чтобы не гадать, и быть уверенным до начала работы с arduino, что у Вас всё пока что работает как надо, советую использовать программу MQTT.fx. Щёлкая кнопку в интерфейсе OpenHAB можно следить публикуется ли что-то в топик брокера. Для этого сначала устанавливаем прогрпамму, потом переходим в её настройки через нажатие на шестерёнку:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1745251763.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">--------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Далее возле уже известной Вам шестерёнки, нажимаем кнопку «Connect». Если соединение прошло успешно, то права появится зелный круг. Переходим во вкладку «Subscribe» и подписываемся на топик /r1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Ubuntu';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image406090404.png" /><span style=" font-family:'Ubuntu';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">А вот теперь можно понажимать кнопку включения света в openHAB и если в программе вижно поступающие данные, то переходить к Arduino.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">Схема всего, что мы с вами сегодня сделали, конечно не очень проста, но понимая, что можно подключить arduino к openHAB и зная о невероятном количество датчиков возможных для подключения к arduino, понимаешь, что возможности этой системы очень и очень большие.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">И вот та самая ссылка на архив со всеми необходимыми файлами, для реализации этого эксперимента.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Ubuntu';">----------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-1646"></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">З</span><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">апись опубликована</span><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;"> </span><a href="http://mediaunix.com/arduino-c-setevym-modulem-i-mqtt-v-openhab/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">06.05.2020</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;"> в рубрике </span><a href="http://mediaunix.com/category/arduino-2/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">arduino</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/it/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">it</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/po/opensource/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">open source</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/po/os/unix/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">unix</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/po/net/%d0%b8%d0%bd%d1%82%d1%80%d0%b0%d0%bd%d0%b5%d1%82/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">интранет</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/po/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">ПО</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/po/net/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">сеть</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/smarthouse/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">умный дом</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/category/po/utilities/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">утилиты</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;"> с метками </span><a href="http://mediaunix.com/tag/arduino/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">Arduino</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/mqtt/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">mqtt</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/raspberry-pi/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">Raspberry Pi</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/raspbian/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">Raspbian</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/server/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">server</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/ssh/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">ssh</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/web/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">web</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/%d1%81%d0%b5%d1%82%d1%8c/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">сеть</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">, </span><a href="http://mediaunix.com/tag/%d1%83%d0%bc%d0%bd%d1%8b%d0%b9-%d0%b4%d0%be%d0%bc/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:13px; text-decoration: underline; color:#757575; background-color:#ffffff;">умный дом</span></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#757575; background-color:#ffffff;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:large; font-weight:600; color:#444444;">Навигация по записям</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://mediaunix.com/arduino-i-upravlenie-svetom-ver-2-0/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; text-decoration: underline; color:#21759b; background-color:#ffffff;">← Arduino и управление светом. Версия 2.0</span></a><a href="http://mediaunix.com/ustanovka-home-assistant-na-raspberry-pi/"><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; text-decoration: underline; color:#21759b; background-color:#ffffff;">Установка Home Assistant на raspberry pi →</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="comments"></a><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#444444;"><br /></span><span style=" font-family:'Open Sans,Helvetica,Arial,sans-serif'; font-size:14px; color:#444444;"> </span></p></body></html>