<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:8px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.3%; background-color:#ffffff;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">Программирование устройств на основе модуля ESP32</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:696; color:#929ca5;">26 мин155K</span></p>
<p style=" margin-top:8px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/companies/epam_systems/articles/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#6f7577; background-color:#000000;">Блог компании EPAM</span></a><a href="https://habr.com/ru/hubs/c/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#6f7577; background-color:#000000;">C*</span></a><a href="https://habr.com/ru/hubs/controllers/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#6f7577; background-color:#000000;">Программирование микроконтроллеров*</span></a><a href="https://habr.com/ru/hubs/arduino/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#6f7577; background-color:#000000;">Разработка под Arduino*</span></a><a href="https://habr.com/ru/hubs/internet_of_things/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#6f7577; background-color:#000000;">Интернет вещей</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><a name="post-content-body"></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">М</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">икроконтроллер — это интегральная схема, способная выполнять программы. Сегодня на рынке представлено множество таких моделей от самых разных производителей. Цены на эти устройства продолжают падать. Однокристальные чипы находят широкое применение в самых разнообразных сферах: от измерительных приборов до изделий развлечений и всевозможной домашней техники. В отличие от персональных компьютеров микроконтроллер сочетает в одном кристалле функции процессора и периферийных устройств, содержит оперативную память и постоянное запоминающее устройство в для хранения кода и данных, однако обладает значительно мешьшими вычислительными ресурсами. ESP32 — это микроконтроллер, разработанный компанией Espressif Systems. ESP32 представляет собой систему на кристалле с интегрированным Wi-Fi и Bluetooth контроллерами. В серии ESP32 используется ядро </span><a href="https://en.wikipedia.org/wiki/Tensilica"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Tensilica Xtensa LX6</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Платы с ESP32 обладают хорошей вычислительной способностью, развитой периферией и при этом весьма популярны ввиду низкой цены в диапазоне 7$ – 14$: </span><a href="https://aliexpress.ru/af/esp32%25252dboard.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Aliexpress</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, </span><a href="https://www.amazon.com/ESP32/s?k=ESP32"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Amazon</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br /></span><span style=" color:#333333;"> <br /><br />Данная статья не претендует на роль исчерпывающего руководства, скорее представляет собой сборник источников материала и рекомендаций. Я затрону вопросы, с которыми мне пришлось столкнуться при выборе программных средств для разработки проекта, а также некоторые кейсы практического применения модулей ESP32. В следующей статье я покажу наглядный пример использования ESP32 в качестве котроллера управления для небольшой двухколесной мобильной платформы. А в этом материале мы рассмотрим:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Выбор среды разработки;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Настройку рабочего окружения, компиляцию и загрузку проекта ESP-IDF;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Обработку сигналов ввода/вывода GPIO;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Широтно-импульсную модуляцию с использованием модуля MCPWM;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Аппартный счетчик PCNT;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Подключение к WI-Fi и MQTT.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Обзор модуля ESP32-WROOM-32E</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;"><br />Согласно datasheet модуль содержит:<br /><br />MCU<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">ESP32-D0WD-V3 embedded, Xtensa dual-core 32-bit LX6 microprocessor, up to 240 MHz</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">448 KB ROM for booting and core functions</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">520 KB SRAM for data and instructions</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">16 KB SRAM in RTC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;"><br />Wi-Fi<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">802.11b/g/n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Bit rate: 802.11n up to 150 Mbps</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">A-MPDU and A-MSDU aggregation</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">0.4 µs guard interval support</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Center frequency range of operating channel: 2412 ~ 2484 MHz</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;"><br />Bluetooth<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Bluetooth V4.2 BR/EDR and Bluetooth LE specification</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Class-1, class-2 and class-3 transmitter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">AFH</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">CVSD and SBC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;"><br />Hardware<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Interfaces: SD card, UART, SPI, SDIO, I 2 C, LED PWM, Motor PWM, I 2 S, IR, pulse counter, GPIO, capacitive touch sensor, ADC, DAC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">40 MHz crystal oscillator</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">4 MB SPI flash</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Operating voltage/Power supply: 3.0 ~ 3.6 V</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Operating temperature range: –40 ~ 85 °C</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Dimensions: See Table 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;"><br />Certification<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Bluetooth certification: BQB</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">RF certification: FCC/CE-RED/SRRC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;">Green certification: REACH/RoHS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" color:#333333;"><br /> </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; font-style:italic; color:#333333;">Функциональная блок-диаграмма</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Подробнее с особенностями микроконтроллера можно ознакомиться в </span><a href="https://ru.wikipedia.org/wiki/ESP32"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Википедии</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />В основе модуля лежит микросхема ESP32-D0WD-V3 *. Встроенный чип разработан с учетом возможности масштабирования и адаптации. Центральный процессор содержит два ядра, которыми можно управлять индивидуально, а тактовая частота ЦП регулируется от 80 МГц до 240 МГц. Чип также имеет сопроцессор с низким энергопотреблением, который можно использовать вместо ЦП для экономии энергии при выполнении задач, не требующих больших вычислительных мощностей, таких как мониторинг состояния пинов. ESP32 объединяет богатый набор периферийных устройств, начиная от емкостных сенсорных датчиков, датчиков Холла, интерфейса SD-карты, Ethernet, высокоскоростного SPI, UART, I²S и I²C.<br /><br />Техническая документация представлена на </span><a href="https://www.espressif.com/en/support/documents/technical-documents"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">официальном ресурсе</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Информацию про распиновку модуля ESP-WROOM-32 можно легко найти на просторах сети. Например </span><a href="https://randomnerdtutorials.com/esp32-pinout-reference-gpios/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">Выбор среды разработки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">Arduino IDE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Микроконтроллеры семейства AVR, а затем и платформа Arduino появились задолго до ESP32. Одной из ключевых особенностей Arduino является относительно низкий порог вхождения, позволяющий практически любому человеку создать решение быстро и легко. Платформа сделала важный вклад в open source hardware сообщество и позволила приобщиться к нему огромному числу радиолюбителей. Среду разработки Arduino IDE можно свободно скачать с </span><a href="https://www.arduino.cc/en/Main/Software"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">официального сайта </span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Не смотря на очевидные ограничения по сравнению с профессиональной средой разработки, Arduino IDE покрывает 90% из того, что требуется достичь для любительских проектов. В сети также имеется достаточное количество статей на тему установки и настройки Arduino IDE для программирования модулей ESP32, например: </span><a href="https://github.com/espressif/arduino-esp32"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Arduino core for the ESP32</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, </span><a href="https://habr.com/ru/post/404685/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">habr.com</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, </span><a href="https://voltiq.ru/instruction-installing-esp32-board-in-arduino-ide-for-windows/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">voltiq.ru</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> и </span><a href="https://randomnerdtutorials.com/installing-the-esp32-board-in-arduino-ide-windows-instructions/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">randomnerdtutorials.com</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Программируя ESP32 в среде Arduino необходимо учитывать распиновку, как указано на странице </span><a href="https://github.com/espressif/arduino-esp32"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">arduino-esp32</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br /></span><img src="image1851567043.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Распиновка модуля ESP32</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Основное преимущество данного подхода разработки заключается в быстром вхождении и легкости создания проектов, с помощью тех же принципов и многих библиотек, что и для Arduino. А также использование многих библиотек, как и для Arduino. Еще одной полезной особенностью является возможность совмещать библиотеки и принципы разработки Arduino с оригинальным ESP-IDF фреймворком.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">PlatformIO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Как сказано на официальном </span><a href="https://platformio.org/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">ресурсе платформы</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">: «Cross-platform PlatformIO IDE and Unified Debugger · Static Code Analyzer and Remote Unit Testing. Multi-platform and Multi-architecture Build System · Firmware File Explorer and Memory Inspection» Иными словами PlatformIO – это экосистема для разработки встроенных устройств, поддерживающая множество платформ, включая Arduino и ESP32. В качестве IDE используется Visual Studio Code или Atom. Установка и настройка достаточно простая – после установки редактора кода выбираем PlatformIO из списка плагинов и устанавливаем. В сети есть много материалов на данную тему, начиная от официального источника </span><a href="https://platformio.org/platformio-ide"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> и </span><a href="https://docs.platformio.org/en/latest/tutorials/espressif32/arduino_debugging_unit_testing.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, и продолжая статьями с подробными иллюстрациями </span><a href="https://alexgyver.ru/platformio-%D0%B7%D0%B0%D0%BC%D0%B5%D0%BD%D0%B0-arduino-ide/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь </span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">и </span><a href="https://laboratorynotices.wordpress.com/2019/06/13/%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-vsc-%D0%B8-platformio-%D0%B4%D0%BB%D1%8F-esp32/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />PlatformIO по сравнению с Arduino IDE обладает всеми качествами современной среды разработки: организация проектов, поддержка плагинов, автодополнение кода и многое другое.<br /><br />Особенностью разработки на PlatformIO является унифицированная </span><a href="https://docs.platformio.org/en/latest/core/quickstart.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">структура </span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">проекта для всех платформ<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">project_dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">├── lib</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">│   └── README</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">├── platformio.ini</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">└── src</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    └── main.cpp</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Каждый проект PlatformIO содержит файл конфигурации с именем </span><a href="https://docs.platformio.org/en/latest/projectconf/index.html#projectconf"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">platformio.ini</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> в корневом каталоге проекта. platformio.ini имеет разделы (каждый из которых обозначен [заголовком]) и пары: «ключ / значение» внутри разделов. Строки, начинающиеся с символа точка с зяпятой «;» игнорируются и могут использоваться для комментариев. Параметры с несколькими значениями можно указать двумя способами:<br /><br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">разделение значения с помощью «,» (запятая + пробел);</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">многострочный формат, где каждая новая строка начинается как минимум с двух пробелов.</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Следующей фичей разработки для ESP32 является возможность выбора фреймворка: Arduino или ESP-IDF. Выбирая Arduino в качестве фреймворка мы получаем ранее описанные преимущества разработки.<br /><br /></span><img src="image481001895.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />В состав PlatformIO входит удобный инструментарий билда, загрузки и отладки проектов<br /><br /></span><img src="image163505949.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">Espressif IoT Development framework</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Для ESP32 компания Espressif разработала фреймворк под названием IoT Development Framework, известный как «ESP-IDF». Его можно найти на </span><a href="https://github.com/espressif/esp-idf"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Github</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Проект содержит очень хорошую документацию и снабжен примерами, которые можно брать за базу. Установка и настройка среды окружения хорошо описана в разделе </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/index.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Get Started</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Имеется несколько вариантов установки и работы с фреймворком.<br /><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Клонирование проекта из репозитория и ручная установка утилит.</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Клонирование проекта из Github<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">mkdir -p ~/esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">cd</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> ~/esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">git </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">clone</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> --recursive https://github.com/espressif/esp-idf.git</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Для Windows установка утилит разработки возможна с помощью </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/windows-setup.html#get-started-windows-tools-installer"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">инсталлятора </span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">или с помощью скриптов для командной строки:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">cd</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> %userprofile%\esp\esp-idf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">install.bat</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Для PowerShell<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">cd</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> ~/esp/esp-idf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">./install.ps1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Для Linux и macOS<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">cd</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> ~/esp/esp-idf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">./install.sh</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Следующим шагом является </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">настройка переменных окружений среды</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Если установка инструментов разработки была выполнена на Windows с помощью инсталлятора, то ярлык на командную консоль добавляется в меню и на рабочий стол, после чего можно открывать командную оболочку и работать с проектами. Альтернативный спрособ запуска командной оболочки для Windows:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">%userprofile%\esp\esp-idf\export.bat</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />или Windows PowerShell:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">.</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#c82829;">$HOME</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">/esp/esp-idf/export.ps1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Linux и macOS:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">. </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#c82829;">$HOME</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">/esp/esp-idf/export.sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Следует обратить внимание на пробел между точкой и путем к скрипту<br /><br />Далее в руководстве рекомендуется добавить алиас на скрипт настройки переменных окружения в пользовательский профиль, если работа производится в системе Linux или macOS. Для этого необходимо скопировать и вставить следующую команду в профиль своей оболочки (.profile, .bashrc, .zprofile, и т.д.):<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">alias</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> get_idf=</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">'. $HOME/esp/esp-idf/export.sh'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Вызывая команду get_idf в консоль экспортируются необходимы переменные окружения. В моем случае также необходимо было прописать алиас на запуск виртуального окружения python.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">alias</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> esp_va=’</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">source</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#c82829;">$HOME</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">/.espressif/python_env/idf4.2_py2.7_env/bin/activate’</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />А также добавить esp_va в следующий алиас<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">alias</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> get_idf=</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">'esp_ve &amp;&amp; . $HOME/esp/esp-idf/export.sh'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Для создание нового проекта</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> с нуля можно склонировать исходники с github.com или скопировать из каталога с примерами esp-idf/examples/get-started/hello_world/.<br /><br />Информация о структуре проекта, утилитах компиляции, загрузки, настройки и так далее находится </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/build-system.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Проект представляет собой каталог со следующей структурой:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">- myProject/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">             - CMakeLists.txt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">             - sdkconfig</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">             - components/ - component1/ - CMakeLists.txt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                                         - Kconfig</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                                         - src1.c</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                           - component2/ - CMakeLists.txt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                                         - Kconfig</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                                         - src1.c</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                                         - include/ - component2.h</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">             - main/       - CMakeLists.txt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                           - src1.c</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">                           - src2.c</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">             - build/</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Конфигурация проекта</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> содержится в файле sdkconfig в корневом каталоге. Для изменения настроек необходимо вызвать команду idf.py menuconfig (или idf.py.exe menuconfig в Windows).<br /><br />В одном проекте обычно создаются два приложения — «project app» (основной исполняемый файл, то есть ваша кастомная прошивка) и «bootloader app» (программа начального загрузчика проекта).<br />«components» — это модульные части автономного кода, которые компилируются в статические библиотеки (файлы .a) и связаны с приложением. Некоторые из них предоставляются самой ESP-IDF, другие могут быть получены из иных источников.<br /><br />Утилита командной строки idf.py предоставляет интерфейс для простого управления сборками проекта. Ее расположение в Windows — %userprofile%\.espressif\tools\idf-exe\1.0.1\idf.py.exe. Она управляет следующими инструментами:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">CMake — настраивает проект для сборки</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Консольный сборщик проекта: Ninja, либо GNU Make)</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">esptool.py — для прошивки модулей.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Каждый проект имеет один файл CMakeLists.txt верхнего уровня, который содержит параметры сборки для всего проекта. Минимальная конфигурация файла включает следующие необходимые строчки:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">cmake_minimum_required</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(VERSION </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">3.5</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">include</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">($ENV{IDF_PATH}/tools/cmake/</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">project</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">.cmake)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">project</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(myProject)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Проект ESP-IDF можно рассматривать как совокупность компонентов, в котором каталог main является главным комонентом, запускающим код. Поэтому в данной директории также содержится файл CMakeLists.txt. Чаще всего его структура подобна:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">idf_component_register(SRCS </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;main.c&quot;</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> INCLUDE_DIRS </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;.&quot;</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />В ней указывается, что исходный файл main.c необходимо зарегистрировать для компонента, а файлы заголовков содержатся в текущем каталоге. При необходимости можно переименовать каталог main, установив EXTRA_COMPONENT_DIRS в прокте CMakeLists.txt. Подробно можно ознакомиться </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/build-system.html#cmake-minimal-component-cmakelists"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Помимо этого в каталоге находится исходный main.с (имя может быть любое) файл с точкой входа – функцией void app_main(void).<br /><br />Кастомые компоненты создатся в каталоге components. Подробнее процесс описан в разделе </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/build-system.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Component Requirements</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Подключение модуля ESP32 к компьютеру в большинстве случаев производится с помощью USB-кабеля подобно платам Arduino за счет имеющегося бутлоадера. Подробнее процесс описан </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/establish-serial-connection.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Едиственное, что необходимо – это наличие драйвера конвертора USB to UART в системе, который можно скачать по ссылкам из приведенного источника. После установки драйвера, необходимо определить номер COM-порта в системе для загрузки скомпилированной прошивки в модуль.<br /><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Конфигурирование проекта.</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />В большинстве случаев подходят настройки по умолчанию. Но для вызова консольного интерфейса меню необходимо перейти в каталог проекта и в командной строке набрать:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">idf.py menuconfig</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br /></span><img src="image718013438.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; font-style:italic; color:#333333;">Меню с конфигурационными настройками</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />После вызова этой команды файл sdkconfig будет создан, если его ранее не было или он заново сконфигурирован. В более ранних обучающих материалах можно встретить команды make menuconfig, которые являются устаревшими.<br /><br />Добавление кастомных настроек в файл sdkconfig возможно вручную, например:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#8e908c;">#</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#8e908c;"># WiFi Settings кастомное меню </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#8e908c;">#</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">CONFIG_ESP_HOST_NAME=</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;имя точки&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">CONFIG_ESP_WIFI_SSID=</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;название точки доступа&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">CONFIG_ESP_WIFI_PASSWORD=</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;пароль&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Но предпочтительным является способ с помощью дополнительного конфигурационного файла Kconfig.projbuild, который необходимо располагать в каталоге с компонентом. Содержимое файла может быть следующим:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#8e908c;"># put here your custom config value</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">menu </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;Example Configuration&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">config ESP_WIFI_SSID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    string </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;Keenetic&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    default </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;myssid&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">help</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    SSID (network name) </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">for</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> the example to connect to.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">config ESP_WIFI_PASSWORD</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    string </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;password&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    default </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;mypassword&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">help</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    WiFi password (WPA or WPA2) </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">for</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> the example to use.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">endmenu</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />После вызова команды idf.py menuconfig в файле sdkconfig автоматически добавиться дополнительный раздел. Вызов команды idf.py menuconfig возможен и в проекте PlatformIO, однако, нужно учитывать факт отличия структуры проекта PlatformIO от классического ESP-IDF, из-за чего файл sdkconfig может заново сгенерироваться и потерять кастомные настройки. Тут возможны вышеупомянутые варианты: правка файла руками, временное переименование каталога src в main или настройка файла CMakeLists.txt<br /><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Компиляция и загрузка проекта.</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Для билда проекта необходимо набрать команду<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">idf.py build</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Эта команда скомпилирует приложение и все компоненты ESP-IDF, а затем сгенерирует загрузчик, таблицу разделов и двоичные файлы приложения.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ idf.py build</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">Running cmake </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">in</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> directory /path/to/hello_world/build</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">Executing </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;cmake -G Ninja --warn-uninitialized /path/to/hello_world&quot;</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">Warn about uninitialized values.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">-- Found Git: /usr/bin/git (found version </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;2.17.0&quot;</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">-- Building empty aws_iot component due to configuration</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">-- Component names: ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">-- Component paths: ...</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">... (more lines of build system output)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[527/527] Generating hello-world.bin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">esptool.py v2.3.1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">Project build complete. To flash, run this </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">command</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">../../../components/esptool_py/esptool/esptool.py -p (PORT) -b 921600 write_flash --flash_mode dio --flash_size detect --flash_freq 40m 0x10000 build/hello-world.bin  build 0x1000 build/bootloader/bootloader.bin 0x8000 build/partition_table/partition-table.bin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">or run </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">'idf.py -p PORT flash'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Следует учитывать, что первоначальный процесс компиляции даже простого проекта занимает время, так как, в отличие от Arduino фреймворка компилируются многие дополнительные модули ESP-IDF. Дальнейшее изменение исходников приводит только к компиляции этих же файлов. Исключение составляет изменение конфигурации.<br /><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Для загрузки скомпилированных двоичных файлов</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> (bootloader.bin, partition-table.bin и hello-world.bin) на плату ESP32 необходимо запустить команду<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">idf.py -p PORT [-b BAUD] flash</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />где PORT мы заменяем на тот, что нам нужно (COM1, /dev/ttyUSB1), а также опционально можем изменить скорость загрузки, указав необходимое значение для BAUD<br /><br />Для отслеживания загруженной программы можно использовать любую утилиту мониторинга com-порта, такие как </span><a href="http://der-hammer.info/pages/terminal.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">HTerm</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, </span><a href="https://freeware.the-meiers.org/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">CoolTerm</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, или использовать утилиту мониторинга </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/tools/idf-monitor.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">IDF Monitor</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, для запуска которой необходимо ввести команду<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">idf.py -p PORT monitor</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">ESP-IDF Eclipse Plugin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Документация по установке и настройке плагина находится </span><a href="https://github.com/espressif/idf-eclipse-plugin"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br /></span><img src="image1523330683.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Предустановки для использования:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Java 11 and above; (хотя и на java 8 работает, возможно из-за этого глюки);</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Python 3.5 and above;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Eclipse 2020-06 CDT;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Git;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">ESP-IDF 4.0 and above;</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Плагин довольно неплохо интегрирован в среду разработки и, автоматизирует львиную долю функционала. Но, к сожалению, не без ложки дегтя. В Eclipse версиях позже 2019-09 в ESP-IDF проектах в Windows до сих пор присутствует </span><a href="https://github.com/espressif/idf-eclipse-plugin/issues/43#issuecomment-630616042"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">баг</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> с индексированием исходных файлов.<br /><br /></span><img src="image2094876456.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Кроме этого наблюдаются и другие сбои, когда проект просто не билдится по непонятным причинам. Помогает только закрытие проекта и перезагрузка Eclipse.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">ESP-IDF Visual Studio Code Extension</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />И последний, на мой взгляд, самый интересный вариант – это официальный </span><a href="https://github.com/espressif/vscode-esp-idf-extension"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">плагин</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> для Visual Studio Code.<br />Как и PlatformIO, он легко устанавливается из раздела расширений. Установка и настройка ESP-IDF фреймворка в этом расширении представлена в качестве меню onboarding, о чем также говорится в описании. Загрузка и установка всех компонентов происходит автоматически в процессе прохождения этапов меню. Можно привести все скрины процесса, но они интуитивно понятны, и практически не требуют пояснения. В пользу PlatformIO можно отметить более удобный инструментарий билда, загрузки и мониторинга проекта. В отличие от этого ESP-IDF плагин управляется с помощью меню команд, которое можно вызвать с помощью клавиши F1 или сочетания клавиш, описанных в мануале.<br /><br /></span><img src="image116499391.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; font-style:italic; color:#333333;">Первоначальная настройка плагина</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Преимущество использования плагина состоит в том, что соблюдается классическая структура проекта, нет необходимости как-то еще «шаманить» с настройками (в PlatformIO такая необходимость возникает). Есть один нюанс: если мы хотим открыть ранее созданный проект в Visual studio code с ESP-IDF плагином, то нам всего лишь необходимо скопировать в корень с проектом каталог .vscode, который можно получить, сгенерировав хотя бы один раз шаблонный проект с помощью ESP-IDF плагина.<br /><br /></span><img src="image766439718.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; font-style:italic; color:#333333;">Меню команд</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">FreeRTOS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Согласно Википедии </span><a href="https://ru.wikipedia.org/wiki/FreeRTOS"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">FreeRTOS </span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">— многозадачная операционная система реального времени (ОСРВ) для встраиваемых систем. FreeRTOS обеспечивает мультизадачность за счет совместного использования процессорного времени всеми потоками или, в терминологии ОС, задачами (task). На мой взгляд, наиболее полное и внятное руководство по FreeRTOS на русском находится </span><a href="http://microsin.net/programming/arm/freertos-part1.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. На языке оригинала мануалы можно изучить из </span><a href="https://www.freertos.org/Documentation/RTOS_book.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">официального источника</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Я лишь приведу рисунок состояния задач.<br /><br /></span><img src="image693612788.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />FreeRTOS была портирована на широкий спектр аппаратных платформ, включая процессоры Xtensa, используемые в ESP32. Подробнее можно ознакомиться в </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/freertos.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">документации</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">GPIOs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/gpio.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">GPIO </span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">или универсальный ввод/вывод – это возможность дискретного управления пина сигналом «1» или «0».<br /><br />Как видно из самого названия, такие пины имеют два рабочих режима: ввод или вывод. В первом случае мы читаем значение, во втором – записываем. Еще одним важным фактором при работе с GPIO является уровень напряжения. ESP32 — это устройство с напряжением 3,3 В. Поэтому следует быть осторожным при работе с другими устройствами, которые имеют напряжение 5 В и выше. Также важно понимать, что максимальный ток, которым можно нагружать вывод GPIO, составляет 12 мА. Для использования функций GPIO, предоставляемых ESP-IDF, нам необходимо подключить заголовок driver/gpio.h. Затем можно вызвать gpio_pad_select_gpio(), чтобы указать функцию данного вывода. На ESP32 доступно 34 различных GPIO. Они обозначены как:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">GPIO_NUM_0 – GPIO_NUM_19</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">GPIO_NUM_21 – GPIO_NUM_23</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">GPIO_NUM_25 – GPIO_NUM_27</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">GPIO_NUM_32 – GPIO_NUM_39</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Следующая нумерация не входит в число пинов 20, 24, 28, 29, 30 и 31.<br />Таблицу с распиновкой можно посмотреть </span><a href="https://randomnerdtutorials.com/esp32-pinout-reference-gpios/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Следует обратить внимание, что пины GPIO_NUM_34 — GPIO_NUM_39 используют только режим ввода. Их нельзя использовать для вывода сигнала. Кроме того, контакты 6, 7, 8, 9, 10 и 11 используются для взаимодействия с внешней флеш-картой по SPI. Не рекомендуется их использовать для других целей, но если очень хочется, то можно. Тип данных gpio_num_t — это перечисление со значениями, соответствующими номерам пинов. Рекомендуется использовать эти значения, а не числа. Направление пина устанавливается с помощью функции gpio_set_direction (). Например, для установки пина как выход:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_set_direction</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(GPIO_NUM_17, GPIO_MODE_OUTPUT);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Для установки пина в качестве входа:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_set_direction</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(GPIO_NUM_17, GPIO_MODE_INPUT);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Если мы настроили GPIO как выход, то можем установить его значение равным 1 или 0, вызывая gpio_set_level ().<br /><br />Следующий пример переключает GPIO раз в секунду:<br /><br /></span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'monospace,monospace'; font-size:9pt; color:#333333; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_pad_select_gpio</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(GPIO_NUM_17);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_set_direction</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(GPIO_NUM_17, GPIO_MODE_OUTPUT);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">while</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">1</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">printf</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;Off\n&quot;</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_set_level</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(GPIO_NUM_17, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">0</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">vTaskDelay</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">1000</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> / portTICK_RATE_MS);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">printf</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#718c00;">&quot;On\n&quot;</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_set_level</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(GPIO_NUM_17, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">1</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">vTaskDelay</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">1000</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> / portTICK_RATE_MS);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />В качестве альтернативы настройке всех атрибутов отдельных пинов мы можем установить свойства одного или нескольких контактов с помощью вызова функции gpio_config (). Она принимает в качестве входных данных структуру gpio_config_t и устанавливает направление, pull up, pull down и настройки прерывания для всех выводов, представленных в битовой маске.<br />Например:<br /><br /></span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'monospace,monospace'; font-size:9pt; color:#333333; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">gpio_config_t</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> gpioConfig;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">gpioConfig.pin_bit_mask = (</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">1</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> &lt;&lt; </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">16</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">) | (</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">1</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> &lt;&lt; </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">17</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">gpioConfig.mode = GPIO_MODE_OUTPUT;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">gpioConfig.pull_up_en = GPIO_PULLUP_DISABLE;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">gpioConfig.pull_down_en = GPIO_PULLDOWN_ENABLE;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">gpioConfig.intr_type = GPIO_INTR_DISABLE;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_config</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">(&amp;gpioConfig);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">Pull up и pull down настройки</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Обычно считается, что входной пин GPIO имеет сигнал высокого или низкого уровня. Это означает, что он подключен к источнику питания или к земле. Однако, если пин не подключен ни к чему, то он находится в «плавающем» (floating) состоянии. Часто необходимо установить начальный уровень неподключенного пина как высокий или низкий. В таком случае производится аппаратная (подключение c помощью резисторов) или программная подтяжка вывода соответственно к +V – pull up или к 0 – pull down. В ESP32 SDK мы можем определить GPIO как pull up или pull down с помощью функции gpio_set_pull_mode (). Эта функция принимает в качестве входных данных номер контакта, который мы хотим установить, и режим подтяжки, связанный с этим контактом.<br />Например:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">gpio_set_pull_mode</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> (</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">21</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">, GPIO_PULLUP_ONLY);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#333333;">GPIO обработка прерывания</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Чтобы обнаружить изменение входного сигнала на пине, мы можем периодически опрашивать его состояние, однако, это не лучшее решение по ряду причин. Во-первых, мы должны циклически делать проверку, тратя процессорное время. Во-вторых, в момент опроса состояние пина может быть уже не актуальное за счет задержки и есть риск пропустить входные сигналы. Решением этих проблем является прерывание. Прерывание похоже на дверной звонок: без него нам придется периодически проверять, есть ли кто-нибудь у двери. В исходном коде мы можем определить функцию обратного вызова прерывания, которая будет вызываться, когда вывод изменяет значение своего сигнала. Мы также можем определить, что является причиной вызова обработчика, установив следующие параметры:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Disable – не вызывать прерывание при изменении сигнала;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">PosEdge — вызов обработчика прерывания при изменении с низкого на высокий;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">NegEdge — вызов обработчика прерывания при изменении с высокого на низкий;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">AnyEdge — вызов обработчика прерывания либо при изменении с низкого на высокий, либо при изменении с высокого на низкий;</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><img src="image2140548840.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Обработчик прерывания может быть отмечен для загрузки в ОЗУ во время компиляции. По умолчанию сгенерированный код находится во флэш-памяти. Если предварительно пометить его как IRAM_ATTR, он будет готов к немедленному выполнению из оперативной памяти.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%; background-color:#f7f7f7;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">void</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> IRAM_ATTR </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#4271ae;">my_gpio_isr_handle</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;">(</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; font-weight:696; color:#8959a8;">void</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#f5871f;"> *arg)</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"> {...}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span><img src="image873060048.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Кто работал с микроконтроллерами, знает, что обработка входных сигналов от кнопок сопровождается дребезгом контактов. Что может интерпретироваться как серия переходов, и следовательно, серия событий обработчика прерывания. Для этого мы должны внести в код обработку дребезга контактов. Для этого нам надо считать исходное событие, дождаться пока вибрации не утихнут, а затем выполнить повторную выборку входного состояния.<br /><br /></span><img src="image1088849136.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Следующий пример демонстрирует обработку прерывания входных сигналов. Настоятельно рекомендую ознакомится с управлением очередями во FreeRTOS для дальнейшего понимания кода, если вы еще с этим не знакомы. В примере показаны две задачи:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">test1_task, которая разблокируется при наступлении события прерывания при активации сигнала на пине 25. В консоль единократно выводится сообщение «Registered a click»;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">test2_task периодически опрашивается, и при активации сигнала на пине 26 каждые 100 мсек в консоль выводится сообщение «GPIO 26 is high!».</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Выше также установлен программный таймер xTimer. Он не является обязательным для данного случая, скорее служит примером асинхронной задержки.<br /><br />Антидребезг производится с помощью функции </span><a href="https://github.com/nkolban/esp32-snippets/tree/master/c-utils"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">timeval_durationBeforeNow</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, которая проверяет, длится ли нажатие более 100 мсек. Есть и другие программные шаблоны против дребезга, но смысл примерно тот же. В составе ESP-IDF также имеется </span><a href="https://github.com/espressif/esp-idf/blob/8bc19ba893e5544d571a753d82b44a84799b94b1/examples/peripherals/gpio/main/gpio_example_main.c"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">пример</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> работы GPIO.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa;">Обработка входных сигналов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">PCNT (Pulse Counter)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Модуль </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/pcnt.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">PCNT</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> (счетчик импульсов) предназначен для подсчета количества нарастающих и/или спадающих фронтов входного сигнала. Каждый блок модуля имеет 16-битный регистр со знаком и два канала, которые можно настроить для увеличения или уменьшения значения счетчика. Каждый канал имеет входной сигнал, который фиксирует изменение сигнала, а также вход управления, который можно использовать для включения или отключения счета. Входы имеют дополнительные фильтры, которые можно использовать для устранения нежелательных выбросов сигнала.<br /><br />Счетчик PCNT имеет восемь независимых счетных единиц (units), пронумерованных от 0 до 7. В API они указаны с помощью pcnt_unit_t. Каждый модуль имеет два независимых канала, пронумерованных 0 и 1 и указанных с помощью pcnt_channel_t.<br /><br />Конфигурация предоставляется отдельно для каждого канала устройства с помощью pcnt_config_t и охватывает:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Номер юнита и номер канала, к которому относится эта конфигурация;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Номера GPIO импульсного входа и входа стробирующего импульса;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Две пары параметров: pcnt_ctrl_mode_t и pcnt_count_mode_t для определения того, как счетчик реагирует в зависимости от состояния управляющего сигнала и того, как выполняется подсчет положительного/отрицательного фронта импульсов;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Два предельных значения (минимальное/максимальное), которые используются для установления точек наблюдения и запуска прерываний, когда счетчик импульсов достигает некого предела.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Затем настройка конкретного канала выполняется путем вызова функции pcnt_unit_config() с указанной выше конфигурационной структурой pcnt_config_t в качестве входного параметра.<br />Чтобы отключить импульс или управляющий вход в конфигурации, нужно указать PCNT_PIN_NOT_USED вместо номера GPIO.<br /><br />После выполнения настройки с помощью pcnt_unit_config() счетчик сразу же начинает работать. Накопленное значение счетчика можно проверить, вызвав pcnt_get_counter_value().<br /><br />Следующие функции позволяют управлять работой счетчика: pcnt_counter_pause(), pcnt_counter_resume() и pcnt_counter_clear().<br /><br />Также возможно динамически изменять ранее установленные режимы счетчика с помощью pcnt_unit_config(), вызывая pcnt_set_mode().<br /><br />При желании контакт импульсного входа и контакт входа управления можно изменить на лету с помощью pcnt_set_pin().<br /><br />Модуль PCNT имеет фильтры на каждом из импульсных и управляющих входов, добавляя возможность игнорировать короткие выбросы в сигналах. Длина игнорируемых импульсов предоставляется в тактовых циклах APB_CLK с помощью вызова pcnt_set_filter_value(). Текущие настройки фильтра можно проверить с помощью pcnt_get_filter_value(). Цикл APB_CLK работает на частоте 80 МГц.<br /><br />Фильтр запускается/приостанавливается вызовом pcnt_filter_enable()/pcnt_filter_disable().<br />Следующие события, определенные в pcnt_evt_type_t, могут вызвать прерывание. Событие происходит, когда счетчик импульсов достигает определенных значений:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Минимальные или максимальные значения счетчика: counter_l_lim или counter_h_lim, указанные в pcnt_config_t;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Достижение уставки 0 или уставки 1, что устанавливаются с помощью функции pcnt_set_event_value ().</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Количество импульсов = 0</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Чтобы зарегистрировать, включить или отключить прерывание для указанных выше событий, необходимо вызвать pcnt_isr_register(), pcnt_intr_enable() и pcnt_intr_disable(). Чтобы включить или отключить события при достижении пороговых значений, также потребуется вызвать функции pcnt_event_enable() и pcnt_event_disable().<br /><br />Чтобы проверить, какие пороговые значения установлены на данный момент, нужно использовать функцию pcnt_get_event_value().<br /><br />Пример из ESP-IDF представлен </span><a href="https://github.com/espressif/esp-idf/tree/8bc19ba/examples/peripherals/pcnt"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Я использовал счетчик PCNT для вычисления скорости вращения колеса. Для этого необходимо считать количество импульсов на оборот, после чего обнулять счетчик.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa;">Пример кода</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">Широтно-импульсная модуляция (ШИМ) с использованием модуля MCPWM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Информация о модуле представлена </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/mcpwm.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br />В сети имеется много статей на тему </span><a href="http://mypractic.ru/urok-37-shirotno-impulsnaya-modulyaciya-v-arduino.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">ШИМ</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">, особенно если искать применительно к Arduino.<br />Википедия дает короткое и емкое определение: «Широтно-импульсная модуляция (ШИМ, англ. pulse-width modulation (PWM)) — процесс управления мощностью методом пульсирующего включения и выключения прибора». Принцип регулирования с помощью ШИМ – изменение ширины импульсов при постоянной амплитуде и частоте сигнала.<br /><br /></span><img src="image557442760.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Частота ШИМ Arduino 488,28 Гц., разрешение — 8 разрядов (0…255), и имеется возможность использования шести аппаратных выводов: 3, 5, 6, 9, 10, 11. Однако, используя настройки регистров микроконтроллера AVR, можно добиться и других значений частоты ШИМ.<br /><br />Микроконтроллер ESP32 имеет в своем арсенале отдельный модуль MCPWM, а точнее два модуля, каждый из которых имеет три пары ШИМ выводов:<br /><br /></span><img src="image1030117036.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Далее в документации выходы отдельного блока помечены как PWMxA / PWMxB.<br />Более подробная блок-схема блока MCPWM представлена ниже. Каждая пара A/B может синхронизироваться любым из трех таймеров: Timer 0, 1 и 2. Один и тот же таймер может использоваться для синхронизации более чем одной пары выходов ШИМ. Каждый блок также может собирать входные данные (например, сигналы синхронизации), обнаруживать сигналы тревог (например, перегрузка по току или перенапряжение двигателя), а также получать обратную связь с помощью сигналов захвата (например, на положение ротора).<br /><br /></span><img src="image467113266.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Объем конфигурации зависит от типа двигателя и, в частности, от того, сколько выходов и входов требуется, и какой будет последовательность сигналов для управления двигателем.<br /><br />В нашем случае опишем простую конфигурацию для управления щеточным двигателем постоянного тока, который использует только некоторые из доступных ресурсов MCPWM. Пример схемы показан ниже. Он включает в себя H-мост для переключения поляризации напряжения, подаваемого на двигатель (M), и обеспечения достаточного тока для его управления.<br /><br /></span><img src="image349964837.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />Конфигурация включает следующие шаги:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Выбор блока MPWn, который будет использоваться для привода двигателя. На плате ESP32 доступны два модуля из перечисленных в mcpwm_unit_t.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Инициализация двух GPIO в качестве выходных сигналов в выбранном модуле путем вызова mcpwm_gpio_init (). Два выходных сигнала обычно используются для управления двигателем вправо или влево. Все доступные параметры сигналов перечислены в mcpwm_io_signals_t. Чтобы установить более одного вывода за раз, нужно использовать функцию mcpwm_set_pin () вместе с mcpwm_pin_config_t.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Выбор таймера. В устройстве доступны три таймера. Таймеры перечислены в mcpwm_timer_t.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Установка частоты таймера и начальной загрузки в структуре mcpwm_config_t.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Вызов mcpwm_init () с указанными выше параметрами.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Существуют такие способы управления ШИМ:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Мы можем установить высокое или низкое значение для конкретного сигнала с помощью функции mcpwm_set_signal_high () или mcpwm_set_signal_low (). Это заставит двигатель вращаться с максимальной скоростью или остановиться. В зависимости от выбранного выхода A или B двигатель будет вращаться вправо или влево.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Другой вариант — подать на выходы сигнал ШИМ, вызвав mcpwm_start () или mcpwm_stop (). Скорость двигателя будет пропорциональна режиму ШИМ.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Чтобы изменить режим ШИМ, необходимо вызвать mcpwm_set_duty () и указать значение режима в процентах. При желании можно вызвать mcpwm_set_duty_in_us (), чтобы устанавливать значение в микросекундах. Проверить текущее установленное значение можно с помощью вызова mcpwm_get_duty (). Фазу сигнала ШИМ можно изменить, вызвав mcpwm_set_duty_type (). Коэффициент заполнения устанавливается индивидуально для каждого выхода A и B с помощью mcpwm_generator_t. Значение коэффициента заполнения относится к длительности высокого или низкого выходного сигнала. Это настраивается при вызове mcpwm_init (), как описано выше, и выборе одной из опций в mcpwm_duty_type_t.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Пример кода для коллекторного двигателя находится </span><a href="https://github.com/espressif/esp-idf/tree/8bc19ba/examples/peripherals/mcpwm/mcpwm_brushed_dc_control"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /><br />В своем проекте я практически использовал код из примера, немного подкорректировав его, и добавил управление вторым двигателем. Для независимого управления ШИМ-каналами необходимо каждый из них настроить отдельным таймером, например MCPWM_TIMER_0 и CPWM_TIMER_1:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa;">Пример кода</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">Подключение к WI-Fi и работа с MQTT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Тема протокола Wi-FI достаточно обширная. Для описания протокола понадобится серия отдельных статей. В официальном руководстве можно ознакомиться с разделом </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/wifi.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Wi-Fi driver</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Описание программного API находится </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/network/esp_wifi.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Примеры кода можно посмотреть </span><a href="https://github.com/espressif/esp-idf/tree/8bc19ba/examples/wifi"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Библиотеки Wi-Fi обеспечивают поддержку для настройки и мониторинга сетевых функций ESP32 Wi-Fi. Доступны такие конфигурации:<br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Режим станции (также известный как режим STA или режим клиента Wi-Fi). ESP32 подключается к точке</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;"> доступа;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Режим AP (он же режим Soft-AP или режим точки доступа). Станции подключаются к ESP32.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Комбинированный режим AP-STA (ESP32 одновременно является точкой доступа и станцией,</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;"> подключенной к другой точке доступа);</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Различные режимы безопасности для вышеперечисленных (WPA, WPA2, WEP и т. д.);</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Поиск точек доступа (активное и пассивное сканирование);</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style="-qt-paragraph-type:empty; margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><br /></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:medium;">Смешанный режим для мониторинга пакетов Wi-Fi IEEE802.11.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">MQTT протокол</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"><br />Ознакомиться с темой можно </span><a href="https://mqtt.org/getting-started/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;"> или </span><a href="https://www.youtube.com/watch?v=fYoGubQFz5c"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">. Руководство ESP-IDF с примерами находится </span><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/protocols/mqtt.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">здесь</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#333333;">.<br /><br />Для настройки MQTT в коде сначала необходимо подключиться к сети Wi-Fi. После чего установить подключение к брокеру. Обработка сообщения производится в коллбеке, в качестве параметра которого выступает esp_mqtt_event_handle_t event. Если тип события равен MQTT_EVENT_DATA, значит можно парсить топик и данные. Можно настроить различное поведение в результате успешного подключения, отключения и подписки на топики.<br /></span></p></body></html>